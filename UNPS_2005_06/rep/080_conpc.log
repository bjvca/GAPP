----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/080_conpc.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:06

. set more off

. 
. 
. ***************************************************************************
. * 080_conpc.do          (start)
. *
. * Creates a file with per capita nominal consumption divided between food
. * and non-food categories based on the calorie definition of food
. * rather than the COICOP (INE) definition of food. ready for 
. * temporal deflation when necessary
. **************************************************************************** 
. 
. /*
> This file uses:
>         work/hhdata.dta
>         work/consump_nom.dta
>       
> This file creates:
>         work/conpc.dta
> */
. 
. 
. 
. ***************************************************************************
. * Food expenditure
. **************************************************************************** 
. *use "$path/in/cons_cod.dta" 
. use "$path/work/cons_cod.dta" 

.             *sort product 
.             *merge product using "$path/work/food_cat.dta" 
.             *tab _m 
.             *drop _m 
.             keep if food_cat==1 
(3977 observations deleted)

.             collapse (sum) cod_hh_nom, by(hhid) 

.             rename cod_hh_nom food_hh_nom 

.                 sort hhid 

.             keep hhid food_hh_nom 

.             tempfile foodexp 

. save `foodexp' 
file /tmp/St02564.000001 saved

. 
. ***************************************************************************
. * Food expenditure merged with all expenditure
. **************************************************************************** 
. use "$path/work/cons_cod.dta" 

. *use "$path/in/cons_cod.dta" 
. *use "$path/in/cons_cat.dta" 
. sum 

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42120    2.35e+09    1.17e+09   1.01e+09   4.19e+09
     product |     42975    193.7532    225.9257        100        999
    food_cat |     42120    1.074122    .2619717          1          2
    prod_cat |     42975    1.072647     .259559          1          2
    descript |     42975    112.7149    45.82533          1        172
-------------+--------------------------------------------------------
       untcd |     38654    42.16236    29.89049          1        143
   quantityd |     38998    .5255736     .974978          0   57.14286
      valuez |     38998    254.6912    460.8533          0   39285.71
      untdes |     37290    40.64728    29.24059          1        143
     qkg_uca |     36999     2.23029    5.213349       .001      186.2
-------------+--------------------------------------------------------
    quantity |     36287    .9825775    2.842624          0      135.2
  cod_hh_nom |     42975    430.3994    1512.109          0   72488.63

. collapse (sum) cod_hh_nom, by(hhid) 

. *gen cons_pc_nom = cons_hh_nom/hhsize 
. rename cod_hh_nom cons_hh_nom 

. *keep  hhid cons_pc_nom cons_hh_nom  
. *keep hhid cod_hh_nom 
. *use "$path/in/cons_cod.dta" 
. *use "$path/in/consump_nom.dta" 
. *use "$path/work/consump_nom.dta" 
. *            keep  hhid cons_hh_nom  
.             display _N 
3123

.             keep  hhid cons_hh_nom  

.             sort hhid 

.             merge hhid using "$path/work/hhdata.dta" 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          2 |          1        0.03        0.06
          3 |      3,122       99.94      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.             drop _m 

. gen cons_pc_nom = cons_hh_nom/hhsize 
(2 missing values generated)

.             sort hhid 

.             merge hhid using `foodexp' 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        0.13        0.13
          3 |      3,120       99.87      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                 drop if _merge==2 
(0 observations deleted)

.             replace food_hh_nom=0 if _merge==1 & food_hh_nom==. 
(4 real changes made)

.             drop _m 

.                 gen food_pc_nom=food_hh_nom/hhsize 
(1 missing value generated)

.                 gen nf_hh_nom=cons_hh_nom-food_hh_nom 
(1 missing value generated)

.             gen nf_pc_nom=nf_hh_nom/hhsize 
(2 missing values generated)

.  
.             keep hhid cons_hh_nom food_pc_nom nf_pc_nom cons_pc_nom survquar spdomain news r
> eg_tpi rural hhweight hhsize 

.             lab var food_pc_nom "nominal food consumption per capita" 

.             lab var nf_pc_nom "nominal non-food consumption per capita" 

. keep hhid cons_hh_nom cons_pc_nom food_pc_nom nf_pc_nom 

.             sort hhid 

. 
. * MAH   sum  codebook hhid 
. save "$path/work/conpc.dta", replace 
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/conpc.dta saved

. 
. 
. ***************************************************************************
. * 080_conpc.do          (end)
. **************************************************************************** 
. 
. 
. log close 
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/080_conpc.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:06
----------------------------------------------------------------------------------------------
