----------------------------------------------------------------------------------------------
      name:  log_000_boom
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/rep/000_boom.log
  log type:  text
 opened on:  10 Mar 2014, 14:46:59

. 
. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. display ""


. display "Generel information:"
Generel information:

. display "   UGANDA NATIONAL PANEL SURVEY 2005/06"
   UGANDA NATIONAL PANEL SURVEY 2005/06

. display "   Poverty rate estimation"
   Poverty rate estimation

. display "   Methodology: Iterative procedure and revealed preferences tests"
   Methodology: Iterative procedure and revealed preferences tests

. display ""


. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. 
. 
. **************************************************************************

. * 000_boom.do(start)

. *

. * Reminders:

. *1) Check very top of this file to make sure you are on the right path! 

. *2) GAMS 22.5 must be placed onto the path. See 190_revpref13_m1.bat.

. *   Typically this needs to be edited.

. *   3) In case of implementing a new survey the user must make necessary

. *      changes in 010_initial.do, 020_hhdata.do and 030_rawdata.do.

. *

. * Process:

. * - The do-file prefix indicates first time a do-file is called

. *

. * KS, 2003

. * CA, 2009-2010

. * MAH, Apr. 2012

. **************************************************************************

. 
. clear all

. set more off

. set mem 700m

. 
. noisily display "Start time: " "$S_TIME"
Start time: 14:47:00

. 
. 
. 
. **************************************************************************

. * Macros. Region definitions. Demographic definitions.

. **************************************************************************

. do "$path/new/final_tableA1-A5-Haruna-2005_06.do"

. **     PROGRAMME:    preparing_household data_UNPS_2005-2006 for Uganda_tables_A1_to_A5     
>  
. **     AUTHOR:       HARUNA SEKABIRA
. **     OBJECTIVE:    Create standard tables A1 to A5 for UNPS 2011/2012
. **     DATA IN:      GSEC1.dta
. **                                       GSEC2.dta
. **                                       GSEC3.dta
. **                   GSEC15B.dta, etc.
. **     DATA OUT:     hhdata.dta (table A1)
. **                                       indata.dta (table A2)
. **                                       calperg.dta (table A3)
. **                   cons_cod_trans.dta (table A4)
. **                   cons_cod.dta (table A5), 
. **     NOTES:           the files in the in folder here have been copied from the World Bank
>  Website (http://go.worldbank.org/VX1NA9WGC0) and original zipped folder put in the "in" fol
> der
. clear

. set logtype text

. capture log close

. set more off

. if c(os)=="Unix" {
. global path "/home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/"
. }

. else{
. global path "C:\Users\Haruna\Desktop\GAPP\UNPS_2005_06"
. }

. 
. 
. * ====================Table A1==========================: Household Characteristics and inte
> rview details
. use "$path/in/GSEC1.dta" 

. ***------- Primary Sampling Unit
. * The primary sampling unit for the 2012 is the comm, using codes as of 2005/6 UNHS and is t
> he enumeration area.
. codebook comm 

----------------------------------------------------------------------------------------------
comm                                                                        EA Code in 2005/06
----------------------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10130002,41530009]          units:  1
         unique values:  322                      missing .:  0/3123

                  mean:   2.4e+07
              std. dev:   1.2e+07

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.1e+07   2.1e+07   3.1e+07   4.1e+07

.         /* There are 321 unique values, the UNHS 10/11 report mentions 322, located in C:\Us
> ers\Haruna\Desktop\GAPP\UNHS_2011\GAPP3\working-files */
. rename comm psu

. label variable psu "Primary Sampling Unit"

. ***------Interview date
. ** the interview date was in three propotions, the day, month and year and all these had bee
> n entered separately. However, this infromation is 
. ** replicated below in the survey quarters and months better thus might be a repeat to do it
>  here.
. ***------- Interview Quarter
. * For the Mozambique Data, instead of using the regular quarter definition for their "surqua
> r" variable they defined the quarters
. * relative to the time period covered by the survey: the survey ran from Sept 2008 to August
>  2009 so they defined the quarters
. * as follows: Sept-Nov 08, Dec08-Feb09, Mar-May 08 and June-Aug 08.
. * I will use the same framework
. *the one below corresponds to this: "tab month year,m" in other versions
. tab h1bq2b h1bq2c, m 

  Month of |   Year of interview
 interview |      2005       2006 |     Total
-----------+----------------------+----------
         5 |       323         13 |       336 
         6 |       457         38 |       495 
         7 |       277        171 |       448 
         8 |       338        315 |       653 
         9 |       356        332 |       688 
        10 |       247        232 |       479 
        11 |         9         11 |        20 
         . |         4          0 |         4 
-----------+----------------------+----------
     Total |     2,011      1,112 |     3,123 


. drop if h1bq2b == . | h1bq2b == 0
(4 observations deleted)

.         /* According to the repartition of months and year, the survey ran from November 201
> 1 to January 2013. I will define the
>          * the quarters accordingly */
. gen float survquar=1 if h1bq2b>=5 & h1bq2b<=7 & h1bq2c==2005 
(2062 missing values generated)

. replace survquar=2 if h1bq2b>=8 & h1bq2b<=10  & h1bq2c==2005
(941 real changes made)

. replace survquar=3 if h1bq2b>=5 & h1bq2b<=6  & h1bq2c==2006 | h1bq2b == 11 & h1bq2c == 2005
(60 real changes made)

. replace survquar=4 if h1bq2b>=7 & h1bq2b<=9  & h1bq2c==2006
(818 real changes made)

. replace survquar=5 if h1bq2b>=10 & h1bq2b<=11  & h1bq2c==2006
(243 real changes made)

. label define lsurvquar 1 "May '05 - Jul-'05" 2 "Aug-Oct 05" 3 "Nov '05 & May-Jun 06" 4 "Jul-
> Sept 2006" 5 "Oct-Nov '06"

. label values survquar lsurvquar

. label variable survquar "Sequential Survey Quarter (May-Nov'05 & May-Nov '06)"

. tab survquar

   Sequential Survey |
 Quarter (May-Nov'05 |
      & May-Nov '06) |      Freq.     Percent        Cum.
---------------------+-----------------------------------
   May '05 - Jul-'05 |      1,057       33.89       33.89
          Aug-Oct 05 |        941       30.17       64.06
Nov '05 & May-Jun 06 |         60        1.92       65.98
       Jul-Sept 2006 |        818       26.23       92.21
         Oct-Nov '06 |        243        7.79      100.00
---------------------+-----------------------------------
               Total |      3,119      100.00

. ***------- Sequential Interview month 
. * Following the Mozambique file, I am creating a survey month variable rather than an interv
> iew date variable as per the excel sheet
. * Number 1 corresponds to the first month of the survey and not to January.
. gen float survmon=1 if h1bq2b==5 & h1bq2c==2005
(2796 missing values generated)

. replace survmon=2 if h1bq2b==6 & h1bq2c==2005
(457 real changes made)

. replace survmon=3 if h1bq2b==7 & h1bq2c==2005
(277 real changes made)

. replace survmon=4 if h1bq2b==8 & h1bq2c==2005
(338 real changes made)

. replace survmon=5 if h1bq2b==9 & h1bq2c==2005
(356 real changes made)

. replace survmon=6 if h1bq2b==10 & h1bq2c==2005
(247 real changes made)

. replace survmon=7 if h1bq2b==11 & h1bq2c==2005
(9 real changes made)

. replace survmon=8 if h1bq2b==5 & h1bq2c==2006
(13 real changes made)

. replace survmon=9 if h1bq2b==6 & h1bq2c==2006
(38 real changes made)

. replace survmon=10 if h1bq2b==7 & h1bq2c==2006
(171 real changes made)

. replace survmon=11 if h1bq2b==8 & h1bq2c==2006                          
(315 real changes made)

. replace survmon=12 if h1bq2b==9 & h1bq2c==2006
(332 real changes made)

. replace survmon=13 if h1bq2b==10 & h1bq2c==2006
(232 real changes made)

. replace survmon=14 if h1bq2b==11 & h1bq2c==2006 
(11 real changes made)

. **** there was only one person in January 2013, hence it is added on to Dec '12
. label define lsurvmon 1 "May 05" 2 "Jun 05" 3 "Jul 05" 4 "Aug 05" 5 "Sept 05" 6 "Oct 05" 7 "
> Nov 05" 8 "May 06" 9 "Jun 06" 10 "Jul 06" 11 "Aug 06" 12 "Sept 06" 13 "Oct 06" 14 "Nov 06"

. label values survmon lsurvmon

. tab survmon,m

    survmon |      Freq.     Percent        Cum.
------------+-----------------------------------
     May 05 |        323       10.36       10.36
     Jun 05 |        457       14.65       25.01
     Jul 05 |        277        8.88       33.89
     Aug 05 |        338       10.84       44.73
    Sept 05 |        356       11.41       56.14
     Oct 05 |        247        7.92       64.06
     Nov 05 |          9        0.29       64.35
     May 06 |         13        0.42       64.76
     Jun 06 |         38        1.22       65.98
     Jul 06 |        171        5.48       71.47
     Aug 06 |        315       10.10       81.56
    Sept 06 |        332       10.64       92.21
     Oct 06 |        232        7.44       99.65
     Nov 06 |         11        0.35      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. label variable survmon "Sequential Survey Month (November 2011 = January '13)"

. ***------- Household Sample Weight
. rename hmult hhweight

. label variable hhweight "Household sample weight"

. ***------- Household id
. codebook HHID /*there are  3,119 unique values and 3,119 observations in the dataset so the 
> variable "hh" uniquely identifies the observations */

----------------------------------------------------------------------------------------------
HHID                                                                           household  code
----------------------------------------------------------------------------------------------

                  type:  string (str10)

         unique values:  3119                     missing "":  0/3119

              examples:  "1081000309"
                         "2053000907"
                         "3041000204"
                         "4023002511"

. rename HHID hhid

. label variable hhid "Household ID"

. ***------- Geographical Stratification during sampling
. 
. tab region

     Region |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        324       10.39       10.39
    Central |        700       22.44       32.83
    Eastern |        697       22.35       55.18
   Northern |        695       22.28       77.46
    Western |        703       22.54      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. gen float strata = 1 if region ==0 & urban == 1 | region == 1 & urban ==1
(2659 missing values generated)

. replace strata = 2 if region ==0 & urban == 0 | region == 1 & urban ==0
(564 real changes made)

. replace strata = 3 if region ==2 & urban==1
(135 real changes made)

. replace strata = 4 if region ==2 & urban==0
(562 real changes made)

. replace strata = 5 if region ==3 & urban==1
(137 real changes made)

. replace strata = 6 if region ==3 & urban==0
(558 real changes made)

. replace strata = 7 if region ==4 & urban==1
(128 real changes made)

. replace strata = 8 if region ==4 & urban==0
(575 real changes made)

. la define lstrata 1 "central urban" 2 "central rural" 3 "Eastern urban" 4 "Eastern rural" 5 
> "Northern urban" 6 "Northern rural" 7 "Western Urban" 8 "Western rural"

. la values strata lstrata

. label variable strata "Geographical stratification variable during sampling (ranging from 1 
> to 6 sub regions)"
note: label truncated to 80 characters

. tab strata

  Geographical |
stratification |
      variable |
        during |
      sampling |
 (ranging from |
 1 to 6 sub re |      Freq.     Percent        Cum.
---------------+-----------------------------------
 central urban |        460       14.75       14.75
 central rural |        564       18.08       32.83
 Eastern urban |        135        4.33       37.16
 Eastern rural |        562       18.02       55.18
Northern urban |        137        4.39       59.57
Northern rural |        558       17.89       77.46
 Western Urban |        128        4.10       81.56
 Western rural |        575       18.44      100.00
---------------+-----------------------------------
         Total |      3,119      100.00

. ***----------------------rural/urban identifier 
. tab urban

 substratum |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,259       72.43       72.43
      urban |        860       27.57      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. gen rural=1 if urban==0
(860 missing values generated)

. replace rural=0 if urban==1
(860 real changes made)

. label define lrural 1 "Rural" 0 "Urban"

. la values rural lrural

. label variable rural "Rural/Urban Location"

. tab rural,m

Rural/Urban |
   Location |      Freq.     Percent        Cum.
------------+-----------------------------------
      Urban |        860       27.57       27.57
      Rural |      2,259       72.43      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. ***-----Regions used for temporal price index calculations
. tab region,m 

     Region |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        324       10.39       10.39
    Central |        700       22.44       32.83
    Eastern |        697       22.35       55.18
   Northern |        695       22.28       77.46
    Western |        703       22.54      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. replace region = 1 if region == 0
(324 real changes made)

. la define lregion 1 "Central" 2 "Eastern" 3 "Northern" 4 "Western"

. la values region lregion 

. clonevar reg_tpi = region

. label variable reg_tpi "Regions used for temporal price index calculations"

. tab reg_tpi 

    Regions |
   used for |
   temporal |
price index |
calculation |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
    Central |      1,024       32.83       32.83
    Eastern |        697       22.35       55.18
   Northern |        695       22.28       77.46
    Western |        703       22.54      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. ***------ Spatial domains (each with its own poverty line)
. tab strata

  Geographical |
stratification |
      variable |
        during |
      sampling |
 (ranging from |
 1 to 6 sub re |      Freq.     Percent        Cum.
---------------+-----------------------------------
 central urban |        460       14.75       14.75
 central rural |        564       18.08       32.83
 Eastern urban |        135        4.33       37.16
 Eastern rural |        562       18.02       55.18
Northern urban |        137        4.39       59.57
Northern rural |        558       17.89       77.46
 Western Urban |        128        4.10       81.56
 Western rural |        575       18.44      100.00
---------------+-----------------------------------
         Total |      3,119      100.00

. *  Geographical |
. *stratification |
. *      variable |
. *        during |
. *      sampling |
.  *(ranging from |
.  *1 to 6 sub re |      Freq.     Percent        Cum.
. *---------------+-----------------------------------
. * central urban |        460       14.75       14.75
. * central rural |        564       18.08       32.83
. * Eastern urban |        135        4.33       37.16
. * Eastern rural |        562       18.02       55.18
. *Northern urban |        137        4.39       59.57
. *Northern rural |        558       17.89       77.46
. * Western Urban |        128        4.10       81.56
. * Western rural |        575       18.44      100.00
. *---------------+-----------------------------------
. *         Total |      3,119      100.00
. 
. * In the Arndt & Simler 2010 paper the spatial domains are a combinaison of regions and rura
> l/urban delimitations + the capital
. * city, however in the 2010/11 some urban sections have far less than 200 respondents, so we
>  shall combine all other regions 
. * (rural + urban)except the central since its urban would be boosted by Kampala, getting us 
> 5 spatial domains
. gen float spdomain=1 if strata==1 | strata==1
(2659 missing values generated)

. replace spdomain=2 if strata==2
(564 real changes made)

. replace spdomain=3 if strata==3 | strata==4
(697 real changes made)

. replace spdomain=4 if strata==5 | strata==6
(695 real changes made)

. replace spdomain=5 if strata==7 | strata==8
(703 real changes made)

. label define lspdomain 1 "Central Urban" 2 "Central Rural" 3 "Eastern" 4 "Northern" 5 "Weste
> rn" 

. label values spdomain lspdomain

. label variable spdomain "Spatial domains: each with own poverty line (they are 5)"

. tab spdomain

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |        460       14.75       14.75
Central Rural |        564       18.08       32.83
      Eastern |        697       22.35       55.18
     Northern |        695       22.28       77.46
      Western |        703       22.54      100.00
--------------+-----------------------------------
        Total |      3,119      100.00

. ***---------------News; another way to specify variables, is the traditional Uganda regions,
>  North east central and western, represented in region
. gen float news=1 if region==1 
(2095 missing values generated)

. replace news=2  if region==2 
(697 real changes made)

. replace news=3  if region==3 
(695 real changes made)

. replace news=4  if region==4 
(703 real changes made)

. label define lnews 1 "Central" 2 "Eastern" 3 "Northern" 4 "Western" 

. label values news lnews

. label variable new "regions north, east, central and western; other ways to dissagregate pov
> erty lines"
note: label truncated to 80 characters

. tab news

    regions |
     north, |
      east, |
central and |
   western; |
 other ways |
         to |
dissagregat |
  e poverty |
        lin |      Freq.     Percent        Cum.
------------+-----------------------------------
    Central |      1,024       32.83       32.83
    Eastern |        697       22.35       55.18
   Northern |        695       22.28       77.46
    Western |        703       22.54      100.00
------------+-----------------------------------
      Total |      3,119      100.00

. ****-------geo1-geo?; other administrative geographical boundariies where a survey is repres
> entative is not required as also done in news rural and others
. *** -------------------Bootstrap weights: the toolkit requires that this should be=1 for all
>  households and we generate it below
. gen float bswt=1

. label variable bswt "bootstrap weights; and all equal to 1 for all households, as a toolkit 
> requirement"
note: label truncated to 80 characters

. sort hhid

. save "$path/in/hhdata_hhsize.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/hhdata_hhsize.dta saved

. save "$path/out/hhdata_hhsize.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdata_hhsize.dta saved

. **** --------------------------------Household size
. ** Since we need Household size in the hhdata.dta, and it was unavailable in the GSEC1.dta, 
> we use the Unique person identifier in GSEC2.dta
. clear 

. use "$path/in/GSEC2.dta"

. rename pid indlin

. bysort HHID: gen pid=_n

. order HH pid

. collapse (count) pid, by (HHID)

. rename pid hhsize

. la var hhsize "number of household menbers"

. rename HHID hhid

. sort hhid

. save "$path/in/hhsize.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/hhsize.dta saved

. clear 

. use "$path/in/hhdata_hhsize.dta"

. merge 1:1 hhid using "$path/in/hhsize.dta"
hhid was str10 now str11

    Result                           # of obs.
    -----------------------------------------
    not matched                             4
        from master                         0  (_merge==1)
        from using                          4  (_merge==2)

    matched                             3,119  (_merge==3)
    -----------------------------------------

. tab _m

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |          4        0.13        0.13
            matched (3) |      3,119       99.87      100.00
------------------------+-----------------------------------
                  Total |      3,123      100.00

. drop _m 

. sort hhid

. destring hhid, replace
hhid has all characters numeric; replaced as double

. destring psu, replace
psu already numeric; no replace

. save "$path/out/hhdata.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdata.dta saved

. save "$path/in/hhdata.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/hhdata.dta saved

. *====================== Table A2===================================: Individual characterist
> ics - demographics
. clear

. use "$path/in/GSEC2.dta" 

. sort HHID

. ***----- Household members
. *According to enumerator manual of 2011/12, Usual and Regular household members are defined 
> as : *Usual members: those persons who have been living in the 
. *household for 6 months or more during the last 12 months. members who have come to stay in 
> the household permanently usual members, even though they have 
. *lived in this household for less than 6 *months. children born to usual members during the 
> last 12 months are usual members. Both these categories will 
. *be given code "1" or "2" depending upon whether they are present or absent on the date of t
> he interview. *Regular members refer to those persons who would 
. *have been usual members of this household, but have been away for more than six months duri
> ng the last 12 months, for education purposes, search of
. *employment, business transactions etc. and living in boarding schools, lodging houses or ho
> stels etc.*These will be coded "3" or "4" depending upon presence 
. *or absence on the date of the interview. For the purposes of the calculation of a poverty l
> ine we'll exclude from the household the members who have left 
. *the household permanently or died We'll keep the members away for more than 6 months but pr
> esent on the day of the interview */
. rename  tid resident

. tab resident

           what is the |
    residential status |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
  Usual member present |     15,172       90.53       90.53
   Usual member absent |        792        4.73       95.26
Regular member present |        204        1.22       96.47
 Regular Member absent |        591        3.53      100.00
-----------------------+-----------------------------------
                 Total |     16,759      100.00

. *drop if resident==7
. ***------ Household ID
. rename HHID hhid

. label variable hhid "Household ID"

. ***------ Individual ID
. destring hhid PID, replace
hhid has all characters numeric; replaced as double
PID has all characters numeric; replaced as double

. gen double indid = hhid*100 +  PID

. codebook indid

----------------------------------------------------------------------------------------------
indid                                                                              (unlabeled)
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [2.026e+11,4.612e+12]        units:  100
         unique values:  16759                    missing .:  0/16759

                  mean:   1.2e+12
              std. dev:   1.3e+12

           percentiles:        10%       25%       50%       75%       90%
                           2.1e+11   4.1e+11   6.2e+11   1.2e+12   3.4e+12

. * There are 16,759 unique values, and there are 16,759 observations in the dataset so indid 
> uniquely identifies the data
. *duplicates report indid
. *duplicates list indid
. *duplicates drop indid, force
. *codebook indid 
. *there are now 17043 and 17,043 observations implying that indid now uniquely identifies the
>  data
. label variable indid "Individual ID"

. ***------ Sex
. rename  h2q4 sex

. label variable sex "Sex"

. ***------ Age
. rename  h2q9 age

. label variable age "Age in years"

. * In order to have the information on whether the mother resides in the house or not we need
>  the file "GSEC3"
. sort indid

. save "$path/in/temp_A2_1.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/temp_A2_1.dta saved

. clear

. use "$path/in/GSEC3.dta" 

. ***------ Individual ID
. rename HHID hhid

. destring hhid PID,replace
hhid has all characters numeric; replaced as double
PID has all characters numeric; replaced as double

. gen double indid=hhid*100 +  PID

. label variable indid "Individual ID"

. codebook indid

----------------------------------------------------------------------------------------------
indid                                                                            Individual ID
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [2.026e+11,4.612e+12]        units:  100
         unique values:  16329                    missing .:  0/16329

                  mean:   1.1e+12
              std. dev:   1.2e+12

           percentiles:        10%       25%       50%       75%       90%
                           2.1e+11   4.1e+11   6.2e+11   1.2e+12   3.4e+12

. * There are 16,329 unique values, and there are 16,329 observations in the dataset so indid 
> uniquely identifies data
. *duplicates report indid
. *duplicates list indid
. *duplicates drop indid, force
. *codebook indid 
. ***----- Mother lives in household?
. tab h3q6,m

      is tha |
     natural |
   mother of |
 name living |
  in this hh |      Freq.     Percent        Cum.
-------------+-----------------------------------
         yes |      8,123       49.75       49.75
no but alive |      5,046       30.90       80.65
 no but dead |      3,106       19.02       99.67
no dont know |         30        0.18       99.85
           . |         24        0.15      100.00
-------------+-----------------------------------
       Total |     16,329      100.00

. *There are 7,122  (ie 43.1 %) missing responses,: 1: Yes = 6,913 2: No = 1,95 3: Dead = 363 
> 4: Missing = 6,882. I will group them 
. gen motherhh=1 if h3q5==1 
(16328 missing values generated)

. replace motherhh=0 if h3q6==2 | h3q6==3 | h3q6==4 | h3q6==.
(8206 real changes made)

. label variable motherhh "Mother lives in hh"

. label define lmoth 0 "No" 1 "Yes"

. label values motherhh lmoth

. keep indid motherhh

. tab motherhh

     Mother |
lives in hh |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      8,206      100.00      100.00
------------+-----------------------------------
      Total |      8,206      100.00

. sort indid

. merge 1:1 indid using "$path/in/temp_A2_1.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                           430
        from master                         0  (_merge==1)
        from using                        430  (_merge==2)

    matched                            16,329  (_merge==3)
    -----------------------------------------

. tab _merge

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |        430        2.57        2.57
            matched (3) |     16,329       97.43      100.00
------------------------+-----------------------------------
                  Total |     16,759      100.00

. drop _merge

. keep hhid indid sex age motherhh

. save "$path/out/indata.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/indata.dta saved

. save "$path/in/indata.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/indata.dta saved

. * ========================Table A3============================: Calorie content of food item
> s
. * we compiled the calorie content and edible portion in an excel file then converted that fi
> le into a STATA file located in "in" folder
. clear

. use "$path/in/foodcomp_uganda_PANNELsurvey2005.dta"

. * Since they did not include edible portions in the file I assume that the calorie per gram 
> is only for the edible portion.
. * ----------- computing calperg that way
. destring kcal_100g edible, replace
kcal_100g has all characters numeric; replaced as int
edible has all characters numeric; replaced as byte

. gen double calperg=((kcal_100g*edible)/100)/100

. keep product descript calperg

. label variable product "Food product code: numerical"

. label variable descript "Product Description: incl. product code in the beginning"

. label variable calperg "Calorie content of food product: calories per gram"

. destring product, replace
product has all characters numeric; replaced as int

. sort product

. save "$path/out/calperg.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/calperg.dta saved

. save "$path/in/calperg.dta",replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/calperg.dta saved

. clear

. * ===================Table A4=============: Amount and Quantity of food transactoin - Transa
> ction level
. use "$path/in/GSEC14A.dta"

. sort HHID

. rename HHID hhid

. la var hhid "household id"

. ** we drop alcoholic and tobacco as these were not considered basic in foods generally and b
> y GAPP, these included beer-152, other alcoholic dricns-153
. ** cigarettes-155, other tobacco-156 and beer taken in restaurants-159, just like we did in 
> the 2009 poverty calculations
. rename h14aq2 itmcd

. rename h14aq3 untcd

. drop if inlist( itmcd ,152,153,155,156,159)
(1396 observations deleted)

. duplicates report  hhid itmcd

Duplicates in terms of hhid itmcd

--------------------------------------
   copies | observations       surplus
----------+---------------------------
        1 |        38996             0
        2 |            2             1
--------------------------------------

. *duplicates list  hhid itmcd
. codebook hhid

----------------------------------------------------------------------------------------------
hhid                                                                              household id
----------------------------------------------------------------------------------------------

                  type:  string (str11), but longest is str10

         unique values:  3120                     missing "":  0/38998

              examples:  "1071000209"
                         "2033002307"
                         "3023000301"
                         "4023001103"

. egen quantity=rowtotal( h14aq4 h14aq6 h14aq8 h14aq10)

. la var quantity "quantity of food consumed by the household including purchases, at home, aw
> ay from home & kind"
note: label truncated to 80 characters

. ** these quantities and values are collected by UBOS at a 7 days basis, thus we divide by 7 
> to get the daily figures as a requirement by GAPP 
. gen quantityd = quantity/7

. drop quantity h14aq10 h14aq8 h14aq6 h14aq4

. la var quantityd "daily household food consumption"

. egen value=rowtotal ( h14aq5 h14aq7 h14aq9 h14aq11 )

. la var value "household food consumption in seven days"

. gen valuez = value/7 

. la var valuez "daily value of food consumed by the household"

. rename quantityd quantityz

. drop value h14aq11 h14aq9 h14aq7 h14aq5 h14aq13 h14aq12

. gen unit = 1

. la var unit "set equal to one since all observations are converted into kg"

. gen food_cat = 1

. la var food_cat "food category equals 1, if product is food and 0 if non food"

. rename itmcd product

. la var product "Food product code: numerical"

. destring product, replace
product already numeric; no replace

. save "$path/in/household_table4.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/household_table4.dta saved

. save "$path/out/household_table4.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/household_table4.dta saved

. count
38998

. sort product untcd

. 
. replace product=100 if product==101  | product==102  | product==103  | product==104
(1529 real changes made)

. 
. ** to convert quantities of food in standard units, the Kilograms, a file called "conversion
> s_all.dta" generated by Fiona with equivalents of local units into 
. * kilograms located in the "in" folder was used. for UNPS 2009, and 2010 data we used "Conve
> rsionfactors.dta", by Haruna, also in "in" folder
. merge m:1 product untcd using  "$path/in/conversionfactors.dta"
untcd was byte now int

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,418
        from master                     2,563  (_merge==1)
        from using                        855  (_merge==2)

    matched                            36,435  (_merge==3)
    -----------------------------------------

. tab _m

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |      2,563        6.43        6.43
         using only (2) |        855        2.15        8.58
            matched (3) |     36,435       91.42      100.00
------------------------+-----------------------------------
                  Total |     39,853      100.00

. drop _m

. *label drop _all
. save "$path/in/household_table4cf.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/household_table4cf.dta saved

. save "$path/out/household_table4cf.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/household_table4cf.dta saved

. gen quantity = quantityz * qkg_uca
(3566 missing values generated)

. la var quantity "daily quantity consumed in Kgs per household"

. la var value  "daily value of consumption in UGX per per household"

. sort hhid

. label drop _all

. destring hhid, replace
hhid has all characters numeric; replaced as double
(855 missing values generated)

. save "$path/out/cons_cod_trans.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/cons_cod_trans.dta saved

. save "$path/in/cons_cod_trans.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/cons_cod_trans.dta saved

. **================ Table 5===============: TOTAL AMOUNT AND QUANTITY OF PRODUCTS: Food as we
> ll as non food
. **  DATA IN:       GSEC4.dta : On Education costs, column h4q15g which has all total school 
> expenses, it is on 365 dayss basis
. **                 GSEC5.dta : On Medical Expenditure, column h5q12, on 30 days basis
. **                 GSEC14.dta : On assets Expenditure, column h14q5 on total estimated prese
> nt value, considering 10% value used per 365 days basis
. **                 GSEC15C.dta: On non-durables and frequently purchased items e.g imputed r
> ent, electricity, soap etc,on 30days basis, columns h15cq: 5,7 & 9 for value
. **                 GSEC15D.dta: On semi-durable goods and services e.g. clothes, furniture, 
> equipments, column; h15dq:5,7&9, on 365 days basis for value
. **                 GSEC15E.dta:     On Non-consumption expenses like taxes, remitances away,
>  subscriptions etc, on 365 days basis, colum 3::file is MISSING in W.B, data supplied
. **  DATA OUT: cons_cod.dta
. clear

. ***----------------------calculating Education expenses
. use "$path/in/GSEC4.dta"

. rename HHID hhid

. codebook hhid

----------------------------------------------------------------------------------------------
hhid                                                   Unique HH Identifier Across Panel Waves
----------------------------------------------------------------------------------------------

                  type:  string (str11), but longest is str10

         unique values:  3121                     missing "":  0/13441

              examples:  "1083002009"
                         "2073000601"
                         "3041000701"
                         "4023003010"

. keep hhid h4q10f

. sort hhid

. ** since total education expenses were clooected in h4q10f and since is at yearly basis, we 
> divided it by 365 to get daily expenses on education
. gen educationd = h4q10f/365
(7047 missing values generated)

. 
. replace educationd=0
(12862 real changes made)

. la var educationd "daily household expense on education"

. drop h4q10f

. save "$path/out/hhdeducationexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeducationexp.dta saved

. clear

. **---------------------calculating medical expenses
. use "$path/in/GSEC5.dta"

. rename HHID hhid

. sort hhid

. keep hhid h5q10 h5q11 

. egen medicalexp = rowtotal (h5q10 h5q11 ) 

. gen medicalexpd = medicalexp/30

. replace medicalexpd=0
(4513 real changes made)

. drop h5q10 h5q11

. la var medicalexpd "household daily expenditure"

. save "$path/out/hhdmedicalexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdmedicalexp.dta saved

. clear

. ****---------------calculating expenses on basic durable assests
. use "$path/in/GSEC12A.dta"

. des

Contains data from /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/GSEC12A.dta
  obs:        68,332                          
 vars:             9                          9 Feb 2012 15:57
 size:     1,776,632                          
----------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
----------------------------------------------------------------------------------------------
HHID            str11  %11s                   Unique HH Identifier Across Panel Waves
h12aq2          int    %34.0g      H12AQ2     asset code
h12aq3          byte   %8.0g       H12AQ3     does any member of your hh own (asset) at
                                                present
h12aq4          byte   %8.0g                  how many do your hh hold at present.number
h12aq5          long   %12.0g                 how many do your hh hold at present.total
                                                estimated value
h12aq6          byte   %8.0g       H12AQ6     did any member of your hh own (asset) 12months
                                                ago
h12aq7          byte   %8.0g                  how many did your hh own 12months ago.number
h12aq8          long   %12.0g                 how many did your hh own 12months ago.total
                                                estimated value
h12aq9          byte   %13.0g      H12AQ9     compared with 2001 would you say that your
                                                (...)is
----------------------------------------------------------------------------------------------
Sorted by:  HHID  h12aq2

. save "$path/out/hhddurables.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhddurables.dta saved

. 
. *keep if inlist( h12aq2 ,02,03,10,11,12,13) 
. drop if inlist(h12aq2, 1, 2 )
(6228 observations deleted)

. 
. gen assetvalue = h12aq5
(42166 missing values generated)

. ** i took land-03, bicycle-10, motor cycle-11 and motorvehicle-12, boat-13 and other buildin
> gs-02, as durables and assumed that a year, 
. ** the household can use 0.1% of these assests, just to limit the influence of assests that 
> were inflating unnecessarily especially the urban poverty estimates,
. ** house not treated as an asset as the toolkit takes care of imputed rent
. gen dassetvalue = (assetvalue*0.1)/365
(42166 missing values generated)

. 
. la var dassetvalue "household daily durables expenditure"

. rename HHID hhid

. sort hhid

. save "$path/out/hhddurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhddurablesexp.dta saved

. clear

. **----------------------calculating expenses on basic non durable assest
. use "$path/in/GSEC12A.dta"

. save "$path/out/hhnondurables.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhnondurables.dta saved

. rename HHID hhid

. drop if inlist(  h12aq2 ,01,02,03,10,11,12,13)
(21759 observations deleted)

. gen nondurablevalue = h12aq5
(31856 missing values generated)

. ** also discounted them by 1% to get rough value used per year, we considered furniture-04, 
> Hh appliances as Kettle,flat iron-05, electronics as tv-06, 
. *radio-07, generators-08, solar-panel-09, other transport mean -14, jewelry&watches-15, mobi
> lephone-16, computer-17, internet-18, other elwctronics-19, 
. *otherassets as lawn mores-20,  others;-21 & 22, NOTE: figures are codes in data set
. la var nondurablevalue "household daily non-durables expenditure"

. sort hhid

. gen dnondurables = (nondurablevalue*0.01)/365
(31856 missing values generated)

. la var dnondurables "household daily non-durables expenditure"

. keep hhid dnondurables nondurablevalue

. save "$path/out/hhdnondurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdnondurablesexp.dta saved

. clear

. ***-------------------calculating expenses on basic frequently bought items
. use "$path/in/GSEC14B.dta"

. des

Contains data from /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/GSEC14B.dta
  obs:        33,876                          
 vars:            10                          9 Feb 2012 15:57
 size:     1,558,296                          
----------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
----------------------------------------------------------------------------------------------
HHID            str11  %11s                   Unique HH Identifier Across Panel Waves
h14bq2          int    %54.0g      H14BQ2     Consumption Item Code
h14bq3          byte   %34.0g      H14BQ3     unit of quantity
h14bq4          float  %9.0g                  purchase quantity
h14bq5          long   %12.0g                 purchase value
h14bq6          float  %9.0g                  home produced quantity
h14bq7          long   %12.0g                 home produced value
h14bq8          float  %9.0g                  received in kind quantity
h14bq9          long   %12.0g                 received in kind value
h14bq10         double %9.0g                  unit price
----------------------------------------------------------------------------------------------
Sorted by:  HHID  h14bq2

. rename HHID hhid

. sort hhid

. ** here we considered rent of rented house-301, imputed rent of own house-302, imputed rent 
> of free given house-303, repair expenses-304, water-305 
. ** electricity-306, generator fuels-307, parafin-308, charcoal-309, firewood-310, matches-45
> 1, washing soap-452, bathing soap-453, toothpaste-454, 
. ** taxifares-463, and expenditure on phones not owned-468, and we dropped others-311, cosmet
> ics-455, handbags-456, batteries-drycells-457, newspapers-458, 
. * others-459, tires-461, petrol-462, bus fares-464, bodaboda fare-465, stamps/envelops-466, 
> mobilephoneairtime-467 and others-469,health fees as 
. *consultation-501, medicine-502, hospitalcharges-503, traditionaldoctors-504, others-505 sin
> ce medical expenses were cosidered in section 5, 
. * sports/theater-601, drycleaning-602, houseboys-603, barbers&beauty shops-604 and lodging-6
> 05. THESE HAVE BEEN CONSIDERED NON BASIC
. drop if inlist( h14bq2 ,311,455,456,457,458,459,461,462,464,465,466,467,469,501,502,503,504,
> 505,601,602,603,604,605)
(9010 observations deleted)

. egen hhfrequents = rowtotal ( h14bq5 h14bq7 h14bq9)

. gen dhhfrequents = hhfrequents/30

. la var dhhfrequents "daily household expenditure on frequently bought commodities"

. tostring hhid, force replace
hhid already string; no replace

. save "$path/out/hhdfrequentsexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdfrequentsexp.dta saved

. clear

. ****------------------calculating basic expenses on semi durables
. **   in considering semi durable goods and services, the value of those services and goods r
> ecieved in kind, column h15dq9 of GSEC15D.dta has been excluded
. **   just as in kind food consumptions were eliminated in table 4 as per the GAPP guidelines
> , These have also been discounted by 10% usage per year
. use "$path/in/GSEC14C.dta"

. save "$path/out/hhsemidurables.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhsemidurables.dta saved

. des

Contains data from /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhsemidurables.dta
  obs:        28,662                          
 vars:             5                          10 Mar 2014 14:47
 size:       716,550                          
----------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
----------------------------------------------------------------------------------------------
HHID            str11  %11s                   Unique HH Identifier Across Panel Waves
h14cq2          int    %12.0g                 Consumption Item Code
h14cq3          long   %12.0g                 purchases value
h14cq4          long   %12.0g                 consumption out of hh/enterprise stock
h14cq5          long   %12.0g                 value received in kind
----------------------------------------------------------------------------------------------
Sorted by:  HHID  h14cq2

. sort HHID

. rename HHID hhid

. ** we have considered the following men clothing-201, womenclothing-202, childrenclothing-20
> 3, men footware-206, women footware-207, children footware-208
. ** bedding mattress-304, blankets-305, charcoal/parafin stoves-402, plastic plates and tumbl
> ers-502, and dropped other clothing-204, tailoring materials-205, 
. *other footware-209, furniture items-301, carpets-302, curtains&bedsheets-303, others-306, k
> ettles-401, tv&radio-403, byclcles-404, radio-405, motors-406, 
. *motorcycles-407,computers-408, phone handsets-409, others-410, jewelry&watches-411,glass/ta
> ble ware of codes 501 and 503-506, education cost (601-605)
. *as education done in section 4, and others like functions & premiums (701-703) ** as these 
> have been consideered NON BASIC
. *drop if inlist( h14cq2 ,204,205,208,209,301,302,303,306,401,403,404,405,406,407,408,409,410
> ,411,501,503,504,505,506,601,602,603,604,605,701,702,703)
. egen hhsemidurables = rowtotal ( h14cq3 h14cq4 h14cq5)

. sort hhid

. gen hhdsemidurs = (hhsemidurables*0.5)/365

. la var hhdsemidurs "household daily semi durables goods and seervices expenses"

. drop hhsemidurables

. tostring hhid, force replace
hhid already string; no replace

. save "$path/out/hhdsemidurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdsemidurablesexp.dta saved

. clear

. 
. use "$path/in/GSEC14D.dta"

. save "$path/in/hhnonconsmpexptaxes.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/hhnonconsmpexptaxes.dta saved

. sort HHID

. rename HHID hhid

. ** we only considered graduated tax-904, that may cause arrest if not paid and it used to be
>  per head paid to local government annually
. ** and dropped income tax-901, property tax-902, user fees-903, social security payments-905
> , remmitances-906, funerals-907 and others-909
. drop if inlist( itmcd ,901,902,903,905,906,907,909)
(3742 observations deleted)

. gen hhdnonconsumpexp = value/365
(2 missing values generated)

. la var hhdnonconsumpexp "hh daily expenditure on taxes, contributions, donations, duties, et
> c"

. sort hhid 

. collapse hhdnonconsumpexp, by (hhid)

. save "$path/out/hhdnonconsumpexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdnonconsumpexp.dta saved

. clear

. ****-----------------------calculating basic non-consumption expenses
. ** The file GSEC15E.dta, where this information was kept was absent
. ** after generating all daily non food total household expenditures of various considered it
> ems, then we start merging these  SIX hhd--- prefixed files, and ending with sufix exp to ge
> t all non food hh daily expenditure
. use "$path/out/hhdeducationexp.dta", clear

. collapse (sum) educationd , by(hhid)

. sort hhid

. save "$path/out/hhdeducationexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeducationexp.dta saved

. use "$path/out/hhdmedicalexp.dta", clear

. collapse (sum) medicalexpd , by(hhid)

. sort hhid

. save "$path/out/hhdmedicalexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdmedicalexp.dta saved

. use "$path/out/hhdeducationexp.dta", clear

. merge 1:1 hhid using "$path/out/hhdmedicalexp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                             3
        from master                         3  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,118  (_merge==3)
    -----------------------------------------

. drop _merge

. sort hhid

. save "$path/out/hhdeduc&medicex.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeduc&medicex.dta saved

. use "$path/out/hhddurablesexp.dta"

. collapse (sum) dassetvalue , by(hhid)

. sort hhid

. save "$path/out/hhddurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhddurablesexp.dta saved

. use "$path/out/hhdeduc&medicex.dta"

. merge 1:1 hhid using "$path/out/hhddurablesexp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         4  (_merge==1)
        from using                          1  (_merge==2)

    matched                             3,117  (_merge==3)
    -----------------------------------------

. drop _merge

. sort hhid

. save "$path/out/hhdeduc&medic&durabex.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeduc&medic&durabex.dta saved

. use "$path/out/hhdnondurablesexp.dta"

. collapse (sum) dnondurables , by(hhid)

. sort hhid

. save "$path/out/hhdnondurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdnondurablesexp.dta saved

. use "$path/out/hhdeduc&medic&durabex.dta"

. merge 1:1 hhid using "$path/out/hhdnondurablesexp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         5  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,117  (_merge==3)
    -----------------------------------------

. drop _merge

. sort hhid

. save "$path/out/hhdeduc&medic&durab&nondurabex.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeduc&medic&durab&nondurabex.dta sav
> ed

. clear

. use "$path/out/hhdfrequentsexp.dta"

. tostring hhid, force replace
hhid already string; no replace

. collapse (sum) dhhfrequents , by(hhid)

. sort hhid

. tostring hhid, force replace
hhid already string; no replace

. save "$path/out/hhdfrequentsexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdfrequentsexp.dta saved

. use "$path/out/hhdeduc&medic&durab&nondurabex.dta"

. merge 1:1 hhid using "$path/out/hhdfrequentsexp.dta" 

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                             3,122  (_merge==3)
    -----------------------------------------

. drop _merge

. sort hhid

. save "$path/out/hhdeduc&medic&durab&nondurab&freqsex.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeduc&medic&durab&nondurab&freqsex.d
> ta saved

. use "$path/out/hhdsemidurablesexp.dta"

. tostring hhid, force replace
hhid already string; no replace

. collapse (sum) hhdsemidurs , by(hhid)

. sort hhid

. tostring hhid, force replace
hhid already string; no replace

. save "$path/out/hhdsemidurablesexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdsemidurablesexp.dta saved

. use "$path/out/hhdeduc&medic&durab&nondurab&freqsex.dta"

. merge 1:1 hhid using "$path/out/hhdsemidurablesexp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                            42
        from master                        42  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,080  (_merge==3)
    -----------------------------------------

. drop _merge

. sort hhid

. merge 1:1 hhid using "$path/out/hhdnonconsumpexp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,197
        from master                     2,197  (_merge==1)
        from using                          0  (_merge==2)

    matched                               925  (_merge==3)
    -----------------------------------------

. save "$path/out/hhdeduc&medic&durab&nondurab&freqs&semidurabex.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhdeduc&medic&durab&nondurab&freqs&sem
> idurabex.dta saved

. gen hhnonfoodexp =  educationd+medicalexpd+dassetvalue+dnondurables+dhhfrequents+hhdsemidurs
(49 missing values generated)

. la var hhnonfoodexp "household total non food expenditure"

. keep hhid hhnonfoodexp

. gen product = 0

. la var product "product code equal to 1 for food and 0 for non food"

. gen food_cat = 0

. la var food_cat "food product or not equals 1 for foods and 0 for non foods"

. gen prod_cat = 2

. la var prod_cat "COICOP product categories, 2 for all non food"

. replace product = 2 if product==0
(3122 real changes made)

. replace food_cat = 2 if food_cat==0
(3122 real changes made)

. gen descript = 2

. la var descript "product description including product code but equals 2 for all non-foods"

. save "$path/out/hhtotalnonfoodexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhtotalnonfoodexp.dta saved

. label define descrip 2 " non food", add

. label values descript descrip

. label define descrip 1 " food", add

. replace descript = 1 in 6
(1 real change made)

. replace descript = 2 in 6
(1 real change made)

. sort hhid

. destring hhid, replace
hhid has all characters numeric; replaced as double

. save "$path/out/hhtotalnonfoodexp.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/hhtotalnonfoodexp.dta saved

. use "$path/out/hhtotalnonfoodexp.dta"

. append using  "$path/out/cons_cod_trans.dta"

. rename quantityz quantityd

. egen cod_hh_nom = rowtotal( hhnonfoodexp valuez)

. la var cod_hh_nom "total household daily expenditure"

. la var quantityd "housedhold daily quantity of food consumed in Kgs"

. drop unit

. drop hhnonfoodexp

. sort hhid

. replace product = 999 if product==2
(3122 real changes made)

. la var product "product code is 999, if product is non food"

. replace prod_cat = 1 if prod_cat==.
(39853 real changes made)

. replace descript=1 if descript==.
(2563 real changes made)

. label drop _all

. save "$path/out/cons_cod.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//out/cons_cod.dta saved

. save "$path/in/cons_cod.dta", replace
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//in/cons_cod.dta saved

. 
. 
end of do-file

. do "$path/new/010_initial.do"

. cap log close

. log using "$path/rep/010_initial.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/010_initial.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:03

. clear

. set more off

. #delimit ;
delimiter now ;
. ******************************************************************************
> * 010_initial.do                (start)
> ******************************************************************************;
. ******************************************************************************
> * Purpose: Set some globals
> ******************************************************************************;
. ******************************************************************************
> * TPI basket
> ******************************************************************************;
. * Number of items for Uganda i primarily set it to 30 on considering a product for appearing
>  over 1000 times on households menu min was 1085 and max was 6157 however the relevant code 
> in new is atvivated to take care of this automatically;
. global product_tpi_n "30";

. * Code choose $product_tpi_n ;
. global product_tpi   "product_tpi==1";

. * Initial (arbitrary) quantile defining poor for price index calculations.
> * Mozambique: bottom 60%. Vietnam: bottom 20%. Tanzania: bottom 40% . Uganda: headcount 2009
>  24.5% ;
. global tpi_bottom "50";

.  * Set the number of regions in the TPI calc for Uganda are set to 4 as east central north a
> nd east;
. global n_tpi "5";

. * To reproduce the mozambique 10 numbers, the following global should be commented out. It c
> ontrols a line in 140_iterate.do 
> * where observations not measured in kg are dropped. For all other datasets, all observation
> s should be converted to kg's before
> * the toolkit is run. For all other datasets, this line should therefore be included.
> global MZ "*";
. ******************************************************************************
> * Initial (arbitrary) quantile defining the (relatively) poor.
> ******************************************************************************;
. global bottom "50";

. ******************************************************************************
> * Number of iterations in 140_iterate.do
> ******************************************************************************;
. global it_n "5";

. ******************************************************************************
> * Set the number of regions in the spatial domain;
. ******************************************************************************;
. global n_spdom "5";

. ******************* we deleted East urban (132 hhds), North urban (172 hhds) and West urban 
> (107 hhds) because too few observations were in those spatial domains;
.  ******************************************************************************
> * Revealed preferences choices
> ******************************************************************************;
. * Activate GAMS program according to number of regions in spatial domain;
. *global revpref "190_revpref13_m1.bat";
. *global no_temp_rev " ";
. * k spatial regions and no intertemporal revealed preference condition:
>   Activate the next two lines below;
. global no_temp_rev "*";

. global revpref "190_revpref13_r.bat";

.  **************************************************************************
> * 010_initial.do                (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/010_initial.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:03
----------------------------------------------------------------------------------------------

. 
end of do-file

. 
. *do "C:\user\gapp\z_data_preb/new/100_collect_expen_moz.do"

. *s;

. 
. *do "C:\user\gapp\z_data_preb/new/000_boom.do"

. 
. *global path "C:\user\gapp"

. 
. 
. 
. **************************************************************************;

. **************************************************************************;

. * This is the block of do files to set up the data to get nominal

. * consumption. These DO NOT need to be bootstrapped.

. **************************************************************************;

. **************************************************************************;

. 
. * This code produces some once for all data for the in-folder. Don't

. * run it unless you know what you are doing!!!

. * Produces education expenditure

. *do "$path\new\Create/education_Create.do"

. * Imputation of missing recepts-in-kind. Run the code without this first...

. *do "$path\new\Create/0_code_chain.do"

. * First poverty lines dependent on IAF

. *do "$path\new\Create/povlines_first_iof_Create.do"

. * Match product codes for different surveys

. *do "$path\new\Create/match96_02_Create.do"

. * Basket from previous survey

. *do "$path\new\Create/smallbasket_iof_Create.do"

. * Match product codes between surveys

. *do "$path\new\Create/rev_pref_matchcodes_02-96_iof_Create.do"

. * Update poverty lines

. *do "$path\new\Create/povlines-96-v1-vers7_iof_Create.do"

. * Food share

. *do "$path\new\Create/foodshr96_iof_Create.do"

. 
. *do "$path\new\Create/.do"

. *do "$path\new\Create/.do"

. 
. */

. * This set of files takes the raw data and creates more handy data 

. * sets in the work-folder

. do "$path/new/020_in_2_work_folder.do"

. clear all

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. set mem 999m

. 
. cap log close

. log using "$path/rep/020_hhdata.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/020_hhdata.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:04

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 020_hhdata.do         (start)
> *
> * Organize the hhid identifier in the HHData file the same way, and keep
> * only the relevant variables.
> *
> * This file sets:
> * - interview month, quarter and year
> * - regions: make all needed regions. But in the end only the one specified
> *            in initial.do are kept. These are
> *            - rural: 0=urban, 1=rural
> *            - news: speficifying North, East, West, South. But combinations
> *                    are also possible, eg. North-East, Center,...
> *            - reg_tpi: regions with own TPI
> *            - strata: strata regions
> *            - spdomain: spatial domains (regions with own poverty line)
> *            - news_ru_ur: combination of news and rural
> **************************************************************************;
. use "$path/in/hhdata.dta", clear;

. *recode spdomain 10=1 11=2 20=3 30=4 40=5 these have been set to five for Uganda to ensure h
> we have at least 1000 households per domain;
. tab spdomain, missing;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |        460       14.73       14.73
Central Rural |        564       18.06       32.79
      Eastern |        697       22.32       55.11
     Northern |        695       22.25       77.36
      Western |        703       22.51       99.87
            . |          4        0.13      100.00
--------------+-----------------------------------
        Total |      3,123      100.00

.         sort hhid;

.         save "$path/work/hhdata.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/hhdata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
          hh |         0
         psu |      3119    2.42e+07    1.16e+07   1.01e+07   4.15e+07
      region |      3119    2.345303    1.154947          1          4
    h1aq1_05 |      3119    241.3331    115.9545        101        415
-------------+--------------------------------------------------------
       h1aq1 |      3119     243.201    116.4849        101        419
       urban |      3119    .2757294    .4469527          0          1
tracking_s~e |      3119    .2055146    .4041419          0          1
    inidpcmp |      3119           2           0          2          2
      h1bq2a |      3119    16.73549    6.425793          3         31
-------------+--------------------------------------------------------
      h1bq2b |      3119    7.762744    1.607834          5         11
      h1bq2c |      3119    2005.357    .4790494       2005       2006
interview_~t |      3119    1.000321    .0179057          1          2
        wave |      3119           0           0          0          0
    hhweight |      3119    1673.657     752.607   140.8407   5553.862
-------------+--------------------------------------------------------
     stratum |      3119    3.711446    1.623898          1          6
    survquar |      3119    2.438602    1.384417          1          5
     survmon |      3119    6.258416     4.17765          1         14
      strata |      3119    4.414877    2.449958          1          8
       rural |      3119    .7242706    .4469527          0          1
-------------+--------------------------------------------------------
     reg_tpi |      3119    2.345303    1.154947          1          4
    spdomain |      3119     3.19782    1.362579          1          5
        news |      3119    2.345303    1.154947          1          4
        bswt |      3119           1           0          1          1
      hhsize |      3123    5.366314    3.108797          1         29

. use "$path/in/indata.dta", clear;

.         *sort hhid;
.         save "$path/work/indata.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/indata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16759    1.15e+12    1.25e+12   2.03e+11   4.61e+12
    motherhh |      8206           0           0          0          0
        hhid |     16759    2.47e+09    1.15e+09   1.01e+09   4.19e+09
         sex |     16759    1.511248    .4998884          1          2
         age |     16759    19.75619    17.18438          0        102

. use "$path/in/calperg.dta", clear;

.         *sort hhid;
.         save "$path/work/calperg.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/calperg.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
    descript |         0
     calperg |        62    1.980935    2.136932          0       8.84

. use "$path/in/cons_cod.dta", clear;

.                 save "$path/work/cons_cod.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_cod.dta saved

. use "$path/in/cons_cod_trans.dta", clear;

.                 save "$path/work/cons_cod_trans.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_cod_trans.dta saved

. /*
> use "$path/in/cons_cod_trans.dta", clear;
>         *sort hhid;
>         sum;
> for var value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3: replace X=0 if X==.;
> collapse food_cat prod_cat (sum) value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3, by(hhid
>  product descript);
>         save "$path/work/cons_cod.dta", replace;
>         sum;
> */
>  
> **************************************************************************
> * 020_hhdata.do         (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. 
. /*
unrecognized command:  / invalid command name
r(199);

. * All kind of raw expenditure is handled: daily, own and monthly, rent and use value, educat
> ion etc.

. do "$path/new/030_rawdata.do"
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//new/030_rawdata.do not found
r(601);

. 
. * Data set specific changes to each processed raw data set takes place here

. do "$path/new/040_specifities.do"
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//new/040_specifities.do not found
r(601);

. 
. * These files summarizes and checks the data. But no temporal deflation done here yet

. do "$path/new/050_consump_nom.do"
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//new/050_consump_nom.do not found
r(601);

. 
. * Bring in data on food product's calories per gram

. do "$path/new/060_calperg.do"
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//new/060_calperg.do not found
r(601);

. */

. **********************************************************************;

. **********************************************************************;

. 
. do "$path/new/070_calpp.do"/* Calories per person in spatial domains*/

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/070_calpp.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/070_calpp.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:05

. clear

. set more off

. #delimit ;
delimiter now ;
. *global fert_rate "fert_rate";
. ***********************************************************************
> * 070_calpp.do          (start)
> *
> * Purpose: Determine calories required for each person per domain per day.
> ***********************************************************************;
. /*
> This file uses:
>         work/indata.dta
>         work/hhdata.dta
> 
> This file creates:
>         work/calpp.dta
> */
> 
> *-------------------------------------------------------------------------*
> * Include fertility rates from csv-file
> *-------------------------------------------------------------------------*;
. clear;

. insheet sex rural age fert_rate using "$path/in/fert_rate_Uganda.csv";
(4 vars, 96 obs)

. ***************************************** check for Ugandan fertility rates ****************
> *********************
> ********************************************************************************************
> *****************;
. sort sex rural age;

. tempfile fert_rate;

. save `fert_rate';
file /tmp/St02564.000001 saved

. list;

     +------------------------------+
     | sex   rural   age   fert_r~e |
     |------------------------------|
  1. |   2       0    12       .008 |
  2. |   2       0    13       .008 |
  3. |   2       0    14       .008 |
  4. |   2       0    15       .134 |
  5. |   2       0    16       .134 |
     |------------------------------|
  6. |   2       0    17       .134 |
  7. |   2       0    18       .134 |
  8. |   2       0    19       .134 |
  9. |   2       0    20       .313 |
 10. |   2       0    21       .313 |
     |------------------------------|
 11. |   2       0    22       .313 |
 12. |   2       0    23       .313 |
 13. |   2       0    24       .313 |
 14. |   2       0    25       .291 |
 15. |   2       0    26       .291 |
     |------------------------------|
 16. |   2       0    27       .291 |
 17. |   2       0    28       .291 |
 18. |   2       0    29       .291 |
 19. |   2       0    30       .232 |
 20. |   2       0    31       .232 |
     |------------------------------|
 21. |   2       0    32       .232 |
 22. |   2       0    33       .232 |
 23. |   2       0    34       .232 |
 24. |   2       0    35       .172 |
 25. |   2       0    36       .172 |
     |------------------------------|
 26. |   2       0    37       .172 |
 27. |   2       0    38       .172 |
 28. |   2       0    39       .172 |
 29. |   2       0    40       .074 |
 30. |   2       0    41       .074 |
     |------------------------------|
 31. |   2       0    42       .074 |
 32. |   2       0    43       .074 |
 33. |   2       0    44       .074 |
 34. |   2       0    45       .023 |
 35. |   2       0    46       .023 |
     |------------------------------|
 36. |   2       0    47       .023 |
 37. |   2       0    48       .023 |
 38. |   2       0    49       .023 |
 39. |   2       0    50       .006 |
 40. |   2       0    51       .006 |
     |------------------------------|
 41. |   2       0    52       .006 |
 42. |   2       0    53       .006 |
 43. |   2       0    54       .006 |
 44. |   2       0    55       .006 |
 45. |   2       0    56       .006 |
     |------------------------------|
 46. |   2       0    57       .006 |
 47. |   2       0    58       .006 |
 48. |   2       0    59       .006 |
 49. |   2       1    12       .008 |
 50. |   2       1    13       .008 |
     |------------------------------|
 51. |   2       1    14       .008 |
 52. |   2       1    15       .134 |
 53. |   2       1    16       .134 |
 54. |   2       1    17       .134 |
 55. |   2       1    18       .134 |
     |------------------------------|
 56. |   2       1    19       .134 |
 57. |   2       1    20       .313 |
 58. |   2       1    21       .313 |
 59. |   2       1    22       .313 |
 60. |   2       1    23       .313 |
     |------------------------------|
 61. |   2       1    24       .313 |
 62. |   2       1    25       .291 |
 63. |   2       1    26       .291 |
 64. |   2       1    27       .291 |
 65. |   2       1    28       .291 |
     |------------------------------|
 66. |   2       1    29       .291 |
 67. |   2       1    30       .232 |
 68. |   2       1    31       .232 |
 69. |   2       1    32       .232 |
 70. |   2       1    33       .232 |
     |------------------------------|
 71. |   2       1    34       .232 |
 72. |   2       1    35       .172 |
 73. |   2       1    36       .172 |
 74. |   2       1    37       .172 |
 75. |   2       1    38       .172 |
     |------------------------------|
 76. |   2       1    39       .172 |
 77. |   2       1    40       .074 |
 78. |   2       1    41       .074 |
 79. |   2       1    42       .074 |
 80. |   2       1    43       .074 |
     |------------------------------|
 81. |   2       1    44       .074 |
 82. |   2       1    45       .023 |
 83. |   2       1    46       .023 |
 84. |   2       1    47       .023 |
 85. |   2       1    48       .023 |
     |------------------------------|
 86. |   2       1    49       .023 |
 87. |   2       1    50       .006 |
 88. |   2       1    51       .006 |
 89. |   2       1    52       .006 |
 90. |   2       1    53       .006 |
     |------------------------------|
 91. |   2       1    54       .006 |
 92. |   2       1    55       .006 |
 93. |   2       1    56       .006 |
 94. |   2       1    57       .006 |
 95. |   2       1    58       .006 |
     |------------------------------|
 96. |   2       1    59       .006 |
     +------------------------------+

. *-------------------------------------------------------------------------*
> * Now do the calorie needs for individuals
> *-------------------------------------------------------------------------*;
. use "$path/work/indata.dta";

. * CA bootstrap modification;
. sort hhid;

. merge hhid using "$path/work/hhdata.dta";
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     16,759      100.00      100.00
------------+-----------------------------------
      Total |     16,759      100.00

.  drop _m;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16759    1.15e+12    1.25e+12   2.03e+11   4.61e+12
    motherhh |      8206           0           0          0          0
        hhid |     16759    2.47e+09    1.15e+09   1.01e+09   4.19e+09
         sex |     16759    1.511248    .4998884          1          2
         age |     16759    19.75619    17.18438          0        102
-------------+--------------------------------------------------------
          hh |         0
         psu |     16731    2.45e+07    1.14e+07   1.01e+07   4.15e+07
      region |     16731    2.379953    1.140978          1          4
    h1aq1_05 |     16731    244.8445    114.4735        101        415
       h1aq1 |     16731    246.7354    115.0025        101        419
-------------+--------------------------------------------------------
       urban |     16731    .2545574    .4356252          0          1
tracking_s~e |     16731    .2037535    .4027998          0          1
    inidpcmp |     16731           2           0          2          2
      h1bq2a |     16731    16.78083    6.442273          3         31
      h1bq2b |     16731    7.682027    1.614348          5         11
-------------+--------------------------------------------------------
      h1bq2c |     16731    2005.375    .4840427       2005       2006
interview_~t |     16731    1.000418    .0204508          1          2
        wave |     16731           0           0          0          0
    hhweight |     16731    1683.355    737.5353   140.8407   5553.862
     stratum |     16731    3.784651    1.590639          1          6
-------------+--------------------------------------------------------
    survquar |     16731    2.461419    1.413745          1          5
     survmon |     16731    6.304465    4.259338          1         14
      strata |     16731    4.505349    2.406286          1          8
       rural |     16731    .7454426    .4356252          0          1
     reg_tpi |     16731    2.379953    1.140978          1          4
-------------+--------------------------------------------------------
    spdomain |     16731      3.2539    1.326619          1          5
        news |     16731    2.379953    1.140978          1          4
        bswt |     16731           1           0          1          1
      hhsize |     16759    7.166716    3.472568          1         29

. * Include fertility rates;
. sort sex rural age;

. merge sex rural age using `fert_rate';
variables sex rural age do not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16759    1.15e+12    1.25e+12   2.03e+11   4.61e+12
    motherhh |      8206           0           0          0          0
        hhid |     16759    2.47e+09    1.15e+09   1.01e+09   4.19e+09
         sex |     16759    1.511248    .4998884          1          2
         age |     16759    19.75619    17.18438          0        102
-------------+--------------------------------------------------------
          hh |         0
         psu |     16731    2.45e+07    1.14e+07   1.01e+07   4.15e+07
      region |     16731    2.379953    1.140978          1          4
    h1aq1_05 |     16731    244.8445    114.4735        101        415
       h1aq1 |     16731    246.7354    115.0025        101        419
-------------+--------------------------------------------------------
       urban |     16731    .2545574    .4356252          0          1
tracking_s~e |     16731    .2037535    .4027998          0          1
    inidpcmp |     16731           2           0          2          2
      h1bq2a |     16731    16.78083    6.442273          3         31
      h1bq2b |     16731    7.682027    1.614348          5         11
-------------+--------------------------------------------------------
      h1bq2c |     16731    2005.375    .4840427       2005       2006
interview_~t |     16731    1.000418    .0204508          1          2
        wave |     16731           0           0          0          0
    hhweight |     16731    1683.355    737.5353   140.8407   5553.862
     stratum |     16731    3.784651    1.590639          1          6
-------------+--------------------------------------------------------
    survquar |     16731    2.461419    1.413745          1          5
     survmon |     16731    6.304465    4.259338          1         14
      strata |     16731    4.505349    2.406286          1          8
       rural |     16731    .7454426    .4356252          0          1
     reg_tpi |     16731    2.379953    1.140978          1          4
-------------+--------------------------------------------------------
    spdomain |     16731      3.2539    1.326619          1          5
        news |     16731    2.379953    1.140978          1          4
        bswt |     16731           1           0          1          1
      hhsize |     16759    7.166716    3.472568          1         29
   fert_rate |      4895    .1603115    .1141129       .006       .313
-------------+--------------------------------------------------------
      _merge |     16759    1.584164    .9094666          1          3

. * Do calorie calculations ;
.     gen num=1;

.     gen cal = .;
(16759 missing values generated)

. * Same assumptions about sex/age specific calories need in IAF 1997, IAF 2003 and IOF 2009;
. * Children (no difference between boys and girls)   ;
.      replace cal =  820 if age < 1;
(636 real changes made)

. * Add 500 cal per day for mothers in first six months of breast feeding
> * We assume that 60% of children under 1 are under six months old
> * And that all of them breast feed
> * We add these mother requirements of 300 on average to each child under 1 whose mother is a
> live;
.     replace cal = 1120 if age <  1 & motherhh==1;
(0 real changes made)

.     replace cal = 1150 if age >= 1 & age <2;
(571 real changes made)

.     replace cal = 1350 if age >= 2 & age <3;
(637 real changes made)

.     replace cal = 1550 if age >= 3 & age <5;
(1080 real changes made)

. * Males ;
.     replace cal = 1850 if age >=  5 & age <7  & sex==1;
(582 real changes made)

.     replace cal = 2100 if age >=  7 & age <10 & sex==1;
(773 real changes made)

.     replace cal = 2200 if age >= 10 & age <12 & sex==1;
(486 real changes made)

.     replace cal = 2400 if age >= 12 & age <14 & sex==1;
(532 real changes made)

.     replace cal = 2650 if age >= 14 & age <16 & sex==1;
(471 real changes made)

.     replace cal = 2850 if age >= 16 & age <18 & sex==1;
(384 real changes made)

.     replace cal = 3000 if age >= 18 & age <30 & sex==1;
(1590 real changes made)

.     replace cal = 2900 if age >= 30 & age <60 & sex==1;
(1606 real changes made)

.     replace cal = 2450 if age>=60 & age~=. & sex==1;
(312 real changes made)

. * Girls 5-12 years (probability of pregnancy assumed = 0) ;
.     replace cal = 1750 if age >=  5 & age < 7 & sex==2;
(563 real changes made)

.     replace cal = 1800 if age >=  7 & age <10 & sex==2;
(755 real changes made)

.     replace cal = 1950 if age >= 10 & age <12 & sex==2;
(540 real changes made)

. * Women with a correction for pregnancy. We add 285 calories per for the final trimester.
> * To do this we find the probability that rural and urban women are pregnant from
> * live births data in the 1997 census over the past 12 months (no correction for still birth
> s).
> * 3/4*probability of birth gives probability of preganancy. Probability of final trimester i
> s one
> * third of that of that or 1/4 of the probability of birth
> 
> * Women urban;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==0;
(134 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==0;
(222 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==0;
(623 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==0;
(422 real changes made)

. * Women rural;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==1;
(374 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==1;
(630 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==1;
(1242 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==1;
(1248 real changes made)

. * Women 60+ are not pregnant ;
.     replace cal = 1950 if age>=60 & age~=. & sex==2;
(339 real changes made)

.     count if cal ==.;
    7

.     *Fill in these two observations for IAF 2002/03:;
.     * 1) this one is a child;
.     *replace cal = 1500 if cal ==. & age==.;
.     * 2) this one is 21 years old;
.     *replace cal = 2500 if cal ==. & b2==.;
.     collapse (sum) cal num (max) psu hhsize hhweight strata rural spdomain, by (hhid);

.     gen chk=hhsize - num;

.     sum chk;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
         chk |      3123           0           0          0          0

.     drop chk;

.     gen calpp = cal / hhsize;

.     sort spdomain;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
         cal |      3123    11467.27    6718.735       1950   70377.13
         num |      3123    5.366314    3.108797          1         29
         psu |      3119    2.42e+07    1.16e+07   1.01e+07   4.15e+07
      hhsize |      3123    5.366314    3.108797          1         29
-------------+--------------------------------------------------------
    hhweight |      3119    1673.657     752.607   140.8407   5553.862
      strata |      3119    4.414877    2.449958          1          8
       rural |      3119    .7242706    .4469527          0          1
    spdomain |      3119     3.19782    1.362579          1          5
       calpp |      3123    2185.638     303.542       1310       3000

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
         cal |      3123    11467.27    6718.735       1950   70377.13
         num |      3123    5.366314    3.108797          1         29
         psu |      3119    2.42e+07    1.16e+07   1.01e+07   4.15e+07
      hhsize |      3123    5.366314    3.108797          1         29
-------------+--------------------------------------------------------
    hhweight |      3119    1673.657     752.607   140.8407   5553.862
      strata |      3119    4.414877    2.449958          1          8
       rural |      3119    .7242706    .4469527          0          1
    spdomain |      3119     3.19782    1.362579          1          5
       calpp |      3123    2185.638     303.542       1310       3000

.  codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              Household ID
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3123                     missing .:  0/3123

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. collapse (mean) calpp[aw=hhsize*hhweight], by (spdomain);

. sort spdomain;

. save "$path/work/calpp.dta",replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/calpp.dta saved

. ***********************************************************************
> * 070_calpp.do          (end)
> ***********************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/070_calpp.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:06
----------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/080_conpc.do"/* Nominal food/non-food expenditure */

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 100m

. 
. clear

. cap log close

. log using "$path/rep/080_conpc.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/080_conpc.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:06

. set more off

. 
. 
. ***************************************************************************
. * 080_conpc.do          (start)
. *
. * Creates a file with per capita nominal consumption divided between food
. * and non-food categories based on the calorie definition of food
. * rather than the COICOP (INE) definition of food. ready for 
. * temporal deflation when necessary
. **************************************************************************** 
. 
. /*
> This file uses:
>         work/hhdata.dta
>         work/consump_nom.dta
>       
> This file creates:
>         work/conpc.dta
> */
. 
. 
. 
. ***************************************************************************
. * Food expenditure
. **************************************************************************** 
. *use "$path/in/cons_cod.dta" 
. use "$path/work/cons_cod.dta" 

.             *sort product 
.             *merge product using "$path/work/food_cat.dta" 
.             *tab _m 
.             *drop _m 
.             keep if food_cat==1 
(3977 observations deleted)

.             collapse (sum) cod_hh_nom, by(hhid) 

.             rename cod_hh_nom food_hh_nom 

.                 sort hhid 

.             keep hhid food_hh_nom 

.             tempfile foodexp 

. save `foodexp' 
file /tmp/St02564.000001 saved

. 
. ***************************************************************************
. * Food expenditure merged with all expenditure
. **************************************************************************** 
. use "$path/work/cons_cod.dta" 

. *use "$path/in/cons_cod.dta" 
. *use "$path/in/cons_cat.dta" 
. sum 

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42120    2.35e+09    1.17e+09   1.01e+09   4.19e+09
     product |     42975    193.7532    225.9257        100        999
    food_cat |     42120    1.074122    .2619717          1          2
    prod_cat |     42975    1.072647     .259559          1          2
    descript |     42975    112.7149    45.82533          1        172
-------------+--------------------------------------------------------
       untcd |     38654    42.16236    29.89049          1        143
   quantityd |     38998    .5255736     .974978          0   57.14286
      valuez |     38998    254.6912    460.8533          0   39285.71
      untdes |     37290    40.64728    29.24059          1        143
     qkg_uca |     36999     2.23029    5.213349       .001      186.2
-------------+--------------------------------------------------------
    quantity |     36287    .9825775    2.842624          0      135.2
  cod_hh_nom |     42975    430.3994    1512.109          0   72488.63

. collapse (sum) cod_hh_nom, by(hhid) 

. *gen cons_pc_nom = cons_hh_nom/hhsize 
. rename cod_hh_nom cons_hh_nom 

. *keep  hhid cons_pc_nom cons_hh_nom  
. *keep hhid cod_hh_nom 
. *use "$path/in/cons_cod.dta" 
. *use "$path/in/consump_nom.dta" 
. *use "$path/work/consump_nom.dta" 
. *            keep  hhid cons_hh_nom  
.             display _N 
3123

.             keep  hhid cons_hh_nom  

.             sort hhid 

.             merge hhid using "$path/work/hhdata.dta" 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          2 |          1        0.03        0.06
          3 |      3,122       99.94      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.             drop _m 

. gen cons_pc_nom = cons_hh_nom/hhsize 
(2 missing values generated)

.             sort hhid 

.             merge hhid using `foodexp' 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        0.13        0.13
          3 |      3,120       99.87      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                 drop if _merge==2 
(0 observations deleted)

.             replace food_hh_nom=0 if _merge==1 & food_hh_nom==. 
(4 real changes made)

.             drop _m 

.                 gen food_pc_nom=food_hh_nom/hhsize 
(1 missing value generated)

.                 gen nf_hh_nom=cons_hh_nom-food_hh_nom 
(1 missing value generated)

.             gen nf_pc_nom=nf_hh_nom/hhsize 
(2 missing values generated)

.  
.             keep hhid cons_hh_nom food_pc_nom nf_pc_nom cons_pc_nom survquar spdomain news r
> eg_tpi rural hhweight hhsize 

.             lab var food_pc_nom "nominal food consumption per capita" 

.             lab var nf_pc_nom "nominal non-food consumption per capita" 

. keep hhid cons_hh_nom cons_pc_nom food_pc_nom nf_pc_nom 

.             sort hhid 

. 
. * MAH   sum  codebook hhid 
. save "$path/work/conpc.dta", replace 
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/conpc.dta saved

. 
. 
. ***************************************************************************
. * 080_conpc.do          (end)
. **************************************************************************** 
. 
. 
. log close 
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/080_conpc.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:06
----------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/090_temp_index.do"

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/090_temp_index.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/090_temp_index.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:06

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 090_temp_index.do     (start)
> **************************************************************************;
. *do "$path/new/010_initial.do";
. **************************************************************************
> * Program to compute the temporal price index (intra-survey)
> * 
> * The index is based on 6 regions (North/Center/South by rural/urban) 
> * and four quarters. For IAF 2002/03 (t=t1) it is based on the same 9
> * commodities used for the analysis of the 1996 IAF (t=t0), 
> * except that we have to go to 8 commodities because the 2002-03 survey 
> * does not distinguish between large and small groundnuts, which were 
> * separate items in the old index. For IOF 2008/09 (t=t2) we expand the
> * the food basket to include the 15 most important food products among
> * the poorest.
> *
> * The commodity weights for the items vary by the 6 regions, and are 
> * calculated from the observations in the IAF2002, using the relatively 
> * poor households (below median nominal consumption per capita).
> *
> * The unit values (prices) calculated here are also based on the prices 
> * paid by the relatively poor, using the same definition.
> *
> * K Simler, Sep 2003
> * CA
> * MAH, April 2010
> * URB, Feb 2013 (automatization to any number of n_tpi's)
> **************************************************************************;
. /*
> This file uses:
>         work/own.dta
>         work/receipts.dta
>         work/daily.dta
>         work/hhdata
>         work/cons_cat.dta
> 
> This file creates:
>         work/tpi_unit_val_quarterly.dta
>         work/tpi_unit_val_monthly.dta
>         work/tpi_news_share.dta
>         work/tpi_reg_tpi_share.dta
>         work/temp_index_news.dta
>         work/temp_index_reg_tpi.dta
> */      
> 
> 
> **************************************************************************
> * Either the products used for intertemporal price index is specified
> * explicitly, or they are automatically found as the the n_tpi products
> * with the highest weighted expenditure shares among the $bottom % poorest
> * part of the population
> **************************************************************************;
. * Generating the n_tpi most important food items for the poorest $bottom % ;
. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (start)
> **************************************************************************;
. *------------------------------------------------------------------------*
> * Population weights for each HH
> *------------------------------------------------------------------------*;
. use "$path/work/hhdata.dta", clear;

. keep hhid hhweight hhsize;

. gen popwt = hhweight*hhsize;
(4 missing values generated)

. lab var popwt "Population weights = hhsize X hhweight";

. sort hhid;

. tempfile popwt;

. save `popwt', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
    hhweight |      3119    1673.657     752.607   140.8407   5553.862
      hhsize |      3123    5.366314    3.108797          1         29
       popwt |      3119    9029.887     6948.95     201.98   61536.83

. *------------------------------------------------------------------------*
> * Make list of all consumed products
> *------------------------------------------------------------------------*;
. *use "$path/in/cons_cod.dta", clear;
. *save "$path/work/cons_cod.dta", replace;
. use "$path/work/cons_cod.dta", clear;

. keep product descript;

. collapse product, by(descript);

. sort product;

. tempfile descript;

. save `descript', replace;
(note: file /tmp/St02564.000002 not found)
file /tmp/St02564.000002 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    descript |        71    134.0986    30.19988          1        172
     product |        71     150.174    104.0955        100        999

. *------------------------------------------------------------------------*
> * Find the poorest part of the population
> *------------------------------------------------------------------------*;
. use
> "$path/work/cons_cod.dta", clear;

. *use
> *"$path/work/cons_cod.dta", clear;
. ********************************************check the COICOP categories to create the variab
> le prod_cat, for the moment it is equal to food_cat******;
. keep hhid prod_cat product cod_hh_nom;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42120    2.35e+09    1.17e+09   1.01e+09   4.19e+09
     product |     42975    193.7532    225.9257        100        999
    prod_cat |     42975    1.072647     .259559          1          2
  cod_hh_nom |     42975    430.3994    1512.109          0   72488.63

. merge hhid using `popwt';
variable hhid does not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42121    2.35e+09    1.17e+09   1.01e+09   4.19e+09
     product |     42975    193.7532    225.9257        100        999
    prod_cat |     42975    1.072647     .259559          1          2
  cod_hh_nom |     42975    430.3994    1512.109          0   72488.63
    hhweight |     42063    1663.904    765.4544   140.8407   5553.862
-------------+--------------------------------------------------------
      hhsize |     42121    5.699366    3.142954          1         29
       popwt |     42063    9531.535    7231.145     201.98   61536.83
      _merge |     42976    2.960187    .2793194          1          3

. drop _merge;

. preserve;

. collapse (sum) cod_hh_nom (mean) popwt hhweight hhsize, by(hhid);

. gen cod_pc_nom = cod_hh_nom/hhsize;
(1 missing value generated)

.         sum cod_pc_nom [aw=popwt] , detail;

                         cod_pc_nom
-------------------------------------------------------------
      Percentiles      Smallest
 1%     186.1903              0
 5%     275.7369       103.3254
10%     353.8824       125.3987       Obs                3119
25%     489.4693       126.4294       Sum of Wgt.  28164219.1

50%     769.2858                      Mean           1059.709
                        Largest       Std. Dev.       1073.31
75%     1221.598       20495.57
90%     2053.998       20954.27       Variance        1151995
95%     2859.285       22853.78       Skewness       5.701393
99%     5168.295       23846.89       Kurtosis        70.5224

.         global medcpc_= r(p$tpi_bottom);

.         gen bottom_ = cod_pc_nom <= $medcpc_;

. sum [aw=popwt];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    3119  28164219.1    2.48e+09   1.19e+09   1.01e+09   4.19e+09
  cod_hh_nom |    3119  28164219.1    7210.542   7751.913          0   84210.06
       popwt |    3119  28164219.1    14375.74   9296.074     201.98   61536.83
    hhweight |    3119  28164219.1    2006.475   790.1052   140.8407   5553.862
      hhsize |    3119  28164219.1    7.167363   3.433959          1         29
-------------+-----------------------------------------------------------------
  cod_pc_nom |    3119  28164219.1    1059.709    1073.31          0   23846.89
     bottom_ |    3119  28164219.1    .5005946   .5000798          0          1

. sum [aw=hhweight];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    3119  5220136.65    2.44e+09   1.20e+09   1.01e+09   4.19e+09
  cod_hh_nom |    3119  5220136.65    5717.451   6407.983          0   84210.06
       popwt |    3119  5220136.65    10825.54   7890.683     201.98   61536.83
    hhweight |    3119  5220136.65     2011.98   812.8751   140.8407   5553.862
      hhsize |    3119  5220136.65    5.395303    3.09255          1         29
-------------+-----------------------------------------------------------------
  cod_pc_nom |    3119  5220136.65    1248.649   1406.246          0   23846.89
     bottom_ |    3119  5220136.65    .4413824   .4966317          0          1

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
  cod_hh_nom |      3124    5920.748    6787.715          0   84210.06
       popwt |      3119    9029.887     6948.95     201.98   61536.83
    hhweight |      3119    1673.657     752.607   140.8407   5553.862
      hhsize |      3123    5.366314    3.108797          1         29
-------------+--------------------------------------------------------
  cod_pc_nom |      3123     1329.67    1627.455          0   23846.89
     bottom_ |      3124    .4372599    .4961275          0          1

. keep if bottom_==1;
(1758 observations deleted)

. keep hhid;

. sort hhid;

. tempfile hhid;

. save `hhid';
file /tmp/St02564.000004 saved

. restore;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42121    2.35e+09    1.17e+09   1.01e+09   4.19e+09
     product |     42975    193.7532    225.9257        100        999
    prod_cat |     42975    1.072647     .259559          1          2
  cod_hh_nom |     42975    430.3994    1512.109          0   72488.63
    hhweight |     42063    1663.904    765.4544   140.8407   5553.862
-------------+--------------------------------------------------------
      hhsize |     42121    5.699366    3.142954          1         29
       popwt |     42063    9531.535    7231.145     201.98   61536.83

. merge hhid using `hhid';
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     27,655       64.35       64.35
          3 |     15,321       35.65      100.00
------------+-----------------------------------
      Total |     42,976      100.00

. keep if _m==3;
(27655 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     15321    2.68e+09    9.79e+08   1.02e+09   4.19e+09
     product |     15320    208.0257    247.8593        100        999
    prod_cat |     15320    1.089099    .2848962          1          2
  cod_hh_nom |     15320     265.924     418.148          0   7644.004
    hhweight |     15292    1691.487    626.3613   140.8407     4498.1
-------------+--------------------------------------------------------
      hhsize |     15321     6.45715    2.964676          1         29
       popwt |     15292    10866.38    6567.464    225.125   56511.65
      _merge |     15321           3           0          3          3

. *------------------------------------------------------------------------*
> * Keep only food product expenditure by the poor. Calculate food product
> * share of total food expenditure by the poor
> *------------------------------------------------------------------------*;
. keep if prod_cat==1;
(1366 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     13955    2.68e+09    9.79e+08   1.02e+09   4.19e+09
     product |     13955     130.657    16.01476        100        161
    prod_cat |     13955           1           0          1          1
  cod_hh_nom |     13955    195.7463    277.9207          0       4000
    hhweight |     13929     1691.59    624.9568   140.8407     4498.1
-------------+--------------------------------------------------------
      hhsize |     13955    6.487567    2.968187          1         29
       popwt |     13929     10917.5    6581.081    225.125   56511.65
      _merge |     13955           3           0          3          3

. sort product;

. *preserve;
. collapse (sum) cod_hh_nom [aw=hhweight], by(product);

. sort cod;

. egen total=sum(cod_hh_nom);

. gen sh=100*cod_hh_nom/total;

. *------------------------------------------------------------------------*
> * Include product labels
> *------------------------------------------------------------------------*;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        53    130.3019    16.22034        100        161
  cod_hh_nom |        53    51685.07     70019.9          0   285452.1
       total |        53     2739309           0    2739309    2739309
          sh |        53    1.886792    2.556116          0   10.42059

. sort product;

. merge product using `descript';

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         18       25.35       25.35
          3 |         53       74.65      100.00
------------+-----------------------------------
      Total |         71      100.00

. keep if _merge==1 | _merge==3;
(18 observations deleted)

. drop _merge;

. sort sh;

. *list;
. list in -$product_tpi_n/-1;

     +----------------------------------------------------+
     | product   cod_hh~m     total         sh   descript |
     |----------------------------------------------------|
 24. |     146   23070.11   2739309   .8421873        146 |
 25. |     150   25316.98   2739309   .9242105        150 |
 26. |     157   27412.62   2739309   1.000713        157 |
 27. |     143   28630.19   2739309   1.045161        143 |
 28. |     144   29305.61   2739309   1.069818        144 |
     |----------------------------------------------------|
 29. |     134   30007.02   2739309   1.095423        134 |
 30. |     109   31458.23   2739309     1.1484        109 |
 31. |     161    31797.2   2739309   1.160775        161 |
 32. |     119   32056.73   2739309   1.170249        119 |
 33. |     110   35221.35   2739309   1.285775        110 |
     |----------------------------------------------------|
 34. |     138   35735.55   2739309   1.304546        138 |
 35. |     121   38001.51   2739309   1.387266        121 |
 36. |     112   44222.42   2739309   1.614364        112 |
 37. |     136   46645.93   2739309   1.702836        136 |
 38. |     140   47757.93   2739309    1.74343        140 |
     |----------------------------------------------------|
 39. |     115   54456.53   2739309   1.987966        115 |
 40. |     122   55961.67   2739309   2.042912        122 |
 41. |     116   57174.44   2739309   2.087185        116 |
 42. |     127   57759.82   2739309   2.108555        127 |
 43. |     139   60254.97   2739309   2.199641        139 |
     |----------------------------------------------------|
 44. |     125   67827.11   2739309   2.476067        125 |
 45. |     123   74151.96   2739309   2.706959        123 |
 46. |     117   96047.05   2739309   3.506251        117 |
 47. |     147   119788.4   2739309   4.372942        147 |
 48. |     107   150986.5   2739309   5.511846        107 |
     |----------------------------------------------------|
 49. |     108   208942.2   2739309   7.627553        108 |
 50. |     100   237663.9   2739309   8.676054        100 |
 51. |     141   240267.8   2739309   8.771111        141 |
 52. |     113   251597.5   2739309   9.184708        113 |
 53. |     105   285452.1   2739309   10.42059        105 |
     +----------------------------------------------------+

. list product descript in -$product_tpi_n/-1;

     +--------------------+
     | product   descript |
     |--------------------|
 24. |     146        146 |
 25. |     150        150 |
 26. |     157        157 |
 27. |     143        143 |
 28. |     144        144 |
     |--------------------|
 29. |     134        134 |
 30. |     109        109 |
 31. |     161        161 |
 32. |     119        119 |
 33. |     110        110 |
     |--------------------|
 34. |     138        138 |
 35. |     121        121 |
 36. |     112        112 |
 37. |     136        136 |
 38. |     140        140 |
     |--------------------|
 39. |     115        115 |
 40. |     122        122 |
 41. |     116        116 |
 42. |     127        127 |
 43. |     139        139 |
     |--------------------|
 44. |     125        125 |
 45. |     123        123 |
 46. |     117        117 |
 47. |     147        147 |
 48. |     107        107 |
     |--------------------|
 49. |     108        108 |
 50. |     100        100 |
 51. |     141        141 |
 52. |     113        113 |
 53. |     105        105 |
     +--------------------+

. *restore;
. *------------------------------------------------------------------------*
> * Keep the required number of most important food products
> *------------------------------------------------------------------------*;
. keep in -$product_tpi_n/-1;
(23 observations deleted)

. list;

     +----------------------------------------------------+
     | product   cod_hh~m     total         sh   descript |
     |----------------------------------------------------|
  1. |     146   23070.11   2739309   .8421873        146 |
  2. |     150   25316.98   2739309   .9242105        150 |
  3. |     157   27412.62   2739309   1.000713        157 |
  4. |     143   28630.19   2739309   1.045161        143 |
  5. |     144   29305.61   2739309   1.069818        144 |
     |----------------------------------------------------|
  6. |     134   30007.02   2739309   1.095423        134 |
  7. |     109   31458.23   2739309     1.1484        109 |
  8. |     161    31797.2   2739309   1.160775        161 |
  9. |     119   32056.73   2739309   1.170249        119 |
 10. |     110   35221.35   2739309   1.285775        110 |
     |----------------------------------------------------|
 11. |     138   35735.55   2739309   1.304546        138 |
 12. |     121   38001.51   2739309   1.387266        121 |
 13. |     112   44222.42   2739309   1.614364        112 |
 14. |     136   46645.93   2739309   1.702836        136 |
 15. |     140   47757.93   2739309    1.74343        140 |
     |----------------------------------------------------|
 16. |     115   54456.53   2739309   1.987966        115 |
 17. |     122   55961.67   2739309   2.042912        122 |
 18. |     116   57174.44   2739309   2.087185        116 |
 19. |     127   57759.82   2739309   2.108555        127 |
 20. |     139   60254.97   2739309   2.199641        139 |
     |----------------------------------------------------|
 21. |     125   67827.11   2739309   2.476067        125 |
 22. |     123   74151.96   2739309   2.706959        123 |
 23. |     117   96047.05   2739309   3.506251        117 |
 24. |     147   119788.4   2739309   4.372942        147 |
 25. |     107   150986.5   2739309   5.511846        107 |
     |----------------------------------------------------|
 26. |     108   208942.2   2739309   7.627553        108 |
 27. |     100   237663.9   2739309   8.676054        100 |
 28. |     141   240267.8   2739309   8.771111        141 |
 29. |     113   251597.5   2739309   9.184708        113 |
 30. |     105   285452.1   2739309   10.42059        105 |
     +----------------------------------------------------+

. gen product_tpi=1;

. keep product product_tpi;

. list;

     +--------------------+
     | product   produc~i |
     |--------------------|
  1. |     146          1 |
  2. |     150          1 |
  3. |     157          1 |
  4. |     143          1 |
  5. |     144          1 |
     |--------------------|
  6. |     134          1 |
  7. |     109          1 |
  8. |     161          1 |
  9. |     119          1 |
 10. |     110          1 |
     |--------------------|
 11. |     138          1 |
 12. |     121          1 |
 13. |     112          1 |
 14. |     136          1 |
 15. |     140          1 |
     |--------------------|
 16. |     115          1 |
 17. |     122          1 |
 18. |     116          1 |
 19. |     127          1 |
 20. |     139          1 |
     |--------------------|
 21. |     125          1 |
 22. |     123          1 |
 23. |     117          1 |
 24. |     147          1 |
 25. |     107          1 |
     |--------------------|
 26. |     108          1 |
 27. |     100          1 |
 28. |     141          1 |
 29. |     113          1 |
 30. |     105          1 |
     +--------------------+

. sort product;

. tempfile product_tpi;

. save `product_tpi', replace;
(note: file /tmp/St02564.000005 not found)
file /tmp/St02564.000005 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        30       127.5    16.77591        100        161
 product_tpi |        30           1           0          1          1

. clear;

. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (end)
> **************************************************************************;
. **************************************************************************;
. * First, need to calculate the average prices for the food items, by 
> * strata and quarter. For this, we are using the "unit values"
> * (value/quantity) for the observations in the consumption questionnaires,
> * including daily, own and receipts-in-kind.
> *
> * The unit values are constructed as sum(value)/sum(quantity), which effectively
> * weights them by the quantity and value of the transaction. Sampling
> * weights are also used.
> *
> * Get the own consumption file, and limit analysis to the observations
> * in KGs where both value and quantity are available.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. *use "$path/work/cons_cod.dta";
. keep if prod_cat==1;
(3122 observations deleted)

. drop if quantityd==0 | quantityd==.;
(2057 observations deleted)

. *keep if quantityd!=. & cod_hh_nom2!=.;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     37796    2.36e+09    1.17e+09   1.01e+09   4.19e+09
     product |     37796     129.612    15.56369        100        158
    food_cat |     37796           1           0          1          1
    prod_cat |     37796           1           0          1          1
    descript |     37796    124.8312    28.44431          1        158
-------------+--------------------------------------------------------
       untcd |     37796    41.40547    29.19073          1         99
   quantityd |     37796     .542288    .9857734   .0057143   57.14286
      valuez |     37796    238.0692    351.5228          0       7500
      untdes |     36432    39.82636     28.4377          1         99
     qkg_uca |     36284    2.194586    4.830398       .001     113.25
-------------+--------------------------------------------------------
    quantity |     36284    .9826587    2.842728      .0001      135.2
  cod_hh_nom |     37796    238.0692    351.5228          0       7500

. sort product;

. merge product using `product_tpi';
variable product does not uniquely identify observations in the master data

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,873       23.47       23.47
          2 |          2        0.01       23.48
          3 |     28,923       76.52      100.00
------------+-----------------------------------
      Total |     37,798      100.00

. drop _merge;

. keep if $product_tpi;
(8873 observations deleted)

. *        replace valued_ac=0 if valued_ac==.;
. *        replace quantityd_ac=0 if quantityd_ac==.;
.         gen valued_tot=cod_hh_nom;
(2 missing values generated)

.         gen quantityd_tot=quantityd;
(2 missing values generated)

. *               replace quantityd_tot=0 if (valued_tot>0 & valued_tot<.) & quantityd_tot==.;
.         keep if quantityd_tot!=. & valued_tot!=.;
(2 observations deleted)

.                 collapse (sum) valued_tot quantityd_tot, by(hhid product);

.                 sort hhid;

. tempfile acredd;

. save `acredd' , replace;
(note: file /tmp/St02564.000006 not found)
file /tmp/St02564.000006 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     28800    2.39e+09    1.16e+09   1.01e+09   4.19e+09
     product |     28800    127.6664    15.94733        100        150
  valued_tot |     28800    274.7174     386.191   1.428571       7500
quantityd_~t |     28800    .5733206    .9622761   .0071429         50

. /*
> **************************************************************************;
> * Create a data set with an empty 1 observation. Used to avoid empty data
> * sets when the survey do not have the Mozambican set up
> **************************************************************************;
> use "$path/work/own.dta";
> 
> preserve;
> keep in 1;
> drop unit valued quantityd;
> gen unit=2;
> gen valued=0;
> gen quantityd=0;
> tempfile 1obs;
> save `1obs';
> restore;
> 
> **************************************************************************;
> * Own consumption
> **************************************************************************;
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_ac;
>         rename quantityd quantityd_ac;
>         compress;
>         sort hhid product;
>         tempfile ac;
> save `ac', replace;
> 
> **************************************************************************;
> * Now do a similar thing with receipts-in-kind file.
> **************************************************************************;
> use "$path/work/receipts.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> 
> 
> keep if $product_tpi;
> append using `1obs';
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_re;
>         rename quantityd quantityd_re;
>         compress;
>         sort hhid product;
>         tempfile re;
> save `re', replace;
> 
> **************************************************************************;
> * And also with the daily expenditure file.
> **************************************************************************;
> use "$path/work/daily.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> *rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> *rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         collapse (sum) value quantity days , 
>                 by(hhid product unit);
> 
>         gen valued=value/7 if days<=7;
>         replace valued=value/days if days>7 & days<.;
>         gen quantityd=quantity/7 if days<=7;
>         replace quantityd=quantity/days if days>7 & days<.;
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
> 
>         rename valued valued_dd;
>         rename quantityd quantityd_dd;
>         compress;
>         sort hhid product;
>         tempfile dd;
> save `dd', replace;
> 
> 
> 
> 
> **************************************************************************;
> * Merge the three components (own, daily, receipts) together at the HH/product level, 
> * then aggregate to the regional level, using the sample weights (hhweight).
> * We DON'T want to weight by "hhsize" because the quantity and value are
> * already for the household (i.e., other things equal, larger households
> * are buying larger quantities, and therefore already getting more weight).
> * Then calculate sum(val)/sum(quantity) to get the quantity weighted mean
> * unit value in each strata in each quarter.
> **************************************************************************;
> use `ac';
>         sort hhid product;
>         merge hhid product using `re';
>         tab _m;
>         drop _m;
>         
>         sort hhid product;
>         merge hhid product using `dd';
>         tab _m;
>         drop _m;
>         
>         replace valued_ac=0 if valued_ac==.;
>         replace valued_re=0 if valued_re==.;
>         replace valued_dd=0 if valued_dd==.;
>         replace quantityd_ac=0 if quantityd_ac==.;
>         replace quantityd_re=0 if quantityd_re==.;
>         replace quantityd_dd=0 if quantityd_dd==.;
> 
>         gen valued_tot=valued_ac+valued_re+valued_dd;
>         gen quantityd_tot=quantityd_ac+quantityd_re+quantityd_dd;
> 
>         sort hhid;
> 
>         tempfile acredd;
> save `acredd' , replace;
> */
> 
> 
> 
> use "$path/work/hhdata.dta";

.         keep strata hhid hhweight hhsize rural survmon survquar news spdomain reg_tpi;

.         sort hhid;

.         tempfile hhd;

. save `hhd' , replace;
(note: file /tmp/St02564.000007 not found)
file /tmp/St02564.000007 saved

. use `acredd', clear;

.         merge hhid using `hhd';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        109        0.38        0.38
          3 |     28,800       99.62      100.00
------------+-----------------------------------
      Total |     28,909      100.00

.         drop _merge;

.                 tab survquar , miss;

   Sequential Survey |
 Quarter (May-Nov'05 |
      & May-Nov '06) |      Freq.     Percent        Cum.
---------------------+-----------------------------------
   May '05 - Jul-'05 |      9,769       33.79       33.79
          Aug-Oct 05 |      8,847       30.60       64.40
Nov '05 & May-Jun 06 |        530        1.83       66.23
       Jul-Sept 2006 |      7,537       26.07       92.30
         Oct-Nov '06 |      2,185        7.56       99.86
                   . |         41        0.14      100.00
---------------------+-----------------------------------
               Total |     28,909      100.00

.                 tab survmon survquar, miss;

Sequential |
    Survey |
     Month |
 (November |
    2011 = |
   January |       Sequential Survey Quarter (May-Nov'05 & May-Nov '06)
      '13) | May '05 -  Aug-Oct 0  Nov '05 &  Jul-Sept   Oct-Nov '          . |     Total
-----------+------------------------------------------------------------------+----------
    May 05 |     3,058          0          0          0          0          0 |     3,058 
    Jun 05 |     4,288          0          0          0          0          0 |     4,288 
    Jul 05 |     2,423          0          0          0          0          0 |     2,423 
    Aug 05 |         0      3,043          0          0          0          0 |     3,043 
   Sept 05 |         0      3,412          0          0          0          0 |     3,412 
    Oct 05 |         0      2,392          0          0          0          0 |     2,392 
    Nov 05 |         0          0         84          0          0          0 |        84 
    May 06 |         0          0        118          0          0          0 |       118 
    Jun 06 |         0          0        328          0          0          0 |       328 
    Jul 06 |         0          0          0      1,521          0          0 |     1,521 
    Aug 06 |         0          0          0      2,995          0          0 |     2,995 
   Sept 06 |         0          0          0      3,021          0          0 |     3,021 
    Oct 06 |         0          0          0          0      2,109          0 |     2,109 
    Nov 06 |         0          0          0          0         76          0 |        76 
         . |         0          0          0          0          0         41 |        41 
-----------+------------------------------------------------------------------+----------
     Total |     9,769      8,847        530      7,537      2,185         41 |    28,909 


.         compress;
product was float now int
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
hhsize was long now byte

.         sort hhid;

. save `acredd', replace;
file /tmp/St02564.000006 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     28909    2.39e+09    1.16e+09   1.01e+09   4.19e+09
     product |     28800    127.6664    15.94733        100        150
  valued_tot |     28800    274.7174     386.191   1.428571       7500
quantityd_~t |     28800    .5733206    .9622761   .0071429         50
    hhweight |     28868    1670.244    757.6454   140.8407   5553.862
-------------+--------------------------------------------------------
    survquar |     28868    2.429195    1.377738          1          5
     survmon |     28868    6.230394    4.164311          1         14
      strata |     28868    4.299051    2.452283          1          8
       rural |     28868    .7014341    .4576369          0          1
     reg_tpi |     28868    2.298808    1.154778          1          4
-------------+--------------------------------------------------------
    spdomain |     28868    3.140051    1.370939          1          5
        news |     28868    2.298808    1.154778          1          4
      hhsize |     28909    5.744543    3.100327          1         29

. **************************************************************************;
. * Need to merge with the file that has nominal consumption per household,
> * and compute nominal consumption per capita from that, so that we can
> * choose the relatively poor (i.e., below median nominal consumption per
> * capita).
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta" ;
. *save "$path/work/cons_cat.dta", replace ;
. *use "$path/work/cons_cat.dta" ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.  drop _m;

.         collapse (mean) cons_hh_nom hhsize hhweight , by(hhid);

.         gen cpc=cons_hh_nom/hhsize;
(2 missing values generated)

.         sum cpc [aw=hhsize*hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     192.6279       103.3254
 5%     279.1713       125.3987
10%     353.8824       126.4294       Obs                3118
25%       489.79       141.0714       Sum of Wgt.  28155664.2

50%     769.2858                      Mean           1060.031
                        Largest       Std. Dev.      1073.314
75%     1221.598       20495.57
90%     2062.153       20954.27       Variance        1152003
95%     2859.285       22853.78       Skewness       5.702454
99%     5168.295       23846.89       Kurtosis       70.53564

.         global medcpc=r(p$tpi_bottom);

.         gen bottom_tpi=cpc<=$medcpc;

.         keep hhid bottom_tpi;

.         sort hhid;

.         tempfile bottom_tpi;

. save `bottom_tpi', replace;
(note: file /tmp/St02564.000008 not found)
file /tmp/St02564.000008 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      3123    2.43e+09    1.16e+09   1.01e+09   4.19e+09
  bottom_tpi |      3124    .4369398    .4960869          0          1

. use `acredd' ;

.         merge hhid using `bottom_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.00        0.00
          3 |     28,909      100.00      100.00
------------+-----------------------------------
      Total |     28,910      100.00

.         drop _merge;

.         keep if bottom_tpi;
(17832 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     11078    2.69e+09    9.81e+08   1.02e+09   4.19e+09
     product |     11066    128.5111    15.93723        100        150
  valued_tot |     11066    221.6525    297.9822   3.571429       4000
quantityd_~t |     11066    .6175737    .9334974   .0142857         26
    hhweight |     11055    1695.147    627.2694   140.8407     4498.1
-------------+--------------------------------------------------------
    survquar |     11055    2.335866    1.388388          1          5
     survmon |     11055    5.907644    4.143839          1         14
      strata |     11055     5.07924    1.990764          1          8
       rural |     11055     .885934    .3179058          0          1
     reg_tpi |     11055    2.596653    .9812092          1          4
-------------+--------------------------------------------------------
    spdomain |     11055    3.578381    1.019346          1          5
        news |     11055    2.596653    .9812092          1          4
      hhsize |     11078    6.444485     2.92606          1         29
  bottom_tpi |     11078           1           0          1          1

. * Drop one HH with extremely high quantity and low value in IAF 2002/03 (t=t1) ;
. *        drop if hhid==263001;
.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survmon);

.                         drop if product==.;
(8 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         lab var ppkg "Unit value per kg";

.                         sort reg_tpi product ;

.                         compress;

.                         tempfile uvm;

.                 save `uvm', replace;
(note: file /tmp/St02564.00000a not found)
file /tmp/St02564.00000a saved

.                 save "$path/work/tpi_unit_val_monthly.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/tpi_unit_val_monthly.dta saved

.         restore;

.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(6 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         sort reg_tpi product survquar;

.                         list in  1/3;

     +----------------------------------------------------------------------------------+
     | product            survquar   reg_tpi      news   valued~t   quanti~t       ppkg |
     |----------------------------------------------------------------------------------|
  1. |     100   May '05 - Jul-'05   Central   Central   15969.55   12.19603   1309.405 |
  2. |     100          Aug-Oct 05   Central   Central   11058.25   7.464759   1481.394 |
  3. |     100       Jul-Sept 2006   Central   Central   16799.21   12.75837   1316.721 |
     +----------------------------------------------------------------------------------+

.                         list in -3/-1;

     +------------------------------------------------------------------------------+
     | product        survquar   reg_tpi      news   valued~t   quanti~t       ppkg |
     |------------------------------------------------------------------------------|
439. |     150      Aug-Oct 05   Western   Western     1271.7   6.681939    190.319 |
440. |     150   Jul-Sept 2006   Western   Western   1944.216   9.488426   204.9039 |
441. |     150     Oct-Nov '06   Western   Western   322.1541   1.559935   206.5177 |
     +------------------------------------------------------------------------------+

.                         tempfile uvq;

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/tpi_unit_val_quarterly.dta saved

.                 save `uvq', replace;
(note: file /tmp/St02564.00000c not found)
file /tmp/St02564.00000c saved

.         restore;

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each reg_tpi & product combination. This should eliminate outliers that
> * may have an undue influence on the price calculation. Then use sample
> * weighting PLUS quantity weighting on those HH-level observations.
> **************************************************************************;
.         preserve;

.                 gen hhppkg=valued_tot/quantityd_tot;
(12 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(reg_tpi product);
(12 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(reg_tpi product);
(12 missing values generated)

.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
(556 observations deleted)

.                                 gen hhqtywt=hhweight*quantityd_tot;
(35 missing values generated)

.                                 collapse (sum) valued_tot quantityd_tot [aw=hhqtywt] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(0 observations deleted)

.                         gen ppkg_trim=valued_tot/quantityd_tot;

.                         lab var ppkg_trim "90% trimmed unit value per kg";

.                         sort reg_tpi product survquar;

.                         list , nol;

     +----------------------------------------------------------------------+
     | product   survquar   reg_tpi   news   valued~t   quanti~t   ppkg_t~m |
     |----------------------------------------------------------------------|
  1. |     100          1         1      1   31050.14   22.36237     1388.5 |
  2. |     100          2         1      1   13470.42   11.59048   1162.197 |
  3. |     100          4         1      1    19063.2   14.84122   1284.477 |
  4. |     100          5         1      1   6346.565   4.335784   1463.764 |
  5. |     105          1         1      1   24914.17   31.09283   801.2834 |
     |----------------------------------------------------------------------|
  6. |     105          2         1      1   19079.73    22.3184   854.8879 |
  7. |     105          4         1      1   20121.33   28.23954   712.5235 |
  8. |     105          5         1      1   13213.03    7.26683   1818.266 |
  9. |     107          1         1      1   18021.82   37.45608   481.1454 |
 10. |     107          2         1      1   16158.36   21.82102   740.4952 |
     |----------------------------------------------------------------------|
 11. |     107          4         1      1   9745.876   13.41197   726.6553 |
 12. |     107          5         1      1   3900.957   6.024129   647.5554 |
 13. |     108          1         1      1   2720.338   6.321983   430.2983 |
 14. |     108          2         1      1   321.4645   .7501794   428.5168 |
 15. |     108          4         1      1   3401.845   7.382059   460.8261 |
     |----------------------------------------------------------------------|
 16. |     108          5         1      1   2452.092   7.603622     322.49 |
 17. |     109          1         1      1   761.9048   .4761905       1600 |
 18. |     109          2         1      1   710.5352   1.003751   707.8802 |
 19. |     109          4         1      1   1434.724   1.428571   1004.307 |
 20. |     110          1         1      1   2998.664   2.794584   1073.027 |
     |----------------------------------------------------------------------|
 21. |     110          2         1      1   5952.055   5.302676   1122.462 |
 22. |     110          4         1      1   2505.805   2.746029   912.5195 |
 23. |     110          5         1      1   762.3681   .6353068       1200 |
 24. |     112          1         1      1   8638.122   96.81876    89.2195 |
 25. |     112          2         1      1   285.7143   1.428571        200 |
     |----------------------------------------------------------------------|
 26. |     112          4         1      1    414.132   3.385985   122.3077 |
 27. |     113          1         1      1   25646.89   40.02989   640.6935 |
 28. |     113          2         1      1   47552.62   83.14722   571.9087 |
 29. |     113          4         1      1   20051.33   37.02082   541.6231 |
 30. |     113          5         1      1   8404.481   14.25764   589.4721 |
     |----------------------------------------------------------------------|
 31. |     115          1         1      1   924.0752   2.247082   411.2334 |
 32. |     115          2         1      1   404.3108   .4147557   974.8168 |
 33. |     115          4         1      1   407.8501   1.387114   294.0278 |
 34. |     115          5         1      1   788.5464   1.750934   450.3576 |
 35. |     116          1         1      1   14.28571   .2857143         50 |
     |----------------------------------------------------------------------|
 36. |     117          1         1      1   4327.102   1.868485   2315.834 |
 37. |     117          2         1      1   3759.464   1.511288    2487.59 |
 38. |     117          4         1      1   4539.488   1.951237   2326.467 |
 39. |     117          5         1      1   1255.535   .4757439   2639.099 |
 40. |     119          1         1      1   257.1429   .1428571       1800 |
     |----------------------------------------------------------------------|
 41. |     119          2         1      1   314.2857   .1428571       2200 |
 42. |     121          1         1      1   987.4776   .2857143   3456.172 |
 43. |     121          2         1      1   1290.389   .2857143   4516.363 |
 44. |     121          4         1      1   1327.876   .5714286   2323.783 |
 45. |     122          1         1      1   4336.329   10.68984   405.6497 |
     |----------------------------------------------------------------------|
 46. |     122          2         1      1   7925.481    8.99736   880.8674 |
 47. |     122          4         1      1   3949.882   6.681002   591.2111 |
 48. |     122          5         1      1   1051.435   1.850639   568.1468 |
 49. |     123          1         1      1   3376.936    11.7405   287.6313 |
 50. |     123          2         1      1   1578.245   7.862275   200.7364 |
     |----------------------------------------------------------------------|
 51. |     123          4         1      1   1486.409   6.312201   235.4819 |
 52. |     123          5         1      1   2798.025   27.16512   103.0007 |
 53. |     125          1         1      1   9014.344   26.59099   338.9999 |
 54. |     125          2         1      1   6265.147   29.62701   211.4674 |
 55. |     125          4         1      1   3337.475   12.68168    263.173 |
     |----------------------------------------------------------------------|
 56. |     125          5         1      1   10353.41   49.32473    209.903 |
 57. |     127          1         1      1    2339.56   28.11753   83.20646 |
 58. |     127          2         1      1   1919.657   23.25116   82.56177 |
 59. |     127          4         1      1   2062.639   25.74401   80.12114 |
 60. |     127          5         1      1   699.5163   9.489016   73.71854 |
     |----------------------------------------------------------------------|
 61. |     134          1         1      1   2830.762    14.2602   198.5078 |
 62. |     134          2         1      1    3011.99   6.420524    469.119 |
 63. |     134          4         1      1   12570.08   29.56691   425.1401 |
 64. |     134          5         1      1   1368.208   6.999391   195.4753 |
 65. |     136          1         1      1   3967.915   39.02188   101.6844 |
     |----------------------------------------------------------------------|
 66. |     136          2         1      1   3402.726   29.46202   115.4953 |
 67. |     136          4         1      1    2930.76   26.17429   111.9709 |
 68. |     136          5         1      1   841.4545   7.897409   106.5482 |
 69. |     138          1         1      1   2137.343    21.5845   99.02212 |
 70. |     138          2         1      1   5029.618    47.0823   106.8261 |
     |----------------------------------------------------------------------|
 71. |     138          4         1      1   1004.165   9.893947   101.4929 |
 72. |     138          5         1      1   727.4298   8.249875   88.17464 |
 73. |     139          1         1      1    625.902   6.286078   99.56956 |
 74. |     139          2         1      1   550.3973   5.214247   105.5564 |
 75. |     139          4         1      1   769.0334   7.794882   98.65876 |
     |----------------------------------------------------------------------|
 76. |     139          5         1      1   644.4208   7.163976   89.95295 |
 77. |     140          1         1      1   8451.925   28.33922   298.2412 |
 78. |     140          2         1      1   368.5357   1.197043   307.8718 |
 79. |     140          4         1      1   257.1429   .8571429        300 |
 80. |     141          1         1      1   7860.869   22.16986   354.5747 |
     |----------------------------------------------------------------------|
 81. |     141          2         1      1      12443    30.2139   411.8304 |
 82. |     141          4         1      1   13073.09   27.93229    468.028 |
 83. |     141          5         1      1   8579.286   15.02531   570.9891 |
 84. |     143          1         1      1   2155.047   3.442937   625.9327 |
 85. |     143          2         1      1   169.9573   .2578785   659.0594 |
     |----------------------------------------------------------------------|
 86. |     143          4         1      1   753.3078   .6605421   1140.439 |
 87. |     144          1         1      1   569.5909   1.703622   334.3411 |
 88. |     144          2         1      1   4046.539   11.60391   348.7221 |
 89. |     144          4         1      1   2451.214   7.486633   327.4121 |
 90. |     144          5         1      1   847.0567   4.825843   175.5251 |
     |----------------------------------------------------------------------|
 91. |     146          1         1      1   71.42857   .0714286       1000 |
 92. |     146          2         1      1   57.14286   .2857143        200 |
 93. |     147          1         1      1   10030.75   5.522516   1816.336 |
 94. |     147          2         1      1      12787   8.095111   1579.595 |
 95. |     147          4         1      1    10350.8   6.578101   1573.523 |
     |----------------------------------------------------------------------|
 96. |     147          5         1      1   3497.648   2.219922   1575.572 |
 97. |     150          1         1      1   1175.517   6.912663   170.0527 |
 98. |     150          2         1      1   1325.627   6.934003   191.1778 |
 99. |     150          4         1      1   915.2883   5.463646   167.5234 |
100. |     150          5         1      1    526.957   2.890811   182.2869 |
     |----------------------------------------------------------------------|
101. |     100          1         2      2   7199.485   6.701557     1074.3 |
102. |     100          2         2      2   25997.67   20.76133   1252.216 |
103. |     100          4         2      2      30661   21.32415   1437.854 |
104. |     100          5         2      2   14092.53   16.90049   833.8532 |
105. |     105          1         2      2   66653.79    145.904   456.8333 |
     |----------------------------------------------------------------------|
106. |     105          2         2      2   64764.03    104.472   619.9175 |
107. |     105          3         2      2   332.1429   1.214286   273.5294 |
108. |     105          4         2      2   28631.32   32.29985   886.4227 |
109. |     105          5         2      2   3039.184   3.979407   763.7278 |
110. |     107          1         2      2   14334.03   25.72579   557.1852 |
     |----------------------------------------------------------------------|
111. |     107          2         2      2   9113.504   10.89238   836.6865 |
112. |     107          3         2      2   128.5714   .4285714        300 |
113. |     107          4         2      2   9036.914   17.37915    519.986 |
114. |     107          5         2      2    4284.21   4.964618   862.9486 |
115. |     108          1         2      2   66299.99    179.971   368.3927 |
     |----------------------------------------------------------------------|
116. |     108          2         2      2   11442.33   38.62062   296.2751 |
117. |     108          4         2      2   13376.97    43.1264   310.1806 |
118. |     108          5         2      2    6392.56   17.60043   363.2049 |
119. |     109          1         2      2   105.4431   .2857143   369.0507 |
120. |     109          2         2      2   485.8338   1.020273   476.1804 |
     |----------------------------------------------------------------------|
121. |     109          4         2      2   357.1429   .7142857        500 |
122. |     110          1         2      2   9379.672   10.32681   908.2839 |
123. |     110          2         2      2   7632.524   9.537962   800.2259 |
124. |     110          3         2      2   267.8571   .3571429        750 |
125. |     110          4         2      2   3672.132   3.660146   1003.275 |
     |----------------------------------------------------------------------|
126. |     110          5         2      2    3049.25    2.81177   1084.459 |
127. |     112          1         2      2    23096.3   294.0182   78.55399 |
128. |     112          2         2      2   3074.602   59.58986   51.59605 |
129. |     113          1         2      2   46740.54   87.07559   536.7813 |
130. |     113          2         2      2   42753.76   109.8079   389.3506 |
     |----------------------------------------------------------------------|
131. |     113          3         2      2   1418.076   4.134111   343.0183 |
132. |     113          4         2      2   32987.91   70.53026   467.7128 |
133. |     113          5         2      2   25992.28   55.51959    468.164 |
134. |     115          1         2      2   17312.27   29.92039   578.6112 |
135. |     115          2         2      2   7892.361   20.80586   379.3336 |
     |----------------------------------------------------------------------|
136. |     115          4         2      2   6589.507   14.10947   467.0273 |
137. |     115          5         2      2   10364.86   28.19486   367.6154 |
138. |     116          1         2      2    17234.3    128.705   133.9055 |
139. |     116          2         2      2   995.3412   3.822424   260.3953 |
140. |     116          4         2      2   3115.137   22.10295   140.9376 |
     |----------------------------------------------------------------------|
141. |     116          5         2      2   124.2045   .4722403   263.0113 |
142. |     117          1         2      2   27123.64   11.05744   2452.976 |
143. |     117          2         2      2   11280.37   4.642283   2429.918 |
144. |     117          3         2      2   142.8571   .0714286       2000 |
145. |     117          4         2      2   9159.621   3.742912   2447.191 |
     |----------------------------------------------------------------------|
146. |     117          5         2      2   971.1666   .4046528       2400 |
147. |     119          1         2      2   8761.363   3.500906   2502.599 |
148. |     119          2         2      2   526.8841   .2142857   2458.792 |
149. |     119          4         2      2   523.4845   .2331708   2245.069 |
150. |     119          5         2      2   3473.379   1.447241       2400 |
     |----------------------------------------------------------------------|
151. |     121          1         2      2   7527.598   2.401398   3134.673 |
152. |     121          2         2      2   4620.345   1.494158   3092.272 |
153. |     121          4         2      2   2693.196   .8571429   3142.062 |
154. |     121          5         2      2   1749.904   .5714286   3062.332 |
155. |     122          1         2      2   25990.55   34.05213   763.2576 |
     |----------------------------------------------------------------------|
156. |     122          2         2      2   3884.959   5.859834   662.9811 |
157. |     122          4         2      2   5651.907   10.73887    526.304 |
158. |     122          5         2      2   911.1735   1.294677   703.7845 |
159. |     123          1         2      2   16696.37   48.10662   347.0701 |
160. |     123          2         2      2   5010.975   14.11866   354.9187 |
     |----------------------------------------------------------------------|
161. |     123          3         2      2   71.42857   .7142857        100 |
162. |     123          4         2      2   7885.568   23.07918   341.6745 |
163. |     123          5         2      2   3192.284   13.35988   238.9456 |
164. |     125          1         2      2   20106.53   95.04843   211.5398 |
165. |     125          2         2      2   7404.022   32.68016   226.5601 |
     |----------------------------------------------------------------------|
166. |     125          3         2      2        200          2        100 |
167. |     125          4         2      2   3918.958   18.20266   215.2959 |
168. |     125          5         2      2   4442.436   23.78972   186.7377 |
169. |     127          1         2      2   8226.069   131.1404   62.72718 |
170. |     127          2         2      2   6952.387      94.14   73.85157 |
     |----------------------------------------------------------------------|
171. |     127          3         2      2   57.14286   .5714286   99.99999 |
172. |     127          4         2      2   8407.001   131.3132   64.02252 |
173. |     127          5         2      2   3016.704   39.54492    76.2855 |
174. |     134          1         2      2   5729.161   10.19897   561.7393 |
175. |     134          2         2      2   980.2945   2.317878   422.9276 |
     |----------------------------------------------------------------------|
176. |     134          4         2      2    6361.27   18.23098   348.9263 |
177. |     134          5         2      2   1479.078   9.214026   160.5246 |
178. |     136          1         2      2   17280.03   141.5853   122.0468 |
179. |     136          2         2      2   3750.861   35.00291   107.1585 |
180. |     136          3         2      2   28.57143   .2857143   99.99999 |
     |----------------------------------------------------------------------|
181. |     136          4         2      2   4358.046   37.52402   116.1402 |
182. |     136          5         2      2    4567.81   34.02384   134.2532 |
183. |     138          1         2      2   10274.57    104.983   97.86884 |
184. |     138          2         2      2   6979.165   57.91332   120.5105 |
185. |     138          3         2      2   42.85714   .4285714        100 |
     |----------------------------------------------------------------------|
186. |     138          4         2      2   6774.006   53.23784   127.2404 |
187. |     138          5         2      2   4982.448   65.36463   76.22543 |
188. |     139          1         2      2   20102.28   217.4746   92.43506 |
189. |     139          2         2      2   4677.759   48.78619   95.88284 |
190. |     139          3         2      2   165.7143   1.657143        100 |
     |----------------------------------------------------------------------|
191. |     139          4         2      2   4510.176   43.54403   103.5774 |
192. |     139          5         2      2   3422.066   33.08124   103.4443 |
193. |     140          1         2      2   3897.419    15.7478   247.4898 |
194. |     140          2         2      2   2722.638   7.363594   369.7431 |
195. |     140          4         2      2   178.5714   .3571429        500 |
     |----------------------------------------------------------------------|
196. |     140          5         2      2   42.85714   .1428571        300 |
197. |     141          1         2      2   35632.17   104.7127   340.2851 |
198. |     141          2         2      2   8094.866   22.90144   353.4654 |
199. |     141          3         2      2   171.4286   .2857143        600 |
200. |     141          4         2      2   9281.632    15.1991   610.6697 |
     |----------------------------------------------------------------------|
201. |     141          5         2      2   3836.587   4.869616   787.8624 |
202. |     143          1         2      2   5865.148   28.57389   205.2625 |
203. |     143          2         2      2   1291.546    5.48361   235.5284 |
204. |     143          3         2      2        200          2        100 |
205. |     143          4         2      2   3735.457    7.90057   472.8086 |
     |----------------------------------------------------------------------|
206. |     143          5         2      2   619.6393   .7992913   775.2358 |
207. |     144          1         2      2   2946.637   16.54455   178.1032 |
208. |     144          2         2      2   3412.961   10.65731    320.246 |
209. |     144          3         2      2   28.57143   .2857143   99.99999 |
210. |     144          4         2      2   3485.979   14.90004   233.9577 |
     |----------------------------------------------------------------------|
211. |     144          5         2      2   2013.474   13.64064   147.6085 |
212. |     146          1         2      2   655.8042   1.525141   429.9957 |
213. |     146          2         2      2   42.85714   .1428571        300 |
214. |     146          4         2      2   401.1453   .6553973   612.0643 |
215. |     147          1         2      2   27035.16   19.49232   1386.964 |
     |----------------------------------------------------------------------|
216. |     147          2         2      2   17328.13   17.14604    1010.62 |
217. |     147          3         2      2      712.5   .4464286       1596 |
218. |     147          4         2      2   11715.73   7.887061   1485.437 |
219. |     147          5         2      2   7874.616   5.316633   1481.128 |
220. |     150          1         2      2   3085.388   18.62915   165.6215 |
     |----------------------------------------------------------------------|
221. |     150          2         2      2   1707.664   12.68932   134.5749 |
222. |     150          3         2      2   59.52381   .3928572   151.5151 |
223. |     150          4         2      2   1664.072   9.927602   167.6207 |
224. |     150          5         2      2   792.4355   4.849155   163.4173 |
225. |     100          1         3      3    378.327    .496062   762.6608 |
     |----------------------------------------------------------------------|
226. |     100          2         3      3        100   .1428571   699.9999 |
227. |     100          3         3      3   3855.737   1.728453   2230.745 |
228. |     100          4         3      3   338.3396   .2857143   1184.189 |
229. |     105          1         3      3   19373.97   103.4535   187.2723 |
230. |     105          2         3      3   13506.06   57.65408   234.2602 |
     |----------------------------------------------------------------------|
231. |     105          3         3      3   3531.237   14.11329   250.2065 |
232. |     105          4         3      3   16155.26   68.39981   236.1887 |
233. |     107          1         3      3   25485.35   94.01256   271.0845 |
234. |     107          2         3      3    20969.7   70.46394   297.5948 |
235. |     107          3         3      3    3129.77   14.03646   222.9743 |
     |----------------------------------------------------------------------|
236. |     107          4         3      3   25322.59   86.00251   294.4401 |
237. |     107          5         3      3   57.14286   .1428571        400 |
238. |     108          1         3      3   40151.92   253.8609    158.165 |
239. |     108          2         3      3    17911.8   69.18621   258.8926 |
240. |     108          3         3      3    18965.2   69.34852   273.4766 |
     |----------------------------------------------------------------------|
241. |     108          4         3      3   24506.94   157.6042   155.4967 |
242. |     108          5         3      3   2592.857   1.163265   2228.948 |
243. |     109          1         3      3   42.85714   .1428571        300 |
244. |     109          4         3      3   85.71429   .4285714        200 |
245. |     110          1         3      3   1150.776   1.585297   725.9053 |
     |----------------------------------------------------------------------|
246. |     110          2         3      3   682.6998   1.337749   510.3348 |
247. |     110          3         3      3   85.71429   .0714286       1200 |
248. |     110          4         3      3   1600.262   3.066602   521.8356 |
249. |     112          1         3      3   9976.777   119.1061    83.7638 |
250. |     112          2         3      3   13756.72   161.1557   85.36289 |
     |----------------------------------------------------------------------|
251. |     112          4         3      3   28.57143   .2857143   99.99999 |
252. |     113          1         3      3   32258.18   215.6159   149.6094 |
253. |     113          2         3      3   27718.66   191.8597   144.4736 |
254. |     113          3         3      3   6297.851   61.54399   102.3309 |
255. |     113          4         3      3   21734.01   133.1294   163.2548 |
     |----------------------------------------------------------------------|
256. |     115          1         3      3   6346.507   56.02795   113.2739 |
257. |     115          2         3      3   4775.515   38.10229   125.3341 |
258. |     115          3         3      3   192.8571   1.285714        150 |
259. |     115          4         3      3   10947.55   71.90379   152.2527 |
260. |     116          1         3      3   21516.29    132.731   162.1045 |
     |----------------------------------------------------------------------|
261. |     116          2         3      3   8523.057   52.13503   163.4804 |
262. |     116          3         3      3        200          2        100 |
263. |     116          4         3      3   23273.86   122.1411   190.5489 |
264. |     116          5         3      3   185.7143   1.857143        100 |
265. |     117          1         3      3    5284.54   2.198922   2403.242 |
     |----------------------------------------------------------------------|
266. |     117          2         3      3   9729.745   3.965071   2453.864 |
267. |     117          3         3      3   876.6579   .3506632       2500 |
268. |     117          4         3      3   14259.51   6.055076   2354.968 |
269. |     119          1         3      3   2243.472    1.19786   1872.899 |
270. |     119          2         3      3   5003.518   3.016396   1658.774 |
     |----------------------------------------------------------------------|
271. |     119          3         3      3   1390.399   1.214347   1144.976 |
272. |     119          4         3      3   12279.46   5.935045   2068.976 |
273. |     121          1         3      3   3935.423   1.142857   3443.495 |
274. |     121          2         3      3   3209.522    1.34293   2389.939 |
275. |     121          3         3      3   1389.469   .4902245   2834.353 |
     |----------------------------------------------------------------------|
276. |     121          4         3      3   7094.181   2.148056   3302.605 |
277. |     122          1         3      3   6415.298   43.02032   149.1225 |
278. |     122          2         3      3   2328.272    1.89654   1227.642 |
279. |     122          3         3      3   714.2857   .4761905       1500 |
280. |     122          4         3      3   3610.949   5.571543   648.1058 |
     |----------------------------------------------------------------------|
281. |     123          1         3      3   11238.39   50.90057    220.791 |
282. |     123          2         3      3   7528.825   30.46615    247.121 |
283. |     123          3         3      3   3845.737   7.357995    522.661 |
284. |     123          4         3      3   10319.18   31.84796   324.0138 |
285. |     125          1         3      3   4303.167   29.30909   146.8202 |
     |----------------------------------------------------------------------|
286. |     125          2         3      3   8969.032   80.56241   111.3302 |
287. |     125          4         3      3   7698.461   41.58231   185.1379 |
288. |     127          1         3      3   9247.367   99.18546   93.23309 |
289. |     127          2         3      3   11278.05   92.18477   122.3418 |
290. |     127          3         3      3   1838.827   12.87337   142.8396 |
     |----------------------------------------------------------------------|
291. |     127          4         3      3   11660.75   109.4786   106.5117 |
292. |     127          5         3      3   28.57143   .5714286         50 |
293. |     134          1         3      3   646.5477   5.183231   124.7384 |
294. |     134          2         3      3   474.2204   4.742204        100 |
295. |     134          4         3      3   593.6421   2.840218   209.0129 |
     |----------------------------------------------------------------------|
296. |     136          1         3      3   3980.208   35.17219   113.1635 |
297. |     136          2         3      3    5912.09   45.97603   128.5907 |
298. |     136          3         3      3   562.5074   5.031091   111.8063 |
299. |     136          4         3      3   2839.657   22.91418   123.9258 |
300. |     138          1         3      3   3050.415   37.46634   81.41749 |
     |----------------------------------------------------------------------|
301. |     138          2         3      3   737.3316    8.49449   86.80116 |
302. |     138          3         3      3   100.9201   1.028295   98.14317 |
303. |     138          4         3      3   1662.936   13.65208   121.8083 |
304. |     139          1         3      3   29358.39      345.7   84.92447 |
305. |     139          2         3      3    13302.6   137.6319   96.65352 |
     |----------------------------------------------------------------------|
306. |     139          3         3      3   1477.566   22.30568   66.24169 |
307. |     139          4         3      3   11458.25   143.2321   79.99783 |
308. |     139          5         3      3   57.14286    .952381         60 |
309. |     140          1         3      3   2193.584   11.25486   194.9011 |
310. |     140          2         3      3   6595.465   34.63333   190.4369 |
     |----------------------------------------------------------------------|
311. |     141          1         3      3   41528.47    169.516   244.9826 |
312. |     141          2         3      3   28566.77   114.8472   248.7372 |
313. |     141          3         3      3   11126.19   53.96189   206.1861 |
314. |     141          4         3      3      44197   205.3512   215.2265 |
315. |     141          5         3      3   1218.045   2.774436   439.0244 |
     |----------------------------------------------------------------------|
316. |     143          1         3      3   3544.486   31.87277   111.2073 |
317. |     143          2         3      3   4232.483    28.8011   146.9556 |
318. |     143          3         3      3   1122.329   10.74163   104.4841 |
319. |     143          4         3      3   3146.676   25.33604   124.1976 |
320. |     144          1         3      3   171.4286   .8571429        200 |
     |----------------------------------------------------------------------|
321. |     144          4         3      3   123.6423   .2857143    432.748 |
322. |     146          1         3      3   10319.62   50.60872   203.9098 |
323. |     146          2         3      3   4480.607   16.08158   278.6174 |
324. |     146          3         3      3   2652.356    16.7205    158.629 |
325. |     146          4         3      3   10094.91   39.96539   252.5912 |
     |----------------------------------------------------------------------|
326. |     146          5         3      3   571.4286   2.857143        200 |
327. |     147          1         3      3   9443.149   38.72586   243.8461 |
328. |     147          2         3      3   10193.39    25.7653   395.6247 |
329. |     147          3         3      3   3296.624   21.75947    151.503 |
330. |     147          4         3      3   11593.39   28.27507   410.0215 |
     |----------------------------------------------------------------------|
331. |     147          5         3      3   85.71429   .4285714        200 |
332. |     150          1         3      3   3460.231   31.03369   111.4992 |
333. |     150          2         3      3   2294.165   18.08048   126.8863 |
334. |     150          3         3      3   818.9608   7.371365   111.1003 |
335. |     150          4         3      3   2704.006   19.40228   139.3654 |
     |----------------------------------------------------------------------|
336. |     150          5         3      3   52.04082   .5204082        100 |
337. |     100          1         4      4   91626.24   56.67748   1616.625 |
338. |     100          2         4      4      24213   21.02853   1151.436 |
339. |     100          4         4      4   59291.93   51.74507   1145.847 |
340. |     100          5         4      4   5906.718   3.402249   1736.122 |
     |----------------------------------------------------------------------|
341. |     105          1         4      4   42959.38   45.51204   943.9124 |
342. |     105          2         4      4   16373.67   22.52246   726.9929 |
343. |     105          4         4      4   28128.81   20.42452   1377.208 |
344. |     105          5         4      4   3670.155   1.923703   1907.859 |
345. |     107          1         4      4   13898.52   19.44127   714.8975 |
     |----------------------------------------------------------------------|
346. |     107          2         4      4   15539.77   24.61611   631.2845 |
347. |     107          4         4      4   18099.54    22.6771   798.1421 |
348. |     107          5         4      4   4659.516   15.24905    305.561 |
349. |     108          1         4      4   13087.59   100.5098   130.2122 |
350. |     108          2         4      4   15434.22   73.15989   210.9655 |
     |----------------------------------------------------------------------|
351. |     108          4         4      4   19873.84   100.9422   196.8833 |
352. |     108          5         4      4   10913.27   16.99183   642.2657 |
353. |     109          1         4      4   22540.24   18.58565   1212.776 |
354. |     109          2         4      4   2759.562   4.166276   662.3569 |
355. |     109          4         4      4   6762.517   6.031243   1121.248 |
     |----------------------------------------------------------------------|
356. |     109          5         4      4   857.1429   .2857143       3000 |
357. |     110          1         4      4   2977.825   5.214624   571.0526 |
358. |     110          2         4      4   282.1967   .4641781   607.9492 |
359. |     110          4         4      4   4558.865   4.979353   915.5536 |
360. |     112          1         4      4   11688.28   153.1888   76.29986 |
     |----------------------------------------------------------------------|
361. |     112          4         4      4   751.4995   14.65687   51.27284 |
362. |     113          1         4      4   41460.18   83.63968      495.7 |
363. |     113          2         4      4   18855.57   89.73698   210.1204 |
364. |     113          4         4      4   19079.21   74.81256   255.0268 |
365. |     113          5         4      4   1060.575   4.891467   216.8215 |
     |----------------------------------------------------------------------|
366. |     115          1         4      4   19213.11   46.19314   415.9299 |
367. |     115          2         4      4   3375.674   9.098119   371.0299 |
368. |     115          4         4      4   6526.351   20.26636   322.0288 |
369. |     115          5         4      4   382.4965   .9562412        400 |
370. |     116          1         4      4   7566.026   15.57352   485.8263 |
     |----------------------------------------------------------------------|
371. |     116          2         4      4   1211.426   5.935877   204.0854 |
372. |     116          4         4      4   193.2143   .7482144   258.2339 |
373. |     117          1         4      4   9905.652   4.660649   2125.381 |
374. |     117          2         4      4   6372.654   2.977197   2140.488 |
375. |     117          4         4      4   13538.89   6.083515   2225.505 |
     |----------------------------------------------------------------------|
376. |     117          5         4      4   1597.313   .7986567       2000 |
377. |     119          1         4      4   572.4499   .2453843   2332.871 |
378. |     119          2         4      4   727.4125   .3026439   2403.526 |
379. |     119          4         4      4   5123.252   2.242924   2284.185 |
380. |     121          2         4      4   1399.076   .4285714    3264.51 |
     |----------------------------------------------------------------------|
381. |     121          4         4      4   2001.106   .5714286   3501.935 |
382. |     121          5         4      4   571.4286   .2857143       2000 |
383. |     122          1         4      4   678.0171   .5306788   1277.641 |
384. |     122          2         4      4   2067.331   3.612219   572.3161 |
385. |     122          4         4      4   4961.527   3.784728   1310.933 |
     |----------------------------------------------------------------------|
386. |     123          1         4      4   1781.204   2.679742   664.6924 |
387. |     123          2         4      4   3210.207   3.257946    985.347 |
388. |     123          4         4      4    7105.37   7.278644   976.1943 |
389. |     123          5         4      4   1026.811   1.142857   898.4597 |
390. |     125          1         4      4   10778.95   60.35729   178.5858 |
     |----------------------------------------------------------------------|
391. |     125          2         4      4   1839.056   11.36651   161.7961 |
392. |     125          4         4      4   6590.826    33.6811   195.6832 |
393. |     125          5         4      4   1855.317   10.32778   179.6434 |
394. |     127          1         4      4   2529.517   20.18435   125.3207 |
395. |     127          2         4      4     558.32   3.557831   156.9271 |
     |----------------------------------------------------------------------|
396. |     127          4         4      4   2378.084    16.0141   148.4994 |
397. |     127          5         4      4   840.1196   8.378963   100.2653 |
398. |     134          1         4      4   1709.931   10.86813   157.3345 |
399. |     134          2         4      4   2007.389   23.26647   86.27821 |
400. |     134          4         4      4   2054.398   16.02095    128.232 |
     |----------------------------------------------------------------------|
401. |     134          5         4      4   57.14286   1.142857         50 |
402. |     136          1         4      4   3263.538   25.27314   129.1307 |
403. |     136          2         4      4   4035.656   24.97969   161.5575 |
404. |     136          4         4      4   3015.463   19.05719   158.2323 |
405. |     136          5         4      4    619.753   3.242196   191.1522 |
     |----------------------------------------------------------------------|
406. |     138          1         4      4   4946.664   45.58166   108.5231 |
407. |     138          2         4      4   2050.038   13.76324   148.9503 |
408. |     138          4         4      4   2154.449   27.22131   79.14567 |
409. |     138          5         4      4   698.6798   7.960438   87.76901 |
410. |     139          1         4      4   2344.531   20.97858   111.7583 |
     |----------------------------------------------------------------------|
411. |     139          2         4      4   3095.796   23.51724   131.6394 |
412. |     139          4         4      4   246.1545   1.411155   174.4348 |
413. |     140          1         4      4   34644.92   117.3369   295.2603 |
414. |     140          2         4      4   1234.244   1.414903    872.317 |
415. |     140          4         4      4   7340.503   16.16053   454.2242 |
     |----------------------------------------------------------------------|
416. |     141          1         4      4   33542.67   93.06965   360.4039 |
417. |     141          2         4      4   25931.12   79.38882   326.6345 |
418. |     141          4         4      4   35142.84   82.04635   428.3291 |
419. |     141          5         4      4   8176.142   19.98008   409.2146 |
420. |     143          1         4      4   1743.989   3.331035   523.5577 |
     |----------------------------------------------------------------------|
421. |     143          2         4      4    2114.02   4.701605    449.638 |
422. |     143          4         4      4   2696.988   4.849624   556.1232 |
423. |     143          5         4      4    370.109   .7109869   520.5568 |
424. |     144          1         4      4   10094.22   18.95455   532.5488 |
425. |     144          2         4      4   7171.987   12.76068    562.038 |
     |----------------------------------------------------------------------|
426. |     144          4         4      4    3220.66   6.297252   511.4389 |
427. |     144          5         4      4        250          1        250 |
428. |     146          2         4      4   235.4197   .5714286   411.9844 |
429. |     146          4         4      4   71.42857   1.428571         50 |
430. |     146          5         4      4   431.3975   1.260911   342.1316 |
     |----------------------------------------------------------------------|
431. |     147          1         4      4   8912.133    6.03984   1475.558 |
432. |     147          2         4      4   4126.054   2.859719   1442.818 |
433. |     147          4         4      4   5365.207   3.333597   1609.435 |
434. |     147          5         4      4   1305.525   .9574323   1363.569 |
435. |     150          1         4      4   3245.487   15.80602   205.3324 |
     |----------------------------------------------------------------------|
436. |     150          2         4      4    1474.83   8.004668   184.2462 |
437. |     150          4         4      4   2117.508   11.16862   189.5945 |
438. |     150          5         4      4   367.2519   1.781368   206.1629 |
     +----------------------------------------------------------------------+

.                         tempfile uvq2;

.                         keep reg_tpi product survquar ppkg_trim;

.                 save `uvq2', replace;
(note: file /tmp/St02564.00000e not found)
file /tmp/St02564.00000e saved

.                                 use `uvq' ;

.                         merge reg_tpi product survquar using `uvq2';
(label lsurvquar already defined)
(label lregion already defined)

.                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          3        0.68        0.68
          3 |        438       99.32      100.00
------------+-----------------------------------
      Total |        441      100.00

.                         drop _merge;

.                 save `uvq', replace;
file /tmp/St02564.00000c saved

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/tpi_unit_val_quarterly.dta saved

.         restore;

. **************************************************************************;
. * Now calculate the weights for the temporal price index. The weights
> * will be based on the bottom 50% of the national nominal consumption
> * per capita (see below). We let the weights vary by strata (3 regions X rural/urban).
> *
> * First, make a small file that has the total nominal HH daily consumption,
> * to use as our denominator. We cannot simply use the `bottom_tpi' file that
> * was created earlier because we will need some other variables from
> * the cons_cat.dta file.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta", clear ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         collapse (mean) cons_hh_nom hhsize strata hhweight rural news survquar reg_tpi,
>                 by(hhid);

.         lab var cons_hh_nom "Nominal daily HH consumption";

.         rename hhsize   cc_hhs;

.         rename strata   cc_reg;

.         rename hhweight cc_hhw;

.         rename rural    cc_rur;

.         rename news     cc_news;

.         rename survquar cc_qua;

.         rename reg_tpi  cc_reg_tpi;

.         sort hhid;

.         tempfile thhcons;

. save `thhcons', replace;
(note: file /tmp/St02564.00000f not found)
file /tmp/St02564.00000f saved

. **************************************************************************;
. * Merge the file with consumption on the food products with HH consumption file,
> * then use "fillin" to take care of cases where a household did not
> * consume all n_tpi commodities. Note that we need to do the merge
> * first because there are some households that are not in `acredd' at
> * all, because they did not consume *any* of the n_tpi items. Then replace
> * missing values in the "filled in" observations with the relevant values 
> * for that household.
> **************************************************************************;
. use `acredd';

.         cap drop _merge;

.         drop if product==.;
(109 observations deleted)

.         merge hhid using `thhcons';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        110        0.38        0.38
          3 |     28,800       99.62      100.00
------------+-----------------------------------
      Total |     28,910      100.00

.         for var valued_tot quantityd_tot : replace X=0 if _merge==2;

->  replace valued_tot=0 if _merge==2
(110 real changes made)

->  replace quantityd_tot=0 if _merge==2
(110 real changes made)

.                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 valued_tot quantityd_tot : replace X=0 if _merge==2;
>                                 */
> 
>         replace hhsize  =cc_hhs     if _merge==2;
(109 real changes made)

.         replace strata  =cc_reg     if _merge==2;
(109 real changes made)

.         replace hhweight=cc_hhw     if _merge==2;
(109 real changes made)

.         replace rural   =cc_rur     if _merge==2;
(109 real changes made)

.         replace news    =cc_news        if _merge==2;
(109 real changes made)

.         replace survquar=cc_qua     if _merge==2;
(109 real changes made)

.         replace reg_tpi =cc_reg_tpi     if _merge==2;
(109 real changes made)

.         drop _merge cc_* ;

.                 fillin hhid product;

.         replace valued_tot=0 if _fillin;
(61686 real changes made)

.                 for var quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;

->  egen tmp=mean(quantityd_tot), by(hhid)

->  replace quantityd_tot=tmp if _fillin
(61686 real changes made)

->  drop tmp

->  egen tmp=mean(strata), by(hhid)
(145 missing values generated)

->  replace strata=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(rural), by(hhid)
(145 missing values generated)

->  replace rural=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(hhweight), by(hhid)
(145 missing values generated)

->  replace hhweight=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(hhsize), by(hhid)
(29 missing values generated)

->  replace hhsize=tmp if _fillin
(61658 real changes made)

->  drop tmp

->  egen tmp=mean(survquar), by(hhid)
(145 missing values generated)

->  replace survquar=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(survmon), by(hhid)
(3306 missing values generated)

->  replace survmon=tmp if _fillin
(58531 real changes made)

->  drop tmp

->  egen tmp=mean(news), by(hhid)
(145 missing values generated)

->  replace news=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(reg_tpi), by(hhid)
(145 missing values generated)

->  replace reg_tpi=tmp if _fillin
(61583 real changes made)

->  drop tmp

->  egen tmp=mean(cons_hh_nom), by(hhid)
(29 missing values generated)

->  replace cons_hh_nom=tmp if _fillin
(61658 real changes made)

->  drop tmp

.                                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;
>                                 */
> 
> **************************************************************************;
. * Now calculate the shares, and then the mean shares in each strata, 
> * using hhweight*hhsize weighting. 
> * Note that we are not doing quantity weighting now for the shares.
> **************************************************************************;
.         gen share = valued_tot/cons_hh_nom ;
(58 missing values generated)

.         gen popwt = hhsize*hhweight;
(145 missing values generated)

.         lab var share "HH share in total consumption";

.         lab var popwt "Population weight: hhsize*hhweight";

. **************************************************************************;
. * Select the bottom 50% (weighted) of the distribution of nominal per 
> * capita consumption.
> **************************************************************************;
.         gen cpc=cons_hh_nom/hhsize;
(58 missing values generated)

.         sum cpc [aw=hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     197.5413       103.3254
 5%     297.8005       103.3254
10%      376.696       103.3254       Obs               90422
25%     534.2612       103.3254       Sum of Wgt.   151348521

50%      851.058                      Mean           1248.942
                        Largest       Std. Dev.      1406.063
75%     1406.032       23846.89
90%     2557.521       23846.89       Variance        1977014
95%     3482.337       23846.89       Skewness       5.749453
99%     6548.099       23846.89       Kurtosis       61.60169

.         global medcpc=r(p$tpi_bottom);

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     90567    2.43e+09    1.16e+09   1.01e+09   4.19e+09
     product |     87472      125.25    14.67179        100        150
  valued_tot |     90596    87.33123    252.5384          0       7500
quantityd_~t |     90596    .5735846    .6567883          0         50
    hhweight |     90451    1673.657    752.4905   140.8407   5553.862
-------------+--------------------------------------------------------
    survquar |     90451    2.438602    1.384203          1          5
     survmon |     87290    6.217276    4.164974          1         14
      strata |     90451    4.414877    2.449579          1          8
       rural |     90451    .7242706    .4468835          0          1
     reg_tpi |     90451    2.345303    1.154768          1          4
-------------+--------------------------------------------------------
    spdomain |     28759    3.142216    1.369879          1          5
        news |     90451    2.345303    1.154768          1          4
      hhsize |     90567    5.366314    3.108316          1         29
 cons_hh_nom |     90567    5922.644    6786.925          0   84210.06
     _fillin |     90596     .680891    .4661339          0          1
-------------+--------------------------------------------------------
       share |     90538    .0176602    .0483751          0          1
       popwt |     90451    9029.887    6947.874     201.98   61536.83
         cpc |     90538    1330.096     1627.29   103.3254   23846.89

.  codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                   Unique HH Identifier Across Panel Waves
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3123                     missing .:  29/90596

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         keep if cpc<=$medcpc;
(46110 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     44486    2.71e+09    1.00e+09   1.02e+09   4.19e+09
     product |     42952      125.25    14.67188        100        150
  valued_tot |     44486    64.41537    190.2396          0       4000
quantityd_~t |     44486    .6369598    .6198901          0         26
    hhweight |     44399    1704.946    659.9521   140.8407   5553.862
-------------+--------------------------------------------------------
    survquar |     44399    2.354017    1.387212          1          5
     survmon |     43993    5.941332    4.130882          1         14
      strata |     44399    5.109079    2.042163          1          8
       rural |     44399    .8850425    .3189743          0          1
     reg_tpi |     44399    2.612018    1.004748          1          4
-------------+--------------------------------------------------------
    spdomain |     12716    3.547421    1.051875          1          5
        news |     44399    2.612018    1.004748          1          4
      hhsize |     44486    6.065189    2.892215          1         29
 cons_hh_nom |     44486    3137.395    1825.995        150   15722.37
     _fillin |     44486    .7133255    .4522132          0          1
-------------+--------------------------------------------------------
       share |     44486    .0207117    .0571617          0          1
       popwt |     44399    10313.72    6505.607    225.125    57829.4
         cpc |     44486    527.9537    178.9447   103.3254    851.058

.                 collapse (mean) share (median) medshare=share [aw=popwt] , 
>                         by(reg_tpi product);

.                 egen sumsh=sum(share) , by(reg_tpi);

.                 replace share=share/sumsh;
(112 real changes made)

.                 drop sumsh;

.                 egen sumsh=sum(medshare) , by(reg_tpi);

.                 replace medshare=medshare/sumsh;
(24 real changes made)

.                 drop sumsh;

.                 lab var share "Reg 6: Mean HH share of total consumption";

.                 lab var medshare "Reg 6: Median HH share of total consumption";

.                 sort reg_tpi product;

.                 save "$path/work/tpi_reg_tpi_share.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/tpi_reg_tpi_share.dta saved

.                 tempfile tempwt6;

.                 save `tempwt6', replace;
(note: file /tmp/St02564.00000g not found)
file /tmp/St02564.00000g saved

. use `uvq', clear;

.         sort reg_tpi product;

. save , replace;
file /tmp/St02564.00000c saved

. use `tempwt6';

.         merge reg_tpi product using `uvq';
variables reg_tpi product do not uniquely identify observations in /tmp/St02564.00000c
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        0.90        0.90
          3 |        441       99.10      100.00
------------+-----------------------------------
      Total |        445      100.00

.         gen tpi1     =ppkg     *share;
(4 missing values generated)

.         gen tpi1_trim=ppkg_trim*share;
(7 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       441    125.5442    14.78831        100        150
     reg_tpi |       445    2.498876    1.085583          1          4
       share |       445    .0383485    .0407269          0   .1976485
    medshare |       445    .0404494    .1027744          0   .6404065
    survquar |       441    2.848073    1.471564          1          5
-------------+--------------------------------------------------------
        news |       441    2.498866    1.085283          1          4
  valued_tot |       441    5545.762    7720.548   14.28571   60589.15
quantityd_~t |       441     15.4772    22.73993   .0714286   173.9763
        ppkg |       441    692.7551    758.9424         50   4516.363
   ppkg_trim |       438    652.3875    771.3226         50   4516.363
-------------+--------------------------------------------------------
      _merge |       445    2.982022    .1889765          1          3
        tpi1 |       441    28.71811     47.2602   .0012743   333.6888
   tpi1_trim |       438    26.71146    45.53869   .0012743   343.1419

. keep if survquar!=.;
(4 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       441    125.5442    14.78831        100        150
     reg_tpi |       441    2.498866    1.085283          1          4
       share |       441    .0386964    .0407464   .0000255   .1976485
    medshare |       441    .0408163    .1031678          0   .6404065
    survquar |       441    2.848073    1.471564          1          5
-------------+--------------------------------------------------------
        news |       441    2.498866    1.085283          1          4
  valued_tot |       441    5545.762    7720.548   14.28571   60589.15
quantityd_~t |       441     15.4772    22.73993   .0714286   173.9763
        ppkg |       441    692.7551    758.9424         50   4516.363
   ppkg_trim |       438    652.3875    771.3226         50   4516.363
-------------+--------------------------------------------------------
      _merge |       441           3           0          3          3
        tpi1 |       441    28.71811     47.2602   .0012743   333.6888
   tpi1_trim |       438    26.71146    45.53869   .0012743   343.1419

. list in  1/3;

     +----------------------------------------------------------------------------------+
  1. | product | reg_tpi |    share | medshare |          survquar |    news | valued~t |
     |     100 | Central | .1245395 |        0 | May '05 - Jul-'05 | Central | 15969.55 |
     |-----------------------------------------+----------------------------------------|
     |  quanti~t   |      ppkg   |  ppkg_t~m   |  _merge   |      tpi1   |   tpi1_t~m   |
     |  12.19603   |  1309.405   |    1388.5   |       3   |  163.0727   |    172.923   |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  2. | product | reg_tpi |    share | medshare |          survquar |    news | valued~t |
     |     105 | Central | .1627478 | .3548732 | May '05 - Jul-'05 | Central | 19836.72 |
     |-----------------------------------------+----------------------------------------|
     |  quanti~t   |      ppkg   |  ppkg_t~m   |  _merge   |      tpi1   |   tpi1_t~m   |
     |  21.78891   |  910.4047   |  801.2834   |       3   |  148.1664   |   130.4071   |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  3. | product | reg_tpi |    share | medshare |          survquar |    news | valued~t |
     |     107 | Central | .0871047 |        0 | May '05 - Jul-'05 | Central | 9570.623 |
     |-----------------------------------------+----------------------------------------|
     |  quanti~t   |      ppkg   |  ppkg_t~m   |  _merge   |      tpi1   |   tpi1_t~m   |
     |  15.48085   |  618.2235   |  481.1454   |       3   |  53.85015   |   41.91001   |
     +----------------------------------------------------------------------------------+

. list in -3/-1;

     +-----------------------------------------------------------------------------+
439. | product | reg_tpi |   share | medshare |      survquar |    news | valued~t |
     |     150 | Western | .010944 | .0249144 |    Aug-Oct 05 | Western |   1271.7 |
     |-----------------------------------------------------------------------------|
     |  quanti~t  |      ppkg  |  ppkg_t~m  |  _merge  |      tpi1   |  tpi1_t~m   |
     |  6.681939  |   190.319  |  184.2462  |       3  |  2.082845   |  2.016385   |
     +-----------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------+
440. | product | reg_tpi |   share | medshare |      survquar |    news | valued~t |
     |     150 | Western | .010944 | .0249144 | Jul-Sept 2006 | Western | 1944.216 |
     |-----------------------------------------------------------------------------|
     |  quanti~t  |      ppkg  |  ppkg_t~m  |  _merge  |      tpi1   |  tpi1_t~m   |
     |  9.488426  |  204.9039  |  189.5945  |       3  |  2.242463   |  2.074916   |
     +-----------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------+
441. | product | reg_tpi |   share | medshare |      survquar |    news | valued~t |
     |     150 | Western | .010944 | .0249144 |   Oct-Nov '06 | Western | 322.1541 |
     |-----------------------------------------------------------------------------|
     |  quanti~t  |      ppkg  |  ppkg_t~m  |  _merge  |      tpi1   |  tpi1_t~m   |
     |  1.559935  |  206.5177  |  206.1629  |       3  |  2.260123   |  2.256241   |
     +-----------------------------------------------------------------------------+

.         **************************************************************************;
. * Find TPI level and indexes for non-trimmed and trimmed prices
> **************************************************************************;
. * Not trimmed ;
.         collapse (sum) tpi1 tpi1_trim  , by(reg_tpi survquar);

.                 for num 1/$n_tpi :
>                         sum tpi1 if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1 if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1 if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1 if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1 if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1 if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

->  sum tpi1 if reg_tpi==5 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==5 & survquar==4 , meanonly

->  global base5=r(mean)

.                 lab var tpi1 "Temporal price index before normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi=tpi1/${base`v'} if reg_tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi=tpi1/${base`v'} if reg_tpi==`
> v' ;
  7.                                         } ;
  8.                                 } ;
(14 missing values generated)
(5 real changes made)
(5 real changes made)
(4 real changes made)
(0 real changes made)

.                                                                                             
>     *gen     tpi=tpi1/$base1 if reg_tpi==1;
.                 *replace tpi=tpi1/$base2 if reg_tpi==2;
.                 *replace tpi=tpi1/$base3 if reg_tpi==3;
.                 *replace tpi=tpi1/$base4 if reg_tpi==4;
.                 *replace tpi=tpi1/$base5 if reg_tpi==5;
.                 *replace tpi=tpi1/$base6 if reg_tpi==6;
.                                                                                 lab var tpi 
> "Temporal price index (Q4=1)";

. * Trimmed ;
.                 for num 1/$n_tpi :
>                         sum tpi1_trim if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1_trim if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1_trim if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1_trim if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1_trim if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1_trim if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

->  sum tpi1_trim if reg_tpi==5 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==5 & survquar==4 , meanonly

->  global base5=r(mean)

.                 lab var tpi1_trim "Six regions: TRIMMED Temporal price index before normaliz
> ation";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi_trim=tpi1_trim/${base`v'} if reg_
> tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi_trim=tpi1_trim/${base`v'} if 
> reg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(14 missing values generated)
(5 real changes made)
(5 real changes made)
(4 real changes made)
(0 real changes made)

.                                                 lab var tpi_trim "TRIMMED Temporal price ind
> ex (Q4=1)";

.                 sort reg_tpi survquar;

.             drop if reg_tpi<1 | reg_tpi>$n_tpi;
(0 observations deleted)

. gen tpi_diff = tpi - tpi_trim;

. lab var tpi_diff "TPI difference btw trimmed/untrimmed";

. twoway (connected tpi_trim survquar),yline(1) by(, title("TPI: Trimmed"))
> by(reg_tpi) sav("$path/work/reg_tpi-tpi_trim", replace);
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/reg_tpi-tpi_trim.gph saved)

. graph export "$path/work/reg_tpi-tpi_trim.tif", replace;
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/reg_tpi-tpi_trim.tif written in TIFF
>  format)

. list reg_tpi survquar tpi tpi_trim tpi_diff;

     +-------------------------------------------------------------------+
     |  reg_tpi               survquar        tpi   tpi_trim    tpi_diff |
     |-------------------------------------------------------------------|
  1. |  Central      May '05 - Jul-'05   1.023404   1.037946    -.014542 |
  2. |  Central             Aug-Oct 05   1.145034   1.058962    .0860724 |
  3. |  Central          Jul-Sept 2006          1          1           0 |
  4. |  Central            Oct-Nov '06   1.123757   1.223628   -.0998706 |
  5. |  Eastern      May '05 - Jul-'05   1.058028   .8873101     .170718 |
     |-------------------------------------------------------------------|
  6. |  Eastern             Aug-Oct 05   .9829763   .8727097    .1102666 |
  7. |  Eastern   Nov '05 & May-Jun 06    .329728   .4442574   -.1145294 |
  8. |  Eastern          Jul-Sept 2006          1          1           0 |
  9. |  Eastern            Oct-Nov '06   1.087058   .9541122    .1329454 |
 10. | Northern      May '05 - Jul-'05   .8942134    .936161   -.0419477 |
     |-------------------------------------------------------------------|
 11. | Northern             Aug-Oct 05   .9299877     .98029   -.0503023 |
 12. | Northern   Nov '05 & May-Jun 06   .9631566   .9508332    .0123234 |
 13. | Northern          Jul-Sept 2006          1          1           0 |
 14. | Northern            Oct-Nov '06   .9321731    1.04144    -.109267 |
 15. |  Western      May '05 - Jul-'05   .9381497   1.015202   -.0770526 |
     |-------------------------------------------------------------------|
 16. |  Western             Aug-Oct 05   .9113454   .8591004     .052245 |
 17. |  Western          Jul-Sept 2006          1          1           0 |
 18. |  Western            Oct-Nov '06   1.152315   1.181831   -.0295157 |
     +-------------------------------------------------------------------+

.                 sort reg_tpi survquar;

. keep reg_tpi survquar tpi_trim;

. save "$path/work/temp_index_reg_tpi.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/temp_index_reg_tpi.dta saved

.                        *********************************************************************
> *****
> * 090_temp_index.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/100_food_basket_flex.do"/* Flexible food basket */

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/100_food_basket_flex.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/100_food_basket_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:25

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 100_food_basket_flex.do     (start)
> *
> * This file is to get the data from the cons_cod.dta in work and then 
> * to create the do file with the 90% of the consumption expenditures 
> * using a flexible basket of goods.
> *
> * NOTE: we actually keep goods representing 95% of expenditure
> * in order to facilitate dropping of some goods (such as rats) where
> * quantity and nutrition information is unknown.
> *
> * We base our basket on the bottom 60 percent of consumption per capita
> * (weighted by hhweight*hhsize). We use the TEMPORALLY-ADJUSTED
> * NOMINAL consumption because we don't have a spatial adjustment yet.
> *
> * (Then we iterate this process to arrive at a final food bundle in later code)
> **************************************************************************;
. *CA modified to bring in hhdata into bootstrap;
. /*
> This file uses:
>                 work/cons_cod.dta
>                 work/hhdata.dta
>                 work/products.dta
>                 work/consump_nom.dta
>                 work/temp_index_reg_tpi.dta
>                 work/food_cat.dta
> 
> This file creates:
>                 work/food_basket_flex.dta
>                 work/codes_food_basket_flex.dta
> */
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************;
. * First, make a small temp file that has the temporally adjusted 
> * nominal consumption per capita, using work/consump_nom and 
> * work/temp_index_reg_tpi.dta. Make a dummy variable indicating
> * whether they are in the bottom 60%.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _m;

.         keep hhid hhweight hhsize cons_pc_nom reg_tpi rural survquar;

.         sort reg_tpi survquar;

.         cap drop _merge;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         15        0.48        0.48
          3 |      3,109       99.52      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.                 gen food_pc_tpi  = food_pc_nom /tpi_trim;
(15 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

.         save `contpi', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

.         collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight] ;

.         rename cons_pc_tpi pctile_60;

.         tempfile 60pct;

.         sort one;

.         save `60pct', replace;
(note: file /tmp/St02564.000002 not found)
file /tmp/St02564.000002 saved

.                 use `contpi';

.                 sort one;

.                 merge one using `60pct';
variable one does not uniquely identify observations in the master data

.                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                 drop _merge;

.                 drop one;

.                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                 tab bottom_basket [aw=hhsize*hhweight];

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,564.9929       50.18       50.18
          1 | 1,554.0071       49.82      100.00
------------+-----------------------------------
      Total |      3,119      100.00

.                 lab var bottom_basket "=1 if in bottom 60% of PCE";

.                                 sort hhid;

. save `contpi' , replace;
file /tmp/St02564.000001 saved

. **************************************************************************;
. * Next, need to keep only the food products in order to calculate the 
> * food poverty line, and then calculate the food expenses by code.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. /*
>         sort product;
>         merge product using "$path/work/food_cat.dta";
>         tab _merge;
>         keep if _merge==3;
>         drop _merge;
> */
>         
>         keep if food_cat==1;
(3977 observations deleted)

.         codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                   Unique HH Identifier Across Panel Waves
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3120                     missing .:  0/38998

                  mean:   2.3e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.1e+09   3.2e+09   4.1e+09

.         sort hhid;

. **************************************************************************;
. * Next, merge in the consumption information, and select those in bottom
> * 60% of nominal distribution, after making temporal adjustment. 
> **************************************************************************;
.         merge hhid using `contpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,002      100.00

.         keep if _merge==3;
(4 observations deleted)

.         drop _merge;

.         keep if bottom_basket==1;
(25093 observations deleted)

.      **************************************************************************;
. * Calculate food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.           gen  food_expenditure= cod_hh_nom;

.                             *gen  food_expenditure= own_valued + daily_valued + monthly_valu
> ed + educ_valued;
.           egen tot_food_expen= sum (food_expen), by (hhid) ;

.           count if food_expenditure==.;
    0

.           count if tot_food_expen==.;
    0

.                     gen food_share= food_expenditure/tot_food_expen;

.           count if food_share==.;
    0

.           drop if food_share==.;
(0 observations deleted)

.           sort hhid product;

.                         tempfile food_basket_flex;

. save `food_basket_flex', replace;
(note: file /tmp/St02564.000003 not found)
file /tmp/St02564.000003 saved

. ********************************************************************************;
. * Now prepare to get the variable spdomain to the using dataset, and then find the 
> * total shares by each product in order to select the most important goods in the 
> * basket.
> ********************************************************************************;
.                 preserve;

.                 use "$path/work/hhdata.dta", clear;

.                         keep hhid spdomain;

.                         sort hhid;

.                         tempfile spdomain;

.                 save `spdomain' , replace;
(note: file /tmp/St02564.000005 not found)
file /tmp/St02564.000005 saved

.                 restore;

.                            collapse (mean) hhweight, by (hhid);

.            sort hhid ;

.             merge hhid using `spdomain';

.            tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      1,766       56.55       56.55
          3 |      1,357       43.45      100.00
------------+-----------------------------------
      Total |      3,123      100.00

.            drop if _m==2;
(1766 observations deleted)

.            drop _merge;

.             collapse (sum) hhweight , by(spdomain);

.            rename hhweight tothhweight;

.            tempfile tothhweight;

. save `tothhweight';
file /tmp/St02564.000006 saved

. use `food_basket_flex';

.           sort hhid;

.           merge hhid using `spdomain';
variable hhid does not uniquely identify observations in the master data

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      1,766       11.27       11.27
          3 |     13,905       88.73      100.00
------------+-----------------------------------
      Total |     15,671      100.00

.           sort _m;

.           drop if _m==2;
(1766 observations deleted)

.           drop _m;

.           sort spdomain;

.             merge spdomain using `tothhweight';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,905      100.00      100.00
------------+-----------------------------------
      Total |     13,905      100.00

.           drop _merge;

.             sort spdomain product;

.             gen f_share_w=(food_share*hhweight)/tothhweight;

.                                                 *drop descript;
.                         *gen descript = 0;
.             collapse (sum) f_share_w, by(spdomain product);

.                      sort spdomain f_share_w;

.           by spdomain: gen cumshr= sum(f_share_w);

.                     count if cumshr<=.075;
  118

.           drop if cumshr<=.075;
(118 observations deleted)

.             lab var f_share_w "average food share for the 13 regions";

. save "$path/work/food_basket_flex.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/food_basket_flex.dta saved

. * List first spatial region to get an idea about contents;
. list product spdomain f_share_w cumshr if spdomain==1;

     +-----------------------------------------------+
     | product        spdomain   f_shar~w     cumshr |
     |-----------------------------------------------|
  1. |     149   Central Urban     .00871   .0760886 |
  2. |     150   Central Urban   .0094023   .0854908 |
  3. |     114   Central Urban   .0099662    .095457 |
  4. |     134   Central Urban   .0119157   .1073727 |
  5. |     125   Central Urban    .012526   .1198987 |
     |-----------------------------------------------|
  6. |     135   Central Urban   .0141241   .1340228 |
  7. |     140   Central Urban    .016719   .1507417 |
  8. |     117   Central Urban   .0194072   .1701489 |
  9. |     161   Central Urban   .0276729   .1978219 |
 10. |     127   Central Urban   .0277953   .2256172 |
     |-----------------------------------------------|
 11. |     136   Central Urban   .0294572   .2550744 |
 12. |     122   Central Urban   .0308958   .2859702 |
 13. |     157   Central Urban   .0362997   .3222699 |
 14. |     123   Central Urban   .0376731    .359943 |
 15. |     144   Central Urban   .0507403   .4106833 |
     |-----------------------------------------------|
 16. |     141   Central Urban    .053628   .4643113 |
 17. |     100   Central Urban   .0608637    .525175 |
 18. |     105   Central Urban   .0690821    .594257 |
 19. |     107   Central Urban   .0830494   .6773064 |
 20. |     147   Central Urban   .0905686   .7678751 |
     |-----------------------------------------------|
 21. |     113   Central Urban   .1092901   .8771651 |
 22. |     110   Central Urban   .1228348          1 |
     +-----------------------------------------------+

.                     gen numreg=1;

.           collapse (sum) numreg cumshr, by (product);

.                           keep product  numreg;

.           display _N;
39

.                     lab var numreg "number of goods in the basket";

. /*
>           merge product using "$path/work/products.dta";
>             tab _merge;
>           keep if _merge==3;
> */
>           keep product  numreg;

.             sort product;

.                display _N;
39

.   save "$path/work/codes_food_basket_flex.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex.dta saved

. **************************************************************************
> * 100_food_basket_flex.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/110_price_unit_flex.do"/* Flexible basket: Prices */

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/110_price_unit_flex.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/110_price_unit_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:25

. clear

. set more off

. #delimit ;
delimiter now ;
. ****************************************************************************************
> * 110_price_unit_flex.do                (start)
> *
> * Purpose: This do file creates a price_unit_flex database with the unit prices of the
> * goods of the flexible food basket in order to determine the poverty lines per spatial
> * domain. It uses the files work/daily.dta and work/own.dta file and draw unit prices
> * by: sum of values and quantity
> ****************************************************************************************;
. *CA modified to bring in work/hhdata.dta for bootstrap
> *CA check for price calcs conditional on number of observations;
. /*
> This file uses:
>         work/daily.dta
>         work/own.dta
>         work/hhdata.dta
>         work/consump_nom.dta
>         work/codes_food_basket_flex.dta
>         work/temp_index_reg_tpi.dta
>           new/conversions.do
> 
> This file creates:
>         work/price_unit_flex.dta
>         work/bottom_basket.dta
> */
> 
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************************
> * Create sorted data set with daily and own and the matched codes
> **************************************************************************************;
. use "$path/work/cons_cod_trans.dta", clear;

. *use "$path/in/cons_cod_trans.dta", clear;
. *save "$path/work/cons_cod_trans.dta", replace;
. *drop if quantityd==0 ;
. keep hhid product food_cat valuez quantity unit;

. rename valuez    value;

. *rename quantityz quantity;
. drop if quantity==0 ;
(3 observations deleted)

. *drop count;
.         sort product;

.         gen count=1;

.                 tempfile dd_acsort;

. save `dd_acsort', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. /*
> use "$path/work/daily.dta";
> tempfile dd_acsort;
>         drop days;
>         sort product;
>         tempfile dd_acsort;
> save `dd_acsort', replace;
> 
> use "$path/work/own.dta";
>         keep hhid product valued quantityd unit;
>         rename valued value;
>         rename quantityd quantity;
> 
>         *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>         drop if quantity==0;
> 
>         append using `dd_acsort';
> 
> *CA modified to merge in work/hhdata.dta for bootstrap;
>         sort hhid;
>       merge hhid using "$path/work/hhdata.dta";
>       tab _m;
> 
> * Drop observations if non existent in HH data set;
> drop if _m!=3;
> drop _m;
> 
> 
>         sort product;
>         gen count=1;
> 
> 
> save `dd_acsort', replace;
> */
> 
> 
> **************************************************************************************;
. * Merge the flexible food basket codes with the daily and own data sets
> * Drop all codes not a part of the flexible food basket
> **************************************************************************************;
.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data
product was int now float

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,634        9.12        9.12
          3 |     36,216       90.88      100.00
------------+-----------------------------------
      Total |     39,850      100.00

.         drop if _merge~=3;
(3634 observations deleted)

.         drop _merge;

. **************************************************************************************;
. * Drop observations where product code or quantity or value information is unavailable
> **************************************************************************************;
.                                 codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              household id
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3118                     missing .:  505/36216

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.1e+09   3.2e+09   4.1e+09

. *        drop if product==. | value==. | quantity==.  ;
.                                 codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              household id
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3118                     missing .:  505/36216

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.1e+09   3.2e+09   4.1e+09

. **************************************************************************************;
. * Convert non-KG quantities (units and liters) to kilograms;
. **************************************************************************************;
. *do "$path/new/110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped
> ********************************************************************;
. *        drop if unit~=2;
. ********************************************************************
> * Merge in labels for the 13 spatial domains
> ********************************************************************;
.         preserve;

.                 use "$path/work/hhdata.dta", clear;

.                                                                         keep hhid spdomain r
> eg_tpi survquar;

.                         sort hhid;

.                         tempfile spdomainreg_tpi;

.                 save `spdomainreg_tpi', replace;
(note: file /tmp/St02564.000003 not found)
file /tmp/St02564.000003 saved

.                                 codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              Household ID
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3123                     missing .:  0/3123

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         restore;

.                 sort hhid;

.         merge hhid using `spdomainreg_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        505        1.39        1.39
          2 |          5        0.01        1.41
          3 |     35,711       98.59      100.00
------------+-----------------------------------
      Total |     36,221      100.00

.         drop _merge;

.         drop if product==.;
(5 observations deleted)

. codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              household id
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3118                     missing .:  505/36216

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.1e+09   3.2e+09   4.1e+09

. tab spd;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |      5,906       16.56       16.56
Central Rural |      6,566       18.41       34.97
      Eastern |      8,446       23.68       58.66
     Northern |      7,117       19.96       78.61
      Western |      7,627       21.39      100.00
--------------+-----------------------------------
        Total |     35,662      100.00

. sum if spd>=3;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     23239    3.06e+09    8.30e+08   2.01e+09   4.19e+09
     product |     23744    129.8697    16.25222        100        161
       value |     23239    241.6601    391.0277   1.428571   19285.71
        unit |     23239           1           0          1          1
    food_cat |     23239           1           0          1          1
-------------+--------------------------------------------------------
    quantity |     21501     1.13447    3.211978   .0014286      135.2
       count |     23744           1           0          1          1
      numreg |     23744    3.880686    1.395461          1          5
    survquar |     23190    2.326693    1.361816          1          5
     reg_tpi |     23190    2.964683    .8317951          2          4
-------------+--------------------------------------------------------
    spdomain |     23190    3.964683    .8317951          3          5

. table spdomain, content(mean quantity count quantity count hhid) row missing;

--------------------------------------------------------------
Spatial       |
domains: each |
with own      |
poverty line  |
(they are 5)  | mean(quantity)     N(quantity)         N(hhid)
--------------+-----------------------------------------------
Central Urban |       .6272362           5,578           5,906
Central Rural |       1.137202           6,316           6,566
      Eastern |        .932739           8,185           8,446
     Northern |       1.077276           5,808           7,117
      Western |       1.401658           7,462           7,627
              | 
        Total |       1.050459          33,349          35,662
--------------------------------------------------------------

.         drop if product==. | value==. | quantity==.  ;
(2821 observations deleted)

. codebook hhid;

----------------------------------------------------------------------------------------------
hhid                                                                              household id
----------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  3021                     missing .:  0/33395

                  mean:   2.4e+09
              std. dev:   1.2e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.1e+09   3.2e+09   4.1e+09

. tab spd;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |      5,578       16.73       16.73
Central Rural |      6,316       18.94       35.67
      Eastern |      8,185       24.54       60.21
     Northern |      5,808       17.42       77.62
      Western |      7,462       22.38      100.00
--------------+-----------------------------------
        Total |     33,349      100.00

. ********************************************************************
> * Merge in temporal price index to convert nominal value to real
> ********************************************************************;
.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        162        0.49        0.49
          3 |     33,233       99.51      100.00
------------+-----------------------------------
      Total |     33,395      100.00

.         drop if _merge ~= 3;
(162 observations deleted)

.         drop _merge;

.         gen value_r=value/tpi_trim;

. **************************************************************************;
. * Identify relatively poor households, based on nominal temporally adjusted
> * consumption per capita. Only work with these households for the price
> * calculations.
> **************************************************************************;
.                 preserve;

.                         use "$path/work/conpc.dta", clear;

. *                       use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.         sort hhid;

.       merge hhid using "$path/work/hhdata.dta";

.       tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.       drop _m;

. *CA modified to keep bswt;
.                                 keep hhid hhweight hhsize cons_pc_nom bswt ;

.                                 sort hhid;

.                                 merge hhid using `spdomainreg_tpi';
(label lsurvquar already defined)
(label lregion already defined)
(label lspdomain already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                                 drop _merge;

.                                 sort reg_tpi survquar;

.                                 cap drop _merge;

.                                 merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.
> dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         15        0.48        0.48
          3 |      3,109       99.52      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                                 drop _merge;

.                                 sort hhid;

.                                 merge hhid using "$path/work/conpc.dta";

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                                 drop _merge;

.                                 gen food_pc_tpi  = food_pc_nom /tpi_trim;
(15 missing values generated)

.                                 lab var food_pc_tpi "Temp-adjusted per capita food consumpti
> on/day";

.                                                                 * Non-food not TPI adjusted 
> ;
.                                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.                                 lab var cons_pc_tpi "Temp adjusted total consumption/day";

.                                 gen one=1;

.                                 tempfile contpi;

.                                 save `contpi', replace;
(note: file /tmp/St02564.000005 not found)
file /tmp/St02564.000005 saved

.                                 collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight], by
> (spdomain) ;

.                                 rename cons_pc_tpi pctile_60;

.                                 tempfile 60pct;

.                                 sort spdomain;

.                                 save `60pct', replace;
(note: file /tmp/St02564.000006 not found)
file /tmp/St02564.000006 saved

.                                 use `contpi';

.                                         sort spdomain;

.                                         merge spdomain using `60pct';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.                                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.                                         drop _merge;

.                                         drop one;

.                                         sort spdomain;

.                                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                                         by spdomain: tab bottom_basket [aw=hhsize*hhweight];

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 233.467673       50.75       50.75
          1 | 226.532327       49.25      100.00
------------+-----------------------------------
      Total |        460      100.00

----------------------------------------------------------------------------------------------
-> spdomain = Central Rural

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 285.075201       50.55       50.55
          1 | 278.924799       49.45      100.00
------------+-----------------------------------
      Total |        564      100.00

----------------------------------------------------------------------------------------------
-> spdomain = Eastern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 348.971102       50.07       50.07
          1 | 348.028898       49.93      100.00
------------+-----------------------------------
      Total |        697      100.00

----------------------------------------------------------------------------------------------
-> spdomain = Northern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 347.620933       50.02       50.02
          1 | 347.379067       49.98      100.00
------------+-----------------------------------
      Total |        695      100.00

----------------------------------------------------------------------------------------------
-> spdomain = Western

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 351.585126       50.01       50.01
          1 | 351.414874       49.99      100.00
------------+-----------------------------------
      Total |        703      100.00

----------------------------------------------------------------------------------------------
-> spdomain = .
no observations


.                                         lab var bottom_basket "=1 if in bottom (60%) of PCE"
> ;

.                                         sort hhid;

.                                                                 save "$path/work/bottom_bask
> et.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/bottom_basket.dta saved

.         restore;

.         sort hhid;

.         merge hhid using "$path/work/bottom_basket.dta";
variable hhid does not uniquely identify observations in the master data
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        115        0.34        0.34
          3 |     33,233       99.66      100.00
------------+-----------------------------------
      Total |     33,348      100.00

.         drop _merge;

.                         * Only keep price observations for the poor ;
.         keep if bottom_basket==1;
(20996 observations deleted)

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * for each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
(17 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(spdomain product);
(17 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
(17 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     12352    2.31e+09    1.18e+09   1.02e+09   4.19e+09
     product |     12335    129.2812    16.03414        100        154
       value |     12335    207.2503    291.3657   2.857143       4200
        unit |     12335           1           0          1          1
    food_cat |     12335           1           0          1          1
-------------+--------------------------------------------------------
    quantity |     12335    1.069382    3.051545   .0002857      135.2
       count |     12335           1           0          1          1
      numreg |     12335    4.007296    1.348036          1          5
    survquar |     12352    2.455149    1.429734          1          5
     reg_tpi |     12352    2.217212    1.170655          1          4
-------------+--------------------------------------------------------
    spdomain |     12352    3.038941    1.396767          1          5
    tpi_trim |     12352    .9958938    .0821045   .8591004   1.223628
     value_r |     12335    207.9584    289.5788    2.75269       4200
 cons_pc_nom |     12352    635.1346    344.6575   103.3254   1949.757
    hhweight |     12352    1769.408     712.246   140.8407   5553.862
-------------+--------------------------------------------------------
        bswt |     12352           1           0          1          1
      hhsize |     12352    6.443491    2.985493          1         29
 cons_hh_nom |     12352    3940.417    2690.047        150   27429.27
 food_pc_nom |     12352     398.762    189.5894          0   1347.619
   nf_pc_nom |     12352    236.3726    201.0937          0   1344.332
-------------+--------------------------------------------------------
 food_pc_tpi |     12352    397.2113    176.2312          0   1298.352
 cons_pc_tpi |     12352    633.5839     328.135   106.8324   1747.104
   pctile_60 |     12352     904.575    414.6753   501.5237   1751.113
bottom_bas~t |     12352           1           0          1          1
      hhppkg |     12335    795.7898    1088.115   6.223299   48172.07
-------------+--------------------------------------------------------
      lower5 |     12335    347.6065    406.6277   14.10155   2832.963
      upper5 |     12335    1608.903    1555.171   47.68716   10201.06

. describe;

Contains data from /tmp/St02564.000001
  obs:        12,352                          
 vars:            27                          10 Mar 2014 14:47
 size:     1,445,184                          (_dta has notes)
----------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
----------------------------------------------------------------------------------------------
hhid            double %10.0g                 household id
product         float  %34.0g      H14AQ2     Food product code: numerical
value           float  %9.0g                  daily value of consumption in UGX per per
                                                household
unit            float  %9.0g                  set equal to one since all observations are
                                                converted into kg
food_cat        float  %9.0g                  food category equals 1, if product is food and 0
                                                if non food
quantity        float  %9.0g                  daily quantity consumed in Kgs per household
count           float  %9.0g                  
numreg          double %9.0g                  number of goods in the basket
survquar        float  %20.0g      lsurvquar
                                              Sequential Survey Quarter (May-Nov'05 & May-Nov
                                                '06)
reg_tpi         byte   %9.0g       lregion    Regions used for temporal price index
                                                calculations
spdomain        float  %13.0g      lspdomain
                                              Spatial domains: each with own poverty line
                                                (they are 5)
tpi_trim        float  %9.0g                  TRIMMED Temporal price index (Q4=1)
value_r         float  %9.0g                  
cons_pc_nom     float  %9.0g                  
hhweight        float  %9.0g                  Household sample weight
bswt            float  %9.0g                  bootstrap weights; and all equal to 1 for all
                                                households, as a toolkit requireme
hhsize          long   %9.0g                  number of household menbers
cons_hh_nom     double %9.0g                  (sum) cod_hh_nom
food_pc_nom     float  %9.0g                  nominal food consumption per capita
nf_pc_nom       float  %9.0g                  nominal non-food consumption per capita
food_pc_tpi     float  %9.0g                  Temp-adjusted per capita food consumption/day
cons_pc_tpi     float  %9.0g                  Temp adjusted total consumption/day
pctile_60       float  %9.0g                  (p 50) cons_pc_tpi
bottom_basket   float  %9.0g                  =1 if in bottom (60%) of PCE
hhppkg          float  %9.0g                  
lower5          float  %9.0g                  
upper5          float  %9.0g                  
----------------------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

. keep if hhppkg-lower5>=0 & hhppkg-upper5<=0;
(882 observations deleted)

. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_unitw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_unitt. Last we take the median, price_unitm. But in the end
> * we only use price_unitw
> *********************************************************************;
.         gen price_unitt=value_r/(quantity*1000);

.         gen price_unitm=price_unitt;

.                 *CA modified to count the boot sample weight bswt;
.         collapse (sum) quantity value_r count bswt 
>                  (mean) price_unitt 
>                  (median) price_unitm [aw=hhweight], by(spdomain product);

.         *Generate weighted price per gram ;
.         gen price_unitw=value_r/(quantity*1000);

.         drop value_r quantity;

.         sort spdomain product;

.         lab var price_unitt "simple average of calculated prices - transaction weighted";

.         lab var price_unitm "median of prices";

.         lab var price_unitw "value share weighted mean prices";

. * Get an idea of the difference between the price measures;
.         gen ratiotw=price_unitt/price_unitw;

.         gen ratiomw=price_unitm/price_unitw;

.         sum ratiotw ratiomw;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     ratiotw |       184    1.219561    .3580905   .9057599   3.137953
     ratiomw |       184    1.054696    .2695414   .4358797   2.686314

.         sort product;

.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          2        1.08        1.08
          3 |        184       98.92      100.00
------------+-----------------------------------
      Total |        186      100.00

.         count if _merge~=3;
    2

.         drop if _merge~=3;
(2 observations deleted)

.         drop _merge;

.         sort product spdomain;

. save "$path/work/price_unit_flex.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex.dta saved

. ****************************************************************************************
> * 110_price_unit_flex.do                (end)
> ****************************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/120_povline_food_flex_original.do"/* Flexible basket: Poverty line */

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/120_povline_food_flex.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/120_povline_food_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:27

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information.
> **************************************************************************;
. /*
> This file uses:
>         work/food_basket_flex.dta
>         work/price_unit_flex.dta
>         work/calperg.dta
>         work/calpp.dta
> 
> This file creates:
>         work/povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path/work/price_unit_flex.dta";
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          6        3.16        3.16
          2 |         63       33.16       36.32
          3 |        121       63.68      100.00
------------+-----------------------------------
      Total |        190      100.00

.         list product spdomain if _merge==1;

     +-------------------------+
     | product        spdomain |
     |-------------------------|
122. |     157   Central Urban |
123. |     157   Central Rural |
124. |     157         Eastern |
125. |     161   Central Urban |
126. |     161         Eastern |
     |-------------------------|
127. |     161        Northern |
     +-------------------------+

.         drop if _merge ~=3;
(69 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path/work/calperg.dta";
variable product does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         25       17.12       17.12
          3 |        121       82.88      100.00
------------+-----------------------------------
      Total |        146      100.00

.         * This tells where we are lacking calorie info or are lacking quantity info due to 
>         * missing price info above;
.         list product spdomain if _merge==1;

.         drop if _merge~=3;
(25 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price observations;
.         by spdomain: count if round(bswt)<10;

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    0
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

.         drop if round(bswt) < 10;
(0 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(6 observations deleted)

.         * reobtain the share represented from the average basket- should be slightly more th
> an 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        20    .8686488           0   .8686488   .8686488

----------------------------------------------------------------------------------------------
-> spdomain = Central Rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        21    .9048939           0   .9048939   .9048939

----------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .9076297           0   .9076297   .9076297

----------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        25    .9019189           0   .9019189   .9019189

----------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        22    .9024827           0   .9024827   .9024827


.         * obtain quantities and calories provided by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path/work/calpp.dta";
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        115      100.00      100.00
------------+-----------------------------------
      Total |        115      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie requirements;
.         gen ratio=.95*calpp/calreg;

.                         replace quan=quan*ratio;
(115 real changes made)

.         replace cal_ir=quan*calperg;
(109 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(115 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        20   -.0001542           0  -.0001542  -.0001542

----------------------------------------------------------------------------------------------
-> spdomain = Central Rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        21    .0000771           0   .0000771   .0000771

----------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27   -.0000514           0  -.0000514  -.0000514

----------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        25   -.0000257           0  -.0000257  -.0000257

----------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        22    .0000385           0   .0000385   .0000385


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;

.         * the sum of the value of the goods in the bundle is assumed to represent 90% of exp
> enditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.         replace povline_f_flex=povline_f_flex90/.9;
(115 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path/work/povline_food_flex.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex.dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> **************************************************************************
> * 120_povline_food_flex.do      (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/120_povline_food_flex.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:27
----------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/130_povmeas_flex.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/130_povmeas_flex.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/130_povmeas_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:27

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before any iteration)
> **************************************************************************;
. *CA modified to add work/hhdata.dta for bootstrap;
. /*
> This file uses:
>         in/foodshr96.dta
>         work/povline_f_flex.dta
>         work/consump_nom.dta
>         work/hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work/foodshr96.dta
>         work/povmeas.dta
>         work/povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news rural survmon survquar;

.         tab reg_tpi, miss;

    Regions |
   used for |
   temporal |
price index |
calculation |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
    Central |      1,024       32.79       32.79
    Eastern |        697       22.32       55.11
   Northern |        695       22.25       77.36
    Western |        703       22.51       99.87
          . |          4        0.13      100.00
------------+-----------------------------------
      Total |      3,123      100.00

.         tab survquar, miss;

   Sequential Survey |
 Quarter (May-Nov'05 |
      & May-Nov '06) |      Freq.     Percent        Cum.
---------------------+-----------------------------------
   May '05 - Jul-'05 |      1,057       33.85       33.85
          Aug-Oct 05 |        941       30.13       63.98
Nov '05 & May-Jun 06 |         60        1.92       65.90
       Jul-Sept 2006 |        818       26.19       92.09
         Oct-Nov '06 |        243        7.78       99.87
                   . |          4        0.13      100.00
---------------------+-----------------------------------
               Total |      3,123      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path/work/hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label lsurvquar already defined)
(label lregion already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         15        0.48        0.48
          3 |      3,109       99.52      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(15 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St02564.000002 not found)
file /tmp/St02564.000002 saved

. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(225 real changes made)

.                                         * Nearness to poverty line and population weights ;
.         gen tripopwt=triwt*hhweight*hhsize;
(5 missing values generated)

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file /tmp/St02564.000004 not found)
file /tmp/St02564.000004 saved

.                 tab spdomain;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |          1       20.00       20.00
Central Rural |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

. **************************************************************************;
. * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.         gen povline_flex=povline_f_flex + povline_na_flex;
(5 missing values generated)

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path/work/povlines.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines.dta saved

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povlines.dta";
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines.dta
(label lsurvquar already defined)
(label lregion already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;
(16 missing values generated)

.         * Poverty line;
.         gen linpob=povline_flex;
(5 missing values generated)

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;
(5 missing values generated)

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;
(16 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(3119 real changes made)

.         gen linpobr=linpob/spi;
(5 missing values generated)

.         replace cr2=cr/spi;
(3108 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
         cr2 |    3108  28069559.9    1060.929   964.5924   121.2709   20278.26
      linpob |    3119  28164219.1    439.7007   65.93853   314.1105   553.3799
     linpobr |    3119  28164219.1    450.0774   .0000115   450.0774   450.0775

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.         gen h = 100     if cr <=(linpob);
(2728 missing values generated)

.         replace  h = 0 if cr > (linpob);
(2728 real changes made)

.                         gen             pg      = ((linpob - cr )/linpob) *100;
(16 missing values generated)

.         replace         pg      = 0             if h==0;
(2728 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;
(16 missing values generated)

.         replace         spg     = 0             if h==0;
(2728 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;
(5 missing values generated)

.         gen spg_flex=spg;
(5 missing values generated)

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(4 missing values generated)

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |    15.2935   .9731112      13.37884    17.20817
     pg_flex |   3.344332    .267422       2.81816    3.870504
    spg_flex |   1.133443    .114167      .9088111    1.358075
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
       Urban |    3.49787   .9220902      1.683591    5.312149
       Rural |   17.75513       1.15      15.49242    20.01783
-------------+------------------------------------------------
pg_flex      |
       Urban |   .6972157    .221734      .2609381    1.133493
       Rural |   3.896757   .3170604      3.272918    4.520597
-------------+------------------------------------------------
spg_flex     |
       Urban |   .2591101   .1154087       .032035    .4861851
       Rural |   1.315907    .134715      1.050845    1.580968
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |   8.300454   1.307511      5.727831    10.87308
     Eastern |   19.46877   1.956764      15.61869    23.31884
    Northern |   20.48259   2.725485         15.12    25.84518
     Western |   16.40297   1.984944      12.49745    20.30849
-------------+------------------------------------------------
pg_flex      |
     Central |   1.718851   .3296987      1.070145    2.367557
     Eastern |     4.0511    .522677      3.022696    5.079505
    Northern |   5.077992   .8763631      3.353685      6.8023
     Western |   3.508019   .5252969      2.474459    4.541578
-------------+------------------------------------------------
spg_flex     |
     Central |    .544989   .1404603      .2686232    .8213547
     Eastern |   1.349988   .2284443      .9005072    1.799468
    Northern |   1.749897   .3554885      1.050448    2.449346
     Western |    1.23619   .2350781      .7736573    1.698724
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |   8.300454   1.307511      5.727831    10.87308
     Eastern |   19.46877   1.956764      15.61869    23.31884
    Northern |   20.48259   2.725485         15.12    25.84518
     Western |   16.40297   1.984944      12.49745    20.30849
-------------+------------------------------------------------
pg_flex      |
     Central |   1.718851   .3296987      1.070145    2.367557
     Eastern |     4.0511    .522677      3.022696    5.079505
    Northern |   5.077992   .8763631      3.353685      6.8023
     Western |   3.508019   .5252969      2.474459    4.541578
-------------+------------------------------------------------
spg_flex     |
     Central |    .544989   .1404603      .2686232    .8213547
     Eastern |   1.349988   .2284443      .9005072    1.799468
    Northern |   1.749897   .3554885      1.050448    2.449346
     Western |    1.23619   .2350781      .7736573    1.698724
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   2.067417   1.009692      .0807763    4.054058
   _subpop_2 |   11.83287   2.005974      7.885974    15.77977
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   20.65156   2.096198      16.52714    24.77598
   _subpop_5 |   9.623426   4.111047      1.534644    17.71221
   _subpop_6 |   22.25124   3.087229      16.17689    28.32558
   _subpop_7 |    3.43429   1.887055     -.2786256    7.147206
   _subpop_8 |   17.24875   2.104325      13.10834    21.38916
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   .4322447   .2277505     -.0158709    .8803603
   _subpop_2 |   2.448003    .504024        1.4563    3.439707
   _subpop_3 |   .6200867   .3669826      -.101978    1.342151
   _subpop_4 |   4.322212   .5621175      3.216205    5.428218
   _subpop_5 |   2.161993   1.117685      -.037132    4.361118
   _subpop_6 |   5.552926   1.000756      3.583867    7.521986
   _subpop_7 |   .4921216   .3535844     -.2035812    1.187824
   _subpop_8 |   3.704706   .5561841      2.610374    4.799038
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   .1836988   .1344806     -.0809014     .448299
   _subpop_2 |   .7497412    .206323      .3437857    1.155697
   _subpop_3 |   .1175462   .0900193     -.0595733    .2946657
   _subpop_4 |   1.447373    .246093      .9631672    1.931578
   _subpop_5 |   .7994442   .5211737     -.2260026    1.824891
   _subpop_6 |   1.904699   .4036793      1.110431    2.698967
   _subpop_7 |    .152026   .1384592     -.1204025    .4244545
   _subpop_8 |   1.306896   .2489831       .817004    1.796788
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   2.067417   1.009692      .0807763    4.054058
   _subpop_2 |   11.83287   2.005974      7.885974    15.77977
     Eastern |   19.46877   1.956764      15.61869    23.31884
    Northern |   20.48259   2.725485         15.12    25.84518
     Western |   16.40297   1.984944      12.49745    20.30849
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   .4322447   .2277505     -.0158709    .8803603
   _subpop_2 |   2.448003    .504024        1.4563    3.439707
     Eastern |     4.0511    .522677      3.022696    5.079505
    Northern |   5.077992   .8763631      3.353685      6.8023
     Western |   3.508019   .5252969      2.474459    4.541578
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   .1836988   .1344806     -.0809014     .448299
   _subpop_2 |   .7497412    .206323      .3437857    1.155697
     Eastern |   1.349988   .2284443      .9005072    1.799468
    Northern |   1.749897   .3554885      1.050448    2.449346
     Western |    1.23619   .2350781      .7736573    1.698724
--------------------------------------------------------------

.         compress;
hhsize was long now byte
survquar was float now byte
spdomain was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
news was float now byte
bswt was float now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize];

. save "$path/work/povmeas.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povmeas.dta saved

. *** HARUNA, the file Povmeas.dta gives the headcount poverty rates using flexible food bundl
> e without inflicting reveales preferences
> *** therefore specifications in line 226 of this do file have been changed repeatedly to gen
> erate these counts for particular
> *** classifications of interest including strata spdomain region urban/rural (urban) and nat
> ional (done by removing the by command 
> **************************************************************************
> * 130_povmeas_flex.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/130_povmeas_flex.log
  log type:  text
 closed on:  10 Mar 2014, 14:47:27
----------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/140_iterate_bjorn.do" $it_n $bottom

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/140_iterate.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/140_iterate.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:35

. clear

. set more off

. #delimit ;
delimiter now ;
. *global povline_initial "$path/in/povlines_first_iof.dta";
. **************************************************************************
> * 140_iterate.do        (start)
> *
> * Purpose: Create flexible food basket and poverty line with iterative procedure
> *
> * This program will take the results from the first pass at the
> * poverty lines and applies the corresponding spatial deflator to
> * re-select the relatively poor, their consumption bundles, and
> * their prices.
> *
> * Welfare indicator is here always temporally and spatially adjusted per capita
> * expenditure. Here called cr_it< >.
> *
> * We will iterate this process 5 times which here assures convergence.
> *
> * CA, Mar 2010: Relatively poor are those below last iterated poverty line
> * MAH, Apr 2010: Cleaning
> * URB, feb 2012: Commented out "drop if unit~=2"
> **************************************************************************;
. /*
> This file uses:
>             in/povlines_first_new.dta
>         work/hhdata.dta
>         work/consump_nom.dta
>         work/own.dta
>         work/daily.dta
>         work/temp_index_reg_tpi.dta
>         work/cons_cod.dta
>         work/food_cat.dta
>         work/cons_real.dta
>         work/products.dta
>         work/match96_02.dta
>         new/conversions.do
>         
> This file creates (where `pass' is the number of the iteration):
>         work/codes_food_basket_flex_it`pass'.dta
>         work/price_unit_flex_it`pass'.dta
>         work/quan_flex_it`pass'.dta
>         work/match_cod_flex_it`pass'.csv
>         work/relpoor_it`pass'.dta
>         work/povlines_it`pass'.dta
>         work/foodshares_it`pass'.dta
>         work/nat_pov_flex.csv
>         work/rur_pov_flex.csv
>         work/strata_pov_flex.csv
>         work/spdomain_pov_flex.csv
>         work/reg_tpi_pov_flex.csv
> */
> 
> **************************************************************************;
. * Make a key file that will be used over and over, without change
> * in every iteration. This will include the TEMPORALLY deflated consumption
> * and various HH data such as hhweight, spdomain, etc.
> **************************************************************************;
. use "$path/work/conpc.dta";

.         sort hhid;

.         merg hhid using "$path/work/hhdata.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         15        0.48        0.48
          3 |      3,109       99.52      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.                 gen food_pc_tpi = food_pc_nom /tpi_trim;
(15 missing values generated)

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         tempfile contpi;

.         sort hhid;

. save `contpi', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. save contpi_, replace;
file contpi_.dta saved

. *use "$path/in/povlines_first_iterate.dta", clear;
. *save "$path/work/povlines_first.dta", replace;
. **************************************************************************;
. * Now set some information pertaining to the iterations. For now we'll
> * manually set the number of iterations. Also specify the percentile
> * cutpoint that we will use for defining the relatively poor.
> **************************************************************************;
. local lastpass=0;

. local pass=1;

. * Use these two lines to manually specify the number of iterations
> * and the cutpoint here in the do file.;
.   *local maxit=5;
.   *local cutpt=50;
. * Use these few lines if you want to specify the number of iterations
> * and percentile cutpoint by passing them as parameters on the command
> * line, e.g.:   wstata do new/iterate1.do 5 50;
. if "`1'"=="" | "`2'"=="" {      ;
.         di in red "Error: you need to specify number of iterations as first parameter";
.         di in red "       and percentile cutpoint as second parameter on command line.";
. };

. local maxit `1';

. local cutpt `2';

. tempfile cutoff;

. di "**********************************************************************";
**********************************************************************

. while `pass' <= `maxit' {;
  2.         **************************************************************************;
. **************************************************************************;
. * Pick out the bottom X percent in real consumption per capita 
> * (temporally & spatially adjusted), as ranked by the previous iteration.
> * The percentile to use is defined by "cutpt". This produces a file that
> * has the hhid, and a dummy variable indicating if they were below the
> * cutpoint on the last iteration.
> **************************************************************************;
. **************************************************************************;
. /*
> * Comment out if IOF 2008/09. (This code included instead of below code in order to replicat
> e published figures 2002/03). ( START ) ;
> 
>         if "`pass'"=="1" {      ;
>               use `contpi', clear;
>               sort spdomain;
>               merge spdomain using "$path/work/povlines_first.dta";
>               tab _m;
>               drop _m;
> *              gen relpoor`pass'= cons_pc_tpi<=cutoff;
>                gen relpoor`pass'= cons_pc_tpi if cons_pc_tpi<=cutoff;
>               rename cons_pc_tpi cr_it0;
>               sort hhid;
>          save "$path/work/relpoor_it`pass'.dta", replace;
> *        use "$path/work/cons_real.dta", clear;
> *              gen cr_it0=cr2;
>         };
>         
> 
> * Comment out if IOF 2008/09. (This code included instead of below code in order to replicat
> e published figures 2002/03). ( END ) ;
> */
> 
> 
> 
> * Comment out if IAF 2002/03. (This code below excluded in order to replicate published figu
> res 2002/03). ( START ) ;
.         if "`pass'"=="1" { ;
  3. * Find real income at cut point initially;
.                 use "$path/work/cons_real.dta", clear;
  4.                                     gen cr_it0=cr2;
  5.                         cap drop one;
  6.             gen one=1;
  7.                                     collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
  8.                                     rename cr_it`lastpass' cutoff;
  9.                                     sort one;
 10.             save `cutoff', replace;
 11.             save cutoff, replace;
 12.  * Find relatively poor initially;
.             use "$path/work/cons_real.dta", clear;
 13.                                                 gen cr_it`lastpass'=cr2;
 14.             cap drop one;
 15.             cap drop cutoff;
 16.             gen one=1;
 17.                                     sort one;
 18.             merge one using `cutoff';
 19.             tab _merge;
 20.             drop _merge;
 21.                                     drop one;
 22.                            gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 23.             *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                     tab relpoor`pass' [aw=popwt];
 24.                                     keep hhid cr_it`lastpass' relpoor`pass' popwt;
 25.             sort hhid;
 26.         save "$path/work/relpoor_it`pass'.dta", replace;
 27.         };
 28. * Comment out if IAF 2002/03. (This code below excluded in order to replicate published f
> igures 2002/03). ( END ) ;
.                 if `pass'>1 {   ;
 29. * Find real income at cut point in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta" , clear;
 30.                                                 cap drop one;
 31.                 gen one=1;
 32.                                                                 *CA modified from hhweigh
> t*hhsize to popwt;
.                 collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
 33.                         rename cr_it`lastpass' cutoff;
 34.                                                                         sort one;
 35.         save `cutoff', replace;
 36.         * Find relatively poor in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta", clear;
 37.                                                 cap drop one;
 38.                 gen one=1;
 39.                                                 sort one;
 40.                 merge one using `cutoff';
 41.                 tab _merge;
 42.                 drop _merge;
 43.                                                 drop one;
 44.                 gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 45.                 *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                                 tab relpoor`pass' [aw=popwt];
 46. *CA modified to popwt above and to keep popwt below;
.                 keep hhid cr_it`lastpass' relpoor`pass' popwt;
 47.                 sort hhid;
 48.         save "$path/work/relpoor_it`pass'.dta", replace;
 49.         };
 50.         **************************************************************************;
. * Get the consumption file, and select only those codes that are food,
> * using our definition of "food", which includes alcoholic beverages.
> **************************************************************************;
.         use "$path/work/cons_cod.dta", clear;
 51. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;
 52.     merge hhid using "$path/work/hhdata.dta";
 53.     tab _m;
 54.     drop _m;
 55.         /*
>                 sort product;
>                 merge product using "$path/work/food_cat.dta";
>                 tab _merge;
>                 keep if _merge==3;
>                 drop _merge;
> */
> 
>                                 * Only food transactions ;
.                 keep if food_cat==1;
 56.                 sort hhid;
 57. **************************************************************************;
. * Merge with file that has temporally AND spatially adjusted consumption
> * per capita from the previous iteration, and also identifies those below 
> * the cutoff. Then select only those who are below the cutoff.
> **************************************************************************;
.                 merge hhid using "$path/work/relpoor_it`pass'.dta";
 58.                 tab _merge;
 59.                 drop _merge;
 60.                                 * Keep only transactions by the poor ;
.                 keep if relpoor`pass';
 61. **************************************************************************;
. * Calculate HH level food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.                 gen  food_expenditure = cod_hh_nom;
 62.                 *gen  food_expenditure= own_valued + daily_valued + monthly_valued + educ
> _valued;
.                 egen tot_food_expen= sum (food_expen), by (hhid) ;
 63.                 count if food_expenditure==.;
 64.                 count if tot_food_expen==.;
 65.                 gen food_share= food_expenditure/tot_food_expen;
 66.                 count if food_share==.;
 67.                 drop if food_share==.;
 68.                 sort hhid product;
 69.                 tempfile foodshares;
 70.         save `foodshares', replace;
 71. ********************************************************************************;
. * Now find the total (economy wise, e.g. not by HH) shares by each product in
> * order to select the most important goods in each domain's basket.
> ********************************************************************************;
.                 collapse (mean) hhweight spdomain, by (hhid);
 72.                 sort hhid ;
 73.                  collapse (sum) hhweight , by(spdomain);
 74.                 rename hhweight tothhweight;
 75.                 tempfile tothhweight;
 76.                 sort spdomain;
 77.         save `tothhweight', replace;
 78.         use `foodshares', clear;
 79.                 sort spdomain;
 80.                 merge spdomain using `tothhweight';
 81.                 tab _merge;
 82.                 drop _merge;
 83.                 sort spdomain product;
 84.                 gen f_share_w`pass'=(food_share*hhweight)/tothhweight;
 85.                 collapse (sum) f_share_w`pass', by(spdomain product );
 86.                                sort spdomain f_share_w`pass';
 87.                 by spdomain: gen cumshr`pass'= sum(f_share_w`pass');
 88.                 count if cumshr`pass'<=.075;
 89.                 drop if cumshr`pass'<=.075;
 90.                 lab var f_share_w`pass' "average food share for the 13 spatial domains";
 91.         save `foodshares', replace;
 92.                                                 * Number of spatials domains a food produ
> ct appears ;
.                 gen numreg=1;
 93.                 collapse (sum) numreg cumshr`pass', by (product );
 94.                 keep product numreg ;
 95.                 display _N;
 96.                 sort product;
 97.                                 * Include food product labels ;
. *                merge product using "$path/work/products.dta";
. *                tab _merge;
. *                keep if _merge==3;
.                 keep product  numreg;
 98.                   sort product;
 99.                      display _N;
100.           save "$path/work/codes_food_basket_flex_it`pass'.dta", replace;
101. **************************************************************************;
. **************************************************************************;
. * That is pretty much the part equivalent to "100_food_basket_flex.do",
> * which figures out the food shares for the relevant reference group. Now
> * we figure out the prices with a code stream that is adapted from
> * "110_price_unit_flex.do".
> **************************************************************************;
. **************************************************************************;
. **************************************************************************************
> * Create sorted data set with daily + own expenditure and the matched codes
> **************************************************************************************;
. use "$path/in/cons_cod_trans.dta", clear;
102. *save "$path/work/cons_cod_trans.dta", replace;
. *drop value   ;
. *drop quantity;
. keep hhid product food_cat valuez quantity unit;
103. rename valuez    value;
104. *rename quantityz quantity;
. *drop count;
. drop if quantity==0 ;
105.         tempfile dd_acsort;
106.         save    `dd_acsort', replace;
107. /*
>         use "$path/work/daily.dta", clear;
>                 drop days;
>                 sort product;
>                 tempfile dd_acsort;
>         save `dd_acsort', replace;
>         
>         use "$path/work/own.dta", clear;
>                 keep hhid product valued quantityd unit;
>                 rename valued value;
>                 rename quantityd quantity;
>         
>                 *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>                 drop if quantity==0;
>         
>                 append using `dd_acsort';
> */
> 
>                 *CA modified to insert work/hhdata.dta for bootstrap;
.                 sort hhid;
108.                 merge hhid using "$path/work/hhdata.dta";
109.                 tab _m;
110.                  drop if _m==2;
111.                 drop _m;
112.                                 sort product;
113.                 gen count=1;
114.         save `dd_acsort', replace;
115.         **************************************************************************;
. * Merge the basket codes with the dd  and own data sets.
> * Drop all codes not a part of the flexible food basket
> **************************************************************************;
.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.dta";
116.                         tab _merge;
117.                 drop if _merge~=3;
118.                 drop _merge;
119. **************************************************************************************
> * Drop observations where product code, quantity or value information is unavailable
> **************************************************************************************;
.                 drop if product==. | value==. | quantity==.  ;
120.         *********************************************************************************
> *****
> * Convert non-KG quantities (units, liters) into kilograms
> **************************************************************************************;
. *do "$path/new/110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped.
> ********************************************************************;
. *                $MZ drop if unit~=2;
.         **************************************************************************;
. * Bring in the spdomain and reg_tpi variables, and also the information on
> * relatively poor households.
> **************************************************************************;
.                 preserve;
121.                                                 * Temporally adjusted expenditure ;
.                         use `contpi', clear;
122.                                 keep hhid hhweight spdomain reg_tpi survquar tpi_trim con
> s_pc_tpi ;
123.                                 sort hhid;
124.                                 tempfile hhd2;
125.                         save `hhd2', replace;
126.                 restore;
127.                                 compress;
128.                 sort hhid;
129.                 merge hhid using `hhd2';
130.                 tab _merge;
131.                 drop _merge;
132.                 sort hhid;
133.                 merge hhid using "$path/work/relpoor_it`pass'.dta";
134.                 tab _merge;
135.                 drop _merge;
136.                                                 * Keep nominal food transactions by poor 
> people ;
.                 keep if relpoor`pass';
137.                 drop if product==.;
138.                                                                 * Temporally deflate tran
> saction values ;
.                 gen value_r=value/tpi_trim;
139. **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
140.                 egen lower5=pctile(hhppkg), p(5)  by(spdomain product);
141.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
142.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
143. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_uw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_ut. Last we take the median, price_um. But in the end
> * we only use price_unitw
> *********************************************************************;
.                 gen price_ut`pass'=value_r/(quantity*1000);
144.                 gen price_um`pass'=price_ut;
145.                 collapse (sum) 
>                         quantity value_r count bswt (mean) price_ut (median) price_um [aw=hh
> weight], 
>                         by(spdomain product);
146.                 *Generate weighted price per gram ;
.                 gen price_uw`pass'=value_r/(quantity*1000);
147.                 drop value_r quantity;
148.                 sort spdomain product;
149.                 lab var price_ut`pass' "Average of calculated prices - transaction weight
> ed";
150.                 lab var price_um`pass' "Median of prices";
151.                 lab var price_uw`pass' "Value share weighted mean prices";
152. * Get an idea of the difference between the price measures;
.                 gen ratiotw`pass'=price_ut`pass'/price_uw`pass';
153.                 gen ratiomw`pass'=price_um`pass'/price_uw`pass';
154.                 sum ratiotw`pass' ratiomw`pass';
155.                 sort product;
156.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.dta";
157.                 tab _m;
158.                 count if _merge~=3;
159.                 drop if _merge~=3;
160.                 drop _merge;
161.                 sort product spdomain;
162.         save "$path/work/price_unit_flex_it`pass'.dta", replace;
163. **************************************************************************;
. **************************************************************************;
. * That concludes the prices part. Now we move to calculating the food
> * poverty lines, which draws code from "120_povline_flex.do" with very few
> * changes:
> * - The changes facilitate accumulating vectors
> *   of intermediate results across iterations, rather than generating a
> *   bunch of new files.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************;
. * Use the file with the food basket (`foodshares'), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information, but list them out.
> **************************************************************************;
.         use `foodshares', clear;
164.                 sort product spdomain;
165.                 merge product spdomain using "$path/work/price_unit_flex_it`pass'.dta";
166.                         tab _merge;
167.                 list product spdomain  if _merge==1;
168.                         drop if _merge ~=3;
169.                 drop _merge;
170.                 sort product;
171.                         merge product using "$path/work/calperg.dta";
172.                 tab _merge;
173.                                                 * This tells where we are lacking calorie
>  info or are lacking quantity info due to 
>                 * missing price info above;
.                 list product spdomain  if _merge==1;
174.                         drop if _merge~=3;
175.                 drop _merge;
176.                 sort spdomain f_share_w`pass';
177.                                 *CA modified to change count bswt;
.                 by spdomain: count if round(bswt)<10;
178.                                 sum bswt;
179.                                                 drop if round(bswt) < 10;
180.                                                                 * Total food share in spa
> tial domain ;
.                 by spdomain: egen baskshr=sum(f_share_w`pass');
181.                                 * Cumulated food share in spatial domain ;
.                 by spdomain: gen  cumshr =sum(f_share_w`pass');
182.                 drop if cumshr<=baskshr-.9;
183.                         drop baskshr;
184.                 by spdomain: egen baskshr=sum(f_share_w`pass');
185.                 tabstat baskshr , by(spdomain) st(n mean sd min max);
186.                                                                 * How many grams in 1 MT 
> exp on food item ;
.                                 gen quan`pass'=f_share_w`pass'/price_uw`pass';
187.                                 * How many calories in 1 MT exp on food item ;
.                 gen cal_ir`pass'=quan`pass'*calperg;
188.                                 * how many calories in 1 MT exp in food basket ;
.                 by spdomain: egen calreg=sum(cal_ir);
189.                         sort spdomain;
190.                 merge spdomain using "$path/work/calpp.dta";
191.                 tab _merge;
192.                 drop _merge;
193.                                                         * get the expansion factor to hit
>  95% of calorie requirements ;
.                 gen ratio=.95*calpp/calreg;
194.                         replace quan`pass'=quan`pass'*ratio;
195.                 replace cal_ir`pass'=quan`pass'*calperg;
196.                         sort spdomain product;
197.                 by spdomain: egen chkcal=sum(cal_ir`pass');
198.                 replace chkcal=chkcal/.95-calpp ;
199.                                                 tabstat chkcal , by(spdomain) st(n mean s
> d min max);
200.                         gen val_ir`pass'=quan`pass'*price_uw`pass';
201.                         by spdomain: egen povline_f_flex90_`pass'=sum(val_ir`pass');
202.                 replace povline_f=povline_f_flex90_`pass'/.9;
203.                 *drop product96;
. keep product spdomain quan`pass'  price_uw`pass' val_ir`pass' povline_f_flex90_`pass' calpp 
> calperg;
204.                     save "$path/work/quan_flex_it`pass'.dta", replace;
205.                         collapse (mean) povline_f_flex90_`pass', by (spdomain);
206.                                                 keep spdomain povline_f_flex90_`pass';
207.                 sort spdomain;
208.                 save "$path/work/povline_food_flex_it`pass'.dta", replace;
209.         **************************************************************************;
. **************************************************************************;
. * Now comes the part that draws the non-food and total poverty lines,
> * and generates estimates of poverty measures. This is drawn from 
> * "130_povmeas_flex.do" with a few changes.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
.         use `contpi', clear;
210.                 sort spdomain;
211.                 merge spdomain using "$path/work/povline_food_flex_it`pass'.dta";
212.                 tab _merge;
213.                 drop _merge;
214.                 gen triwt=0;
215.                 replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex90_`pass'-1)+
> 0.5) if abs(cons_pc_tpi/povline_f_flex90_`pass'-1) <= 0.2;
216.                                 ***since the poor were very few in Kampala and Central ur
> ban for Uganda we added 1 to weights****;
.                                 * Nearness to poverty line and population weights ;
.                 gen tripopwt=(0.001+triwt)*hhweight*hhsize;
217.                                                 preserve;
218.                         collapse (mean) nf_pc_nom [aw=tripopwt] , by(spdomain);
219.                         rename nf_pc_nom povline_nf_flex`pass';
220.                         lab var povline_nf_flex`pass' "Nonfood poverty line. Flexible bun
> dle";
221.                         tempfile znf;
222.                         sort spdomain;
223.                         save `znf', replace;
224.                                                                 restore;
225.                                 sort spdomain;
226.                 merge spdomain using `znf';
227.                 tab _merge;
228.                 drop _merge;
229. **************************************************************************
> * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.                 gen povline_flex`pass'=povline_f_flex90_`pass' + povline_nf_flex`pass';
230. keep spdomain povline_flex`pass';
231.                 sort spdomain;
232.         save "$path/work/povlines_it`pass'.dta", replace;
233. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
.         use `contpi', clear;
234.                 sort spdomain;
235.                 merge spdomain using "$path/work/povlines_it`pass'.dta";
236.                 tab _merge;
237.                 drop _merge;
238.                 gen cr= cons_pc_tpi ;
239.                 gen linpob`pass'=povline_flex`pass';
240.                 qui sum linpob`pass' if spdomain==1, meanonly;
241.                 global spi_base=r(mean);
242.                 gen spi`pass'=linpob`pass'/$spi_base;
243.                 gen cr_it`pass'=cr/spi`pass';
244.                 qui sum cr [aw=hhweight*hhsize];
245.                 global sumcr=r(sum);
246.                 qui sum cr_it`pass' [aw=hhweight*hhsize];
247.                 global sumcr2=r(sum);
248.                 replace spi`pass'=spi`pass'*$sumcr2/$sumcr;
249.                 gen linpobr`pass'=linpob`pass'/spi`pass';
250.                 replace cr_it`pass'=cr/spi`pass';
251.                 su cr cr_it`pass' linpob`pass' linpobr`pass' [aw=hhweight*hhsize];
252.                 lab var cr "Temporally-adjusted cons pc";
253.                 lab var cr_it`pass' "Spatially & temporally adjusted cons pc";
254.                 lab var linpob`pass' "Poverty line";
255.                 lab var linpobr`pass' "Real poverty line";
256.                 lab var spi`pass' "Spatial price index";
257.                 gen linpob=linpob`pass';
258. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.                 gen h=100 if cr_it`pass'<=linpobr`pass' & linpobr`pass'~=. & cr_it`pass'~=.;
259.                 replace  h   = 0 if cr_it`pass' > linpobr`pass' & linpobr`pass'~=. & cr_i
> t`pass'~=.;
260.                 gen      pg  = ((linpobr`pass' - cr_it`pass' )/linpobr`pass') *100;
261.                 replace  pg  = 0             if h==0;
262.                 gen      spg = ((( linpobr`pass' - cr_it`pass' )/ linpobr`pass' )^2)*100;
263.                 replace  spg = 0             if h==0;
264.                 gen h_flex`pass'  =h;
265.                 gen pg_flex`pass' =pg;
266.                 gen spg_flex`pass'=spg;
267.                                 lab var h_flex`pass'   "Poverty headcount. Flexible bundl
> e";
268.                 lab var pg_flex`pass'  "Poverty gap. Flexible bundle";
269.                 lab var spg_flex`pass' "Squared poverty gap. Flexible bundle";
270.                 gen popwt=hhsize*hhweight;
271.                         * Stata 10.1 syntax ;
.                         svyset , clear;
272.                         svyset [pweight=popwt] , str(strata) psu(psu);
273.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass';
274.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(rural);
275.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata);
276.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata rural);
277.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(spdomain);
278. *preserve;
. keep hhid popwt cr_it`pass' h_flex`pass' pg_flex`pass' spg_flex`pass' rural news reg_tpi str
> ata spdomain;
279.                 compress;
280.                 sort hhid;
281.         save "$path/work/cons_real_it`pass'.dta" , replace;
282. *restore;
.                                 * New cutoff point (percentile) to use in next iteration is 
> equal to the poverty ;
.                 * rate in this iteration ;
.                                                 sum h_flex`pass' [aw=popwt] ;
283.                                 * Comment out next line for IAF 2002/03 in order to repli
> cate official figures ( START );
.                 * URB: In this case, we just use the poorest 50% as there are too few actual
> ly poor to calculate the bundle and prices..;
.                 local cutpt= $tpi_bottom;
284. *               local cutpt= round(r(mean));
.                 * Comment out next line for IAF 2002/03 in order to replicate official figur
> es ( END );
. *       save foodshares tempfile to disk;
.         use `foodshares', clear;
285.         save "$path/work/foodshares_it`pass'.dta", replace;
286.         local lastpass = `pass';
287.         local pass = `pass' + 1;
288.         };
(15 missing values generated)
(note: file /tmp/St02564.000002 not found)
file /tmp/St02564.000002 saved
file cutoff.dta saved
(15 missing values generated)
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,123      100.00      100.00
------------+-----------------------------------
      Total |      3,123      100.00

   relpoor1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,564.177       50.15       50.15
          1 |  1,554.823       49.85      100.00
------------+-----------------------------------
      Total |      3,119      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/relpoor_it1.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        1.99        1.99
          2 |          1        0.00        1.99
          3 |     42,120       98.01      100.00
------------+-----------------------------------
      Total |     42,976      100.00
(3978 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,001      100.00
(25598 observations deleted)
(2 missing values generated)
    2
    0
(2 missing values generated)
    2
(2 observations deleted)
(note: file /tmp/St02564.000003 not found)
file /tmp/St02564.000003 saved
(note: file /tmp/St02564.000004 not found)
file /tmp/St02564.000004 saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,401      100.00      100.00
------------+-----------------------------------
      Total |     13,401      100.00
  125
(125 observations deleted)
file /tmp/St02564.000003 saved
39
39
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex_it1.dta saved
(3 observations deleted)
(note: file /tmp/St02564.000005 not found)
file /tmp/St02564.000005 saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        2.15        2.15
          2 |          3        0.01        2.15
          3 |     38,995       97.85      100.00
------------+-----------------------------------
      Total |     39,853      100.00
(3 observations deleted)
file /tmp/St02564.000005 saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,929       12.37       12.37
          3 |     34,921       87.63      100.00
------------+-----------------------------------
      Total |     39,850      100.00
(4929 observations deleted)
(3005 observations deleted)
(note: file /tmp/St02564.000007 not found)
file /tmp/St02564.000007 saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        103        0.32        0.32
          3 |     31,916       99.68      100.00
------------+-----------------------------------
      Total |     32,019      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.00        0.00
          3 |     32,018      100.00      100.00
------------+-----------------------------------
      Total |     32,019      100.00
(20586 observations deleted)
(13 observations deleted)
(831 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw1 |       175    1.247308    .4276395    .816168   3.337594
    ratiomw1 |       175    1.107115    .3966994   .6103029   4.164927
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.69        1.69
          3 |        175       98.31      100.00
------------+-----------------------------------
      Total |        178      100.00
    3
(3 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex_it1.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.85        3.85
          2 |         55       30.22       34.07
          3 |        120       65.93      100.00
------------+-----------------------------------
      Total |        182      100.00

     +-------------------------+
     | product        spdomain |
     |-------------------------|
121. |     157   Central Urban |
122. |     157   Central Rural |
123. |     157         Eastern |
124. |     160   Central Urban |
125. |     161   Central Urban |
     |-------------------------|
126. |     161         Eastern |
127. |     161        Northern |
     +-------------------------+
(62 observations deleted)
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26       17.81       17.81
          3 |        120       82.19      100.00
------------+-----------------------------------
      Total |        146      100.00
(26 observations deleted)

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       120    79.36667    68.25766          3        322
(3 observations deleted)
(4 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .8147091         0  .8147091  .8147091
Central Rural |        21  .9059013         0  .9059013  .9059013
      Eastern |        27  .9085176         0  .9085176  .9085176
     Northern |        24  .8925704         0  .8925704  .8925704
      Western |        23   .904429         0   .904429   .904429
--------------+--------------------------------------------------
        Total |       113  .8888692  .0329241  .8147091  .9085176
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        113      100.00      100.00
------------+-----------------------------------
      Total |        113      100.00
(113 real changes made)
(108 real changes made)
(113 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .0001028         0  .0001028  .0001028
Central Rural |        21 -.0000514         0 -.0000514 -.0000514
      Eastern |        27 -.0000514         0 -.0000514 -.0000514
     Northern |        24  .0001028         0  .0001028  .0001028
      Western |        23  .0000385         0  .0000385  .0000385
--------------+--------------------------------------------------
        Total |       113  .0000242  .0000693 -.0000514  .0001028
-----------------------------------------------------------------
(113 real changes made)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/quan_flex_it1.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(235 real changes made)
(5 missing values generated)
(note: file /tmp/St02564.000009 not found)
file /tmp/St02564.000009 saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(5 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it1.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(16 missing values generated)
(5 missing values generated)
(5 missing values generated)
(16 missing values generated)
(3119 real changes made)
(5 missing values generated)
(3108 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
      cr_it1 |    3108  28069559.9    1060.929   976.2463   122.3149   20035.97
     linpob1 |    3119  28164219.1    440.2566   66.83536   312.2208   546.7244
    linpobr1 |    3119  28164219.1    448.4924   .0000123   448.4924   448.4924
(5 missing values generated)
(2723 missing values generated)
(2707 real changes made)
(16 missing values generated)
(2707 real changes made)
(16 missing values generated)
(2707 real changes made)
(16 missing values generated)
(16 missing values generated)
(16 missing values generated)
(5 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex1 |   15.84921   .9766671      13.92755    17.77087
    pg_flex1 |   3.427597   .2701458      2.896066    3.959128
   spg_flex1 |   1.161953   .1156949      .9343154    1.389591
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
       Urban |   3.616503   .9297338      1.787185    5.445822
       Rural |   18.38507   1.151796      16.11883    20.65131
-------------+------------------------------------------------
pg_flex1     |
       Urban |   .6989874   .2201137      .2658979    1.132077
       Rural |   3.993241    .320007      3.363604    4.622878
-------------+------------------------------------------------
spg_flex1    |
       Urban |     .25927   .1152051      .0325957    .4859444
       Rural |   1.349081   .1364374       1.08063    1.617531
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.56001    1.98039      7.663449    15.45657
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.18469    2.07589      18.10023    26.26916
   _subpop_5 |   9.623426   4.111047      1.534644    17.71221
   _subpop_6 |   21.82511   3.037433      15.84874    27.80148
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   18.36522   2.152594      14.12984    22.60061
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.168492   .4705546      1.242642    3.094342
   _subpop_3 |   .7351377   .4048669      -.061467    1.531742
   _subpop_4 |   4.841435   .5935124      3.673656    6.009213
   _subpop_5 |   2.116834    1.10298     -.0533588    4.287027
   _subpop_6 |   5.453815   .9897749      3.506361    7.401268
   _subpop_7 |   .5238783   .3645131     -.1933275    1.241084
   _subpop_8 |   3.823314   .5658797      2.709905    4.936723
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6519446   .1911633      .2758171    1.028072
   _subpop_3 |   .1503185   .1068702     -.0599564    .3605933
   _subpop_4 |   1.632452   .2637344      1.113536    2.151369
   _subpop_5 |   .7831744   .5147763     -.2296851    1.796034
   _subpop_6 |   1.861008   .3967043      1.080463    2.641552
   _subpop_7 |   .1580154    .142028     -.1214349    .4374657
   _subpop_8 |   1.348266   .2536975      .8490981    1.847434
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

         Over: strata rural
    _subpop_1: central urban Urban
    _subpop_2: central rural Rural
    _subpop_3: Eastern urban Urban
    _subpop_4: Eastern rural Rural
    _subpop_5: Northern urban Urban
    _subpop_6: Northern rural Rural
    _subpop_7: Western Urban Urban
    _subpop_8: Western rural Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.56001    1.98039      7.663449    15.45657
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.18469    2.07589      18.10023    26.26916
   _subpop_5 |   9.623426   4.111047      1.534644    17.71221
   _subpop_6 |   21.82511   3.037433      15.84874    27.80148
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   18.36522   2.152594      14.12984    22.60061
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.168492   .4705546      1.242642    3.094342
   _subpop_3 |   .7351377   .4048669      -.061467    1.531742
   _subpop_4 |   4.841435   .5935124      3.673656    6.009213
   _subpop_5 |   2.116834    1.10298     -.0533588    4.287027
   _subpop_6 |   5.453815   .9897749      3.506361    7.401268
   _subpop_7 |   .5238783   .3645131     -.1933275    1.241084
   _subpop_8 |   3.823314   .5658797      2.709905    4.936723
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6519446   .1911633      .2758171    1.028072
   _subpop_3 |   .1503185   .1068702     -.0599564    .3605933
   _subpop_4 |   1.632452   .2637344      1.113536    2.151369
   _subpop_5 |   .7831744   .5147763     -.2296851    1.796034
   _subpop_6 |   1.861008   .3967043      1.080463    2.641552
   _subpop_7 |   .1580154    .142028     -.1214349    .4374657
   _subpop_8 |   1.348266   .2536975      .8490981    1.847434
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.56001    1.98039      7.663449    15.45657
     Eastern |   20.88803   1.938437      17.07402    24.70205
    Northern |   20.11614   2.680788       14.8415    25.39078
     Western |   17.50719   2.032732      13.50764    21.50673
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.168492   .4705546      1.242642    3.094342
     Eastern |   4.540354   .5520834       3.45409    5.626618
    Northern |   4.986437   .8666725      3.281197    6.691678
     Western |   3.621309   .5344721      2.569697    4.672921
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6519446   .1911633      .2758171    1.028072
     Eastern |    1.52378   .2448531      1.042013    2.005546
    Northern |   1.710046   .3494219      1.022534    2.397559
     Western |   1.275394   .2395396      .8040829    1.746706
--------------------------------------------------------------
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex1 was float now byte
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real_it1.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex1 |    3108  28069559.9    15.84921   36.52606          0        100
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/foodshares_it1.dta saved
file /tmp/St02564.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

   relpoor2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,562.8925       50.11       50.11
          1 | 1,556.1075       49.89      100.00
------------+-----------------------------------
      Total |      3,119      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/relpoor_it2.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        1.99        1.99
          2 |          1        0.00        1.99
          3 |     42,120       98.01      100.00
------------+-----------------------------------
      Total |     42,976      100.00
(3978 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,002      100.00
(25589 observations deleted)
(2 missing values generated)
    2
    0
(2 missing values generated)
    2
(2 observations deleted)
(note: file /tmp/St02564.00000a not found)
file /tmp/St02564.00000a saved
(note: file /tmp/St02564.00000b not found)
file /tmp/St02564.00000b saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,411      100.00      100.00
------------+-----------------------------------
      Total |     13,411      100.00
  125
(125 observations deleted)
file /tmp/St02564.00000a saved
39
39
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex_it2.dta saved
(3 observations deleted)
(note: file /tmp/St02564.00000c not found)
file /tmp/St02564.00000c saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        2.15        2.15
          2 |          3        0.01        2.15
          3 |     38,995       97.85      100.00
------------+-----------------------------------
      Total |     39,853      100.00
(3 observations deleted)
file /tmp/St02564.00000c saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,929       12.37       12.37
          3 |     34,921       87.63      100.00
------------+-----------------------------------
      Total |     39,850      100.00
(4929 observations deleted)
(3005 observations deleted)
(note: file /tmp/St02564.00000e not found)
file /tmp/St02564.00000e saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        103        0.32        0.32
          3 |     31,916       99.68      100.00
------------+-----------------------------------
      Total |     32,019      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     32,019      100.00      100.00
------------+-----------------------------------
      Total |     32,019      100.00
(20565 observations deleted)
(12 observations deleted)
(818 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw2 |       175    1.246757    .4257854   .7769808   3.337594
    ratiomw2 |       175    1.107483     .401684   .6105599   4.164927
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.69        1.69
          3 |        175       98.31      100.00
------------+-----------------------------------
      Total |        178      100.00
    3
(3 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex_it2.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.85        3.85
          2 |         55       30.22       34.07
          3 |        120       65.93      100.00
------------+-----------------------------------
      Total |        182      100.00

     +-------------------------+
     | product        spdomain |
     |-------------------------|
121. |     157   Central Urban |
122. |     157   Central Rural |
123. |     157         Eastern |
124. |     160   Central Urban |
125. |     161   Central Urban |
     |-------------------------|
126. |     161         Eastern |
127. |     161        Northern |
     +-------------------------+
(62 observations deleted)
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26       17.81       17.81
          3 |        120       82.19      100.00
------------+-----------------------------------
      Total |        146      100.00
(26 observations deleted)

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       120        79.6    69.60602          3        337
(3 observations deleted)
(4 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .8147091         0  .8147091  .8147091
Central Rural |        21  .9067186         0  .9067186  .9067186
      Eastern |        27  .9088988         0  .9088988  .9088988
     Northern |        24  .8927878         0  .8927878  .8927878
      Western |        23  .9046368         0  .9046368  .9046368
--------------+--------------------------------------------------
        Total |       113  .8892006  .0330843  .8147091  .9088988
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        113      100.00      100.00
------------+-----------------------------------
      Total |        113      100.00
(113 real changes made)
(108 real changes made)
(113 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .0001028         0  .0001028  .0001028
Central Rural |        21  .0000771         0  .0000771  .0000771
      Eastern |        27  .0000771         0  .0000771  .0000771
     Northern |        24  .0002313         0  .0002313  .0002313
      Western |        23  .0000385         0  .0000385  .0000385
--------------+--------------------------------------------------
        Total |       113  .0001061  .0000682  .0000385  .0002313
-----------------------------------------------------------------
(113 real changes made)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/quan_flex_it2.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(236 real changes made)
(5 missing values generated)
(note: file /tmp/St02564.00000g not found)
file /tmp/St02564.00000g saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(5 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it2.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(16 missing values generated)
(5 missing values generated)
(5 missing values generated)
(16 missing values generated)
(3119 real changes made)
(5 missing values generated)
(3108 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
      cr_it2 |    3108  28069559.9    1060.929   977.2243   122.1025   20050.84
     linpob2 |    3119  28164219.1    439.7347   67.14265   311.7988   546.7244
    linpobr2 |    3119  28164219.1    447.7136          0   447.7136   447.7136
(5 missing values generated)
(2723 missing values generated)
(2707 real changes made)
(16 missing values generated)
(2707 real changes made)
(16 missing values generated)
(2707 real changes made)
(16 missing values generated)
(16 missing values generated)
(16 missing values generated)
(5 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex2 |   15.89283   .9814454      13.96176    17.82389
    pg_flex2 |   3.417863   .2695117      2.887579    3.948147
   spg_flex2 |   1.159023   .1154295      .9319068    1.386139
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
       Urban |   3.616503   .9297338      1.787185    5.445822
       Rural |   18.43772   1.157794      16.15968    20.71577
-------------+------------------------------------------------
pg_flex2     |
       Urban |   .6981809   .2198444      .2656212    1.130741
       Rural |   3.981657   .3192471      3.353515    4.609798
-------------+------------------------------------------------
spg_flex2    |
       Urban |   .2590728   .1150988      .0326076     .485538
       Rural |   1.345583   .1361188       1.07776    1.613407
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   9.623426   4.111047      1.534644    17.71221
   _subpop_6 |   21.82511   3.037433      15.84874    27.80148
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |    2.10521   .4630464      1.194133    3.016287
   _subpop_3 |   .7495527   .4097461     -.0566523    1.555758
   _subpop_4 |   4.908455   .5974235      3.732981    6.083928
   _subpop_5 |   2.106674   1.099692     -.0570482    4.270397
   _subpop_6 |   5.431657   .9873339      3.489006    7.374308
   _subpop_7 |   .5143774   .3613373     -.1965798    1.225335
   _subpop_8 |   3.787678    .562877      2.680177    4.895179
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6316941    .187807      .2621703    1.001218
   _subpop_3 |   .1548432   .1090982     -.0598154    .3695018
   _subpop_4 |   1.657232       .266      1.133858    2.180607
   _subpop_5 |   .7795757   .5133542     -.2304857    1.789637
   _subpop_6 |   1.851306    .395147      1.073826    2.628786
   _subpop_7 |     .15622    .140974     -.1211564    .4335964
   _subpop_8 |   1.336049   .2523135      .8396042    1.832494
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

         Over: strata rural
    _subpop_1: central urban Urban
    _subpop_2: central rural Rural
    _subpop_3: Eastern urban Urban
    _subpop_4: Eastern rural Rural
    _subpop_5: Northern urban Urban
    _subpop_6: Northern rural Rural
    _subpop_7: Western Urban Urban
    _subpop_8: Western rural Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   9.623426   4.111047      1.534644    17.71221
   _subpop_6 |   21.82511   3.037433      15.84874    27.80148
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |    2.10521   .4630464      1.194133    3.016287
   _subpop_3 |   .7495527   .4097461     -.0566523    1.555758
   _subpop_4 |   4.908455   .5974235      3.732981    6.083928
   _subpop_5 |   2.106674   1.099692     -.0570482    4.270397
   _subpop_6 |   5.431657   .9873339      3.489006    7.374308
   _subpop_7 |   .5143774   .3613373     -.1965798    1.225335
   _subpop_8 |   3.787678    .562877      2.680177    4.895179
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6316941    .187807      .2621703    1.001218
   _subpop_3 |   .1548432   .1090982     -.0598154    .3695018
   _subpop_4 |   1.657232       .266      1.133858    2.180607
   _subpop_5 |   .7795757   .5133542     -.2304857    1.789637
   _subpop_6 |   1.851306    .395147      1.073826    2.628786
   _subpop_7 |     .15622    .140974     -.1211564    .4335964
   _subpop_8 |   1.336049   .2523135      .8396042    1.832494
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
     Eastern |   21.57247   1.974915      17.68668    25.45825
    Northern |   20.11614   2.680788       14.8415    25.39078
     Western |   17.13877   2.044267      13.11653    21.16101
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |    2.10521   .4630464      1.194133    3.016287
     Eastern |   4.603517   .5557552      3.510028    5.697005
    Northern |    4.96596   .8645184      3.264958    6.666962
     Western |   3.587274   .5316292      2.541255    4.633293
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6316941    .187807      .2621703    1.001218
     Eastern |   1.547075    .246964      1.061155    2.032994
    Northern |   1.701199   .3480676      1.016351    2.386048
     Western |   1.263815   .2382299       .795081     1.73255
--------------------------------------------------------------
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex2 was float now byte
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real_it2.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex2 |    3108  28069559.9    15.89283    36.5668          0        100
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/foodshares_it2.dta saved
file /tmp/St02564.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

   relpoor3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,564.2118       50.15       50.15
          1 | 1,554.7882       49.85      100.00
------------+-----------------------------------
      Total |      3,119      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/relpoor_it3.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        1.99        1.99
          2 |          1        0.00        1.99
          3 |     42,120       98.01      100.00
------------+-----------------------------------
      Total |     42,976      100.00
(3978 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,002      100.00
(25631 observations deleted)
(2 missing values generated)
    2
    0
(2 missing values generated)
    2
(2 observations deleted)
(note: file /tmp/St02564.00000h not found)
file /tmp/St02564.00000h saved
(note: file /tmp/St02564.00000i not found)
file /tmp/St02564.00000i saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,369      100.00      100.00
------------+-----------------------------------
      Total |     13,369      100.00
  125
(125 observations deleted)
file /tmp/St02564.00000h saved
39
39
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex_it3.dta saved
(3 observations deleted)
(note: file /tmp/St02564.00000j not found)
file /tmp/St02564.00000j saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        2.15        2.15
          2 |          3        0.01        2.15
          3 |     38,995       97.85      100.00
------------+-----------------------------------
      Total |     39,853      100.00
(3 observations deleted)
file /tmp/St02564.00000j saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,929       12.37       12.37
          3 |     34,921       87.63      100.00
------------+-----------------------------------
      Total |     39,850      100.00
(4929 observations deleted)
(3005 observations deleted)
(note: file /tmp/St02564.00000l not found)
file /tmp/St02564.00000l saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        103        0.32        0.32
          3 |     31,916       99.68      100.00
------------+-----------------------------------
      Total |     32,019      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     32,019      100.00      100.00
------------+-----------------------------------
      Total |     32,019      100.00
(20599 observations deleted)
(12 observations deleted)
(817 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw3 |       175    1.245453    .4263509   .7769808   3.337594
    ratiomw3 |       175    1.107208     .400503   .6105599   4.164927
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.69        1.69
          3 |        175       98.31      100.00
------------+-----------------------------------
      Total |        178      100.00
    3
(3 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex_it3.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.85        3.85
          2 |         55       30.22       34.07
          3 |        120       65.93      100.00
------------+-----------------------------------
      Total |        182      100.00

     +-------------------------+
     | product        spdomain |
     |-------------------------|
121. |     157   Central Urban |
122. |     157   Central Rural |
123. |     157         Eastern |
124. |     160   Central Urban |
125. |     161   Central Urban |
     |-------------------------|
126. |     161         Eastern |
127. |     161        Northern |
     +-------------------------+
(62 observations deleted)
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26       17.81       17.81
          3 |        120       82.19      100.00
------------+-----------------------------------
      Total |        146      100.00
(26 observations deleted)

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    1
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       120    79.26667     69.6863          3        338
(4 observations deleted)
(4 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .8147091         0  .8147091  .8147091
Central Rural |        20  .9004949         0  .9004949  .9004949
      Eastern |        27  .9084003         0  .9084003  .9084003
     Northern |        24  .8921682         0  .8921682  .8921682
      Western |        23  .9046451         0  .9046451  .9046451
--------------+--------------------------------------------------
        Total |       112  .8876816  .0325805  .8147091  .9084003
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        112      100.00      100.00
------------+-----------------------------------
      Total |        112      100.00
(112 real changes made)
(107 real changes made)
(112 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .0001028         0  .0001028  .0001028
Central Rural |        20 -.0000514         0 -.0000514 -.0000514
      Eastern |        27 -.0000514         0 -.0000514 -.0000514
     Northern |        24 -.0001542         0 -.0001542 -.0001542
      Western |        23  .0000385         0  .0000385  .0000385
--------------+--------------------------------------------------
        Total |       112 -.0000302  .0000858 -.0001542  .0001028
-----------------------------------------------------------------
(112 real changes made)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/quan_flex_it3.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(236 real changes made)
(5 missing values generated)
(note: file /tmp/St02564.00000n not found)
file /tmp/St02564.00000n saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(5 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it3.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(16 missing values generated)
(5 missing values generated)
(5 missing values generated)
(16 missing values generated)
(3119 real changes made)
(5 missing values generated)
(3108 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
      cr_it3 |    3108  28069559.9    1060.929    977.442    121.897    20009.3
     linpob3 |    3119  28164219.1    439.1663   67.78147   310.1803   546.7244
    linpobr3 |    3119  28164219.1    446.9602   .0000208   446.9602   446.9603
(5 missing values generated)
(2726 missing values generated)
(2710 real changes made)
(16 missing values generated)
(2710 real changes made)
(16 missing values generated)
(2710 real changes made)
(16 missing values generated)
(16 missing values generated)
(16 missing values generated)
(5 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex3 |   15.88506   .9835488      13.94986    17.82026
    pg_flex3 |   3.398433   .2685307      2.870079    3.926786
   spg_flex3 |   1.151381   .1148949      .9253166    1.377444
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
       Urban |   3.446155   .9012713      1.672839    5.219472
       Rural |   18.46366   1.160692      16.17991     20.7474
-------------+------------------------------------------------
pg_flex3     |
       Urban |   .6933881    .218629      .2632198    1.123556
       Rural |   3.959192   .3180957      3.333316    4.585068
-------------+------------------------------------------------
spg_flex3    |
       Urban |   .2571865   .1146384      .0316273    .4827458
       Rural |   1.336748   .1354828      1.070176     1.60332
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   18.17612    2.18453       13.8779    22.47434
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   .4179243   .2238927     -.0226007    .8584493
   _subpop_2 |   2.067666   .4586388      1.165262    2.970071
   _subpop_3 |    .749595   .4097605     -.0566383    1.555828
   _subpop_4 |   4.908658   .5974349      3.733161    6.084154
   _subpop_5 |   2.071339   1.087193     -.0677907    4.210469
   _subpop_6 |   5.346812   .9779424       3.42264    7.270985
   _subpop_7 |   .5158726   .3618358     -.1960655    1.227811
   _subpop_8 |   3.793234   .5633364      2.684829    4.901638
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199515   .1858376      .2543027    .9856004
   _subpop_3 |   .1548567   .1091048     -.0598149    .3695282
   _subpop_4 |   1.657306   .2660066      1.133918    2.180693
   _subpop_5 |   .7658821   .5079229     -.2334929    1.765257
   _subpop_6 |   1.814288   .3891753      1.048558    2.580019
   _subpop_7 |   .1564997    .141139     -.1212015    .4342009
   _subpop_8 |   1.337962   .2525306      .8410899    1.834834
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

         Over: strata rural
    _subpop_1: central urban Urban
    _subpop_2: central rural Rural
    _subpop_3: Eastern urban Urban
    _subpop_4: Eastern rural Rural
    _subpop_5: Northern urban Urban
    _subpop_6: Northern rural Rural
    _subpop_7: Western Urban Urban
    _subpop_8: Western rural Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   18.17612    2.18453       13.8779    22.47434
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   .4179243   .2238927     -.0226007    .8584493
   _subpop_2 |   2.067666   .4586388      1.165262    2.970071
   _subpop_3 |    .749595   .4097605     -.0566383    1.555828
   _subpop_4 |   4.908658   .5974349      3.733161    6.084154
   _subpop_5 |   2.071339   1.087193     -.0677907    4.210469
   _subpop_6 |   5.346812   .9779424       3.42264    7.270985
   _subpop_7 |   .5158726   .3618358     -.1960655    1.227811
   _subpop_8 |   3.793234   .5633364      2.684829    4.901638
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199515   .1858376      .2543027    .9856004
   _subpop_3 |   .1548567   .1091048     -.0598149    .3695282
   _subpop_4 |   1.657306   .2660066      1.133918    2.180693
   _subpop_5 |   .7658821   .5079229     -.2334929    1.765257
   _subpop_6 |   1.814288   .3891753      1.048558    2.580019
   _subpop_7 |   .1564997    .141139     -.1212015    .4342009
   _subpop_8 |   1.337962   .2525306      .8410899    1.834834
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
     Eastern |   21.57247   1.974915      17.68668    25.45825
    Northern |   19.77286   2.671408      14.51668    25.02905
     Western |   17.32966   2.062067       13.2724    21.38693
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   .4179243   .2238927     -.0226007    .8584493
   _subpop_2 |   2.067666   .4586388      1.165262    2.970071
     Eastern |   4.603708    .555766      3.510198    5.697217
    Northern |    4.88805   .8562215      3.203372    6.572727
     Western |    3.59258   .5320644      2.545706    4.639455
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199515   .1858376      .2543027    .9856004
     Eastern |   1.547143   .2469702      1.061212    2.033075
    Northern |   1.667449   .3428755      .9928164    2.342081
     Western |   1.265628   .2384353      .7964897    1.734767
--------------------------------------------------------------
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex3 was float now byte
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real_it3.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex3 |    3108  28069559.9    15.88506   36.55955          0        100
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/foodshares_it3.dta saved
file /tmp/St02564.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

   relpoor4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,564.5939       50.16       50.16
          1 | 1,554.4061       49.84      100.00
------------+-----------------------------------
      Total |      3,119      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/relpoor_it4.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        1.99        1.99
          2 |          1        0.00        1.99
          3 |     42,120       98.01      100.00
------------+-----------------------------------
      Total |     42,976      100.00
(3978 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,002      100.00
(25623 observations deleted)
(2 missing values generated)
    2
    0
(2 missing values generated)
    2
(2 observations deleted)
(note: file /tmp/St02564.00000o not found)
file /tmp/St02564.00000o saved
(note: file /tmp/St02564.00000p not found)
file /tmp/St02564.00000p saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,377      100.00      100.00
------------+-----------------------------------
      Total |     13,377      100.00
  125
(125 observations deleted)
file /tmp/St02564.00000o saved
39
39
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex_it4.dta saved
(3 observations deleted)
(note: file /tmp/St02564.00000q not found)
file /tmp/St02564.00000q saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        2.15        2.15
          2 |          3        0.01        2.15
          3 |     38,995       97.85      100.00
------------+-----------------------------------
      Total |     39,853      100.00
(3 observations deleted)
file /tmp/St02564.00000q saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,929       12.37       12.37
          3 |     34,921       87.63      100.00
------------+-----------------------------------
      Total |     39,850      100.00
(4929 observations deleted)
(3005 observations deleted)
(note: file /tmp/St02564.00000s not found)
file /tmp/St02564.00000s saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        103        0.32        0.32
          3 |     31,916       99.68      100.00
------------+-----------------------------------
      Total |     32,019      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     32,019      100.00      100.00
------------+-----------------------------------
      Total |     32,019      100.00
(20587 observations deleted)
(12 observations deleted)
(831 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw4 |       175    1.245532    .4261914   .7769808   3.337594
    ratiomw4 |       175    1.106541     .401926   .4394891   4.164927
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.69        1.69
          3 |        175       98.31      100.00
------------+-----------------------------------
      Total |        178      100.00
    3
(3 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex_it4.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.85        3.85
          2 |         55       30.22       34.07
          3 |        120       65.93      100.00
------------+-----------------------------------
      Total |        182      100.00

     +-------------------------+
     | product        spdomain |
     |-------------------------|
121. |     157   Central Urban |
122. |     157   Central Rural |
123. |     157         Eastern |
124. |     160   Central Urban |
125. |     161   Central Urban |
     |-------------------------|
126. |     161         Eastern |
127. |     161        Northern |
     +-------------------------+
(62 observations deleted)
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26       17.81       17.81
          3 |        120       82.19      100.00
------------+-----------------------------------
      Total |        146      100.00
(26 observations deleted)

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    1
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       120    79.26667    69.55812          3        339
(4 observations deleted)
(4 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .8147091         0  .8147091  .8147091
Central Rural |        20  .9004949         0  .9004949  .9004949
      Eastern |        27  .9086618         0  .9086618  .9086618
     Northern |        24  .8921608         0  .8921608  .8921608
      Western |        23  .9046368         0  .9046368  .9046368
--------------+--------------------------------------------------
        Total |       112  .8877414    .03262  .8147091  .9086618
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        112      100.00      100.00
------------+-----------------------------------
      Total |        112      100.00
(112 real changes made)
(107 real changes made)
(112 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .0001028         0  .0001028  .0001028
Central Rural |        20 -.0000514         0 -.0000514 -.0000514
      Eastern |        27 -.0000514         0 -.0000514 -.0000514
     Northern |        24 -.0001542         0 -.0001542 -.0001542
      Western |        23  .0000385         0  .0000385  .0000385
--------------+--------------------------------------------------
        Total |       112 -.0000302  .0000858 -.0001542  .0001028
-----------------------------------------------------------------
(112 real changes made)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/quan_flex_it4.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(236 real changes made)
(5 missing values generated)
(note: file /tmp/St02564.00000u not found)
file /tmp/St02564.00000u saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(5 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it4.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(16 missing values generated)
(5 missing values generated)
(5 missing values generated)
(16 missing values generated)
(3119 real changes made)
(5 missing values generated)
(3108 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
      cr_it4 |    3108  28069559.9    1060.929   977.5204   121.9062    20018.6
     linpob4 |    3119  28164219.1     439.223   67.80795   310.1624   546.7244
    linpobr4 |    3119  28164219.1    446.9937          0   446.9937   446.9937
(5 missing values generated)
(2727 missing values generated)
(2711 real changes made)
(16 missing values generated)
(2711 real changes made)
(16 missing values generated)
(2711 real changes made)
(16 missing values generated)
(16 missing values generated)
(16 missing values generated)
(5 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex4 |   15.83399   .9805861      13.90462    17.76337
    pg_flex4 |   3.400828   .2685763      2.872385    3.929272
   spg_flex4 |   1.152262   .1149257      .9261378    1.378387
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
       Urban |   3.446155   .9012713      1.672839    5.219472
       Rural |   18.40201   1.157092      16.12535    20.67867
-------------+------------------------------------------------
pg_flex4     |
       Urban |   .6935682   .2186354      .2633874    1.123749
       Rural |   3.962047   .3181491      3.336065    4.588028
-------------+------------------------------------------------
spg_flex4    |
       Urban |   .2572576   .1146385      .0316982    .4828171
       Rural |   1.337798   .1355201      1.071152    1.604443
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
   _subpop_3 |   .7531418   .4109651     -.0554615    1.561745
   _subpop_4 |   4.925694   .5983956      3.748308    6.103081
   _subpop_5 |   2.070973   1.087055     -.0678861    4.209832
   _subpop_6 |   5.345871   .9778379      3.421904    7.269837
   _subpop_7 |   .5143775   .3613374     -.1965798    1.225335
   _subpop_8 |   3.787679    .562877      2.680178     4.89518
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
   _subpop_3 |   .1559843   .1096572      -.059774    .3717427
   _subpop_4 |   1.663469   .2665669      1.138979    2.187958
   _subpop_5 |    .765731   .5078629     -.2335258    1.764988
   _subpop_6 |    1.81388   .3891091      1.048279     2.57948
   _subpop_7 |     .15622    .140974     -.1211564    .4335965
   _subpop_8 |   1.336049   .2523135      .8396044    1.832495
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

         Over: strata rural
    _subpop_1: central urban Urban
    _subpop_2: central rural Rural
    _subpop_3: Eastern urban Urban
    _subpop_4: Eastern rural Rural
    _subpop_5: Northern urban Urban
    _subpop_6: Northern rural Rural
    _subpop_7: Western Urban Urban
    _subpop_8: Western rural Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
   _subpop_3 |   .7531418   .4109651     -.0554615    1.561745
   _subpop_4 |   4.925694   .5983956      3.748308    6.103081
   _subpop_5 |   2.070973   1.087055     -.0678861    4.209832
   _subpop_6 |   5.345871   .9778379      3.421904    7.269837
   _subpop_7 |   .5143775   .3613374     -.1965798    1.225335
   _subpop_8 |   3.787679    .562877      2.680178     4.89518
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
   _subpop_3 |   .1559843   .1096572      -.059774    .3717427
   _subpop_4 |   1.663469   .2665669      1.138979    2.187958
   _subpop_5 |    .765731   .5078629     -.2335258    1.764988
   _subpop_6 |    1.81388   .3891091      1.048279     2.57948
   _subpop_7 |     .15622    .140974     -.1211564    .4335965
   _subpop_8 |   1.336049   .2523135      .8396044    1.832495
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
     Eastern |   21.57247   1.974915      17.68668    25.45825
    Northern |   19.77286   2.671408      14.51668    25.02905
     Western |   17.13877   2.044267      13.11653    21.16101
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
     Eastern |   4.619755   .5566681      3.524471     5.71504
    Northern |   4.887189   .8561292      3.202693    6.571684
     Western |   3.587274   .5316293      2.541255    4.633293
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
     Eastern |   1.552937   .2474923      1.065978    2.039896
    Northern |   1.667076   .3428179       .992557    2.341595
     Western |   1.263816   .2382299      .7950811     1.73255
--------------------------------------------------------------
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex4 was float now byte
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real_it4.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex4 |    3108  28069559.9    15.83399   36.51182          0        100
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/foodshares_it4.dta saved
file /tmp/St02564.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00

   relpoor5 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,564.5939       50.16       50.16
          1 | 1,554.4061       49.84      100.00
------------+-----------------------------------
      Total |      3,119      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/relpoor_it5.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        1.99        1.99
          2 |          1        0.00        1.99
          3 |     42,120       98.01      100.00
------------+-----------------------------------
      Total |     42,976      100.00
(3978 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     38,998       99.99      100.00
------------+-----------------------------------
      Total |     39,002      100.00
(25623 observations deleted)
(2 missing values generated)
    2
    0
(2 missing values generated)
    2
(2 observations deleted)
(note: file /tmp/St02564.00000v not found)
file /tmp/St02564.00000v saved
(note: file /tmp/St02564.00000w not found)
file /tmp/St02564.00000w saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     13,377      100.00      100.00
------------+-----------------------------------
      Total |     13,377      100.00
  125
(125 observations deleted)
file /tmp/St02564.00000v saved
39
39
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/codes_food_basket_flex_it5.dta saved
(3 observations deleted)
(note: file /tmp/St02564.00000x not found)
file /tmp/St02564.00000x saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        855        2.15        2.15
          2 |          3        0.01        2.15
          3 |     38,995       97.85      100.00
------------+-----------------------------------
      Total |     39,853      100.00
(3 observations deleted)
file /tmp/St02564.00000x saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,929       12.37       12.37
          3 |     34,921       87.63      100.00
------------+-----------------------------------
      Total |     39,850      100.00
(4929 observations deleted)
(3005 observations deleted)
(note: file /tmp/St02564.000011 not found)
file /tmp/St02564.000011 saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lregion already defined)
(label lsurvquar already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        103        0.32        0.32
          3 |     31,916       99.68      100.00
------------+-----------------------------------
      Total |     32,019      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     32,019      100.00      100.00
------------+-----------------------------------
      Total |     32,019      100.00
(20587 observations deleted)
(12 observations deleted)
(831 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw5 |       175    1.245532    .4261914   .7769808   3.337594
    ratiomw5 |       175    1.106541     .401926   .4394891   4.164927
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.69        1.69
          3 |        175       98.31      100.00
------------+-----------------------------------
      Total |        178      100.00
    3
(3 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/price_unit_flex_it5.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.85        3.85
          2 |         55       30.22       34.07
          3 |        120       65.93      100.00
------------+-----------------------------------
      Total |        182      100.00

     +-------------------------+
     | product        spdomain |
     |-------------------------|
121. |     157   Central Urban |
122. |     157   Central Rural |
123. |     157         Eastern |
124. |     160   Central Urban |
125. |     161   Central Urban |
     |-------------------------|
126. |     161         Eastern |
127. |     161        Northern |
     +-------------------------+
(62 observations deleted)
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26       17.81       17.81
          3 |        120       82.19      100.00
------------+-----------------------------------
      Total |        146      100.00
(26 observations deleted)

----------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
----------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    1
----------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
----------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       120    79.26667    69.55812          3        339
(4 observations deleted)
(4 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .8147091         0  .8147091  .8147091
Central Rural |        20  .9004949         0  .9004949  .9004949
      Eastern |        27  .9086618         0  .9086618  .9086618
     Northern |        24  .8921608         0  .8921608  .8921608
      Western |        23  .9046368         0  .9046368  .9046368
--------------+--------------------------------------------------
        Total |       112  .8877414    .03262  .8147091  .9086618
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        112      100.00      100.00
------------+-----------------------------------
      Total |        112      100.00
(112 real changes made)
(107 real changes made)
(112 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        18  .0001028         0  .0001028  .0001028
Central Rural |        20 -.0000514         0 -.0000514 -.0000514
      Eastern |        27 -.0000514         0 -.0000514 -.0000514
     Northern |        24 -.0001542         0 -.0001542 -.0001542
      Western |        23  .0000385         0  .0000385  .0000385
--------------+--------------------------------------------------
        Total |       112 -.0000302  .0000858 -.0001542  .0001028
-----------------------------------------------------------------
(112 real changes made)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/quan_flex_it5.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povline_food_flex_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(236 real changes made)
(5 missing values generated)
(note: file /tmp/St02564.000013 not found)
file /tmp/St02564.000013 saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(5 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines_it5.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      3,124      100.00      100.00
------------+-----------------------------------
      Total |      3,124      100.00
(16 missing values generated)
(5 missing values generated)
(5 missing values generated)
(16 missing values generated)
(3119 real changes made)
(5 missing values generated)
(3108 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
      cr_it5 |    3108  28069559.9    1060.929   977.5204   121.9062    20018.6
     linpob5 |    3119  28164219.1     439.223   67.80795   310.1624   546.7244
    linpobr5 |    3119  28164219.1    446.9937          0   446.9937   446.9937
(5 missing values generated)
(2727 missing values generated)
(2711 real changes made)
(16 missing values generated)
(2711 real changes made)
(16 missing values generated)
(2711 real changes made)
(16 missing values generated)
(16 missing values generated)
(16 missing values generated)
(5 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex5 |   15.83399   .9805861      13.90462    17.76337
    pg_flex5 |   3.400828   .2685763      2.872385    3.929272
   spg_flex5 |   1.152262   .1149257      .9261378    1.378387
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
       Urban |   3.446155   .9012713      1.672839    5.219472
       Rural |   18.40201   1.157092      16.12535    20.67867
-------------+------------------------------------------------
pg_flex5     |
       Urban |   .6935682   .2186354      .2633874    1.123749
       Rural |   3.962047   .3181491      3.336065    4.588028
-------------+------------------------------------------------
spg_flex5    |
       Urban |   .2572576   .1146385      .0316982    .4828171
       Rural |   1.337798   .1355201      1.071152    1.604443
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
   _subpop_3 |   .7531418   .4109651     -.0554615    1.561745
   _subpop_4 |   4.925694   .5983956      3.748308    6.103081
   _subpop_5 |   2.070973   1.087055     -.0678861    4.209832
   _subpop_6 |   5.345871   .9778379      3.421904    7.269837
   _subpop_7 |   .5143775   .3613374     -.1965798    1.225335
   _subpop_8 |   3.787679    .562877      2.680178     4.89518
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
   _subpop_3 |   .1559843   .1096572      -.059774    .3717427
   _subpop_4 |   1.663469   .2665669      1.138979    2.187958
   _subpop_5 |    .765731   .5078629     -.2335258    1.764988
   _subpop_6 |    1.81388   .3891091      1.048279     2.57948
   _subpop_7 |     .15622    .140974     -.1211564    .4335965
   _subpop_8 |   1.336049   .2523135      .8396044    1.832495
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

         Over: strata rural
    _subpop_1: central urban Urban
    _subpop_2: central rural Rural
    _subpop_3: Eastern urban Urban
    _subpop_4: Eastern rural Rural
    _subpop_5: Northern urban Urban
    _subpop_6: Northern rural Rural
    _subpop_7: Western Urban Urban
    _subpop_8: Western rural Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |   22.92328   2.115271      18.76134    27.08523
   _subpop_5 |   8.404917   3.859064      .8119299     15.9979
   _subpop_6 |   21.62438   3.027973      15.66663    27.58214
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.97278   2.165507      13.71199    22.23357
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
   _subpop_3 |   .7531418   .4109651     -.0554615    1.561745
   _subpop_4 |   4.925694   .5983956      3.748308    6.103081
   _subpop_5 |   2.070973   1.087055     -.0678861    4.209832
   _subpop_6 |   5.345871   .9778379      3.421904    7.269837
   _subpop_7 |   .5143775   .3613374     -.1965798    1.225335
   _subpop_8 |   3.787679    .562877      2.680178     4.89518
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
   _subpop_3 |   .1559843   .1096572      -.059774    .3717427
   _subpop_4 |   1.663469   .2665669      1.138979    2.187958
   _subpop_5 |    .765731   .5078629     -.2335258    1.764988
   _subpop_6 |    1.81388   .3891091      1.048279     2.57948
   _subpop_7 |     .15622    .140974     -.1211564    .4335965
   _subpop_8 |   1.336049   .2523135      .8396044    1.832495
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3108
Number of PSUs   =     321        Population size  =  28069560
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   2.095422   1.021369       .085806    4.105039
   _subpop_2 |   11.42645   1.964039      7.562067    15.29084
     Eastern |   21.57247   1.974915      17.68668    25.45825
    Northern |   19.77286   2.671408      14.51668    25.02905
     Western |   17.13877   2.044267      13.11653    21.16101
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   .4179244   .2238927     -.0226007    .8584494
   _subpop_2 |   2.067667   .4586388      1.165262    2.970072
     Eastern |   4.619755   .5566681      3.524471     5.71504
    Northern |   4.887189   .8561292      3.202693    6.571684
     Western |   3.587274   .5316293      2.541255    4.633293
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .1802621   .1344968       -.08437    .4448942
   _subpop_2 |   .6199516   .1858376      .2543027    .9856005
     Eastern |   1.552937   .2474923      1.065978    2.039896
    Northern |   1.667076   .3428179       .992557    2.341595
     Western |   1.263816   .2382299      .7950811     1.73255
--------------------------------------------------------------
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex5 was float now byte
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/cons_real_it5.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex5 |    3108  28069559.9    15.83399   36.51182          0        100
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/foodshares_it5.dta saved

. **************************************************************************
> * Send results to one big csv-file
> **************************************************************************;
. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         gen dum=1;

.         collapse (mean) dum h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt]
> ;

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file /tmp/St02564.000014 saved

.         use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by
> (rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file /tmp/St02564.000015 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by
> (news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file /tmp/St02564.000016 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by
> (reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file /tmp/St02564.000017 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by
> (strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file /tmp/St02564.000018 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by
> (spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file /tmp/St02564.000019 saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file /tmp/St02564.00001a saved

. use          `nat';

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' dum rural news reg_
> tpi strata spdomain using "$path/work/poverty_flexBask.csv", replace c;

. **************************************************************************
> * Convergence graph (based on 5 iterations)
> **************************************************************************;
. #delimit cr
delimiter now cr
. 
. clear

. set obs 1
obs was 0, now 1

. gen iteration=.
(1 missing value generated)

. tempfile converg

. save `converg'
file /tmp/St02564.00001b saved

. 
. forvalues X = 1/`maxit' {
  2.         use "$path/work/cons_real_it`X'.dta", clear
  3.         collapse (mean) h_flex`X' pg_flex`X' spg_flex`X' [aw=popwt], by(strata)
  4.         rename h_flex`X' h_flex
  5.         rename pg_flex`X' pg_flex
  6.         rename spg_flex`X' spg_flex
  7.         gen iteration=`X'
  8.         order iteration
  9.         *sum
.         if `X' != 1     {
 10.                 append using `converg'
 11.                         }
 12.         save `converg', replace
 13.         }
file /tmp/St02564.00001b saved
(label lstrata already defined)
file /tmp/St02564.00001b saved
(label lstrata already defined)
file /tmp/St02564.00001b saved
(label lstrata already defined)
file /tmp/St02564.00001b saved
(label lstrata already defined)
file /tmp/St02564.00001b saved

. 
. use `converg', clear

. sum

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   iteration |        40           3     1.43223          1          5
      strata |        40         4.5    2.320477          1          8
      h_flex |        40    11.73296    7.763625   2.095423   22.92328
     pg_flex |        40    2.493503    1.875903   .4179243   5.453815
    spg_flex |        40    .8395681    .6521121   .1503185   1.861008

. 
. twoway (connected h_flex iteration), by(, title(Convergence graph: Poverty rate. %) subtitle
> (After iterative procedure)) by(strata)

. graph export "$path/work/converge_pov_rate.tif", replace
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/converge_pov_rate.tif written in TIF
> F format)

. 
. sort strata iteration

. 
. for var h_flex pg_flex spg_flex: replace X = round(X,0.01)

->  replace h_flex = round(h_flex,0.01)
(40 real changes made)

->  replace pg_flex = round(pg_flex,0.01)
(40 real changes made)

->  replace spg_flex = round(spg_flex,0.01)
(40 real changes made)

. 
. list strata iteration h_flex pg_flex spg_flex

     +---------------------------------------------------------+
     |         strata   iterat~n   h_flex   pg_flex   spg_flex |
     |---------------------------------------------------------|
  1. |  central urban          1      2.1       .42        .18 |
  2. |  central urban          2      2.1       .42        .18 |
  3. |  central urban          3      2.1       .42        .18 |
  4. |  central urban          4      2.1       .42        .18 |
  5. |  central urban          5      2.1       .42        .18 |
     |---------------------------------------------------------|
  6. |  central rural          1    11.56      2.17        .65 |
  7. |  central rural          2    11.43      2.11        .63 |
  8. |  central rural          3    11.43      2.07        .62 |
  9. |  central rural          4    11.43      2.07        .62 |
 10. |  central rural          5    11.43      2.07        .62 |
     |---------------------------------------------------------|
 11. |  Eastern urban          1      4.5       .74        .15 |
 12. |  Eastern urban          2      4.5       .75        .15 |
 13. |  Eastern urban          3      4.5       .75        .15 |
 14. |  Eastern urban          4      4.5       .75        .16 |
 15. |  Eastern urban          5      4.5       .75        .16 |
     |---------------------------------------------------------|
 16. |  Eastern rural          1    22.18      4.84       1.63 |
 17. |  Eastern rural          2    22.92      4.91       1.66 |
 18. |  Eastern rural          3    22.92      4.91       1.66 |
 19. |  Eastern rural          4    22.92      4.93       1.66 |
 20. |  Eastern rural          5    22.92      4.93       1.66 |
     |---------------------------------------------------------|
 21. | Northern urban          1     9.62      2.12        .78 |
 22. | Northern urban          2     9.62      2.11        .78 |
 23. | Northern urban          3      8.4      2.07        .77 |
 24. | Northern urban          4      8.4      2.07        .77 |
 25. | Northern urban          5      8.4      2.07        .77 |
     |---------------------------------------------------------|
 26. | Northern rural          1    21.83      5.45       1.86 |
 27. | Northern rural          2    21.83      5.43       1.85 |
 28. | Northern rural          3    21.62      5.35       1.81 |
 29. | Northern rural          4    21.62      5.35       1.81 |
 30. | Northern rural          5    21.62      5.35       1.81 |
     |---------------------------------------------------------|
 31. |  Western Urban          1     4.35       .52        .16 |
 32. |  Western Urban          2     4.35       .51        .16 |
 33. |  Western Urban          3     4.35       .52        .16 |
 34. |  Western Urban          4     4.35       .51        .16 |
 35. |  Western Urban          5     4.35       .51        .16 |
     |---------------------------------------------------------|
 36. |  Western rural          1    18.37      3.82       1.35 |
 37. |  Western rural          2    17.97      3.79       1.34 |
 38. |  Western rural          3    18.18      3.79       1.34 |
 39. |  Western rural          4    17.97      3.79       1.34 |
 40. |  Western rural          5    17.97      3.79       1.34 |
     +---------------------------------------------------------+

.         
. #delimit ;
delimiter now ;
. **************************************************************************
> * 140_iterate.do        (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/170_pref_r_price_bjorn.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/170_pref_r_price.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/170_pref_r_price.log
  log type:  text
 opened on:  10 Mar 2014, 14:47:57

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparisons so that
> * we can check the quality of the regional baskets.
> * It also exports the price and quantity data for work in GAMS
> * Rather than make up for missing prices with shares, we estimate
> * a missing price in this case
> **************************************************************************;
. *global n_spdom "13";
. *global it_n "5";
. /*
> This file uses:
>         work/quan_flex_it$it_n.dta
>         work/povline_food_flex_it$it_n.dta
>         work/price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work/pref_r_price.dta
>         work/revpref_price_`i'.dta
>         work/product_flex.inc
>         work/price_unit_flex.inc
>         work/quan_flex.inc
> */
> 
> 
> 
> ***************************************************************************;
. * Export price, codes and quantity data to text
> ***************************************************************************;
. use "$path/work/price_unit_flex_it$it_n.dta";

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n using "$path/work/price_unit_flex.inc",  noquot
> e noname replace ;

. collapse (min) spdomain, by(product);

. outsheet product  using "$path/work/product_flex.inc", noname replace;

. use "$path/work/quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  calpp povline_f_flex90_$it_n using "$path/work
> /quan_flex.inc", noname noquote replace;

. clear;

. **************************************************************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> **************************************************************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path/work/pref_r_price.dta", replace;
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path/work/revpref_price_`i'.dta", replace;
  5.         clear;
  6.                 use "$path/work/quan_flex_it$it_n.dta", clear;
  7.                 keep product spdomain quan$it_n price_uw$it_n val_ir$it_n povline_f_flex9
> 0_$it_n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90_$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quantities to hit constant calorie target;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescaled to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **************************************************************************;
. * Now get the prices in other regions so that you can use them 
> * to build  a new poverty line
> **************************************************************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path/work/price_unit_flex_it$it_n.dta";
 19.                                 keep product spdomain price_uw$it_n descript count bswt;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with the fact that not all commodities are cons
> umed in every region;
.                 *so we might have a quantity from region i but no price in region j;
.                 *these will have _merge value=2;
.                 *alternatively the number of observations might be too small;
.                 *deal with these problems by TAKING THE MAX PRICE OBSERVED ELSEWHERE (exclud
> ing Maputo)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified to handle the counting of bswt instead of co
> unt
>                   replace price_uw$it_n=. if round(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==2 ;
 27.                   replace pricemiss=1 if _m==2 | round(bswt)<5;
 28.                         lab var pricemiss "identify those items with no price observation
> ";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing observed quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             sort product;
 35.                                             *this file contains the price codes that are 
> missing for the region in question;
.                             save `codmiss', replace;
 36. *browse;
.                                   use "$path/work/price_unit_flex_it$it_n.dta", clear;
 37.                         sort product;
 38. *browse;
.                         merge product using `codmiss';
 39.                                                 tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maputo province and city from other price calcul
> ation;
.                                 drop if spdomain>10;
 42.                         collapse (max) price_uw$it_n, by(product);
 43.                   *this file contains the code and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product using `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                                             else use `getmiss', clear;
 50.                         gen val_q=quan_s*price_uw$it_n;
 51.                                                 collapse (sum) val_q pricemiss (mean) spd
> omainq ratquan, by(spdomain);
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path/work/revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path/work/revpref_price_`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path/work/pref_r_price.dta";
 59.       sort spdomain spdomainq;
 60.       save "$path/work/pref_r_price.dta", replace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(94 observations deleted)
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved
variable descript not found
r(111);

end of do-file

r(111);

. do "$path/new/170_pref_r_price_bjorn.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/170_pref_r_price.log", replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/170_pref_r_price.log
  log type:  text
 opened on:  10 Mar 2014, 14:48:50

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparisons so that
> * we can check the quality of the regional baskets.
> * It also exports the price and quantity data for work in GAMS
> * Rather than make up for missing prices with shares, we estimate
> * a missing price in this case
> **************************************************************************;
. *global n_spdom "13";
. *global it_n "5";
. /*
> This file uses:
>         work/quan_flex_it$it_n.dta
>         work/povline_food_flex_it$it_n.dta
>         work/price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work/pref_r_price.dta
>         work/revpref_price_`i'.dta
>         work/product_flex.inc
>         work/price_unit_flex.inc
>         work/quan_flex.inc
> */
> 
> 
> 
> ***************************************************************************;
. * Export price, codes and quantity data to text
> ***************************************************************************;
. use "$path/work/price_unit_flex_it$it_n.dta";

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n using "$path/work/price_unit_flex.inc",  noquot
> e noname replace ;

. collapse (min) spdomain, by(product);

. outsheet product  using "$path/work/product_flex.inc", noname replace;

. use "$path/work/quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  calpp povline_f_flex90_$it_n using "$path/work
> /quan_flex.inc", noname noquote replace;

. clear;

. **************************************************************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> **************************************************************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path/work/pref_r_price.dta", replace;
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path/work/revpref_price_`i'.dta", replace;
  5.         clear;
  6.                 use "$path/work/quan_flex_it$it_n.dta", clear;
  7.                 keep product spdomain quan$it_n price_uw$it_n val_ir$it_n povline_f_flex9
> 0_$it_n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90_$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quantities to hit constant calorie target;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescaled to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **************************************************************************;
. * Now get the prices in other regions so that you can use them 
> * to build  a new poverty line
> **************************************************************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path/work/price_unit_flex_it$it_n.dta";
 19.                                 keep product spdomain price_uw$it_n  count bswt;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with the fact that not all commodities are cons
> umed in every region;
.                 *so we might have a quantity from region i but no price in region j;
.                 *these will have _merge value=2;
.                 *alternatively the number of observations might be too small;
.                 *deal with these problems by TAKING THE MAX PRICE OBSERVED ELSEWHERE (exclud
> ing Maputo)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified to handle the counting of bswt instead of co
> unt
>                   replace price_uw$it_n=. if round(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==2 ;
 27.                   replace pricemiss=1 if _m==2 | round(bswt)<5;
 28.                         lab var pricemiss "identify those items with no price observation
> ";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing observed quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             sort product;
 35.                                             *this file contains the price codes that are 
> missing for the region in question;
.                             save `codmiss', replace;
 36. *browse;
.                                   use "$path/work/price_unit_flex_it$it_n.dta", clear;
 37.                         sort product;
 38. *browse;
.                         merge product using `codmiss';
 39.                                                 tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maputo province and city from other price calcul
> ation;
.                                 drop if spdomain>10;
 42.                         collapse (max) price_uw$it_n, by(product);
 43.                   *this file contains the code and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product using `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                                             else use `getmiss', clear;
 50.                         gen val_q=quan_s*price_uw$it_n;
 51.                                                 collapse (sum) val_q pricemiss (mean) spd
> omainq ratquan, by(spdomain);
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path/work/revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path/work/revpref_price_`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path/work/pref_r_price.dta";
 59.       sort spdomain spdomainq;
 60.       save "$path/work/pref_r_price.dta", replace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(94 observations deleted)
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved
(142 observations deleted)
(label lspdomain already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
(note: file /tmp/St02564.000002 not found)
file /tmp/St02564.000002 saved
(18 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(140 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(139 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(140 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02564.000002 saved
(17 observations deleted)
(note: file /tmp/St02564.000003 not found)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        170       97.14       97.14
          3 |          5        2.86      100.00
------------+-----------------------------------
      Total |        175      100.00
(170 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         17       94.44       94.44
          3 |          1        5.56      100.00
------------+-----------------------------------
      Total |         18      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
(139 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_1.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(92 observations deleted)
file /tmp/St02564.000001 saved
(142 observations deleted)
(label lspdomain already defined)
(13 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        165       94.29       94.29
          3 |         10        5.71      100.00
------------+-----------------------------------
      Total |        175      100.00
(165 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       90.00       90.00
          3 |          2       10.00      100.00
------------+-----------------------------------
      Total |         20      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(140 observations deleted)
(label lspdomain already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(20 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(139 observations deleted)
(label lspdomain already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(20 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(140 observations deleted)
(label lspdomain already defined)
(15 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02564.000002 saved
(19 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        170       97.14       97.14
          3 |          5        2.86      100.00
------------+-----------------------------------
      Total |        175      100.00
(170 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         19       95.00       95.00
          3 |          1        5.00      100.00
------------+-----------------------------------
      Total |         20      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(139 observations deleted)
(label lspdomain already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(20 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_2.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(85 observations deleted)
file /tmp/St02564.000001 saved
(142 observations deleted)
(label lspdomain already defined)
(8 observations deleted)
(2 real changes made)
(9 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        133       76.00       76.00
          3 |         42       24.00      100.00
------------+-----------------------------------
      Total |        175      100.00
(133 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       66.67       66.67
          3 |          9       33.33      100.00
------------+-----------------------------------
      Total |         27      100.00
(2 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(140 observations deleted)
(label lspdomain already defined)
(9 observations deleted)
(1 real change made)
(3 real changes made)
file /tmp/St02564.000002 saved
(24 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        162       92.57       92.57
          3 |         13        7.43      100.00
------------+-----------------------------------
      Total |        175      100.00
(162 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       88.89       88.89
          3 |          3       11.11      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(139 observations deleted)
(label lspdomain already defined)
(9 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(27 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(140 observations deleted)
(label lspdomain already defined)
(8 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02564.000002 saved
(26 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        170       97.14       97.14
          3 |          5        2.86      100.00
------------+-----------------------------------
      Total |        175      100.00
(170 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(139 observations deleted)
(label lspdomain already defined)
(9 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(27 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_3.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(88 observations deleted)
file /tmp/St02564.000001 saved
(142 observations deleted)
(label lspdomain already defined)
(12 observations deleted)
(3 real changes made)
(12 real changes made)
file /tmp/St02564.000002 saved
(12 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        118       67.43       67.43
          3 |         57       32.57      100.00
------------+-----------------------------------
      Total |        175      100.00
(118 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         12       50.00       50.00
          3 |         12       50.00      100.00
------------+-----------------------------------
      Total |         24      100.00
(3 missing values generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(140 observations deleted)
(label lspdomain already defined)
(11 observations deleted)
(0 real changes made)
(6 real changes made)
file /tmp/St02564.000002 saved
(18 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        147       84.00       84.00
          3 |         28       16.00      100.00
------------+-----------------------------------
      Total |        175      100.00
(147 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       75.00       75.00
          3 |          6       25.00      100.00
------------+-----------------------------------
      Total |         24      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(139 observations deleted)
(label lspdomain already defined)
(12 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(24 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(140 observations deleted)
(label lspdomain already defined)
(11 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(24 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(139 observations deleted)
(label lspdomain already defined)
(12 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(24 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_4.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(89 observations deleted)
file /tmp/St02564.000001 saved
(142 observations deleted)
(label lspdomain already defined)
(11 observations deleted)
(1 real change made)
(7 real changes made)
file /tmp/St02564.000002 saved
(16 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        142       81.14       81.14
          3 |         33       18.86      100.00
------------+-----------------------------------
      Total |        175      100.00
(142 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         16       69.57       69.57
          3 |          7       30.43      100.00
------------+-----------------------------------
      Total |         23      100.00
(1 missing value generated)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(140 observations deleted)
(label lspdomain already defined)
(12 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02564.000002 saved
(21 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        166       94.86       94.86
          3 |          9        5.14      100.00
------------+-----------------------------------
      Total |        175      100.00
(166 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(139 observations deleted)
(label lspdomain already defined)
(13 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(23 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(140 observations deleted)
(label lspdomain already defined)
(13 observations deleted)
(1 real change made)
(2 real changes made)
file /tmp/St02564.000002 saved
(21 observations deleted)
file /tmp/St02564.000003 saved
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        166       94.86       94.86
          3 |          9        5.14      100.00
------------+-----------------------------------
      Total |        175      100.00
(166 observations deleted)
(0 observations deleted)
file /tmp/St02564.000003 saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
(1 missing value generated)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(139 observations deleted)
(label lspdomain already defined)
(13 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02564.000002 saved
(23 observations deleted)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/revpref_price_5.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved

. *bring in actual flexible bundle numbers;
. use "$path/work/povline_food_flex_it$it_n.dta", clear;

.         merge spdomain using "$path/work/pref_r_price.dta";
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta
(label lspdomain already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

.          drop crap;

.         drop _m;

.         order spdomainq spdomain;

.       sort spdomainq spdomain;

.         *rescale expenditures to hit a constant calorie target;
.         gen povline_f5_s=ratquan*povline_f_flex90_$it_n;

.       compress;
spdomainq was float now byte
spdomain was float now byte
pricemiss was double now byte

. *browse;
.         *categorize revealed preference performance;
.       gen pref_r=0;

.       replace pref_r=1 if float(linf_q)>float(povline_f5_s);
(14 real changes made)

.       replace pref_r=2 if float(linf_q)<float(povline_f5_s);
(7 real changes made)

.       lab var pref_r "Fails or passes revealed preference test";

.       lab def pref_r
>                         0 "comparison of the same region with itself"
>                         1 "passes revealed preference test"
>                         2 "fails revealed preference test" ;

.         lab val pref_r pref_r;

.       drop if spdomainq==spdomain;
(5 observations deleted)

.         tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         13       65.00       65.00
         fails revealed preference test |          7       35.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

.              sort spdomainq ;

.       by spdomainq: tab pref_r;

----------------------------------------------------------------------------------------------
-> spdomainq = 1

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

----------------------------------------------------------------------------------------------
-> spdomainq = 2

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          1       25.00       25.00
         fails revealed preference test |          3       75.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

----------------------------------------------------------------------------------------------
-> spdomainq = 3

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

----------------------------------------------------------------------------------------------
-> spdomainq = 4

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
         fails revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

----------------------------------------------------------------------------------------------
-> spdomainq = 5

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00


. save "$path/work/pref_r_price.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/pref_r_price.dta saved

. *drop comparisons with Maputo ;
. drop if spdomain>=11;
(0 observations deleted)

. drop if spdomainq>=11;
(0 observations deleted)

. display "this is with maputo dropped";
this is with maputo dropped

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         13       65.00       65.00
         fails revealed preference test |          7       35.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. *further drop Nampula rural and urban;
. drop if spdomain==3 | spdomain==4;
(8 observations deleted)

. display "this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 s
> patial domains)";
this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 spatial doma
> ins)

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          7       58.33       58.33
         fails revealed preference test |          5       41.67      100.00
----------------------------------------+-----------------------------------
                                  Total |         12      100.00

. **************************************************************************
> * 170_pref_r_price.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/170_pref_r_price.log
  log type:  text
 closed on:  10 Mar 2014, 14:48:52
----------------------------------------------------------------------------------------------

. 
end of do-file

. shell /usr/GAMS/gams24.1_linux_x64_64_sfx/gams "/home/bjvca/data/data/GAP/Haruna/UNPS_2005_0
> 6/new/190a_revpref13_r_bjorn.gms" o="/home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/new/list.
> lst"

*** Could not write to console: /dev/tty
*** Logging to standard output
--- Job 190a_revpref13_r_bjorn.gms Start 03/10/14 14:49:06 24.1.2 r40979 LEX-LEG x86_64/Linux
GAMS 24.1.2   Copyright (C) 1987-2013 GAMS Development. All rights reserved
Licensee: Computer Services                              G130401:1333CP-GEN
          International Food Policy Research Institute               DC2119
--- Starting compilation
--- 190a_revpref13_r_bjorn.gms(19) 2 Mb
--- .product_flex.inc(36) 3 Mb
--- 190a_revpref13_r_bjorn.gms(64) 3 Mb
--- .price_unit_flex.inc(175) 3 Mb
--- 190a_revpref13_r_bjorn.gms(69) 3 Mb
--- .quan_flex.inc(112) 3 Mb
--- 190a_revpref13_r_bjorn.gms(269) 3 Mb 1 Error
*** Status: Compilation error(s)
--- Job 190a_revpref13_r_bjorn.gms Stop 03/10/14 14:49:06 elapsed 0:00:00.007

. shell /usr/GAMS/gams24.1_linux_x64_64_sfx/gams "/home/bjvca/data/data/GAP/Haruna/UNPS_2005_0
> 6/new/190a_revpref13_r_bjorn.gms" o="/home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/new/list.
> lst"

*** Could not write to console: /dev/tty
*** Logging to standard output
--- Job 190a_revpref13_r_bjorn.gms Start 03/10/14 14:51:58 24.1.2 r40979 LEX-LEG x86_64/Linux
GAMS 24.1.2   Copyright (C) 1987-2013 GAMS Development. All rights reserved
Licensee: Computer Services                              G130401:1333CP-GEN
          International Food Policy Research Institute               DC2119
--- Starting compilation
--- 190a_revpref13_r_bjorn.gms(19) 2 Mb
--- .product_flex.inc(36) 3 Mb
--- 190a_revpref13_r_bjorn.gms(64) 3 Mb
--- .price_unit_flex.inc(175) 3 Mb
--- 190a_revpref13_r_bjorn.gms(69) 3 Mb
--- .quan_flex.inc(112) 3 Mb
--- 190a_revpref13_r_bjorn.gms(269) 3 Mb
--- Starting execution: elapsed 0:00:00.004
--- 190a_revpref13_r_bjorn.gms(516) 4 Mb
--- Generating NLP model revpref
--- 190a_revpref13_r_bjorn.gms(518) 7 Mb
---   163 rows  250 columns  1,173 non-zeroes
---   1,010 nl-code  336 nl-non-zeroes
--- 190a_revpref13_r_bjorn.gms(518) 4 Mb
--- Executing CONOPT: elapsed 0:00:00.038
*** Could not write to console: /dev/tty
*** Logging to standard output
CONOPT 3         24.1.2 r40979 Released Jun 16, 2013 LEG x86_64/Linux         
 
 
    C O N O P T 3   version 3.15K
    Copyright (C)   ARKI Consulting and Development A/S
                    Bagsvaerdvej 246 A
                    DK-2880 Bagsvaerd, Denmark
 
 
   Iter Phase Ninf   Infeasibility   RGmax    NSB   Step InItr MX OK
      0   0        4.0995088422E+02 (Input point)
                                Pre-triangular equations:        0
                                Post-triangular equations:       1
      1   0        4.0995088422E+02 (After pre-processing)
      2   0        1.2081643485E+00 (After scaling)
     10   0     3  3.9334351043E-01               1.0E+00      F  T
     16   1     3  3.6327513439E-02 7.7E+00    86 9.9E-01    3 T  T
 
 ** Feasible solution. Value of objective =   0.583539704793
 
   Iter Phase Ninf     Objective     RGmax    NSB   Step InItr MX OK
     21   4        3.7064585671E-01 4.8E+00   104 8.8E+00      F  T
     26   4        2.2865627141E-01 2.8E-01   101 1.0E+00   21 T  T
     31   4        8.2378679166E-02 1.5E-01    99 1.0E+00   31 T  T
     36   4        3.7705260348E-02 1.7E-02   100 1.0E+00   11 F  T
     40   4        3.7705258717E-02 2.3E-08   100
 
 ** Optimal solution. Reduced gradient less than tolerance.
 
*** Could not write to console: /dev/tty
*** Logging to standard output
--- Restarting execution
--- 190a_revpref13_r_bjorn.gms(518) 2 Mb
--- Reading solution for model revpref
--- 190a_revpref13_r_bjorn.gms(587) 3 Mb
--- Putfile povline_rp /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/work/povline_rp_inout.csv
--- Putfile res /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/work/qent.csv
--- Putfile lin /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/work/povline_food_ent.csv
*** Status: Normal completion
--- Job 190a_revpref13_r_bjorn.gms Stop 03/10/14 14:51:58 elapsed 0:00:00.284

. do "$path/new/210_povmeas_ent_flex.do"

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/210_povmeas_ent_flex.log" , replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/210_povmeas_ent_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:52:41

. clear

. set more off

. #delimit ;
delimiter now ;
. *********************************************************************************
> * 210_povmeas_ent_flex.do               (start)
> *
> * This file produces poverty measures taking the entropy adjusted poverty 
> * lines as a base. It produces two sets of poverty measures. In one, 
> * Maputo is treated with the logic of the fixed bundle. In the second, the revealed preferen
> ce logic
> * is maintained. Here, the flexible bundle is viewed as being determined by the 
> * lower constraint on the value of the food bundle dictated by P_t2*Q_t1. In this case,
> * the year t2 food shares are calculated and applied.
> *
> * Fixed poverty lines/etc. are mentioned here and there. But there are NO fixed
> * calculations for Maputo (or other provinces) anymore
> *
> *********************************************************************************;
. /*
> This file uses:
>         work\povline_food_ent.csv
>         work\conpc.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\povlines_ent.dta
>         work\povmeas_ent_flex.dta
>         work\povlines_ent.dta
>       work\nat_pov_ent_m.csv
>       work\rur_pov_ent_m.csv
>       work\news_pov_ent_m.csv
>       work\reg_tpi_pov_ent_m.csv
>       work\strata_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>         work\povlines_ent.csv
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         14        0.45        0.45
          3 |      3,109       99.55      100.00
------------+-----------------------------------
      Total |      3,123      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(15 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. **************************************************************************;
. * Calculate the food shares for people near the food poverty line
> **************************************************************************;
. *Bring in entropy estimated flexible lines;
. clear;

. insheet using "$path\work\povline_food_ent.csv";
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06/\work\povline_food_ent.csv not found
r(601);

end of do-file

r(601);

. do "$path/new/210_povmeas_ent_flex.do"

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/210_povmeas_ent_flex.log" , replace
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/210_povmeas_ent_flex.log
  log type:  text
 opened on:  10 Mar 2014, 14:55:34

. clear

. set more off

. #delimit ;
delimiter now ;
. *********************************************************************************
> * 210_povmeas_ent_flex.do               (start)
> *
> * This file produces poverty measures taking the entropy adjusted poverty 
> * lines as a base. It produces two sets of poverty measures. In one, 
> * Maputo is treated with the logic of the fixed bundle. In the second, the revealed preferen
> ce logic
> * is maintained. Here, the flexible bundle is viewed as being determined by the 
> * lower constraint on the value of the food bundle dictated by P_t2*Q_t1. In this case,
> * the year t2 food shares are calculated and applied.
> *
> * Fixed poverty lines/etc. are mentioned here and there. But there are NO fixed
> * calculations for Maputo (or other provinces) anymore
> *
> *********************************************************************************;
. /*
> This file uses:
>         work\povline_food_ent.csv
>         work\conpc.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\povlines_ent.dta
>         work\povmeas_ent_flex.dta
>         work\povlines_ent.dta
>       work\nat_pov_ent_m.csv
>       work\rur_pov_ent_m.csv
>       work\news_pov_ent_m.csv
>       work\reg_tpi_pov_ent_m.csv
>       work\strata_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>         work\povlines_ent.csv
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         14        0.45        0.45
          3 |      3,109       99.55      100.00
------------+-----------------------------------
      Total |      3,123      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(15 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(16 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St02564.000001 not found)
file /tmp/St02564.000001 saved

. **************************************************************************;
. * Calculate the food shares for people near the food poverty line
> **************************************************************************;
. *Bring in entropy estimated flexible lines;
. clear;

. insheet using "$path/work/povline_food_ent.csv";
(3 vars, 5 obs)

.         rename ent food_povline_ent;

.      keep spdomain food_povline_ent;

.      sort spdomain;

. *Bring in fixed bundle poverty lines for Maputo ;
. *This is the same level for both entropy and fixed bundle analysis;
. *since the Q02*P02<=Q96*P02 constraint is binding;
. *$no_temp_rev   merge spdomain using "$path/work/povline_food_fix.dta";
. *$no_temp_rev    replace food_povline_ent=food_povline_w if spdomain>10;
.       keep spdomain food_povline_ent;

.       sort spdomain;

.       tempfile food_povline_ent;

. save `food_povline_ent';
file /tmp/St02564.000002 saved

. clear;

. use `contpi';

.         sort spdomain;

.         merge spdomain using `food_povline_ent';
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/food_povline_ent-1)+0.5)
>                 if abs(cons_pc_tpi/food_povline_ent-1)<=0.2;
(238 real changes made)

.         gen tripopwt=triwt*hhweight*hhsize;
(5 missing values generated)

.         collapse (mean) nf_pc_nom food_povline_ent [aw=tripopwt] ,
>         by(reg_tpi);

.         rename nf_pc_nom povline_nf;

.         lab var povline_nf "Nonfood poverty line";

.         sort reg_tpi;

. *       merge spdomain using "$foodshr_pastSurvey", keep(spdomain $fdshr_t1);
. *       tab _m;
. *       drop _m;
. *       gen fdshr_t1 = $fdshr_t1;
. *       drop $fdshr_t1;
. *       lab var fdshr_t1 "year t1 (e.g. 1996) poverty line food share";
.      *calculate line for all provinces with flexible food shares;
.                         gen povline_ent_m=food_povline_ent + povline_nf;

.         gen fdshr=food_povline_ent/povline_ent;

.         lab var fdshr "year t2 (e.g. 2002) poverty line food share";

.       *redo for maputo inserting the fixed food share;
.  *     gen povline_ent=povline_ent_m;
. *MAH;
. *$no_temp_rev   replace povline_ent=food_povline_ent/fdshr_t1 if spdomain >=11;
. *       lab var povline_ent   "poverty lines with Maputo regions calculated using fixed bund
> le non-food shares";
.     lab var povline_ent   "poverty lines with all regions calculated using flexible bundle n
> on-food shares";

. *    lab var povline_ent_m "poverty lines with Maputo regions calculated using flexible bund
> le non-food shares";
.         sort reg_tpi;

. tempfile povlines_ent;

. save `povlines_ent', replace;
(note: file /tmp/St02564.000003 not found)
file /tmp/St02564.000003 saved

. clear;

. **************************************************************************;
. * Calculate poverty measures with all regions using flexible year t2 food shares
> **************************************************************************;
. use `contpi';

.         sort reg_tpi;

.         merge reg_tpi using `povlines_ent';
variable reg_tpi does not uniquely identify observations in the master data
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> **************************************************************************;
.         gen cr= cons_pc_tpi ;
(16 missing values generated)

.         gen linpob=povline_ent;
(5 missing values generated)

. *MAH;
.  *Now only 6 regions, so base is chosen as the 1;
.         *qui sum linpob if spdomain==7, meanonly;
.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;
(5 missing values generated)

.         gen cr2=cr/spi;
(16 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(3119 real changes made)

.         gen linpobr=linpob/spi;
(5 missing values generated)

.         replace cr2=cr/spi;
(3108 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
         cr2 |    3108  28069559.9    1060.929   1057.035   124.7579   23579.28
      linpob |    3119  28164219.1    430.9366   31.21727   369.5095   465.1193
     linpobr |    3119  28164219.1    431.5098   .0000263   431.5098   431.5099

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(2686 missing values generated)

.         replace  h = 0  if cr2 > (linpobr);
(2686 real changes made)

.         gen             pg      = ((linpobr - cr2 )/linpobr) *100;
(16 missing values generated)

.         replace         pg      = 0             if h==0;
(2686 real changes made)

.         gen             spg     = ((( linpobr - cr2 )/ linpobr )^2)*100;
(16 missing values generated)

.         replace         spg     = 0             if h==0;
(2686 real changes made)

.         gen h_ent  =h;

.         gen pg_ent =pg;
(5 missing values generated)

.         gen spg_ent=spg;
(5 missing values generated)

.         lab var h_ent   "Poverty headcount entropy bundle with Maputo food share fixed";

.         lab var pg_ent  "Poverty gap entropy bundle with Maputo food share fixed";

.         lab var spg_ent "Squared poverty gap entropy bundle with Maputo food share fixed";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lnews already defined)
(label lspdomain already defined)
(label lregion already defined)
(label lrural already defined)
(label lstrata already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label SUBSTRAT already defined)
(label INIDPCMP already defined)
(label RESPCODE already defined)
(label districtc05 already defined)
(label districtc09 already defined)
(label stratum already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(4 missing values generated)

.         lab var popwt "Population weights = hhsize X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

. *MAH: Below at various places the original reg13 has been changed into spdomain or spdomain 
> ;
.                 svy: mean h_ent pg_ent spg_ent;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
       h_ent |   16.36014   .9930438      14.40625    18.31402
      pg_ent |   3.723273   .2920829      3.148579    4.297967
     spg_ent |   1.316012   .1308725      1.058511    1.573513
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
       Urban |   2.643933   .6841143      1.297889    3.989977
       Rural |   19.22257   1.177857      16.90505    21.54009
-------------+------------------------------------------------
pg_ent       |
       Urban |   .6989037   .2444724      .2178867    1.179921
       Rural |   4.354427   .3459018      3.673841    5.035014
-------------+------------------------------------------------
spg_ent      |
       Urban |   .2859285   .1227554      .0443984    .5274587
       Rural |    1.53098    .154826      1.226349    1.835611
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
   _subpop_1 |   .3949241   .2837125     -.1633007    .9531489
   _subpop_2 |   11.47244   1.969776      7.596763    15.34811
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |    19.3941   2.087186      15.28741    23.50079
   _subpop_5 |   10.83068   4.242503       2.48325    19.17811
   _subpop_6 |   32.52435   3.238256      26.15285    38.89586
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.50833   2.197115      13.18535    21.83131
-------------+------------------------------------------------
pg_ent       |
   _subpop_1 |   .1942915   .1629339     -.1262927    .5148758
   _subpop_2 |   2.236628   .4778657      1.296393    3.176863
   _subpop_3 |   .5360828   .3407539      -.134375    1.206541
   _subpop_4 |   3.985432   .5405959      2.921771    5.049094
   _subpop_5 |   3.367906   1.534385      .3488935    6.386918
   _subpop_6 |   8.876136   1.296284      6.325605    11.42667
   _subpop_7 |   .5025887   .3574236     -.2006681    1.205845
   _subpop_8 |   3.744954   .5593751      2.644343    4.845564
-------------+------------------------------------------------
spg_ent      |
   _subpop_1 |   .1115351   .1044452     -.0939683    .3170384
   _subpop_2 |   .6749598   .1944341      .2923967    1.057523
   _subpop_3 |   .0973691   .0787008     -.0574803    .2522186
   _subpop_4 |   1.328966   .2340691      .8684178    1.789513
   _subpop_5 |     1.3518   .7282591     -.0811021    2.784702
   _subpop_6 |   3.378728   .6077547      2.182927    4.574529
   _subpop_7 |   .1540516   .1396833     -.1207854    .4288885
   _subpop_8 |    1.32109     .25061      .8279969    1.814183
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
   _subpop_1 |   .3949241   .2837125     -.1633007    .9531489
   _subpop_2 |   11.47244   1.969776      7.596763    15.34811
     Eastern |   18.30339   1.944697      14.47706    22.12972
    Northern |   29.48594   2.868099      23.84275    35.12913
     Western |   16.70276   2.070958        12.628    20.77752
-------------+------------------------------------------------
pg_ent       |
   _subpop_1 |   .1942915   .1629339     -.1262927    .5148758
   _subpop_2 |   2.236628   .4778657      1.296393    3.176863
     Eastern |   3.732832   .5025177      2.744092    4.721571
    Northern |   8.104654   1.138754      5.864073    10.34523
     Western |   3.546443   .5283158      2.506944    4.585943
-------------+------------------------------------------------
spg_ent      |
   _subpop_1 |   .1115351   .1044452     -.0939683    .3170384
   _subpop_2 |   .6749598   .1944341      .2923967    1.057523
     Eastern |   1.238774   .2172529      .8113134    1.666235
    Northern |   3.094836   .5337637      2.044618    4.145055
     Western |   1.249639   .2366178       .784077    1.715202
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
   _subpop_1 |   .3949241   .2837125     -.1633007    .9531489
   _subpop_2 |   11.47244   1.969776      7.596763    15.34811
     Eastern |   18.30339   1.944697      14.47706    22.12972
    Northern |   29.48594   2.868099      23.84275    35.12913
     Western |   16.70276   2.070958        12.628    20.77752
-------------+------------------------------------------------
pg_ent       |
   _subpop_1 |   .1942915   .1629339     -.1262927    .5148758
   _subpop_2 |   2.236628   .4778657      1.296393    3.176863
     Eastern |   3.732832   .5025177      2.744092    4.721571
    Northern |   8.104654   1.138754      5.864073    10.34523
     Western |   3.546443   .5283158      2.506944    4.585943
-------------+------------------------------------------------
spg_ent      |
   _subpop_1 |   .1115351   .1044452     -.0939683    .3170384
   _subpop_2 |   .6749598   .1944341      .2923967    1.057523
     Eastern |   1.238774   .2172529      .8113134    1.666235
    Northern |   3.094836   .5337637      2.044618    4.145055
     Western |   1.249639   .2366178       .784077    1.715202
--------------------------------------------------------------

.                 compress;
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
one was float now byte
h was float now byte
h_ent was float now byte

.       gen dum=1;

.         sort hhid;

.         *set aside the spatial price index;
.       tempfile spi;

. *      use "$path/work/povmeas_ent.dta", clear;
.       collapse (mean) spi, by(reg_tpi);

.       sort reg_tpi;

. save `spi', replace;
(note: file /tmp/St02564.000004 not found)
file /tmp/St02564.000004 saved

. clear;

. **************************************************************************;
. * Calculate poverty measures with Maputo regions on flexible food shares
> **************************************************************************;
. use `contpi';

.         sort reg_tpi;

.         merge reg_tpi using `povlines_ent';
variable reg_tpi does not uniquely identify observations in the master data
(label lregion already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        0.16        0.16
          3 |      3,119       99.84      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop _merge;

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> **************************************************************************;
.         gen cr= cons_pc_tpi ;
(16 missing values generated)

.         gen linpob=povline_ent_m;
(5 missing values generated)

.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;
(5 missing values generated)

.         gen cr2=cr/spi;
(16 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(3119 real changes made)

.         gen linpobr=linpob/spi;
(5 missing values generated)

.         replace cr2=cr/spi;
(3108 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    3108  28069559.9    1060.929    1055.93   106.8324   23434.67
         cr2 |    3108  28069559.9    1060.929   1057.035   124.7579   23579.28
      linpob |    3119  28164219.1    430.9366   31.21727   369.5095   465.1193
     linpobr |    3119  28164219.1    431.5098   .0000263   431.5098   431.5099

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(2686 missing values generated)

.         replace  h = 0 if cr2 > (linpobr);
(2686 real changes made)

.         gen             pg      = ((linpobr - cr2 )/linpobr) *100;
(16 missing values generated)

.         replace         pg      = 0             if h==0;
(2686 real changes made)

.         gen             spg     = ((( linpobr - cr2 )/ linpobr )^2)*100;
(16 missing values generated)

.         replace         spg     = 0             if h==0;
(2686 real changes made)

.         gen h_ent_m  =h;

.         gen pg_ent_m =pg;
(5 missing values generated)

.         gen spg_ent_m=spg;
(5 missing values generated)

.         lab var h_ent_m   "Poverty headcount entropy bundle. Food share flexible. Flexible b
> undle";

.         lab var pg_ent_m  "Poverty gap entropy bundle. Food share flexible. Flexible bundle"
> ;

.         lab var spg_ent_m "Squared poverty gap entropy. Food share flexible. Flexible bundle
> ";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lnews already defined)
(label lspdomain already defined)
(label lregion already defined)
(label lrural already defined)
(label lstrata already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label SUBSTRAT already defined)
(label INIDPCMP already defined)
(label RESPCODE already defined)
(label districtc05 already defined)
(label districtc09 already defined)
(label stratum already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.03        0.03
          3 |      3,123       99.97      100.00
------------+-----------------------------------
      Total |      3,124      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(4 missing values generated)

.         lab var popwt "Population weights = hhsize X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.                 svy: mean h_ent_m pg_ent_m spg_ent_m;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_ent_m |   16.36014   .9930438      14.40625    18.31402
    pg_ent_m |   3.723273   .2920829      3.148579    4.297967
   spg_ent_m |   1.316012   .1308725      1.058511    1.573513
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
       Urban |   2.643933   .6841143      1.297889    3.989977
       Rural |   19.22257   1.177857      16.90505    21.54009
-------------+------------------------------------------------
pg_ent_m     |
       Urban |   .6989037   .2444724      .2178867    1.179921
       Rural |   4.354427   .3459018      3.673841    5.035014
-------------+------------------------------------------------
spg_ent_m    |
       Urban |   .2859285   .1227554      .0443984    .5274587
       Rural |    1.53098    .154826      1.226349    1.835611
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
     Central |   7.465414   1.240227      5.025179     9.90565
     Eastern |   18.30339   1.944697      14.47706    22.12972
    Northern |   29.48594   2.868099      23.84275    35.12913
     Western |   16.70276   2.070958        12.628    20.77752
-------------+------------------------------------------------
pg_ent_m     |
     Central |   1.497862   .3087289      .8904156    2.105308
     Eastern |   3.732832   .5025177      2.744092    4.721571
    Northern |   8.104654   1.138754      5.864073    10.34523
     Western |   3.546443   .5283158      2.506944    4.585943
-------------+------------------------------------------------
spg_ent_m    |
     Central |   .4711544   .1298242      .2157161    .7265928
     Eastern |   1.238774   .2172529      .8113134    1.666235
    Northern |   3.094836   .5337637      2.044618    4.145055
     Western |   1.249639   .2366178       .784077    1.715202
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
     Central |   7.465414   1.240227      5.025179     9.90565
     Eastern |   18.30339   1.944697      14.47706    22.12972
    Northern |   29.48594   2.868099      23.84275    35.12913
     Western |   16.70276   2.070958        12.628    20.77752
-------------+------------------------------------------------
pg_ent_m     |
     Central |   1.497862   .3087289      .8904156    2.105308
     Eastern |   3.732832   .5025177      2.744092    4.721571
    Northern |   8.104654   1.138754      5.864073    10.34523
     Western |   3.546443   .5283158      2.506944    4.585943
-------------+------------------------------------------------
spg_ent_m    |
     Central |   .4711544   .1298242      .2157161    .7265928
     Eastern |   1.238774   .2172529      .8113134    1.666235
    Northern |   3.094836   .5337637      2.044618    4.145055
     Western |   1.249639   .2366178       .784077    1.715202
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: strata = central urban
    _subpop_2: strata = central rural
    _subpop_3: strata = Eastern urban
    _subpop_4: strata = Eastern rural
    _subpop_5: strata = Northern urban
    _subpop_6: strata = Northern rural
    _subpop_7: strata = Western Urban
    _subpop_8: strata = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
   _subpop_1 |   .3949241   .2837125     -.1633007    .9531489
   _subpop_2 |   11.47244   1.969776      7.596763    15.34811
   _subpop_3 |   4.500134   1.885657      .7899681      8.2103
   _subpop_4 |    19.3941   2.087186      15.28741    23.50079
   _subpop_5 |   10.83068   4.242503       2.48325    19.17811
   _subpop_6 |   32.52435   3.238256      26.15285    38.89586
   _subpop_7 |   4.350483   1.955302      .5032859    8.197679
   _subpop_8 |   17.50833   2.197115      13.18535    21.83131
-------------+------------------------------------------------
pg_ent_m     |
   _subpop_1 |   .1942915   .1629339     -.1262927    .5148758
   _subpop_2 |   2.236628   .4778657      1.296393    3.176863
   _subpop_3 |   .5360828   .3407539      -.134375    1.206541
   _subpop_4 |   3.985432   .5405959      2.921771    5.049094
   _subpop_5 |   3.367906   1.534385      .3488935    6.386918
   _subpop_6 |   8.876136   1.296284      6.325605    11.42667
   _subpop_7 |   .5025887   .3574236     -.2006681    1.205845
   _subpop_8 |   3.744954   .5593751      2.644343    4.845564
-------------+------------------------------------------------
spg_ent_m    |
   _subpop_1 |   .1115351   .1044452     -.0939683    .3170384
   _subpop_2 |   .6749598   .1944341      .2923967    1.057523
   _subpop_3 |   .0973691   .0787008     -.0574803    .2522186
   _subpop_4 |   1.328966   .2340691      .8684178    1.789513
   _subpop_5 |     1.3518   .7282591     -.0811021    2.784702
   _subpop_6 |   3.378728   .6077547      2.182927    4.574529
   _subpop_7 |   .1540516   .1396833     -.1207854    .4288885
   _subpop_8 |    1.32109     .25061      .8279969    1.814183
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       8        Number of obs    =      3119
Number of PSUs   =     321        Population size  =  28164219
                                  Design df        =       313

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
   _subpop_1 |   .3949241   .2837125     -.1633007    .9531489
   _subpop_2 |   11.47244   1.969776      7.596763    15.34811
     Eastern |   18.30339   1.944697      14.47706    22.12972
    Northern |   29.48594   2.868099      23.84275    35.12913
     Western |   16.70276   2.070958        12.628    20.77752
-------------+------------------------------------------------
pg_ent_m     |
   _subpop_1 |   .1942915   .1629339     -.1262927    .5148758
   _subpop_2 |   2.236628   .4778657      1.296393    3.176863
     Eastern |   3.732832   .5025177      2.744092    4.721571
    Northern |   8.104654   1.138754      5.864073    10.34523
     Western |   3.546443   .5283158      2.506944    4.585943
-------------+------------------------------------------------
spg_ent_m    |
   _subpop_1 |   .1115351   .1044452     -.0939683    .3170384
   _subpop_2 |   .6749598   .1944341      .2923967    1.057523
     Eastern |   1.238774   .2172529      .8113134    1.666235
    Northern |   3.094836   .5337637      2.044618    4.145055
     Western |   1.249639   .2366178       .784077    1.715202
--------------------------------------------------------------

.         drop bswt one h pg spg;

.         compress;
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
hhsize was long now byte
h_ent_m was float now byte

. label data "Final data set. Official published poverty rates are calculated from this data s
> et";
note: label truncated to 80 characters

.         sort hhid;

.         save "$path/work/povmeas_ent_flex.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povmeas_ent_flex.dta not found
> )
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povmeas_ent_flex.dta saved

. gen dum=1;

.         *output the national measures;
.         collapse  (mean) dum h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file /tmp/St02564.000005 saved

.         *output the rural/urban measures;
.         use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file /tmp/St02564.000006 saved

.         *output the North South Center measures;
.         use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file /tmp/St02564.000007 saved

.         *output the North South Center rural/urban measures;
.         use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file /tmp/St02564.000008 saved

.         *output the provincial measures;
.         use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file /tmp/St02564.000009 saved

.                 *output the dominios espaciais measures;
.         use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file /tmp/St02564.00000a saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file /tmp/St02564.00000b saved

. use          `nat';
(Final data set. Official published poverty rates are calculated from this data s)

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_ent_m pg_ent_m spg_ent_m dum rural news reg_tpi strata spdomain using "
> $path/work/poverty_ent_flexBask.csv", replace c ;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/poverty_ent_flexBask.csv not f
> ound)

.         *set aside the spatial price index;
.       tempfile spi_m;

.       use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.       collapse (mean) spi, by(reg_tpi);

.       rename spi spi_m;

.       sort reg_tpi;

. save `spi_m', replace;
(note: file /tmp/St02564.00000c not found)
file /tmp/St02564.00000c saved

. use `povlines_ent';

.        sort reg_tpi;

.        merge reg_tpi using `spi';
(label lregion already defined)

.        tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1       20.00       20.00
          3 |          4       80.00      100.00
------------+-----------------------------------
      Total |          5      100.00

.  drop _m;

.        sort reg_tpi;

.        merge reg_tpi using `spi_m';
(label lregion already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |          5      100.00      100.00
------------+-----------------------------------
      Total |          5      100.00

.  drop _m;

. save "$path/work/povlines.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines.dta saved

. outsheet reg_tpi food_povline_ent povline_ent fdshr using "$path/work/povlines.csv", replace
>  c;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//work/povlines.csv not found)

.  *********************************************************************************
> * 210_povmeas_ent_flex.do               (end)
> *********************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/210_povmeas_ent_flex.log
  log type:  text
 closed on:  10 Mar 2014, 14:55:35
----------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/220_gen_results.do"

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/220_gen_results.log", text replace
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/220_gen_results.log not found)
----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/220_gen_results.log
  log type:  text
 opened on:  10 Mar 2014, 14:55:46

. set more off

. #delimit ;
delimiter now ;
. *****************************************************************
> * 220_gen_results.do            (start)
> *
> * Do file to generate poverty and inequality results at various
> * levels of aggregation, and save the results for each 
> * bootstrap replication in a file.
> * NOTE: for some reason, -ineqdeco- doesn't generate results
> *       for GE(0), GE(1), GE(2), Gini, etc. when an "if" condition
> *               is used, so I'm using preserve/restore blocks for
> *               sub-groups instead.
> *               Also, saving results presented a few wrinkles, but
> *               doing it via matrices works.
> *****************************************************************;
. /*
>         This file uses:
>                 work/povmeas_ent_flex.dta (the bootstrapped version)
>                 out/bs_results.dta
>         
>         This file creates:
>                 out/bs_results.dta (updated)    
> */
> 
> 
> 
> 
> * Housecleaning;
. cap mat drop rep nat rur urb full;

. * Save the poverty lines in data file created for that purpose,;
. * and store in a matrix, for saving to a data file later.;
. use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         foreach reg of numlist 1/13 {;
  2.                 qui sum linpob if spdomain==`reg';
  3.                 global linpob`reg'=r(mean);
  4.         };

.         mat input rep=(0);

.         mat input linpob=($linpob1 $linpob2 $linpob3 $linpob4 $linpob5 $linpob6 
>                 $linpob7 $linpob8 $linpob9 $linpob10 $linpob11 $linpob12 $linpob13);

.         mat linpob = rep, linpob;

.         mat colnames linpob = rep linpob1 linpob2 linpob3 linpob4 linpob5 linpob6 
>                 linpob7 linpob8 linpob9 linpob10 linpob11 linpob12 linpob13;

.         #delimit cr
delimiter now cr
. 
.         * Change poverty measures from percentage to index terms;
.         gen h   = h_ent_   /100

.         gen pg  = pg_ent_m /100
(4 missing values generated)

.         gen spg = spg_ent_m/100
(4 missing values generated)

. 
.         * National figures;
.         sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |    3119  28164219.1    .1636014   .3699728          0          1

.         glob p0_nat=r(mean)

.         sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |    3119  28164219.1    .0372327   .1085248          0   .7108805

.         glob p1_nat=r(mean)

.         sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |    3119  28164219.1    .0131601   .0494596          0    .505351

.         glob p2_nat=r(mean)

.         ineqdeco cr2 [aw=hhweight*hhsize]
(4 missing values generated)
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
  5.508    2.629    0.477    2.353    1.562    0.664
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
        0 |                                                           
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.13060     0.23063     0.37389
----------------------------------------------

.         glob gini_nat=$S_gini

.         glob ge0_nat =$S_i0

.         glob ge1_nat =$S_i1

.         glob ge2_nat =$S_i2

.         mat input nat=($p0_nat $p1_nat $p2_nat $gini_nat $ge0_nat $ge1_nat $ge2_nat)

. 
.         * Rural figures;
.         preserve

.                 keep if rural==1
(864 observations deleted)

.                 sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |    2259    23301450    .1922257   .3941367          0          1

.                 glob p0_rur=r(mean)

.                 sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |    2259    23301450    .0435443   .1158432          0   .6578453

.                 glob p1_rur=r(mean)

.                 sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |    2259    23301450    .0153098    .052505          0   .4327604

.                 glob p2_rur=r(mean)

.                 ineqdeco cr2 [aw=hhweight*hhsize]
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
  4.224    2.143    0.507    2.169    1.489    0.686
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
        0 |                                                           
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.09799     0.17728     0.30142
----------------------------------------------

.                 glob gini_rur=$S_gini

.                 glob ge0_rur =$S_i0

.                 glob ge1_rur =$S_i1

.                 glob ge2_rur =$S_i2

.         restore

.         mat input rur=($p0_rur $p1_rur $p2_rur $gini_rur $ge0_rur $ge1_rur $ge2_rur)

. 
.         * Urban figures;
.         preserve

.                 keep if rural==0
(2263 observations deleted)

.                 sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |     860  4862769.14    .0264393   .1605312          0          1

.                 glob p0_urb=r(mean)

.                 sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |     860  4862769.14     .006989   .0530444          0   .7108805

.                 glob p1_urb=r(mean)

.                 sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |     860  4862769.14    .0028593   .0288498          0    .505351

.                 glob p2_urb=r(mean)

.                 ineqdeco cr2 [aw=hhweight*hhsize]
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
  5.918    2.471    0.418    2.840    1.722    0.606
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
        0 |                                                           
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.12136     0.22492     0.39471
----------------------------------------------

.                 glob gini_urb=$S_gini

.                 glob ge0_urb =$S_i0

.                 glob ge1_urb =$S_i1

.                 glob ge2_urb =$S_i2

.         restore

.         mat input urb=($p0_urb $p1_urb $p2_urb $gini_urb $ge0_urb $ge1_urb $ge2_urb)

. 
.         * Assemble the matrix pieces and save this set of estimates in the data file;
.                 #delimit;
delimiter now ;
.                 mat full= rep, nat, rur, urb;

.                 mat colnames full = rep 
>                                         p0_nat  p1_nat  p2_nat  gini_nat  ge0_nat  ge1_nat  
>     ge2_nat
>                                         p0_rur  p1_rur  p2_rur  gini_rur  ge0_rur  ge1_rur  
>     ge2_rur
>                                         p0_urb  p1_urb  p2_urb  gini_urb  ge0_urb  ge1_urb  
>     ge2_urb;

.         #delimit cr
delimiter now cr
.         mat list full

full[1,22]
          rep     p0_nat     p1_nat     p2_nat   gini_nat    ge0_nat    ge1_nat    ge2_nat
r1          0  .16360139  .03723273  .01316012          .          .          .          .

       p0_rur     p1_rur     p2_rur   gini_rur    ge0_rur    ge1_rur    ge2_rur     p0_urb
r1  .19222568  .04354427   .0153098          .          .          .          .  .02643933

       p1_urb     p2_urb   gini_urb    ge0_urb    ge1_urb    ge2_urb
r1  .00698904  .00285929          .          .          .          .

. 
. 
. drop _all

. 
. svmat full , names(col)
number of observations will be reset to 1
Press any key to continue, or Break to abort
obs was 0, now 1

.         tempfile rep

.         compress
rep was float now byte
gini_nat was float now byte
ge0_nat was float now byte
ge1_nat was float now byte
ge2_nat was float now byte
gini_rur was float now byte
ge0_rur was float now byte
ge1_rur was float now byte
ge2_rur was float now byte
gini_urb was float now byte
ge0_urb was float now byte
ge1_urb was float now byte
ge2_urb was float now byte

. 
. 
. 
. 
. 
. *****************************************************************
. * 220_gen_results.do            (end)
. *****************************************************************;
. 
. log close
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2005_06//rep/220_gen_results.log
  log type:  text
 closed on:  10 Mar 2014, 14:55:46
----------------------------------------------------------------------------------------------

. 
end of do-file

