-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\ww-ug\10_MZ/rep/120_povline
> _food_flex.log
  log type:  text
 opened on:  24 May 2013, 11:01:29

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information.
> **************************************************************************;
. /*
> This file uses:
>         work\food_basket_flex.dta
>         work\price_unit_flex.dta
>         work\calperg.dta
>         work\calpp.dta
> 
> This file creates:
>         work\povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path\work\price_unit_flex.dta";
product was long now double
(label reg13 already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        344       47.45       47.45
          3 |        381       52.55      100.00
------------+-----------------------------------
      Total |        725      100.00

.         list product spdomain descript if _merge==1;

.         drop if _merge ~=3;
(344 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path\work\calperg.dta";
variable product does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          2        0.27        0.27
          2 |        355       48.23       48.51
          3 |        379       51.49      100.00
------------+-----------------------------------
      Total |        736      100.00

.         * This tells where we are lacking calorie info or are lacking quantity info due t
> o 
>         * missing price info above;
.         list product spdomain descript if _merge==1;

     +----------------------------------------------------------+
     | product                  spdomain               descript |
     |----------------------------------------------------------|
373. |  113791   Sofala & Zambezia-rural   "Caracol, caramucho" |
381. |  119291      Manica & Tete-urbana                   Soda |
     +----------------------------------------------------------+

.         drop if _merge~=3;
(357 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price observations;
.         by spdomain: count if round(bswt)<10;

-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-rur
    1
-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-urb
    3
-------------------------------------------------------------------------------------------
-> spdomain = Nampula-rural
    0
-------------------------------------------------------------------------------------------
-> spdomain = Nampula-urban
    1
-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-urban
    0
-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-rural
    2
-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-urbana
    2
-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-urban
    1
-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-rural
    4
-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-urban
    0
-------------------------------------------------------------------------------------------
-> spdomain = Maputo City
    0

.         drop if round(bswt) < 10;
(16 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(26 observations deleted)

.         * reobtain the share represented from the average basket- should be slightly more
>  than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-rur

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        30    .9032872           0   .9032872   .9032872

-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-urb

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        26    .9032109           0   .9032109   .9032109

-------------------------------------------------------------------------------------------
-> spdomain = Nampula-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        29    .9021769           0   .9021769   .9021769

-------------------------------------------------------------------------------------------
-> spdomain = Nampula-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        28    .9035017           0   .9035017   .9035017

-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .9003816           0   .9003816   .9003816

-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        25    .9033801           0   .9033801   .9033801

-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .8956223           0   .8956223   .8956223

-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-urbana

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        25    .8514768           0   .8514768   .8514768

-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        28    .9067275           0   .9067275   .9067275

-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        28    .9010898           0   .9010898   .9010898

-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        20    .8582838           0   .8582838   .8582838

-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        23    .9109277           0   .9109277   .9109277

-------------------------------------------------------------------------------------------
-> spdomain = Maputo City

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        21     .901933           0    .901933    .901933


.         * obtain quantities and calories provided by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path\work\calpp.dta";
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        337      100.00      100.00
------------+-----------------------------------
      Total |        337      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie requirements;
.         gen ratio=.95*calpp/calreg;

.                         replace quan=quan*ratio;
(337 real changes made)

.         replace cal_ir=quan*calperg;
(336 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(337 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-rur

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        30    .0000257           0   .0000257   .0000257

-------------------------------------------------------------------------------------------
-> spdomain = Niassa & Cabo Delg.-urb

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        26   -.0000899           0  -.0000899  -.0000899

-------------------------------------------------------------------------------------------
-> spdomain = Nampula-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        29    .0000257           0   .0000257   .0000257

-------------------------------------------------------------------------------------------
-> spdomain = Nampula-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        28   -.0000514           0  -.0000514  -.0000514

-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27    .0000899           0   .0000899   .0000899

-------------------------------------------------------------------------------------------
-> spdomain = Sofala & Zambezia-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        25   -.0000771           0  -.0000771  -.0000771

-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27    .0000771           0   .0000771   .0000771

-------------------------------------------------------------------------------------------
-> spdomain = Manica & Tete-urbana

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        25    .0000128           0   .0000128   .0000128

-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        28   -.0000514           0  -.0000514  -.0000514

-------------------------------------------------------------------------------------------
-> spdomain = Gaza & Inhambane-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        28   -.0001156           0  -.0001156  -.0001156

-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        20   -.0000642           0  -.0000642  -.0000642

-------------------------------------------------------------------------------------------
-> spdomain = Maputo Province-urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        23   -.0000642           0  -.0000642  -.0000642

-------------------------------------------------------------------------------------------
-> spdomain = Maputo City

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        21    .0000257           0   .0000257   .0000257


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;

.         * the sum of the value of the goods in the bundle is assumed to represent 90% of 
> expenditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.         replace povline_f_flex=povline_f_flex90/.9;
(337 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path\work\povline_food_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\ww-ug\10_MZ\work\povline_food_flex.
> dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> **************************************************************************
> * 120_povline_food_flex.do      (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\ww-ug\10_MZ/rep/120_povline
> _food_flex.log
  log type:  text
 closed on:  24 May 2013, 11:01:29
-------------------------------------------------------------------------------------------
