---------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 70_pref_r_price.log
  log type:  text
 opened on:  20 May 2013, 12:22:27

. clear

. set more off

. #delimit ;
delimiter now ;
. *************************************************
> *************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparis
> ons so that
> * we can check the quality of the regional basket
> s.
> * It also exports the price and quantity data for
>  work in GAMS
> * Rather than make up for missing prices with sha
> res, we estimate
> * a missing price in this case
> *************************************************
> *************************;
. *global n_spdom "13";
. *global it_n "5";
. /*
> This file uses:
>         work/quan_flex_it$it_n.dta
>         work/povline_food_flex_it$it_n.dta
>         work/price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work/pref_r_price.dta
>         work/revpref_price_`i'.dta
>         work/product_flex.inc
>         work/price_unit_flex.inc
>         work/quan_flex.inc
> */
> 
> 
> 
> *************************************************
> **************************;
. * Export price, codes and quantity data to text
> *************************************************
> **************************;
. use "$path/work/price_unit_flex_it$it_n.dta";

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n usin
> g "$path/work/price_unit_flex.inc",  noquote nona
> me replace ;

. collapse (min) spdomain, by(product);

. outsheet product  using "$path/work/product_flex.
> inc", noname replace;

. use "$path/work/quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  cal
> pp povline_f_flex90_$it_n using "$path/work/quan_
> flex.inc", noname noquote replace;

. clear;

. *************************************************
> *************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> *************************************************
> *************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path/work/pref_r_price.dta", replace;
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path/work/revpref_price_`i'.dta
> ", replace;
  5.         clear;
  6.                 use "$path/work/quan_flex_it$i
> t_n.dta", clear;
  7.                 keep product spdomain quan$it_
> n price_uw$it_n val_ir$it_n povline_f_flex90_$it_
> n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90
> _$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quant
> ities to hit constant calorie target;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescale
> d to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **********************************************
> ****************************;
. * Now get the prices in other regions so that you
>  can use them 
> * to build  a new poverty line
> *************************************************
> *************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path/work/price_unit_fle
> x_it$it_n.dta";
 19.                                 keep product s
> pdomain price_uw$it_n descript count bswt;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with
>  the fact that not all commodities are consumed i
> n every region;
.                 *so we might have a quantity from
>  region i but no price in region j;
.                 *these will have _merge value=2;
.                 *alternatively the number of obse
> rvations might be too small;
.                 *deal with these problems by TAKI
> NG THE MAX PRICE OBSERVED ELSEWHERE (excluding Ma
> puto)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified t
> o handle the counting of bswt instead of count
>                   replace price_uw$it_n=. if roun
> d(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==
> 2 ;
 27.                   replace pricemiss=1 if _m==2
>  | round(bswt)<5;
 28.                         lab var pricemiss "ide
> ntify those items with no price observation";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing o
> bserved quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             so
> rt product;
 35.                                             *t
> his file contains the price codes that are missin
> g for the region in question;
.                             save `codmiss', repla
> ce;
 36. *browse;
.                                   use "$path/work
> /price_unit_flex_it$it_n.dta", clear;
 37.                         sort product;
 38. *browse;
.                         merge product using `codm
> iss';
 39.                                               
>   tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maput
> o province and city from other price calculation;
.                                 drop if spdomain>
> 10;
 42.                         collapse (max) price_u
> w$it_n, by(product);
 43.                   *this file contains the code
>  and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product us
> ing `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                               
>               else use `getmiss', clear;
 50.                         gen val_q=quan_s*price
> _uw$it_n;
 51.                                               
>   collapse (sum) val_q pricemiss (mean) spdomainq
>  ratquan, by(spdomain);
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path/wo
> rk/revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path/work/revpref_price
> _`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path/work/pref_r_price.dta
> ";
 59.       sort spdomain spdomainq;
 60.       save "$path/work/pref_r_price.dta", repl
> ace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
(103 observations deleted)
(note: file /tmp/St02502.000008 not found)
file /tmp/St02502.000008 saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
(note: file /tmp/St02502.000009 not found)
file /tmp/St02502.000009 saved
(27 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(1 real change made)
(1 real change made)
file /tmp/St02502.000009 saved
(26 observations deleted)
(note: file /tmp/St02502.00000a not found)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        224       98.68       98.68
          3 |          3        1.32      100.00
------------+-----------------------------------
      Total |        227      100.00
(224 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(18 observations deleted)
(2 real changes made)
(7 real changes made)
file /tmp/St02502.000009 saved
(20 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        195       85.90       85.90
          3 |         32       14.10      100.00
------------+-----------------------------------
      Total |        227      100.00
(195 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       74.07       74.07
          3 |          7       25.93      100.00
------------+-----------------------------------
      Total |         27      100.00
(2 missing values generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_1.dta saved
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(98 observations deleted)
file /tmp/St02502.000008 saved
(180 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02502.000009 saved
(31 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        224       98.68       98.68
          3 |          3        1.32      100.00
------------+-----------------------------------
      Total |        227      100.00
(224 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         31       96.88       96.88
          3 |          1        3.12      100.00
------------+-----------------------------------
      Total |         32      100.00
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(32 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(14 observations deleted)
(3 real changes made)
(5 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       91.63       91.63
          3 |         19        8.37      100.00
------------+-----------------------------------
      Total |        227      100.00
(208 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         27       84.38       84.38
          3 |          5       15.62      100.00
------------+-----------------------------------
      Total |         32      100.00
(3 missing values generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(4 real changes made)
(12 real changes made)
file /tmp/St02502.000009 saved
(20 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        174       76.65       76.65
          3 |         53       23.35      100.00
------------+-----------------------------------
      Total |        227      100.00
(174 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       62.50       62.50
          3 |         12       37.50      100.00
------------+-----------------------------------
      Total |         32      100.00
(4 missing values generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02502.000009 saved
(31 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        224       98.68       98.68
          3 |          3        1.32      100.00
------------+-----------------------------------
      Total |        227      100.00
(224 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         31       96.88       96.88
          3 |          1        3.12      100.00
------------+-----------------------------------
      Total |         32      100.00
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_2.dta saved
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(107 observations deleted)
file /tmp/St02502.000008 saved
(180 observations deleted)
(label spdomain_original already defined)
(24 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02502.000009 saved
(22 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        222       97.80       97.80
          3 |          5        2.20      100.00
------------+-----------------------------------
      Total |        227      100.00
(222 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       95.65       95.65
          3 |          1        4.35      100.00
------------+-----------------------------------
      Total |         23      100.00
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(24 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(23 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(23 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02502.000009 saved
(21 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        217       95.59       95.59
          3 |         10        4.41      100.00
------------+-----------------------------------
      Total |        227      100.00
(217 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(24 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(23 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_3.dta saved
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(109 observations deleted)
file /tmp/St02502.000008 saved
(180 observations deleted)
(label spdomain_original already defined)
(26 observations deleted)
(0 real changes made)
(3 real changes made)
file /tmp/St02502.000009 saved
(18 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        213       93.83       93.83
          3 |         14        6.17      100.00
------------+-----------------------------------
      Total |        227      100.00
(213 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       85.71       85.71
          3 |          3       14.29      100.00
------------+-----------------------------------
      Total |         21      100.00
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(26 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02502.000009 saved
(20 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        222       97.80       97.80
          3 |          5        2.20      100.00
------------+-----------------------------------
      Total |        227      100.00
(222 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       95.24       95.24
          3 |          1        4.76      100.00
------------+-----------------------------------
      Total |         21      100.00
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(23 observations deleted)
(1 real change made)
(3 real changes made)
file /tmp/St02502.000009 saved
(18 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        213       93.83       93.83
          3 |         14        6.17      100.00
------------+-----------------------------------
      Total |        227      100.00
(213 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       85.71       85.71
          3 |          3       14.29      100.00
------------+-----------------------------------
      Total |         21      100.00
(1 missing value generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(22 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(21 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(26 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02502.000009 saved
(20 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        222       97.80       97.80
          3 |          5        2.20      100.00
------------+-----------------------------------
      Total |        227      100.00
(222 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       95.24       95.24
          3 |          1        4.76      100.00
------------+-----------------------------------
      Total |         21      100.00
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_4.dta saved
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved
(note: dataset contains 0 observations)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(103 observations deleted)
file /tmp/St02502.000008 saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(1 real change made)
(2 real changes made)
file /tmp/St02502.000009 saved
(25 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        219       96.48       96.48
          3 |          8        3.52      100.00
------------+-----------------------------------
      Total |        227      100.00
(219 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25       92.59       92.59
          3 |          2        7.41      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(184 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(1 real change made)
(8 real changes made)
file /tmp/St02502.000009 saved
(19 observations deleted)
file /tmp/St02502.00000a saved
variable product does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        189       83.26       83.26
          3 |         38       16.74      100.00
------------+-----------------------------------
      Total |        227      100.00
(189 observations deleted)
(0 observations deleted)
file /tmp/St02502.00000a saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         19       70.37       70.37
          3 |          8       29.63      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(180 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02502.000009 saved
(27 observations deleted)
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/revpref_
> price_5.dta saved
(label spdomain_original already defined)
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved

. *bring in actual flexible bundle numbers;
. use "$path/work/povline_food_flex_it$it_n.dta", c
> lear;

.         merge spdomain using "$path/work/pref_r_p
> rice.dta";
variable spdomain does not uniquely identify
    observations in
    /home/bjvca/data/data/GAP/Haruna/work/pref_r_
    > price.dta
(label spdomain_original already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

.          drop crap;

.         drop _m;

.         order spdomainq spdomain;

.       sort spdomainq spdomain;

.         *rescale expenditures to hit a constant c
> alorie target;
.         gen povline_f5_s=ratquan*povline_f_flex90
> _$it_n;

.       compress;
spdomainq was float now byte
spdomain was float now byte
pricemiss was double now byte

. *browse;
.         *categorize revealed preference performan
> ce;
.       gen pref_r=0;

.       replace pref_r=1 if float(linf_q)>float(pov
> line_f5_s);
(13 real changes made)

.       replace pref_r=2 if float(linf_q)<float(pov
> line_f5_s);
(7 real changes made)

.       lab var pref_r "Fails or passes revealed pr
> eference test";

.       lab def pref_r
>                         0 "comparison of the same
>  region with itself"
>                         1 "passes revealed prefer
> ence test"
>                         2 "fails revealed prefere
> nce test" ;

.         lab val pref_r pref_r;

.       drop if spdomainq==spdomain;
(5 observations deleted)

.         tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |         1
> 3       65.00       65.00
         fails revealed preference test |          
> 7       35.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |         2
> 0      100.00

.              sort spdomainq ;

.       by spdomainq: tab pref_r;

---------------------------------------------------
-> spdomainq = 1

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 2       50.00       50.00
         fails revealed preference test |          
> 2       50.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |          
> 4      100.00

---------------------------------------------------
-> spdomainq = 2

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 4      100.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |          
> 4      100.00

---------------------------------------------------
-> spdomainq = 3

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 1       25.00       25.00
         fails revealed preference test |          
> 3       75.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |          
> 4      100.00

---------------------------------------------------
-> spdomainq = 4

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 3       75.00       75.00
         fails revealed preference test |          
> 1       25.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |          
> 4      100.00

---------------------------------------------------
-> spdomainq = 5

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 3       75.00       75.00
         fails revealed preference test |          
> 1       25.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |          
> 4      100.00


. save "$path/work/pref_r_price.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/work/pref_r_p
> rice.dta saved

. *drop comparisons with Maputo ;
. drop if spdomain>=11;
(0 observations deleted)

. drop if spdomainq>=11;
(0 observations deleted)

. display "this is with maputo dropped";
this is with maputo dropped

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |         1
> 3       65.00       65.00
         fails revealed preference test |          
> 7       35.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |         2
> 0      100.00

. *further drop Nampula rural and urban;
. drop if spdomain==3 | spdomain==4;
(8 observations deleted)

. display "this is with maputo and nampula dropped 
> (MAH: Actually not - experimenting with 6 spatial
>  domains)";
this is with maputo and nampula dropped (MAH: Actua
> lly not - experimenting with 6 spatial domains)

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq
> .     Percent        Cum.
----------------------------------------+----------
> -------------------------
        passes revealed preference test |          
> 6       50.00       50.00
         fails revealed preference test |          
> 6       50.00      100.00
----------------------------------------+----------
> -------------------------
                                  Total |         1
> 2      100.00

. *************************************************
> *************************
> * 170_pref_r_price.do           (end)
> *************************************************
> *************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 70_pref_r_price.log
  log type:  text
 closed on:  20 May 2013, 12:22:27
---------------------------------------------------
