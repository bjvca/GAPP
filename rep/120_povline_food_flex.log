---------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 20_povline_food_flex.log
  log type:  text
 opened on:  20 May 2013, 12:16:30

. clear

. set more off

. #delimit ;
delimiter now ;
. *************************************************
> *************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_
> flex), which is in shares. 
> * Then merge it with the prices file, and then wi
> th the calories file.
> * Along the way, drop those observations where we
>  have no price information
> * or no calorie information.
> *************************************************
> *************************;
. /*
> This file uses:
>         work/food_basket_flex.dta
>         work/price_unit_flex.dta
>         work/calperg.dta
>         work/calpp.dta
> 
> This file creates:
>         work/povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path/work/
> price_unit_flex.dta";
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         71       34.13       34.13
          3 |        137       65.87      100.00
------------+-----------------------------------
      Total |        208      100.00

.         list product spdomain descript if _merge=
> =1;

.         drop if _merge ~=3;
(71 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gr
> am;
.         merge product using "$path/work/calperg.d
> ta";
variable product does not uniquely identify
    observations in the master data
(note: descript is str26 in using data but will be 
> float now)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         20       12.74       12.74
          3 |        137       87.26      100.00
------------+-----------------------------------
      Total |        157      100.00

.         * This tells where we are lacking calorie
>  info or are lacking quantity info due to 
>         * missing price info above;
.         list product spdomain descript if _merge=
> =1;

.         drop if _merge~=3;
(20 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap
>  counting;
.         * determine if any quantity has fewer tha
> n 10 price observations;
.         by spdomain: count if round(bswt)<10;

---------------------------------------------------
-> spdomain = Central rural
    0
---------------------------------------------------
-> spdomain = Central urban
    1
---------------------------------------------------
-> spdomain = Eastern
    0
---------------------------------------------------
-> spdomain = Northern
    1
---------------------------------------------------
-> spdomain = Western
    0

.         drop if round(bswt) < 10;
(2 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut bac
> k to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(12 observations deleted)

.         * reobtain the share represented from the
>  average basket- should be slightly more than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

---------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
     baskshr |        24     .901623           0   
>  .901623    .901623

---------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
     baskshr |        21    .9074457           0   
> .9074457   .9074457

---------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
     baskshr |        26      .90792           0   
>   .90792     .90792

---------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
     baskshr |        26    .9066816           0   
> .9066816   .9066816

---------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
     baskshr |        26    .9009271           0   
> .9009271   .9009271


.         * obtain quantities and calories provided
>  by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp
>  on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal i
> n 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food baske
> t*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path/work/calpp.dt
> a";
variable spdomain does not uniquely identify
    observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        123      100.00      100.00
------------+-----------------------------------
      Total |        123      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of 
> calorie requirements;
.         gen ratio=.95*calpp/calreg;

.                         replace quan=quan*ratio;
(123 real changes made)

.         replace cal_ir=quan*calperg;
(116 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(123 real changes made)

.                         * these values should be 
> about zero;
.         by spdomain: sum chkcal;

---------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
      chkcal |        24   -.0000771           0  -
> .0000771  -.0000771

---------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
      chkcal |        21   -.0000128           0  -
> .0000128  -.0000128

---------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
      chkcal |        26   -.0000899           0  -
> .0000899  -.0000899

---------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
      chkcal |        26    .0001413           0   
> .0001413   .0001413

---------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.  
>      Min        Max
-------------+-------------------------------------
> -------------------
      chkcal |        26    .0001285           0   
> .0001285   .0001285


.         * obtain the value of each good in the bu
> ndle;
.         gen val_ir=quan*price_unitw;

.         * the sum of the value of the goods in th
> e bundle is assumed to represent 90% of expenditu
> re;
.         by spdomain: egen povline_f_flex90=sum(va
> l_ir);

.         replace povline_f_flex=povline_f_flex90/.
> 9;
(123 real changes made)

.         collapse (mean) povline_f_flex, by (spdom
> ain);

.                 lab var povline_f_flex "Food pove
> rty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path/work/povline_food_flex.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/work/povline_
> food_flex.dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", rep
> lace;
> */
> 
> *************************************************
> *************************
> * 120_povline_food_flex.do      (end)
> *************************************************
> *************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 20_povline_food_flex.log
  log type:  text
 closed on:  20 May 2013, 12:16:30
---------------------------------------------------
