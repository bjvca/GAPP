-------------------------------------------------------------------------------------------
      name:  log_total
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/log_total.log
  log type:  text
 opened on:  17 May 2013, 14:57:58

. log using "$path/rep/log_total.smcl", name(log_tot_s) replace
-------------------------------------------------------------------------------------------
      name:  log_tot_s
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/log_total.smcl
  log type:  smcl
 opened on:  17 May 2013, 14:57:58

. log using "$path/rep/000_boom.log"  , name(log_000_boom) replace
-------------------------------------------------------------------------------------------
      name:  log_000_boom
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/000_boom.log
  log type:  text
 opened on:  17 May 2013, 14:57:58

. 
. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. display ""


. display "Generel information:"
Generel information:

. display "   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10"
   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10

. display "   Poverty rate estimation"
   Poverty rate estimation

. display "   Methodology: Iterative procedure and revealed preferences tests"
   Methodology: Iterative procedure and revealed preferences tests

. display ""


. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. 
. 
. **************************************************************************
. * 000_boom.do   (start)
. *
. * Reminders:
. *       1) Check very top of this file to make sure you are on the right path! 
. *       2) GAMS 22.5 must be placed onto the path. See 190_revpref13_m1.bat.
. *          Typically this needs to be edited.
. *   3) In case of implementing a new survey the user must make necessary
. *      changes in 010_initial.do, 020_hhdata.do and 030_rawdata.do.
. *
. * Process:
. * - The do-file prefix indicates first time a do-file is called
. *
. * KS, 2003
. * CA, 2003-2008
. * MAH, Apr. 2010
. **************************************************************************
. 
. clear all

. set more off

. set mem 700m

. 
. noisily display "Start time: " "$S_TIME"
Start time: 14:57:58

. 
. 
. 
. **************************************************************************
. * Macros. Region definitions. Demographic definitions.
. **************************************************************************
. do "$path/new/010_initial.do"

. cap log close

. log using "$path/rep/010_initial.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/010_initial.log
  log type:  text
 opened on:  17 May 2013, 14:57:58

. clear

. set more off

. #delimit ;
delimiter now ;
. ******************************************************************************
> * 010_initial.do                (start)
> ******************************************************************************;
. ******************************************************************************
> * Purpose: Set some globals
> ******************************************************************************;
. ******************************************************************************
> * TPI basket
> ******************************************************************************;
. * Number of items;
. global product_tpi_n "15";

. * Code choose $product_tpi_n ;
. global product_tpi   "product_tpi==1";

. * Initial (arbitrary) quantile defining poor for price index calculations.
> * Mozambique: bottom 60%. Vietnam: bottom 20%. Tanzania: bottom 40% . Uganda: headcount 2
> 009 24.5% ;
. global tpi_bottom "50";

.  * Set the number of regions in the TPI calc for Uganda are set to east central north and
>  east;
. global n_tpi "4";

. * To reproduce the mozambique 10 numbers, the following global should be commented out. I
> t controls a line in 140_iterate.do 
> * where observations not measured in kg are dropped. For all other datasets, all observat
> ions should be converted to kg's before
> * the toolkit is run. For all other datasets, this line should therefore be included.
> global MZ "*";
. ******************************************************************************
> * Initial (arbitrary) quantile defining the (relatively) poor.
> ******************************************************************************;
. global bottom "50";

. ******************************************************************************
> * Number of iterations in 140_iterate.do
> ******************************************************************************;
. global it_n "5";

. ******************************************************************************
> * Set the number of regions in the spatial domain;
. ******************************************************************************;
. global n_spdom "5";

. ******************* we deleted East urban, North urban and West urban because too few obs
> ervations were in those spatial domains;
.  ******************************************************************************
> * Revealed preferences choices
> ******************************************************************************;
. * Activate GAMS program according to number of regions in spatial domain;
. *global revpref "190_revpref13_m1.bat";
. *global no_temp_rev " ";
. * k spatial regions and no intertemporal revealed preference condition:
>   Activate the next two lines below;
. global no_temp_rev "*";

. global revpref "190_revpref13_r.bat";

.  **************************************************************************
> * 010_initial.do                (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/010_initial.log
  log type:  text
 closed on:  17 May 2013, 14:57:58
-------------------------------------------------------------------------------------------

. 
end of do-file

. 
. *do "C:\user\gapp\z_data_preb/new/100_collect_expen_moz.do"
. *s;
. 
. *do "C:\user\gapp\z_data_preb/new/000_boom.do"
. 
. *global path "C:\user\gapp"
. 
. /*
> 
> **************************************************************************;
> **************************************************************************;
> * This is the block of do files to set up the data to get nominal
> * consumption. These DO NOT need to be bootstrapped.
> **************************************************************************;
> **************************************************************************;
>         
>         * This code produces some once for all data for the in-folder. Don't
>         * run it unless you know what you are doing!!!
>                 * Produces education expenditure
>                 *do "$path\new\Create/education_Create.do"
>                 * Imputation of missing recepts-in-kind. Run the code without this first.
> ..
>                 *do "$path\new\Create/0_code_chain.do"
>                 * First poverty lines dependent on IAF
>                 *do "$path\new\Create/povlines_first_iof_Create.do"
>                 * Match product codes for different surveys
>                 *do "$path\new\Create/match96_02_Create.do"
>                 * Basket from previous survey
>                 *do "$path\new\Create/smallbasket_iof_Create.do"
>                 * Match product codes between surveys
>                 *do "$path\new\Create/rev_pref_matchcodes_02-96_iof_Create.do"
>                 * Update poverty lines
>                 *do "$path\new\Create/povlines-96-v1-vers7_iof_Create.do"               
>                 * Food share
>                 *do "$path\new\Create/foodshr96_iof_Create.do"
>                 
>                 *do "$path\new\Create/.do"
>                 *do "$path\new\Create/.do"
> 
> */
.         * This set of files takes the raw data and creates more handy data 
.         * sets in the work-folder
.         do "$path/new/020_in_2_work_folder.do"

. clear all

. global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"

. set mem 999m

. 
. cap log close

. log using "$path/rep/020_hhdata.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/020_hhdata.log
  log type:  text
 opened on:  17 May 2013, 14:57:58

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 020_hhdata.do         (start)
> *
> * Organize the hhid identifier in the HHData file the same way, and keep
> * only the relevant variables.
> *
> * This file sets:
> * - interview month, quarter and year
> * - regions: make all needed regions. But in the end only the one specified
> *            in initial.do are kept. These are
> *            - rural: 0=urban, 1=rural
> *            - news: speficifying North, East, West, South. But combinations
> *                    are also possible, eg. North-East, Center,...
> *            - reg_tpi: regions with own TPI
> *            - strata: strata regions
> *            - spdomain: spatial domains (regions with own poverty line)
> *            - news_ru_ur: combination of news and rural
> **************************************************************************;
. use "$path\in\hhdata.dta", clear;

. *recode spdomain 10=1 11=2 20=3 30=4 40=5 these have been set to five for Uganda to ensur
> e hwe have at least 1000 households per domain;
. tab spdomain, missing;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |      1,177       17.37       17.37
Central urban |        809       11.94       29.31
      Eastern |      1,406       20.75       50.07
     Northern |      1,956       28.87       78.94
      Western |      1,427       21.06      100.00
--------------+-----------------------------------
        Total |      6,775      100.00

.         sort hhid;

.         save "$path\work\hhdata.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\hhdata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
      strata |      6775    5.551734    2.873672          1         10
        mult |      6775    919.0598    636.8381   26.67222   10279.15
      region |      6775    2.416827    1.118389          1          4
       urban |      6775    .1800738    .3842773          0          1
-------------+--------------------------------------------------------
    district |      6775    250.5169    112.9571        101        419
       rmult |      6775    919.0713    636.8355         27      10279
      hhsize |      6775        4.96     2.75857          1         24
     welfare |      6775    73089.98    95260.67   2034.431    1932420
    hhweight |      6775    4533.332    4304.242         54      92511
-------------+--------------------------------------------------------
      poor09 |      6775      .23631    .4248461          0          1
         day |      6775    14.08576    7.581748          1         31
       month |      6775    6.686199    3.405931          1         12
        Year |      6775    2009.336    .4722506       2009       2010
       h1bq8 |      6775    1.005018    .0706683          1          2
-------------+--------------------------------------------------------
         psu |      6775     365.894     201.698          1        712
    survquar |      6775    2.499336    1.144024          1          4
     survmon |      6775    6.713948     3.34507          1         12
       rural |      6775    .8199262    .3842773          0          1
        news |      6775    2.416827    1.118389          1          4
-------------+--------------------------------------------------------
        bswt |      6775           1           0          1          1
    spdomain |      6775      3.2431    1.373578          1          5
     reg_tpi |      6775    2.416827    1.118389          1          4

. use "$path\in\indata.dta", clear;

.         *sort hhid;
.         save "$path\work\indata.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\indata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98

. use "$path\in\calperg.dta", clear;

.         *sort hhid;
.         save "$path\work\calperg.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\calperg.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
    descript |         0
     calperg |        62    1.980716    2.136812          0       8.84

. use "$path\in\cons_cod.dta", clear;

.         *sort hhid;
.         save "$path\work\cons_cod.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\cons_cod.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    food_cat |    412045    1.782558    .4125064          1          2
    prod_cat |    412045    1.782558    .4125064          1          2
    descript |    412045    1.782558    .4125064          1          2
-------------+--------------------------------------------------------
   quantityd |    412045    .1694884    1.512903          0   364.2857
 cod_hh_nom3 |    412045    83.35781    341.2477          0      18500
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
 cod_hh_nom2 |    412045    1602.658    615777.4          0   3.95e+08

. use "$path\in\cons_cod_trans.dta", clear;

.         *sort hhid;
.         save "$path\work\cons_cod_trans.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\cons_cod_trans.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     89596    2.45e+09    1.13e+09   1.01e+09   4.19e+09
     product |     89596    131.0155     15.7293        100        161
        unit |     89596           1           0          1          1
    food_cat |     89596           1           0          1          1
   quantityz |     89596     .779464    3.170331          0   364.2857
-------------+--------------------------------------------------------
      valuez |     89596     383.356    648.4919          0      18500

. /*
> use "$path\in\cons_cod_trans.dta", clear;
>         *sort hhid;
>         sum;
> for var value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3: replace X=0 if X==.;
> collapse food_cat prod_cat (sum) value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3, by(h
> hid product descript);
>         save "$path\work\cons_cod.dta", replace;
>         sum;
> */
>  
> **************************************************************************
> * 020_hhdata.do         (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.         
. /*
>         * All kind of raw expenditure is handled: daily, own and monthly, rent and use va
> lue, education etc.
>         do "$path/new/030_rawdata.do"
> 
>         * Data set specific changes to each processed raw data set takes place here
>         do "$path/new/040_specifities.do"
> 
>         * These files summarizes and checks the data. But no temporal deflation done here
>  yet
>         do "$path/new/050_consump_nom.do"
> 
>         * Bring in data on food product's calories per gram
>         do "$path/new/060_calperg.do"
> */
. **********************************************************************;
. **********************************************************************;
. 
.                                 do "$path/new/070_calpp.do"                             /
> * Calories per person in spatial domains*/

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path\rep\070_calpp.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\070_calpp.log
  log type:  text
 opened on:  17 May 2013, 14:57:58

. clear

. set more off

. #delimit ;
delimiter now ;
. *global fert_rate "fert_rate";
. ***********************************************************************
> * 070_calpp.do          (start)
> *
> * Purpose: Determine calories required for each person per domain per day.
> ***********************************************************************;
. /*
> This file uses:
>         work\indata.dta
>         work\hhdata.dta
> 
> This file creates:
>         work\calpp.dta
> */
> 
> *-------------------------------------------------------------------------*
> * Include fertility rates from csv-file
> *-------------------------------------------------------------------------*;
. clear;

. insheet sex rural age fert_rate using "$path/in/fert_rate_mozambique.csv";
(4 vars, 96 obs)

. ***************************************** check for Ugandan fertility rates *************
> ************************
> *****************************************************************************************
> ********************;
. sort sex rural age;

. tempfile fert_rate;

. save `fert_rate';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. list;

     +------------------------------+
     | sex   rural   age   fert_r~e |
     |------------------------------|
  1. |   2       0    12       .003 |
  2. |   2       0    13       .003 |
  3. |   2       0    14       .093 |
  4. |   2       0    15       .093 |
  5. |   2       0    16       .093 |
     |------------------------------|
  6. |   2       0    17       .093 |
  7. |   2       0    18       .207 |
  8. |   2       0    19       .207 |
  9. |   2       0    20       .207 |
 10. |   2       0    21       .207 |
     |------------------------------|
 11. |   2       0    22       .207 |
 12. |   2       0    23       .207 |
 13. |   2       0    24       .207 |
 14. |   2       0    25       .207 |
 15. |   2       0    26       .207 |
     |------------------------------|
 16. |   2       0    27       .207 |
 17. |   2       0    28       .207 |
 18. |   2       0    29       .207 |
 19. |   2       0    30       .144 |
 20. |   2       0    31       .144 |
     |------------------------------|
 21. |   2       0    32       .144 |
 22. |   2       0    33       .144 |
 23. |   2       0    34       .144 |
 24. |   2       0    35       .144 |
 25. |   2       0    36       .144 |
     |------------------------------|
 26. |   2       0    37       .144 |
 27. |   2       0    38       .144 |
 28. |   2       0    39       .144 |
 29. |   2       0    40       .144 |
 30. |   2       0    41       .144 |
     |------------------------------|
 31. |   2       0    42       .144 |
 32. |   2       0    43       .144 |
 33. |   2       0    44       .144 |
 34. |   2       0    45       .144 |
 35. |   2       0    46       .144 |
     |------------------------------|
 36. |   2       0    47       .144 |
 37. |   2       0    48       .144 |
 38. |   2       0    49       .144 |
 39. |   2       0    50       .144 |
 40. |   2       0    51       .144 |
     |------------------------------|
 41. |   2       0    52       .144 |
 42. |   2       0    53       .144 |
 43. |   2       0    54       .144 |
 44. |   2       0    55       .144 |
 45. |   2       0    56       .144 |
     |------------------------------|
 46. |   2       0    57       .144 |
 47. |   2       0    58       .144 |
 48. |   2       0    59       .144 |
 49. |   2       1    12       .009 |
 50. |   2       1    13       .009 |
     |------------------------------|
 51. |   2       1    14        .11 |
 52. |   2       1    15        .11 |
 53. |   2       1    16        .11 |
 54. |   2       1    17        .11 |
 55. |   2       1    18        .28 |
     |------------------------------|
 56. |   2       1    19        .28 |
 57. |   2       1    20        .28 |
 58. |   2       1    21        .28 |
 59. |   2       1    22        .28 |
 60. |   2       1    23        .28 |
     |------------------------------|
 61. |   2       1    24        .28 |
 62. |   2       1    25        .28 |
 63. |   2       1    26        .28 |
 64. |   2       1    27        .28 |
 65. |   2       1    28        .28 |
     |------------------------------|
 66. |   2       1    29        .28 |
 67. |   2       1    30       .212 |
 68. |   2       1    31       .212 |
 69. |   2       1    32       .212 |
 70. |   2       1    33       .212 |
     |------------------------------|
 71. |   2       1    34       .212 |
 72. |   2       1    35       .212 |
 73. |   2       1    36       .212 |
 74. |   2       1    37       .212 |
 75. |   2       1    38       .212 |
     |------------------------------|
 76. |   2       1    39       .212 |
 77. |   2       1    40       .212 |
 78. |   2       1    41       .212 |
 79. |   2       1    42       .212 |
 80. |   2       1    43       .212 |
     |------------------------------|
 81. |   2       1    44       .212 |
 82. |   2       1    45       .212 |
 83. |   2       1    46       .212 |
 84. |   2       1    47       .212 |
 85. |   2       1    48       .212 |
     |------------------------------|
 86. |   2       1    49       .212 |
 87. |   2       1    50       .212 |
 88. |   2       1    51       .212 |
 89. |   2       1    52       .212 |
 90. |   2       1    53       .212 |
     |------------------------------|
 91. |   2       1    54       .212 |
 92. |   2       1    55       .212 |
 93. |   2       1    56       .212 |
 94. |   2       1    57       .212 |
 95. |   2       1    58       .212 |
     |------------------------------|
 96. |   2       1    59       .212 |
     +------------------------------+

. *-------------------------------------------------------------------------*
> * Now do the calorie needs for individuals
> *-------------------------------------------------------------------------*;
. use "$path\work\indata.dta";

. * CA bootstrap modification;
. sort hhid;

. merge hhid using "$path\work\hhdata.dta";
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     35,945      100.00      100.00
------------+-----------------------------------
      Total |     35,945      100.00

.  drop _m;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98
-------------+--------------------------------------------------------
      strata |     35945    5.710586    2.766681          1         10
        mult |     35945    917.2863    619.3906   26.67222   10279.15
      region |     35945    2.480234    1.085821          1          4
       urban |     35945    .1471693    .3542795          0          1
    district |     35945    257.0191    109.5067        101        419
-------------+--------------------------------------------------------
       rmult |     35945    917.2973    619.3847         27      10279
      hhsize |     35945    6.416497    2.935303          1         24
     welfare |     35945    62735.83     78270.9   2034.431    1932420
    hhweight |     35945     5917.96    5136.521         54      92511
      poor09 |     35945    .2781472    .4480925          0          1
-------------+--------------------------------------------------------
         day |     35945     14.0508    7.502636          1         31
       month |     35945     6.71398    3.387719          1         12
        Year |     35945    2009.329    .4700192       2009       2010
       h1bq8 |     35945     1.00498     .070393          1          2
         psu |     35945    377.7054    193.8014          1        712
-------------+--------------------------------------------------------
    survquar |     35945    2.484852    1.142574          1          4
     survmon |     35945    6.667353    3.350374          1         12
       rural |     35945    .8528307    .3542795          0          1
        news |     35945    2.480234    1.085821          1          4
        bswt |     35945           1           0          1          1
-------------+--------------------------------------------------------
    spdomain |     35945    3.321575    1.334996          1          5
     reg_tpi |     35945    2.480234    1.085821          1          4

. * Include fertility rates;
. sort sex rural age;

. merge sex rural age using `fert_rate';
variables sex rural age do not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98
-------------+--------------------------------------------------------
      strata |     35945    5.710586    2.766681          1         10
        mult |     35945    917.2863    619.3906   26.67222   10279.15
      region |     35945    2.480234    1.085821          1          4
       urban |     35945    .1471693    .3542795          0          1
    district |     35945    257.0191    109.5067        101        419
-------------+--------------------------------------------------------
       rmult |     35945    917.2973    619.3847         27      10279
      hhsize |     35945    6.416497    2.935303          1         24
     welfare |     35945    62735.83     78270.9   2034.431    1932420
    hhweight |     35945     5917.96    5136.521         54      92511
      poor09 |     35945    .2781472    .4480925          0          1
-------------+--------------------------------------------------------
         day |     35945     14.0508    7.502636          1         31
       month |     35945     6.71398    3.387719          1         12
        Year |     35945    2009.329    .4700192       2009       2010
       h1bq8 |     35945     1.00498     .070393          1          2
         psu |     35945    377.7054    193.8014          1        712
-------------+--------------------------------------------------------
    survquar |     35945    2.484852    1.142574          1          4
     survmon |     35945    6.667353    3.350374          1         12
       rural |     35945    .8528307    .3542795          0          1
        news |     35945    2.480234    1.085821          1          4
        bswt |     35945           1           0          1          1
-------------+--------------------------------------------------------
    spdomain |     35945    3.321575    1.334996          1          5
     reg_tpi |     35945    2.480234    1.085821          1          4
   fert_rate |      9790    .1876158    .0860403       .003        .28
      _merge |     35945    1.544721    .8903613          1          3

. * Do calorie calculations ;
.     gen num=1;

.     gen cal = .;
(35945 missing values generated)

. * Same assumptions about sex/age specific calories need in IAF 1997, IAF 2003 and IOF 200
> 9;
. * Children (no difference between boys and girls)   ;
.      replace cal =  820 if age < 1;
(1196 real changes made)

. * Add 500 cal per day for mothers in first six months of breast feeding
> * We assume that 60% of children under 1 are under six months old
> * And that all of them breast feed
> * We add these mother requirements of 300 on average to each child under 1 whose mother i
> s alive;
.     replace cal = 1120 if age <  1 & motherhh==1;
(1168 real changes made)

.     replace cal = 1150 if age >= 1 & age <2;
(2318 real changes made)

.     replace cal = 1350 if age >= 2 & age <3;
(1288 real changes made)

.     replace cal = 1550 if age >= 3 & age <5;
(2746 real changes made)

. * Males ;
.     replace cal = 1850 if age >=  5 & age <7  & sex==1;
(1272 real changes made)

.     replace cal = 2100 if age >=  7 & age <10 & sex==1;
(1776 real changes made)

.     replace cal = 2200 if age >= 10 & age <12 & sex==1;
(1048 real changes made)

.     replace cal = 2400 if age >= 12 & age <14 & sex==1;
(1122 real changes made)

.     replace cal = 2650 if age >= 14 & age <16 & sex==1;
(932 real changes made)

.     replace cal = 2850 if age >= 16 & age <18 & sex==1;
(792 real changes made)

.     replace cal = 3000 if age >= 18 & age <30 & sex==1;
(3012 real changes made)

.     replace cal = 2900 if age >= 30 & age <60 & sex==1;
(3276 real changes made)

.     replace cal = 2450 if age>=60 & age~=. & sex==1;
(669 real changes made)

. * Girls 5-12 years (probability of pregnancy assumed = 0) ;
.     replace cal = 1750 if age >=  5 & age < 7 & sex==2;
(1202 real changes made)

.     replace cal = 1800 if age >=  7 & age <10 & sex==2;
(1698 real changes made)

.     replace cal = 1950 if age >= 10 & age <12 & sex==2;
(1025 real changes made)

. * Women with a correction for pregnancy. We add 285 calories per for the final trimester.
> * To do this we find the probability that rural and urban women are pregnant from
> * live births data in the 1997 census over the past 12 months (no correction for still bi
> rths).
> * 3/4*probability of birth gives probability of preganancy. Probability of final trimeste
> r is one
> * third of that of that or 1/4 of the probability of birth
> 
> * Women urban;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==0;
(135 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==0;
(267 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==0;
(874 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==0;
(491 real changes made)

. * Women rural;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==1;
(941 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==1;
(1392 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==1;
(2824 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==1;
(2866 real changes made)

. * Women 60+ are not pregnant ;
.     replace cal = 1950 if age>=60 & age~=. & sex==2;
(783 real changes made)

.     count if cal ==.;
    0

.     *Fill in these two observations for IAF 2002/03:;
.     * 1) this one is a child;
.     *replace cal = 1500 if cal ==. & age==.;
.     * 2) this one is 21 years old;
.     *replace cal = 2500 if cal ==. & b2==.;
.     collapse (sum) cal num (max) psu hhsize hhweight strata rural spdomain, by (hhid);

.     gen chk=hhsize - num;

.     sum chk;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
         chk |      6775   -.3455351    .8928498        -11          0

.     drop chk;

.     gen calpp = cal / hhsize;

.     sort spdomain;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
         cal |      6775    11158.93    6185.119       1950   50725.15
         num |      6775    5.305535    2.940196          1         24
         psu |      6775     365.894     201.698          1        712
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
    hhweight |      6775    4533.332    4304.242         54      92511
      strata |      6775    5.551734    2.873672          1         10
       rural |      6775    .8199262    .3842773          0          1
    spdomain |      6775      3.2431    1.373578          1          5
       calpp |      6775    2347.762    704.6076   1463.317   26470.68

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
         cal |      6775    11158.93    6185.119       1950   50725.15
         num |      6775    5.305535    2.940196          1         24
         psu |      6775     365.894     201.698          1        712
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
    hhweight |      6775    4533.332    4304.242         54      92511
      strata |      6775    5.551734    2.873672          1         10
       rural |      6775    .8199262    .3842773          0          1
    spdomain |      6775      3.2431    1.373578          1          5
       calpp |      6775    2347.762    704.6076   1463.317   26470.68

.  codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           Household ID
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. collapse (mean) calpp[aw=hhsize*hhweight], by (spdomain);

. sort spdomain;

. save "$path\work\calpp.dta",replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\calpp.dta saved

. ***********************************************************************
> * 070_calpp.do          (end)
> ***********************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\070_calpp.log
  log type:  text
 closed on:  17 May 2013, 14:57:59
-------------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/080_conpc.do"                             /
> * Nominal food/non-food expenditure */

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 100m

. 
. clear

. cap log close

. log using "$path/rep/080_conpc.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/080_conpc.log
  log type:  text
 opened on:  17 May 2013, 14:57:59

. set more off

. #delimit ;
delimiter now ;
. ***************************************************************************
> * 080_conpc.do          (start)
> *
> * Creates a file with per capita nominal consumption divided between food
> * and non-food categories based on the calorie definition of food
> * rather than the COICOP (INE) definition of food. ready for 
> * temporal deflation when necessary
> ****************************************************************************;
. /*
> This file uses:
>         work\hhdata.dta
>         work\consump_nom.dta
>       
> This file creates:
>         work\conpc.dta
> */
> 
> 
> 
> ***************************************************************************
> * Food expenditure
> ****************************************************************************;
. *use "$path\in\cons_cod.dta";
. use "$path\work\cons_cod.dta";

.             *sort product;
.             *merge product using "$path\work\food_cat.dta";
.             *tab _m;
.             *drop _m;
.             keep if food_cat==1;
(322449 observations deleted)

.             collapse (sum) cod_hh_nom, by(hhid);

.             rename cod_hh_nom food_hh_nom;

.                 sort hhid;

.             keep hhid food_hh_nom;

.             tempfile foodexp;

. save `foodexp';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. ***************************************************************************
> * Food expenditure merged with all expenditure
> ****************************************************************************;
. use "$path\work\cons_cod.dta";

. *use "$path\in\cons_cod.dta";
. *use "$path\in\cons_cat.dta";
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    food_cat |    412045    1.782558    .4125064          1          2
    prod_cat |    412045    1.782558    .4125064          1          2
    descript |    412045    1.782558    .4125064          1          2
-------------+--------------------------------------------------------
   quantityd |    412045    .1694884    1.512903          0   364.2857
 cod_hh_nom3 |    412045    83.35781    341.2477          0      18500
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
 cod_hh_nom2 |    412045    1602.658    615777.4          0   3.95e+08

. collapse (sum) cod_hh_nom, by(hhid);

. *gen cons_pc_nom = cons_hh_nom/hhsize;
. rename cod_hh_nom cons_hh_nom;

. *keep  hhid cons_pc_nom cons_hh_nom ;
. *keep hhid cod_hh_nom;
. *use "$path\in\cons_cod.dta";
. *use "$path\in\consump_nom.dta";
. *use "$path\work\consump_nom.dta";
. *            keep  hhid cons_hh_nom ;
.             display _N;
6775

.             keep  hhid cons_hh_nom ;

.             sort hhid;

.             merge hhid using "$path\work\hhdata.dta";

.             tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.             drop _m;

. gen cons_pc_nom = cons_hh_nom/hhsize;

.             sort hhid;

.             merge hhid using `foodexp';

.             tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 drop if _merge==2;
(0 observations deleted)

.             replace food_hh_nom=0 if _merge==1 & food_hh_nom==.;
(0 real changes made)

.             drop _m;

.                 gen food_pc_nom=food_hh_nom/hhsize;

.                 gen nf_hh_nom=cons_hh_nom-food_hh_nom;

.             gen nf_pc_nom=nf_hh_nom/hhsize;

.              keep hhid cons_hh_nom food_pc_nom nf_pc_nom cons_pc_nom survquar spdomain ne
> ws reg_tpi rural hhweight hhsize;

.             lab var food_pc_nom "nominal food consumption per capita";

.             lab var nf_pc_nom "nominal non-food consumption per capita";

. keep hhid cons_hh_nom cons_pc_nom food_pc_nom nf_pc_nom;

.             sort hhid;

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
 cons_hh_nom |      6775    97487.28     4938495   232.1918   4.06e+08
 cons_pc_nom |      6775    20773.97    987396.4   78.55931   8.12e+07
 food_pc_nom |      6775    1257.269    1252.965          0   17857.14
   nf_pc_nom |      6775     19516.7    987342.9   23.11263   8.12e+07

.  codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                         Household Code
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. save "$path\work\conpc.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\conpc.dta saved

. ***************************************************************************
> * 080_conpc.do          (end)
> ****************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/080_conpc.log
  log type:  text
 closed on:  17 May 2013, 14:58:00
-------------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/090_temp_index.do"                /* Tempor
> al price index */

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/090_temp_index.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/090_temp_index.log
  log type:  text
 opened on:  17 May 2013, 14:58:00

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 090_temp_index.do     (start)
> **************************************************************************;
. *do "$path/new/010_initial.do";
. **************************************************************************
> * Program to compute the temporal price index (intra-survey)
> * 
> * The index is based on 6 regions (North/Center/South by rural/urban) 
> * and four quarters. For IAF 2002/03 (t=t1) it is based on the same 9
> * commodities used for the analysis of the 1996 IAF (t=t0), 
> * except that we have to go to 8 commodities because the 2002-03 survey 
> * does not distinguish between large and small groundnuts, which were 
> * separate items in the old index. For IOF 2008/09 (t=t2) we expand the
> * the food basket to include the 15 most important food products among
> * the poorest.
> *
> * The commodity weights for the items vary by the 6 regions, and are 
> * calculated from the observations in the IAF2002, using the relatively 
> * poor households (below median nominal consumption per capita).
> *
> * The unit values (prices) calculated here are also based on the prices 
> * paid by the relatively poor, using the same definition.
> *
> * K Simler, Sep 2003
> * CA
> * MAH, April 2010
> * URB, Feb 2013 (automatization to any number of n_tpi's)
> **************************************************************************;
. /*
> This file uses:
>         work\own.dta
>         work\receipts.dta
>         work\daily.dta
>         work\hhdata
>         work\cons_cat.dta
> 
> This file creates:
>         work\tpi_unit_val_quarterly.dta
>         work\tpi_unit_val_monthly.dta
>         work\tpi_news_share.dta
>         work\tpi_reg_tpi_share.dta
>         work\temp_index_news.dta
>         work\temp_index_reg_tpi.dta
> */      
> 
> 
> **************************************************************************
> * Either the products used for intertemporal price index is specified
> * explicitly, or they are automatically found as the the n_tpi products
> * with the highest weighted expenditure shares among the $bottom % poorest
> * part of the population
> **************************************************************************;
. * Generating the n_tpi most important food items for the poorest $bottom % ;
. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (start)
> **************************************************************************;
. *------------------------------------------------------------------------*
> * Population weights for each HH
> *------------------------------------------------------------------------*;
. use "$path/work\hhdata.dta", clear;

. keep hhid hhweight hhsize;

. gen popwt = hhweight*hhsize;

. lab var popwt "Population weights = hhsize X hhweight";

. sort hhid;

. tempfile popwt;

. save `popwt', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
      hhsize |      6775        4.96     2.75857          1         24
    hhweight |      6775    4533.332    4304.242         54      92511
       popwt |      6775    29614.26    44555.51         62     832599

. *------------------------------------------------------------------------*
> * Make list of all consumed products
> *------------------------------------------------------------------------*;
. *use "$path/in\cons_cod.dta", clear;
. *save "$path/work\cons_cod.dta", replace;
. use "$path/work\cons_cod.dta", clear;

. keep product descript;

. collapse product, by(descript);

. sort product;

. tempfile descript;

. save `descript', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    descript |         2         1.5    .7071068          1          2
     product |         2    565.0077    613.7578   131.0155        999

. *------------------------------------------------------------------------*
> * Find the poorest part of the population
> *------------------------------------------------------------------------*;
. use
> "$path/work\cons_cod.dta", clear;

. *use
> *"$path/work\cons_cod.dta", clear;
. ********************************************check the COICOP categories to create the var
> iable prod_cat, for the moment it is equal to food_cat******;
. keep hhid prod_cat product cod_hh_nom;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08

. merge hhid using `popwt';
variable hhid does not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
      hhsize |    412045    5.313592    2.837438          1         24
-------------+--------------------------------------------------------
    hhweight |    412045    4940.193    4557.506         54      92511
       popwt |    412045    33954.53     49935.3         62     832599
      _merge |    412045           3           0          3          3

. drop _merge;

. preserve;

. collapse (sum) cod_hh_nom (mean) popwt hhweight hhsize, by(hhid);

. gen cod_pc_nom = cod_hh_nom/hhsize;

.         sum cod_pc_nom [aw=popwt] , detail;

                         cod_pc_nom
-------------------------------------------------------------
      Percentiles      Smallest
 1%     332.3661       78.55931
 5%     680.3636       103.0936
10%     872.9067       107.7462       Obs                6775
25%     1328.983       145.4659       Sum of Wgt.   200636622

50%     2175.789                      Mean           9412.851
                        Largest       Std. Dev.        395673
75%     3972.618        1528531
90%      9057.59        1552604       Variance       1.57e+11
95%     17758.21        1790269       Skewness       202.1632
99%     88724.46       8.12e+07       Kurtosis       41456.83

.         global medcpc_= r(p$tpi_bottom);

.         gen bottom_ = cod_pc_nom <= $medcpc_;

. sum [aw=popwt];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    6775   200636622    2.52e+09   1.10e+09   1.01e+09   4.19e+09
  cod_hh_nom |    6775   200636622    67821.64    2005057   232.1918   4.06e+08
       popwt |    6775   200636622    96639.42   125478.2         62     832599
    hhweight |    6775   200636622    10417.53   10233.19         54      92511
      hhsize |    6775   200636622    7.911641   3.294698          1         24
-------------+-----------------------------------------------------------------
  cod_pc_nom |    6775   200636622    9412.851     395673   78.55931   8.12e+07
     bottom_ |    6775   200636622    .5001342   .5000369          0          1

. sum [aw=hhweight];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    6775    30713326    2.51e+09   1.12e+09   1.01e+09   4.19e+09
  cod_hh_nom |    6775    30713326    61490.01    2271154   232.1918   4.06e+08
       popwt |    6775    30713326    68053.16   97418.28         62     832599
    hhweight |    6775    30713326    8619.458   9115.422         54      92511
      hhsize |    6775    30713326    6.532559   3.001711          1         24
-------------+-----------------------------------------------------------------
  cod_pc_nom |    6775    30713326    10464.25   451493.4   78.55931   8.12e+07
     bottom_ |    6775    30713326    .4751522   .4994191          0          1

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
  cod_hh_nom |      6775    97487.28     4938495   232.1918   4.06e+08
       popwt |      6775    29614.26    44555.51         62     832599
    hhweight |      6775    4533.332    4304.242         54      92511
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
  cod_pc_nom |      6775    20773.97    987396.4   78.55931   8.12e+07
     bottom_ |      6775    .4529889    .4978218          0          1

. keep if bottom_==1;
(3706 observations deleted)

. keep hhid;

. sort hhid;

. tempfile hhid;

. save `hhid';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

. restore;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
      hhsize |    412045    5.313592    2.837438          1         24
-------------+--------------------------------------------------------
    hhweight |    412045    4940.193    4557.506         54      92511
       popwt |    412045    33954.53     49935.3         62     832599

. merge hhid using `hhid';
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    239,058       58.02       58.02
          3 |    172,987       41.98      100.00
------------+-----------------------------------
      Total |    412,045      100.00

. keep if _m==3;
(239058 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    172987    2.80e+09    9.34e+08   1.01e+09   4.19e+09
     product |    172987    827.7079     345.362        100        999
    prod_cat |    172987    1.802505    .3981098          1          2
  cod_hh_nom |    172987    123.5388    359.1169          0    10958.9
      hhsize |    172987    5.986531    2.565258          1         19
-------------+--------------------------------------------------------
    hhweight |    172987    5154.068    4379.562        100      60164
       popwt |    172987    37036.91    46121.88        100     782132
      _merge |    172987           3           0          3          3

. *------------------------------------------------------------------------*
> * Keep only food product expenditure by the poor. Calculate food product
> * share of total food expenditure by the poor
> *------------------------------------------------------------------------*;
. keep if prod_cat==1;
(138823 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     34164    2.78e+09    9.37e+08   1.01e+09   4.19e+09
     product |     34164    131.6748    15.79307        100        161
    prod_cat |     34164           1           0          1          1
  cod_hh_nom |     34164    297.0688    482.2309          0       9000
      hhsize |     34164    5.843549    2.501487          1         19
-------------+--------------------------------------------------------
    hhweight |     34164    5028.222    4166.388        100      60164
       popwt |     34164    35157.19    43014.83        100     782132
      _merge |     34164           3           0          3          3

. sort product;

. *preserve;
. collapse (sum) cod_hh_nom [aw=hhweight], by(product);

. sort cod;

. egen total=sum(cod_hh_nom);

. gen sh=100*cod_hh_nom/total;

. *------------------------------------------------------------------------*
> * Include product labels
> *------------------------------------------------------------------------*;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
  cod_hh_nom |        62    189847.5      266511   1752.996    1123210
       total |        62    1.18e+07           0   1.18e+07   1.18e+07
          sh |        62    1.612903     2.26422   .0148931   9.542551

. sort product;

. merge product using `descript';

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         62       96.88       96.88
          2 |          2        3.13      100.00
------------+-----------------------------------
      Total |         64      100.00

. keep if _merge==1 | _merge==3;
(2 observations deleted)

. drop _merge;

. sort sh;

. *list;
. list in -$product_tpi_n/-1;

     +-----------------------------------------------------+
     | product   cod_hh~m      total         sh   descript |
     |-----------------------------------------------------|
 48. |     153   222373.6   1.18e+07   1.889238          . |
 49. |     125   230312.1   1.18e+07   1.956682          . |
 50. |     123   230714.2   1.18e+07   1.960098          . |
 51. |     127   234920.9   1.18e+07   1.995837          . |
 52. |     140   251058.4   1.18e+07   2.132938          . |
     |-----------------------------------------------------|
 53. |     103   316957.7   1.18e+07   2.692804          . |
 54. |     104   335649.7   1.18e+07   2.851607          . |
 55. |     147   418515.3   1.18e+07   3.555615          . |
 56. |     117   440335.5   1.18e+07   3.740995          . |
 57. |     116   479750.5   1.18e+07   4.075856          . |
     |-----------------------------------------------------|
 58. |     107   720970.3   1.18e+07   6.125207          . |
 59. |     141   940596.5   1.18e+07   7.991104          . |
 60. |     108    1056863   1.18e+07   8.978882          . |
 61. |     105    1108255   1.18e+07   9.415496          . |
 62. |     113    1123210   1.18e+07   9.542551          . |
     +-----------------------------------------------------+

. list product descript in -$product_tpi_n/-1;

     +--------------------+
     | product   descript |
     |--------------------|
 48. |     153          . |
 49. |     125          . |
 50. |     123          . |
 51. |     127          . |
 52. |     140          . |
     |--------------------|
 53. |     103          . |
 54. |     104          . |
 55. |     147          . |
 56. |     117          . |
 57. |     116          . |
     |--------------------|
 58. |     107          . |
 59. |     141          . |
 60. |     108          . |
 61. |     105          . |
 62. |     113          . |
     +--------------------+

. *restore;
. *------------------------------------------------------------------------*
> * Keep the required number of most important food products
> *------------------------------------------------------------------------*;
. keep in -$product_tpi_n/-1;
(47 observations deleted)

. list;

     +-----------------------------------------------------+
     | product   cod_hh~m      total         sh   descript |
     |-----------------------------------------------------|
  1. |     153   222373.6   1.18e+07   1.889238          . |
  2. |     125   230312.1   1.18e+07   1.956682          . |
  3. |     123   230714.2   1.18e+07   1.960098          . |
  4. |     127   234920.9   1.18e+07   1.995837          . |
  5. |     140   251058.4   1.18e+07   2.132938          . |
     |-----------------------------------------------------|
  6. |     103   316957.7   1.18e+07   2.692804          . |
  7. |     104   335649.7   1.18e+07   2.851607          . |
  8. |     147   418515.3   1.18e+07   3.555615          . |
  9. |     117   440335.5   1.18e+07   3.740995          . |
 10. |     116   479750.5   1.18e+07   4.075856          . |
     |-----------------------------------------------------|
 11. |     107   720970.3   1.18e+07   6.125207          . |
 12. |     141   940596.5   1.18e+07   7.991104          . |
 13. |     108    1056863   1.18e+07   8.978882          . |
 14. |     105    1108255   1.18e+07   9.415496          . |
 15. |     113    1123210   1.18e+07   9.542551          . |
     +-----------------------------------------------------+

. gen product_tpi=1;

. keep product product_tpi;

. list;

     +--------------------+
     | product   produc~i |
     |--------------------|
  1. |     153          1 |
  2. |     125          1 |
  3. |     123          1 |
  4. |     127          1 |
  5. |     140          1 |
     |--------------------|
  6. |     103          1 |
  7. |     104          1 |
  8. |     147          1 |
  9. |     117          1 |
 10. |     116          1 |
     |--------------------|
 11. |     107          1 |
 12. |     141          1 |
 13. |     108          1 |
 14. |     105          1 |
 15. |     113          1 |
     +--------------------+

. sort product;

. tempfile product_tpi;

. save `product_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        15    121.9333     16.5679        103        153
 product_tpi |        15           1           0          1          1

. clear;

. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (end)
> **************************************************************************;
. **************************************************************************;
. * First, need to calculate the average prices for the food items, by 
> * strata and quarter. For this, we are using the "unit values"
> * (value/quantity) for the observations in the consumption questionnaires,
> * including daily, own and receipts-in-kind.
> *
> * The unit values are constructed as sum(value)/sum(quantity), which effectively
> * weights them by the quantity and value of the transaction. Sampling
> * weights are also used.
> *
> * Get the own consumption file, and limit analysis to the observations
> * in KGs where both value and quantity are available.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. *use "$path/work/cons_cod.dta";
. keep if prod_cat==1;
(322449 observations deleted)

. drop if quantityd==0 | quantityd==.;
(4392 observations deleted)

. *keep if quantityd!=. & cod_hh_nom2!=.;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     85204    2.44e+09    1.14e+09   1.01e+09   4.19e+09
     product |     85204    131.0922    15.78502        100        161
    food_cat |     85204           1           0          1          1
    prod_cat |     85204           1           0          1          1
    descript |     85204           1           0          1          1
-------------+--------------------------------------------------------
   quantityd |     85204     .819643    3.245947   .0000286   364.2857
 cod_hh_nom3 |     85204    403.1168    658.9792          0      18500
  cod_hh_nom |     85204    403.1168    658.9792          0      18500
 cod_hh_nom2 |     85204    403.1168    658.9792          0      18500

. sort product;

. merge product using `product_tpi';
variable product does not uniquely identify observations in the master data

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     50,968       59.82       59.82
          3 |     34,236       40.18      100.00
------------+-----------------------------------
      Total |     85,204      100.00

. drop _merge;

. keep if $product_tpi;
(50968 observations deleted)

. *        replace valued_ac=0 if valued_ac==.;
. *        replace quantityd_ac=0 if quantityd_ac==.;
.         gen valued_tot=cod_hh_nom2;

.         gen quantityd_tot=quantityd;

. *               replace quantityd_tot=0 if (valued_tot>0 & valued_tot<.) & quantityd_tot=
> =.;
.         keep if quantityd_tot!=. & valued_tot!=.;
(0 observations deleted)

.                 collapse (sum) valued_tot quantityd_tot, by(hhid product);

.                 sort hhid;

. tempfile acredd;

. save `acredd' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     34236    2.47e+09    1.13e+09   1.01e+09   4.19e+09
     product |     34236    123.5172     15.5879        103        153
  valued_tot |     34236    578.2445    711.6146   7.142857      12000
quantityd_~t |     34236    1.508504    4.636162   .0028571   364.2857

. /*
> **************************************************************************;
> * Create a data set with an empty 1 observation. Used to avoid empty data
> * sets when the survey do not have the Mozambican set up
> **************************************************************************;
> use "$path/work/own.dta";
> 
> preserve;
> keep in 1;
> drop unit valued quantityd;
> gen unit=2;
> gen valued=0;
> gen quantityd=0;
> tempfile 1obs;
> save `1obs';
> restore;
> 
> **************************************************************************;
> * Own consumption
> **************************************************************************;
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_ac;
>         rename quantityd quantityd_ac;
>         compress;
>         sort hhid product;
>         tempfile ac;
> save `ac', replace;
> 
> **************************************************************************;
> * Now do a similar thing with receipts-in-kind file.
> **************************************************************************;
> use "$path/work/receipts.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> 
> 
> keep if $product_tpi;
> append using `1obs';
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_re;
>         rename quantityd quantityd_re;
>         compress;
>         sort hhid product;
>         tempfile re;
> save `re', replace;
> 
> **************************************************************************;
> * And also with the daily expenditure file.
> **************************************************************************;
> use "$path/work/daily.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> *rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> *rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         collapse (sum) value quantity days , 
>                 by(hhid product unit);
> 
>         gen valued=value/7 if days<=7;
>         replace valued=value/days if days>7 & days<.;
>         gen quantityd=quantity/7 if days<=7;
>         replace quantityd=quantity/days if days>7 & days<.;
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
> 
>         rename valued valued_dd;
>         rename quantityd quantityd_dd;
>         compress;
>         sort hhid product;
>         tempfile dd;
> save `dd', replace;
> 
> 
> 
> 
> **************************************************************************;
> * Merge the three components (own, daily, receipts) together at the HH/product level, 
> * then aggregate to the regional level, using the sample weights (hhweight).
> * We DON'T want to weight by "hhsize" because the quantity and value are
> * already for the household (i.e., other things equal, larger households
> * are buying larger quantities, and therefore already getting more weight).
> * Then calculate sum(val)/sum(quantity) to get the quantity weighted mean
> * unit value in each strata in each quarter.
> **************************************************************************;
> use `ac';
>         sort hhid product;
>         merge hhid product using `re';
>         tab _m;
>         drop _m;
>         
>         sort hhid product;
>         merge hhid product using `dd';
>         tab _m;
>         drop _m;
>         
>         replace valued_ac=0 if valued_ac==.;
>         replace valued_re=0 if valued_re==.;
>         replace valued_dd=0 if valued_dd==.;
>         replace quantityd_ac=0 if quantityd_ac==.;
>         replace quantityd_re=0 if quantityd_re==.;
>         replace quantityd_dd=0 if quantityd_dd==.;
> 
>         gen valued_tot=valued_ac+valued_re+valued_dd;
>         gen quantityd_tot=quantityd_ac+quantityd_re+quantityd_dd;
> 
>         sort hhid;
> 
>         tempfile acredd;
> save `acredd' , replace;
> */
> 
> 
> 
> use "$path/work/hhdata.dta";

.         keep strata hhid hhweight hhsize rural survmon survquar news spdomain reg_tpi;

.         sort hhid;

.         tempfile hhd;

. save `hhd' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp saved

. use `acredd', clear;

.         merge hhid using `hhd';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        315        0.91        0.91
          3 |     34,236       99.09      100.00
------------+-----------------------------------
      Total |     34,551      100.00

.         drop _merge;

.                 tab survquar , miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |      8,742       25.30       25.30
Sept-Oct 09 |      8,992       26.03       51.33
Nov09-Jan10 |      7,404       21.43       72.76
 Feb-Apr 10 |      9,413       27.24      100.00
------------+-----------------------------------
      Total |     34,551      100.00

.                 tab survmon survquar, miss;

Sequential |
    Survey |
Month (May |   Sequential Survey Quarter May-Jun 09=1)
   2009=1) | May-Jul 0  Sept-Oct   Nov09-Jan  Feb-Apr 1 |     Total
-----------+--------------------------------------------+----------
    May 09 |       187          0          0          0 |       187 
    Jun 09 |     6,230          0          0          0 |     6,230 
    Jul 09 |     2,325          0          0          0 |     2,325 
    Sep 09 |         0      3,119          0          0 |     3,119 
    Oct 09 |         0      5,873          0          0 |     5,873 
    Nov 09 |         0          0      3,162          0 |     3,162 
    Dec 09 |         0          0      2,074          0 |     2,074 
    Jan 10 |         0          0      2,168          0 |     2,168 
    Feb 10 |         0          0          0      2,225 |     2,225 
    Mar 10 |         0          0          0      4,683 |     4,683 
    Apr 10 |         0          0          0      2,505 |     2,505 
-----------+--------------------------------------------+----------
     Total |     8,742      8,992      7,404      9,413 |    34,551 


.         compress;
product was float now int
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
hhsize was double now byte

.         sort hhid;

. save `acredd', replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     34551    2.47e+09    1.13e+09   1.01e+09   4.19e+09
     product |     34236    123.5172     15.5879        103        153
  valued_tot |     34236    578.2445    711.6146   7.142857      12000
quantityd_~t |     34236    1.508504    4.636162   .0028571   364.2857
      strata |     34551    5.478278    2.879859          1         10
-------------+--------------------------------------------------------
      hhsize |     34551    5.225059     2.74337          1         24
    hhweight |     34551    4924.711    4407.844         54      92511
    survquar |     34551     2.50615    1.140574          1          4
     survmon |     34551    6.729646    3.333076          1         12
       rural |     34551    .8112066    .3913501          0          1
-------------+--------------------------------------------------------
        news |     34551    2.380539    1.120118          1          4
    spdomain |     34551    3.200399    1.378315          1          5
     reg_tpi |     34551    2.380539    1.120118          1          4

. **************************************************************************;
. * Need to merge with the file that has nominal consumption per household,
> * and compute nominal consumption per capita from that, so that we can
> * choose the relatively poor (i.e., below median nominal consumption per
> * capita).
> **************************************************************************;
. use "$path\work\conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta" ;
. *save "$path/work/cons_cat.dta", replace ;
. *use "$path/work/cons_cat.dta" ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path\work\hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.  drop _m;

.         collapse (mean) cons_hh_nom hhsize hhweight , by(hhid);

.         gen cpc=cons_hh_nom/hhsize;

.         sum cpc [aw=hhsize*hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     332.3661       78.55931
 5%     680.3636       103.0936
10%     872.9067       107.7462       Obs                6775
25%     1328.983       145.4659       Sum of Wgt.   200636622

50%     2175.789                      Mean           9412.851
                        Largest       Std. Dev.        395673
75%     3972.618        1528531
90%      9057.59        1552604       Variance       1.57e+11
95%     17758.21        1790269       Skewness       202.1632
99%     88724.46       8.12e+07       Kurtosis       41456.83

.         global medcpc=r(p$tpi_bottom);

.         gen bottom_tpi=cpc<=$medcpc;

.         keep hhid bottom_tpi;

.         sort hhid;

.         tempfile bottom_tpi;

. save `bottom_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000008.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000008.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
  bottom_tpi |      6775    .4529889    .4978218          0          1

. use `acredd' ;

.         merge hhid using `bottom_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     34,551      100.00      100.00
------------+-----------------------------------
      Total |     34,551      100.00

.         drop _merge;

.         keep if bottom_tpi;
(20939 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     13612    2.77e+09    9.56e+08   1.01e+09   4.19e+09
     product |     13473    123.4582    15.75092        103        153
  valued_tot |     13473    513.2872    612.4287   7.142857       9000
quantityd_~t |     13473     1.48159     4.67223   .0051429        362
      strata |     13612    6.282765    2.360666          1         10
-------------+--------------------------------------------------------
      hhsize |     13612    5.921393    2.485605          1         19
    hhweight |     13612    5240.411    4192.181        100      60164
    survquar |     13612    2.550103    1.163222          1          4
     survmon |     13612    6.841316      3.4422          1         12
       rural |     13612    .9381428    .2409048          0          1
-------------+--------------------------------------------------------
        news |     13612    2.668969    .9527972          1          4
    spdomain |     13612    3.548266    1.190332          1          5
     reg_tpi |     13612    2.668969    .9527972          1          4
  bottom_tpi |     13612           1           0          1          1

. * Drop one HH with extremely high quantity and low value in IAF 2002/03 (t=t1) ;
. *        drop if hhid==263001;
.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survmon);

.                         drop if product==.;
(30 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         lab var ppkg "Unit value per kg";

.                         sort reg_tpi product ;

.                         compress;

.                         tempfile uvm;

.                 save `uvm', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved

.                 save "$path/work/tpi_unit_val_monthly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_monthly.dta saved

.         restore;

.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(16 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         sort reg_tpi product survquar;

.                         list in  1/3;

     +-------------------------------------------------------------------------+
     | product      survquar   news   reg_tpi   valued~t   quanti~t       ppkg |
     |-------------------------------------------------------------------------|
  1. |     103    May-Jul 09      1   central   22568.77   73.73573   306.0764 |
  2. |     103   Sept-Oct 09      1   central   14153.36   46.40452   304.9995 |
  3. |     103   Nov09-Jan10      1   central   6368.062   18.81594   338.4398 |
     +-------------------------------------------------------------------------+

.                         list in -3/-1;

     +-------------------------------------------------------------------------+
     | product      survquar   news   reg_tpi   valued~t   quanti~t       ppkg |
     |-------------------------------------------------------------------------|
237. |     153   Sept-Oct 09      4   western   5314.159   5.482946    969.216 |
238. |     153   Nov09-Jan10      4   western   7463.587   5.877618   1269.832 |
239. |     153    Feb-Apr 10      4   western   4601.457    3.04152   1512.881 |
     +-------------------------------------------------------------------------+

.                         tempfile uvq;

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_quarterly.dta sav
> ed

.                 save `uvq', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

.         restore;

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each reg_tpi & product combination. This should eliminate outliers that
> * may have an undue influence on the price calculation. Then use sample
> * weighting PLUS quantity weighting on those HH-level observations.
> **************************************************************************;
.         preserve;

.                 gen hhppkg=valued_tot/quantityd_tot;
(139 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(reg_tpi product);
(139 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(reg_tpi product);
(139 missing values generated)

.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
(889 observations deleted)

.                                 gen hhqtywt=hhweight*quantityd_tot;
(139 missing values generated)

.                                 collapse (sum) valued_tot quantityd_tot [aw=hhqtywt] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(0 observations deleted)

.                         gen ppkg_trim=valued_tot/quantityd_tot;

.                         lab var ppkg_trim "90% trimmed unit value per kg";

.                         sort reg_tpi product survquar;

.                         list , nol;

     +----------------------------------------------------------------------+
     | product   survquar   news   reg_tpi   valued~t   quanti~t   ppkg_t~m |
     |----------------------------------------------------------------------|
  1. |     103          1      1         1   28319.06   96.17417    294.456 |
  2. |     103          2      1         1   18820.04    63.6893   295.4977 |
  3. |     103          3      1         1   9132.665   27.16821   336.1527 |
  4. |     103          4      1         1   27228.33    88.0705   309.1652 |
  5. |     104          1      1         1   42474.56   71.73248   592.1246 |
     |----------------------------------------------------------------------|
  6. |     104          2      1         1   17802.97   23.25988   765.3936 |
  7. |     104          3      1         1   31911.45   52.31848   609.9461 |
  8. |     104          4      1         1   9015.529   25.42311   354.6194 |
  9. |     105          1      1         1   91509.81   395.6744   231.2755 |
 10. |     105          2      1         1   57368.14   241.7264   237.3268 |
     |----------------------------------------------------------------------|
 11. |     105          3      1         1   145358.1   1071.283    135.686 |
 12. |     105          4      1         1   114331.1   759.7541   150.4843 |
 13. |     107          1      1         1   85844.55   873.0867   98.32306 |
 14. |     107          2      1         1   32172.96   369.5086   87.06957 |
 15. |     107          3      1         1   23106.83   195.9678   117.9113 |
     |----------------------------------------------------------------------|
 16. |     107          4      1         1    30158.9   322.1287   93.62376 |
 17. |     108          1      1         1    35842.4   134.7221   266.0469 |
 18. |     108          2      1         1   14800.12   15.20498   973.3733 |
 19. |     108          3      1         1   22291.46   24.94331   893.6847 |
 20. |     108          4      1         1   5728.396   5.748081   996.5754 |
     |----------------------------------------------------------------------|
 21. |     113          1      1         1   91826.66    75.2524   1220.249 |
 22. |     113          2      1         1   124001.4   97.77476   1268.236 |
 23. |     113          3      1         1   62127.95   50.07518   1240.693 |
 24. |     113          4      1         1   87345.91   77.05343   1133.576 |
 25. |     116          1      1         1   114.2857   .2857143        400 |
     |----------------------------------------------------------------------|
 26. |     116          2      1         1   42.85714   .0357143       1200 |
 27. |     116          3      1         1   142.8571   .1428571       1000 |
 28. |     116          4      1         1   1382.168   1.373979    1005.96 |
 29. |     117          1      1         1   15414.56   3.561197   4328.479 |
 30. |     117          2      1         1    8197.15    2.04051   4017.206 |
     |----------------------------------------------------------------------|
 31. |     117          3      1         1   27218.37   6.048779   4499.812 |
 32. |     117          4      1         1   12511.55   3.448729   3627.873 |
 33. |     123          1      1         1   5117.439   84.14975   60.81348 |
 34. |     123          2      1         1   8558.404   44.09394   194.0948 |
 35. |     123          3      1         1   6036.032   18.57097   325.0252 |
     |----------------------------------------------------------------------|
 36. |     123          4      1         1   7414.212   53.56753   138.4087 |
 37. |     125          1      1         1   24705.94   393.7206   62.74994 |
 38. |     125          2      1         1   11200.71   136.2267   82.22111 |
 39. |     125          3      1         1   8734.345   121.0963   72.12728 |
 40. |     125          4      1         1    28546.5   303.3625    94.1003 |
     |----------------------------------------------------------------------|
 41. |     127          1      1         1    9833.11   9.506735   1034.331 |
 42. |     127          2      1         1   7060.237   10.01646   704.8632 |
 43. |     127          3      1         1   9604.674   12.31256    780.071 |
 44. |     127          4      1         1   7881.445    10.9077   722.5579 |
 45. |     140          1      1         1   168173.8   312.1417    538.774 |
     |----------------------------------------------------------------------|
 46. |     140          2      1         1   14004.16   9.738918   1437.959 |
 47. |     140          3      1         1   13425.82    12.5723    1067.89 |
 48. |     140          4      1         1        750         .5       1500 |
 49. |     141          1      1         1    73760.3    50.9324     1448.2 |
 50. |     141          2      1         1   12806.28    7.15612   1789.557 |
     |----------------------------------------------------------------------|
 51. |     141          3      1         1   62646.22   41.02652   1526.969 |
 52. |     141          4      1         1   36183.02   27.68363   1307.019 |
 53. |     147          1      1         1   54118.57   24.23457   2233.114 |
 54. |     147          2      1         1    17767.9   7.739445   2295.758 |
 55. |     147          3      1         1   26837.26   11.40099    2353.94 |
     |----------------------------------------------------------------------|
 56. |     147          4      1         1   22323.89   9.559492   2335.259 |
 57. |     153          1      1         1   4290.671   2.800241   1532.251 |
 58. |     153          2      1         1   4229.531   2.279642   1855.349 |
 59. |     153          3      1         1   2714.002    2.30214   1178.904 |
 60. |     153          4      1         1    4017.72   4.906215   818.9043 |
     |----------------------------------------------------------------------|
 61. |     103          1      2         2   15216.61   42.38829   358.9814 |
 62. |     103          2      2         2   10384.88   29.72081   349.4143 |
 63. |     103          3      2         2   2621.611   8.571429   305.8545 |
 64. |     103          4      2         2   11809.92   38.17354   309.3746 |
 65. |     104          1      2         2   2169.555   5.613356   386.4987 |
     |----------------------------------------------------------------------|
 66. |     104          2      2         2   4216.845   5.868171    718.596 |
 67. |     104          3      2         2   2266.713   3.726532   608.2634 |
 68. |     104          4      2         2    711.778   1.071429   664.3262 |
 69. |     105          1      2         2   110893.2   530.7202   208.9486 |
 70. |     105          2      2         2     227212     834.56   272.2536 |
     |----------------------------------------------------------------------|
 71. |     105          3      2         2   240318.4   771.1798   311.6244 |
 72. |     105          4      2         2   170147.4   843.8369   201.6354 |
 73. |     107          1      2         2   111622.5   1423.144   78.43377 |
 74. |     107          2      2         2   80616.85   1267.057   63.62529 |
 75. |     107          3      2         2   83343.61   920.6839   90.52359 |
     |----------------------------------------------------------------------|
 76. |     107          4      2         2   42145.69   585.6392   71.96529 |
 77. |     108          1      2         2   223255.7   294.0954   759.1269 |
 78. |     108          2      2         2   165368.5   210.7026    784.843 |
 79. |     108          3      2         2   126050.7   153.0366   823.6641 |
 80. |     108          4      2         2   77268.72   103.1481   749.1049 |
     |----------------------------------------------------------------------|
 81. |     113          1      2         2   112812.5   107.5083   1049.338 |
 82. |     113          2      2         2     257837   246.4263   1046.305 |
 83. |     113          3      2         2   143475.6   134.1408   1069.589 |
 84. |     113          4      2         2   111106.9   141.3594   785.9888 |
 85. |     116          1      2         2   67574.73   158.8968   425.2742 |
     |----------------------------------------------------------------------|
 86. |     116          2      2         2   50211.55    115.254     435.66 |
 87. |     116          3      2         2    9590.41   14.60383   656.7053 |
 88. |     116          4      2         2   25656.21   59.25055   433.0121 |
 89. |     117          1      2         2   22650.82   5.262053   4304.559 |
 90. |     117          2      2         2    58746.1   14.44641   4066.485 |
     |----------------------------------------------------------------------|
 91. |     117          3      2         2   39753.66   9.453981   4204.965 |
 92. |     117          4      2         2   46207.79   11.27829   4097.056 |
 93. |     123          1      2         2    19677.4   111.2016   176.9525 |
 94. |     123          2      2         2   23213.51   106.9577   217.0345 |
 95. |     123          3      2         2   35242.69   115.5208   305.0765 |
     |----------------------------------------------------------------------|
 96. |     123          4      2         2   12075.58    39.7925   303.4638 |
 97. |     125          1      2         2   12538.33   158.3562   79.17799 |
 98. |     125          2      2         2    30960.9   465.6374   66.49143 |
 99. |     125          3      2         2   21628.59   306.5145     70.563 |
100. |     125          4      2         2   24096.16   288.1129   83.63444 |
     |----------------------------------------------------------------------|
101. |     127          1      2         2   17128.75   22.78219   751.8484 |
102. |     127          2      2         2   17629.16    29.5287   597.0177 |
103. |     127          3      2         2   16981.87   28.49795   595.8978 |
104. |     127          4      2         2   13846.96   19.14888   723.1213 |
105. |     140          1      2         2   37986.05   29.46379   1289.245 |
     |----------------------------------------------------------------------|
106. |     140          2      2         2   45309.99   40.97656   1105.754 |
107. |     140          3      2         2   9400.593    7.53642   1247.355 |
108. |     140          4      2         2   1474.728   .6486086    2273.68 |
109. |     141          1      2         2   45619.38   29.55759   1543.407 |
110. |     141          2      2         2   42371.15   28.91936   1465.149 |
     |----------------------------------------------------------------------|
111. |     141          3      2         2   24229.99   19.20201   1261.847 |
112. |     141          4      2         2   43447.75   20.69524   2099.408 |
113. |     147          1      2         2   59120.19   27.67904   2135.919 |
114. |     147          2      2         2   47470.97   21.53229   2204.641 |
115. |     147          3      2         2      38467   16.56121   2322.717 |
     |----------------------------------------------------------------------|
116. |     147          4      2         2   68759.17   30.41655   2260.584 |
117. |     153          1      2         2   19452.29   43.12555   451.0619 |
118. |     153          2      2         2   24716.01   57.57064   429.3162 |
119. |     153          3      2         2   15118.67   30.78195   491.1536 |
120. |     153          4      2         2   20709.89   73.44278   281.9867 |
     |----------------------------------------------------------------------|
121. |     103          1      3         3   1387.982   4.285715   323.8625 |
122. |     103          2      3         3   1714.286   4.285715        400 |
123. |     103          3      3         3   10114.38   37.68812   268.3706 |
124. |     104          1      3         3   931.9478   1.071429   869.8179 |
125. |     104          2      3         3   3589.251   3.157794   1136.632 |
     |----------------------------------------------------------------------|
126. |     104          3      3         3   571.4286   .7142857        800 |
127. |     104          4      3         3   7284.352    16.7008   436.1679 |
128. |     105          1      3         3   28746.72   59.90147   479.9001 |
129. |     105          2      3         3   155633.5   411.9799   377.7697 |
130. |     105          3      3         3   143629.8   355.1062   404.4698 |
     |----------------------------------------------------------------------|
131. |     105          4      3         3   177375.9   461.8986   384.0148 |
132. |     107          1      3         3   147889.6   2164.835   68.31451 |
133. |     107          2      3         3   73678.71   1128.811   65.27107 |
134. |     107          3      3         3   41353.67   743.4236   55.62598 |
135. |     107          4      3         3   200328.1   3359.779   59.62537 |
     |----------------------------------------------------------------------|
136. |     108          1      3         3     113069   110.3901   1024.267 |
137. |     108          2      3         3     100464   232.1916   432.6772 |
138. |     108          3      3         3   108203.3   140.4258   770.5372 |
139. |     108          4      3         3   251788.9   366.0768   687.8033 |
140. |     113          1      3         3   74056.14   55.14548   1342.923 |
     |----------------------------------------------------------------------|
141. |     113          2      3         3   119602.9   113.5709   1053.112 |
142. |     113          3      3         3   50177.28   47.17356   1063.674 |
143. |     113          4      3         3   153256.8   277.4742   552.3282 |
144. |     116          1      3         3   122448.6   201.3366   608.1783 |
145. |     116          2      3         3   42876.34   95.12967   450.7147 |
     |----------------------------------------------------------------------|
146. |     116          3      3         3   122266.5   226.4491   539.9292 |
147. |     116          4      3         3   283037.1   631.8442   447.9539 |
148. |     117          1      3         3   43657.85   10.51257   4152.919 |
149. |     117          2      3         3   87249.14   20.52166   4251.563 |
150. |     117          3      3         3    42356.1   9.925028   4267.605 |
     |----------------------------------------------------------------------|
151. |     117          4      3         3   81555.37   20.36307   4005.062 |
152. |     123          1      3         3   39847.85   172.9701   230.3741 |
153. |     123          2      3         3   30541.64   40.93434   746.1128 |
154. |     123          3      3         3   40856.48   82.57945   494.7536 |
155. |     123          4      3         3   60931.27   99.12797   614.6729 |
     |----------------------------------------------------------------------|
156. |     125          1      3         3   27347.45   347.2096   78.76351 |
157. |     125          2      3         3   43603.09   587.6797   74.19534 |
158. |     125          3      3         3   11449.98   179.5487    63.7709 |
159. |     125          4      3         3   43612.75   567.5557   76.84313 |
160. |     127          1      3         3   41507.15   20.58854   2016.032 |
     |----------------------------------------------------------------------|
161. |     127          2      3         3   41261.23    36.2179    1139.25 |
162. |     127          3      3         3   29846.15   22.77964   1310.211 |
163. |     127          4      3         3   52372.55   38.43873   1362.494 |
164. |     140          1      3         3   23070.64   22.02973   1047.251 |
165. |     140          2      3         3    23208.8   24.12267   962.1154 |
     |----------------------------------------------------------------------|
166. |     140          3      3         3   3949.273   7.958361    496.242 |
167. |     140          4      3         3   1342.447   1.883322    712.808 |
168. |     141          1      3         3   162506.6   80.52101   2018.189 |
169. |     141          2      3         3   97560.73   46.33667   2105.476 |
170. |     141          3      3         3   95006.45    51.9903   1827.388 |
     |----------------------------------------------------------------------|
171. |     141          4      3         3   259997.5   109.5022   2374.358 |
172. |     147          1      3         3   36311.64   16.23056   2237.239 |
173. |     147          2      3         3   57144.58   25.95222   2201.915 |
174. |     147          3      3         3   38348.62   15.83702   2421.454 |
175. |     147          4      3         3   67064.92    27.9402   2400.302 |
     |----------------------------------------------------------------------|
176. |     153          1      3         3   24801.75   38.12256   650.5792 |
177. |     153          2      3         3   30626.28   58.13491   526.8139 |
178. |     153          3      3         3   52033.58   99.52981   522.7939 |
179. |     153          4      3         3   58707.19   120.4651   487.3379 |
180. |     103          1      4         4   44778.51   163.7554   273.4475 |
     |----------------------------------------------------------------------|
181. |     103          2      4         4   72394.29   233.4372   310.1232 |
182. |     103          3      4         4   31806.17   97.61178   325.8436 |
183. |     103          4      4         4   112989.5    364.812   309.7197 |
184. |     104          1      4         4   143081.3   185.6128   770.8592 |
185. |     104          2      4         4     112974   150.3383    751.465 |
     |----------------------------------------------------------------------|
186. |     104          3      4         4   30398.32   27.86736   1090.822 |
187. |     104          4      4         4   46275.97   50.80224   910.9042 |
188. |     105          1      4         4   96406.96   562.4341   171.4102 |
189. |     105          2      4         4   83866.33   347.3599   241.4393 |
190. |     105          3      4         4   107863.9   586.1739   184.0134 |
     |----------------------------------------------------------------------|
191. |     105          4      4         4   131065.8    532.648   246.0645 |
192. |     107          1      4         4   93749.12   1092.712   85.79494 |
193. |     107          2      4         4   69811.16   822.3728   84.88992 |
194. |     107          3      4         4   34417.14   494.0651   69.66113 |
195. |     107          4      4         4   38149.64   296.9164   128.4861 |
     |----------------------------------------------------------------------|
196. |     108          1      4         4   86082.59   385.6029   223.2415 |
197. |     108          2      4         4   42465.75   73.28425   579.4662 |
198. |     108          3      4         4   32316.56   61.21784   527.8944 |
199. |     108          4      4         4   10573.29    14.5281   727.7824 |
200. |     113          1      4         4   96491.34   83.23969   1159.199 |
     |----------------------------------------------------------------------|
201. |     113          2      4         4     120858   137.8231   876.9068 |
202. |     113          3      4         4   173842.9   215.9366   805.0648 |
203. |     113          4      4         4   58064.97   79.76872   727.9165 |
204. |     116          1      4         4   1022.575   1.225386   834.4922 |
205. |     116          2      4         4   3224.496   4.713887   684.0418 |
     |----------------------------------------------------------------------|
206. |     116          3      4         4   1939.862   3.350982   578.8937 |
207. |     116          4      4         4    1677.04   2.376296   705.7369 |
208. |     117          1      4         4   22788.04   5.596151   4072.092 |
209. |     117          2      4         4   28219.85   6.708414   4206.635 |
210. |     117          3      4         4   6515.356   1.589221   4099.716 |
     |----------------------------------------------------------------------|
211. |     117          4      4         4   19084.52   4.996784   3819.361 |
212. |     123          1      4         4   13946.75   19.09676   730.3201 |
213. |     123          2      4         4      25811   112.3558   229.7255 |
214. |     123          3      4         4   3401.328   22.35786   152.1312 |
215. |     123          4      4         4   4187.914   3.498721   1196.984 |
     |----------------------------------------------------------------------|
216. |     125          1      4         4    14303.9   179.4714   79.70015 |
217. |     125          2      4         4    28040.2   299.4866   93.62756 |
218. |     125          3      4         4    15624.2   224.3097   69.65456 |
219. |     125          4      4         4   39501.82   386.4713   102.2115 |
220. |     127          1      4         4   8198.837   7.288663   1124.875 |
     |----------------------------------------------------------------------|
221. |     127          2      4         4    5140.67   6.138281   837.4772 |
222. |     127          3      4         4   8321.004   7.638924    1089.29 |
223. |     127          4      4         4    11049.9   8.131307   1358.933 |
224. |     140          1      4         4   92135.84   118.7114   776.1332 |
225. |     140          2      4         4   17408.64   14.46378   1203.602 |
     |----------------------------------------------------------------------|
226. |     140          3      4         4   28858.82   70.10011   411.6801 |
227. |     140          4      4         4   6416.295   4.845619   1324.143 |
228. |     141          1      4         4   148954.6   101.4302   1468.544 |
229. |     141          2      4         4   96470.34   59.77904   1613.782 |
230. |     141          3      4         4    75222.7   47.38911   1587.341 |
     |----------------------------------------------------------------------|
231. |     141          4      4         4   60408.31   32.24249   1873.562 |
232. |     147          1      4         4   23547.74   10.45022   2253.324 |
233. |     147          2      4         4   22270.22   9.571515   2326.718 |
234. |     147          3      4         4   9586.356   4.335199   2211.284 |
235. |     147          4      4         4   10944.31   4.637684   2359.865 |
     |----------------------------------------------------------------------|
236. |     153          1      4         4   17942.73   17.95513   999.3094 |
237. |     153          2      4         4    8706.94    11.6054    750.249 |
238. |     153          3      4         4   19314.54   16.82786   1147.771 |
239. |     153          4      4         4   6548.263   5.328297    1228.96 |
     +----------------------------------------------------------------------+

.                         tempfile uvq2;

.                         keep reg_tpi product survquar ppkg_trim;

.                 save `uvq2', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp saved

.                                 use `uvq' ;

.                         merge reg_tpi product survquar using `uvq2';
(label REG_TPI already defined)
(label lsurvquar already defined)

.                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        239      100.00      100.00
------------+-----------------------------------
      Total |        239      100.00

.                         drop _merge;

.                 save `uvq', replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_quarterly.dta sav
> ed

.         restore;

. **************************************************************************;
. * Now calculate the weights for the temporal price index. The weights
> * will be based on the bottom 50% of the national nominal consumption
> * per capita (see below). We let the weights vary by strata (3 regions X rural/urban).
> *
> * First, make a small file that has the total nominal HH daily consumption,
> * to use as our denominator. We cannot simply use the `bottom_tpi' file that
> * was created earlier because we will need some other variables from
> * the cons_cat.dta file.
> **************************************************************************;
. use "$path\work\conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta", clear ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path\work\hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         collapse (mean) cons_hh_nom hhsize strata hhweight rural news survquar reg_tpi,
>                 by(hhid);

.         lab var cons_hh_nom "Nominal daily HH consumption";

.         rename hhsize   cc_hhs;

.         rename strata   cc_reg;

.         rename hhweight cc_hhw;

.         rename rural    cc_rur;

.         rename news     cc_news;

.         rename survquar cc_qua;

.         rename reg_tpi  cc_reg_tpi;

.         sort hhid;

.         tempfile thhcons;

. save `thhcons', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000f.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000f.tmp saved

. **************************************************************************;
. * Merge the file with consumption on the food products with HH consumption file,
> * then use "fillin" to take care of cases where a household did not
> * consume all n_tpi commodities. Note that we need to do the merge
> * first because there are some households that are not in `acredd' at
> * all, because they did not consume *any* of the n_tpi items. Then replace
> * missing values in the "filled in" observations with the relevant values 
> * for that household.
> **************************************************************************;
. use `acredd';

.         cap drop _merge;

.         drop if product==.;
(315 observations deleted)

.         merge hhid using `thhcons';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        315        0.91        0.91
          3 |     34,236       99.09      100.00
------------+-----------------------------------
      Total |     34,551      100.00

.         for var valued_tot quantityd_tot : replace X=0 if _merge==2;

->  replace valued_tot=0 if _merge==2
(315 real changes made)

->  replace quantityd_tot=0 if _merge==2
(315 real changes made)

.                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 valued_tot quantityd_tot : replace X=0 if _merge==2;
>                                 */
> 
>         replace hhsize  =cc_hhs     if _merge==2;
(315 real changes made)

.         replace strata  =cc_reg     if _merge==2;
(315 real changes made)

.         replace hhweight=cc_hhw     if _merge==2;
(315 real changes made)

.         replace rural   =cc_rur     if _merge==2;
(315 real changes made)

.         replace news    =cc_news        if _merge==2;
(315 real changes made)

.         replace survquar=cc_qua     if _merge==2;
(315 real changes made)

.         replace reg_tpi =cc_reg_tpi     if _merge==2;
(315 real changes made)

.         drop _merge cc_* ;

.                 fillin hhid product;

.         replace valued_tot=0 if _fillin;
(73849 real changes made)

.                 for var quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;

->  egen tmp=mean(quantityd_tot), by(hhid)

->  replace quantityd_tot=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(strata), by(hhid)

->  replace strata=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(rural), by(hhid)

->  replace rural=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(hhweight), by(hhid)

->  replace hhweight=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(hhsize), by(hhid)

->  replace hhsize=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(survquar), by(hhid)

->  replace survquar=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(survmon), by(hhid)
(5040 missing values generated)

->  replace survmon=tmp if _fillin
(69124 real changes made)

->  drop tmp

->  egen tmp=mean(news), by(hhid)

->  replace news=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(reg_tpi), by(hhid)

->  replace reg_tpi=tmp if _fillin
(73849 real changes made)

->  drop tmp

->  egen tmp=mean(cons_hh_nom), by(hhid)

->  replace cons_hh_nom=tmp if _fillin
(73849 real changes made)

->  drop tmp

.                                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;
>                                 */
> 
> **************************************************************************;
. * Now calculate the shares, and then the mean shares in each strata, 
> * using hhweight*hhsize weighting. 
> * Note that we are not doing quantity weighting now for the shares.
> **************************************************************************;
.         gen share = valued_tot/cons_hh_nom ;

.         gen popwt = hhsize*hhweight;

.         lab var share "HH share in total consumption";

.         lab var popwt "Population weight: hhsize*hhweight";

. **************************************************************************;
. * Select the bottom 50% (weighted) of the distribution of nominal per 
> * capita consumption.
> **************************************************************************;
.         gen cpc=cons_hh_nom/hhsize;

.         sum cpc [aw=hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     341.2898       78.55931
 5%     695.3857       78.55932
10%     897.8539       78.55932       Obs              108400
25%     1376.486       78.55932       Sum of Wgt.   491413216

50%     2259.297                      Mean           10464.25
                        Largest       Std. Dev.      451462.1
75%     4217.707       8.12e+07
90%     9842.668       8.12e+07       Variance       2.04e+11
95%     19766.71       8.12e+07       Skewness       177.7597
99%     111655.2       8.12e+07       Kurtosis       31946.76

.         global medcpc=r(p$tpi_bottom);

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    108400    2.51e+09    1.13e+09   1.01e+09   4.19e+09
     product |    101625    121.9333    16.00619        103        153
  valued_tot |    108400    182.6271    481.8536          0      12000
quantityd_~t |    108400      1.4749     3.25775          0   364.2857
      strata |    108400    5.551734    2.873473          1         10
-------------+--------------------------------------------------------
      hhsize |    108400        4.96    2.758379          1         24
    hhweight |    108400    4533.332    4303.944         54      92511
    survquar |    108400    2.499336    1.143945          1          4
     survmon |    103360    6.719814    3.353746          1         12
       rural |    108400    .8199262    .3842507          0          1
-------------+--------------------------------------------------------
        news |    108400    2.416827    1.118312          1          4
    spdomain |     34236    3.202126    1.379049          1          5
     reg_tpi |    108400    2.416827    1.118312          1          4
 cons_hh_nom |    108400    97487.28     4938154   232.1918   4.06e+08
     _fillin |    108400    .6812638    .4659887          0          1
-------------+--------------------------------------------------------
       share |    108400    .0152195    .0411734          0   .7534428
       popwt |    108400    29614.26    44552.43         62     832599
         cpc |    108400    20773.97      987328   78.55931   8.12e+07

.  codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                         Household Code
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/108400

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         keep if cpc<=$medcpc;
(57072 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     51328    2.81e+09    9.50e+08   1.01e+09   4.19e+09
     product |     48120    121.9333    16.00628        103        153
  valued_tot |     51328    144.5371    402.5764          0       9000
quantityd_~t |     51328    1.488656     3.31426          0        362
      strata |     51328    6.332606    2.333378          1         10
-------------+--------------------------------------------------------
      hhsize |     51328    5.628741    2.566767          1         24
    hhweight |     51328    4789.738    4259.487        100      60164
    survquar |     51328    2.546135    1.163029          1          4
     survmon |     49024    6.838773     3.45944          1         12
       rural |     51328    .9466958    .2246417          0          1
-------------+--------------------------------------------------------
        news |     51328    2.703865    .9463027          1          4
    spdomain |     14268    3.522638    1.217835          1          5
     reg_tpi |     51328    2.703865    .9463027          1          4
 cons_hh_nom |     51328    7198.385    4750.943   232.1918   53180.82
     _fillin |     51328    .7192176    .4493858          0          1
-------------+--------------------------------------------------------
       share |     51328    .0198654    .0515374          0   .7534428
       popwt |     51328    33070.38    43851.13        100     782132
         cpc |     51328    1292.952    550.5071   78.55931   2259.297

.                 collapse (mean) share (median) medshare=share [aw=popwt] , 
>                         by(reg_tpi product);

.                 egen sumsh=sum(share) , by(reg_tpi);

.                 replace share=share/sumsh;
(60 real changes made)

.                 drop sumsh;

.                 egen sumsh=sum(medshare) , by(reg_tpi);

.                 replace medshare=medshare/sumsh;
(15 real changes made)

.                 drop sumsh;

.                 lab var share "Reg 6: Mean HH share of total consumption";

.                 lab var medshare "Reg 6: Median HH share of total consumption";

.                 sort reg_tpi product;

.                 save "$path/work/tpi_reg_tpi_share.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_reg_tpi_share.dta saved

.                 tempfile tempwt6;

.                 save `tempwt6', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp saved

. use `uvq', clear;

.         sort reg_tpi product;

. save , replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

. use `tempwt6';

.         merge reg_tpi product using `uvq';
variables reg_tpi product do not uniquely identify observations in
    C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        1.65        1.65
          3 |        239       98.35      100.00
------------+-----------------------------------
      Total |        243      100.00

.         gen tpi1     =ppkg     *share;
(4 missing values generated)

.         gen tpi1_trim=ppkg_trim*share;
(4 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       239    122.0126     16.0261        103        153
     reg_tpi |       243    2.497942    1.122182          1          4
       share |       243    .0658325     .056306          0   .2426034
    medshare |       243    .0658436    .1519141          0   .7792769
    survquar |       239    2.493724    1.118486          1          4
-------------+--------------------------------------------------------
        news |       239    2.497908    1.122252          1          4
  valued_tot |       239    32500.26    34021.66   42.85714   199196.3
quantityd_~t |       239    94.10801     188.606   .0357143   1910.384
        ppkg |       239    1094.785    1044.717   59.80142    4510.64
   ppkg_trim |       239    1020.765    1045.403   55.62598   4499.812
-------------+--------------------------------------------------------
      _merge |       243    2.967078    .2550047          1          3
        tpi1 |       239     65.7482    73.82272   .4798732   326.7566
   tpi1_trim |       239    63.03959    74.10655   .4798732   353.8831

. keep if survquar!=.;
(4 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       239    122.0126     16.0261        103        153
     reg_tpi |       239    2.497908    1.122252          1          4
       share |       239    .0669343    .0561213   .0011997   .2426034
    medshare |       239    .0669456    .1529434          0   .7792769
    survquar |       239    2.493724    1.118486          1          4
-------------+--------------------------------------------------------
        news |       239    2.497908    1.122252          1          4
  valued_tot |       239    32500.26    34021.66   42.85714   199196.3
quantityd_~t |       239    94.10801     188.606   .0357143   1910.384
        ppkg |       239    1094.785    1044.717   59.80142    4510.64
   ppkg_trim |       239    1020.765    1045.403   55.62598   4499.812
-------------+--------------------------------------------------------
      _merge |       239           3           0          3          3
        tpi1 |       239     65.7482    73.82272   .4798732   326.7566
   tpi1_trim |       239    63.03959    74.10655   .4798732   353.8831

. list in  1/3;

     +-----------------------------------------------------------------------------------+
  1. | product | reg_tpi |    share | medshare |   survquar | news | valued~t | quanti~t |
     |     103 | central | .0639916 |        0 | May-Jul 09 |    1 | 22568.77 | 73.73573 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |    306.0764    |     294.456    |         3    |    19.58633    |    18.84271     |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  2. | product | reg_tpi |    share | medshare |   survquar | news | valued~t | quanti~t |
     |     104 | central | .0671342 |        0 | May-Jul 09 |    1 | 31972.39 | 51.59874 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |     619.635    |    592.1246    |         3    |    41.59869    |     39.7518     |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  3. | product | reg_tpi |    share | medshare |   survquar | news | valued~t | quanti~t |
     |     105 | central | .2093356 | .3397116 | May-Jul 09 |    1 | 51399.64 | 228.2883 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |    225.1523    |    231.2755    |         3    |    47.13239    |     48.4142     |
     +-----------------------------------------------------------------------------------+

. list in -3/-1;

     +-----------------------------------------------------------------------------------+
237. | product | reg_tpi |   share | medshare |    survquar | news | valued~t | quanti~t |
     |     153 | western | .012343 |        0 | Sept-Oct 09 |    4 | 5314.159 | 5.482946 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |     969.216    |     750.249    |         3    |    11.96306    |    9.260348     |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
238. | product | reg_tpi |   share | medshare |    survquar | news | valued~t | quanti~t |
     |     153 | western | .012343 |        0 | Nov09-Jan10 |    4 | 7463.587 | 5.877618 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |    1269.832    |    1147.771    |         3    |    15.67358    |    14.16698     |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
239. | product | reg_tpi |   share | medshare |    survquar | news | valued~t | quanti~t |
     |     153 | western | .012343 |        0 |  Feb-Apr 10 |    4 | 4601.457 |  3.04152 |
     |-----------------------------------------------------------------------------------|
     |        ppkg    |    ppkg_t~m    |    _merge    |        tpi1    |    tpi1_t~m     |
     |    1512.881    |     1228.96    |         3    |    18.67354    |    15.16909     |
     +-----------------------------------------------------------------------------------+

.         **************************************************************************;
. * Find TPI level and indexes for non-trimmed and trimmed prices
> **************************************************************************;
. * Not trimmed ;
.         collapse (sum) tpi1 tpi1_trim  , by(reg_tpi survquar);

.                 for num 1/$n_tpi :
>                         sum tpi1 if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1 if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1 if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1 if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1 if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1 if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

.                 lab var tpi1 "Temporal price index before normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi=tpi1/${base`v'} if reg_tpi==`v
> ' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi=tpi1/${base`v'} if reg_tpi
> ==`v' ;
  7.                                         } ;
  8.                                 } ;
(12 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)

.                                                                                          
>        *gen     tpi=tpi1/$base1 if reg_tpi==1;
.                 *replace tpi=tpi1/$base2 if reg_tpi==2;
.                 *replace tpi=tpi1/$base3 if reg_tpi==3;
.                 *replace tpi=tpi1/$base4 if reg_tpi==4;
.                 *replace tpi=tpi1/$base5 if reg_tpi==5;
.                 *replace tpi=tpi1/$base6 if reg_tpi==6;
.                                                                                 lab var t
> pi "Temporal price index (Q4=1)";

. * Trimmed ;
.                 for num 1/$n_tpi :
>                         sum tpi1_trim if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1_trim if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1_trim if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1_trim if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1_trim if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1_trim if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

.                 lab var tpi1_trim "Six regions: TRIMMED Temporal price index before norma
> lization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi_trim=tpi1_trim/${base`v'} if r
> eg_tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi_trim=tpi1_trim/${base`v'} 
> if reg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(12 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)

.                                                 lab var tpi_trim "TRIMMED Temporal price 
> index (Q4=1)";

.                 sort reg_tpi survquar;

.             drop if reg_tpi<1 | reg_tpi>$n_tpi;
(0 observations deleted)

. gen tpi_diff = tpi - tpi_trim;

. lab var tpi_diff "TPI difference btw trimmed/untrimmed";

. twoway (connected tpi_trim survquar),yline(1) by(, title("TPI: Trimmed"))
> by(reg_tpi) sav("$path/work/reg_tpi-tpi_trim", replace);
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/reg_tpi-tpi_trim.gph saved)

. graph export "$path/work/reg_tpi-tpi_trim.tif", replace;
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/reg_tpi-tpi_trim.tif written 
> in TIFF format)

. list reg_tpi survquar tpi tpi_trim tpi_diff;

     +----------------------------------------------------------+
     |  reg_tpi      survquar        tpi   tpi_trim    tpi_diff |
     |----------------------------------------------------------|
  1. |  central    May-Jul 09    .989413   1.031987   -.0425741 |
  2. |  central   Sept-Oct 09   1.144807   1.158773   -.0139661 |
  3. |  central   Nov09-Jan10   1.095241   1.098785   -.0035439 |
  4. |  central    Feb-Apr 10          1          1           0 |
  5. |  eastern    May-Jul 09   1.028587   .9939144    .0346727 |
     |----------------------------------------------------------|
  6. |  eastern   Sept-Oct 09   1.056235   .9891661    .0670691 |
  7. |  eastern   Nov09-Jan10   1.071347   1.034392    .0369555 |
  8. |  eastern    Feb-Apr 10          1          1           0 |
  9. | northern    May-Jul 09   1.130185   1.119139    .0110453 |
 10. | northern   Sept-Oct 09   1.037306   .9677771    .0695288 |
     |----------------------------------------------------------|
 11. | northern   Nov09-Jan10   1.032251   .9921228    .0401278 |
 12. | northern    Feb-Apr 10          1          1           0 |
 13. |  western    May-Jul 09   .7887307   .8666803   -.0779496 |
 14. |  western   Sept-Oct 09   .9702555   .9174521    .0528034 |
 15. |  western   Nov09-Jan10   .8940035   .8827032    .0113003 |
     |----------------------------------------------------------|
 16. |  western    Feb-Apr 10          1          1           0 |
     +----------------------------------------------------------+

.                 sort reg_tpi survquar;

. keep reg_tpi survquar tpi_trim;

. save "$path/work/temp_index_reg_tpi.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/temp_index_reg_tpi.dta saved

.                        ******************************************************************
> ********
> * 090_temp_index.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 do "$path/new/100_food_basket_flex.do"  /* Flexible food 
> basket */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/100_food_basket_flex.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/100_food_basket_flex.lo
> g
  log type:  text
 opened on:  17 May 2013, 14:58:08

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 100_food_basket_flex.do     (start)
> *
> * This file is to get the data from the cons_cod.dta in work and then 
> * to create the do file with the 90% of the consumption expenditures 
> * using a flexible basket of goods.
> *
> * NOTE: we actually keep goods representing 95% of expenditure
> * in order to facilitate dropping of some goods (such as rats) where
> * quantity and nutrition information is unknown.
> *
> * We base our basket on the bottom 60 percent of consumption per capita
> * (weighted by hhweight*hhsize). We use the TEMPORALLY-ADJUSTED
> * NOMINAL consumption because we don't have a spatial adjustment yet.
> *
> * (Then we iterate this process to arrive at a final food bundle in later code)
> **************************************************************************;
. *CA modified to bring in hhdata into bootstrap;
. /*
> This file uses:
>                 work\cons_cod.dta
>                 work\hhdata.dta
>                 work\products.dta
>                 work/consump_nom.dta
>                 work/temp_index_reg_tpi.dta
>                 work/food_cat.dta
> 
> This file creates:
>                 work\food_basket_flex.dta
>                 work\codes_food_basket_flex.dta
> */
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************;
. * First, make a small temp file that has the temporally adjusted 
> * nominal consumption per capita, using work/consump_nom and 
> * work/temp_index_reg_tpi.dta. Make a dummy variable indicating
> * whether they are in the bottom 60%.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.         sort hhid;

.         merge hhid using "$path/work\hhdata.dta";

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _m;

.         keep hhid hhweight hhsize cons_pc_nom reg_tpi rural survquar;

.         sort reg_tpi survquar;

.         cap drop _merge;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.                 gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

.         save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

.         collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight] ;

.         rename cons_pc_tpi pctile_60;

.         tempfile 60pct;

.         sort one;

.         save `60pct', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

.                 use `contpi';

.                 sort one;

.                 merge one using `60pct';
variable one does not uniquely identify observations in the master data

.                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 drop _merge;

.                 drop one;

.                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                 tab bottom_basket [aw=hhsize*hhweight];

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 3,389.1978       50.03       50.03
          1 | 3,385.8022       49.97      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 lab var bottom_basket "=1 if in bottom 60% of PCE";

.                                 sort hhid;

. save `contpi' , replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. **************************************************************************;
. * Next, need to keep only the food products in order to calculate the 
> * food poverty line, and then calculate the food expenses by code.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. /*
>         sort product;
>         merge product using "$path/work/food_cat.dta";
>         tab _merge;
>         keep if _merge==3;
>         drop _merge;
> */
>         
>         keep if food_cat;
(0 observations deleted)

.         codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                         Household Code
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/412045

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         sort hhid;

. **************************************************************************;
. * Next, merge in the consumption information, and select those in bottom
> * 60% of nominal distribution, after making temporal adjustment. 
> **************************************************************************;
.         merge hhid using `contpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00

.         keep if _merge==3;
(0 observations deleted)

.         drop _merge;

.         keep if bottom_basket==1;
(239580 observations deleted)

.      **************************************************************************;
. * Calculate food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.           gen  food_expenditure= cod_hh_nom3;

.                             *gen  food_expenditure= own_valued + daily_valued + monthly_v
> alued + educ_valued;
.           egen tot_food_expen= sum (food_expen), by (hhid) ;

.           count if food_expenditure==.;
    0

.           count if tot_food_expen==.;
    0

.                     gen food_share= food_expenditure/tot_food_expen;
(925 missing values generated)

.           count if food_share==.;
  925

.           drop if food_share==.;
(925 observations deleted)

.           sort hhid product;

.                         tempfile food_basket_flex;

. save `food_basket_flex', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

. ********************************************************************************;
. * Now prepare to get the variable spdomain to the using dataset, and then find the 
> * total shares by each product in order to select the most important goods in the 
> * basket.
> ********************************************************************************;
.                 preserve;

.                 use "$path/work/hhdata.dta", clear;

.                         keep hhid spdomain;

.                         sort hhid;

.                         tempfile spdomain;

.                 save `spdomain' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

.                 restore;

.                            collapse (mean) hhweight, by (hhid);

.            sort hhid ;

.             merge hhid using `spdomain';

.            tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      3,740       55.20       55.20
          3 |      3,035       44.80      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.            drop if _m==2;
(3740 observations deleted)

.            drop _merge;

.             collapse (sum) hhweight , by(spdomain);

.            rename hhweight tothhweight;

.            tempfile tothhweight;

. save `tothhweight';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. use `food_basket_flex';

.           sort hhid;

.           merge hhid using `spdomain';
variable hhid does not uniquely identify observations in the master data

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      3,740        2.13        2.13
          3 |    171,540       97.87      100.00
------------+-----------------------------------
      Total |    175,280      100.00

.           sort _m;

.           drop if _m==2;
(3740 observations deleted)

.           drop _m;

.           sort spdomain;

.             merge spdomain using `tothhweight';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    171,540      100.00      100.00
------------+-----------------------------------
      Total |    171,540      100.00

.           drop _merge;

.             sort spdomain product;

.             gen f_share_w=(food_share*hhweight)/tothhweight;

.                                                 *drop descript;
.                         *gen descript = 0;
.             collapse (sum) f_share_w, by(spdomain product descript);

.                      sort spdomain f_share_w;

.           by spdomain: gen cumshr= sum(f_share_w);

.                     count if cumshr<=.075;
  152

.           drop if cumshr<=.075;
(152 observations deleted)

.             lab var f_share_w "average food share for the 13 regions";

. save "$path\work\food_basket_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\food_basket_flex.dta saved

. * List first spatial region to get an idea about contents;
. list product spdomain f_share_w cumshr if spdomain==1;

     +-----------------------------------------------+
     | product        spdomain   f_shar~w     cumshr |
     |-----------------------------------------------|
  1. |     121   Central rural   .0064068   .0767725 |
  2. |     161   Central rural   .0066762   .0834487 |
  3. |     118   Central rural   .0073465   .0907952 |
  4. |     153   Central rural   .0075225   .0983177 |
  5. |     101   Central rural   .0076074   .1059251 |
     |-----------------------------------------------|
  6. |     139   Central rural   .0078916   .1138167 |
  7. |     110   Central rural   .0080346   .1218513 |
  8. |     132   Central rural   .0100711   .1319225 |
  9. |     135   Central rural   .0101237   .1420462 |
 10. |     102   Central rural   .0104644   .1525106 |
     |-----------------------------------------------|
 11. |     150   Central rural   .0112384    .163749 |
 12. |     157   Central rural   .0116523   .1754013 |
 13. |     122   Central rural    .013191   .1885923 |
 14. |     134   Central rural   .0159155   .2045079 |
 15. |     127   Central rural   .0175163   .2220242 |
     |-----------------------------------------------|
 16. |     123   Central rural   .0189618    .240986 |
 17. |     144   Central rural   .0194784   .2604644 |
 18. |     136   Central rural   .0202216   .2806861 |
 19. |     125   Central rural   .0210586   .3017446 |
 20. |     108   Central rural   .0225817   .3243264 |
     |-----------------------------------------------|
 21. |     138   Central rural   .0247066   .3490329 |
 22. |     117   Central rural    .024848   .3738809 |
 23. |     140   Central rural   .0260197   .3999006 |
 24. |     112   Central rural   .0295591   .4294597 |
 25. |     147   Central rural   .0478787   .4773384 |
     |-----------------------------------------------|
 26. |     103   Central rural   .0517283   .5290666 |
 27. |     104   Central rural   .0519577   .5810243 |
 28. |     141   Central rural    .069258   .6502824 |
 29. |     107   Central rural   .0755683   .7258507 |
 30. |     113   Central rural   .1306667   .8565174 |
     |-----------------------------------------------|
 31. |     105   Central rural   .1434826          1 |
     +-----------------------------------------------+

.                     gen numreg=1;

.           collapse (sum) numreg cumshr, by (product descript);

.                           keep product descript numreg;

.           display _N;
46

.                     lab var numreg "number of goods in the basket";

. /*
>           merge product using "$path\work\products.dta";
>             tab _merge;
>           keep if _merge==3;
> */
>           keep product descript numreg;

.             sort product;

.                display _N;
46

.   save "$path/work\codes_food_basket_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work\codes_food_basket_flex.dta sav
> ed

. **************************************************************************
> * 100_food_basket_flex.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 do "$path/new/110_price_unit_flex.do"   /* Flexible baske
> t: Prices */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path\rep\110_price_unit_flex.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\110_price_unit_flex.log
  log type:  text
 opened on:  17 May 2013, 14:58:11

. clear

. set more off

. #delimit ;
delimiter now ;
. ****************************************************************************************
> * 110_price_unit_flex.do                (start)
> *
> * Purpose: This do file creates a price_unit_flex database with the unit prices of the
> * goods of the flexible food basket in order to determine the poverty lines per spatial
> * domain. It uses the files work\daily.dta and work\own.dta file and draw unit prices
> * by: sum of values and quantity
> ****************************************************************************************;
. *CA modified to bring in work\hhdata.dta for bootstrap
> *CA check for price calcs conditional on number of observations;
. /*
> This file uses:
>         work\daily.dta
>         work\own.dta
>         work\hhdata.dta
>         work\consump_nom.dta
>         work\codes_food_basket_flex.dta
>         work\temp_index_reg_tpi.dta
>           new\conversions.do
> 
> This file creates:
>         work\price_unit_flex.dta
>         work\bottom_basket.dta
> */
> 
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************************
> * Create sorted data set with daily and own and the matched codes
> **************************************************************************************;
. use "$path/work/cons_cod_trans.dta", clear;

. *use "$path/in/cons_cod_trans.dta", clear;
. *save "$path/work/cons_cod_trans.dta", replace;
. *drop if quantityd==0 ;
. keep hhid product food_cat valuez quantityz unit;

. rename valuez    value;

. rename quantityz quantity;

. drop if quantity==0 ;
(4392 observations deleted)

. *drop count;
.         sort product;

.         gen count=1;

.                 tempfile dd_acsort;

. save `dd_acsort', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. /*
> use "$path\work\daily.dta";
> tempfile dd_acsort;
>         drop days;
>         sort product;
>         tempfile dd_acsort;
> save `dd_acsort', replace;
> 
> use "$path\work\own.dta";
>         keep hhid product valued quantityd unit;
>         rename valued value;
>         rename quantityd quantity;
> 
>         *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>         drop if quantity==0;
> 
>         append using `dd_acsort';
> 
> *CA modified to merge in work\hhdata.dta for bootstrap;
>         sort hhid;
>       merge hhid using "$path\work\hhdata.dta";
>       tab _m;
> 
> * Drop observations if non existent in HH data set;
> drop if _m!=3;
> drop _m;
> 
> 
>         sort product;
>         gen count=1;
> 
> 
> save `dd_acsort', replace;
> */
> 
> 
> **************************************************************************************;
. * Merge the flexible food basket codes with the daily and own data sets
> * Drop all codes not a part of the flexible food basket
> **************************************************************************************;
.         merge product using "$path\work\codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,257       12.04       12.04
          3 |     74,947       87.96      100.00
------------+-----------------------------------
      Total |     85,204      100.00

.         drop if _merge~=3;
(10257 observations deleted)

.         drop _merge;

. **************************************************************************************;
. * Drop observations where product code or quantity or value information is unavailable
> **************************************************************************************;
.                                 codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           household id
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6749                     missing .:  0/74947

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. *        drop if product==. | value==. | quantity==.  ;
.                                 codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           household id
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6749                     missing .:  0/74947

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. **************************************************************************************;
. * Convert non-KG quantities (units and liters) to kilograms;
. **************************************************************************************;
. *do "$path\new\110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped
> ********************************************************************;
. *        drop if unit~=2;
. ********************************************************************
> * Merge in labels for the 13 spatial domains
> ********************************************************************;
.         preserve;

.                 use "$path/work/hhdata.dta", clear;

.                                                                         keep hhid spdomai
> n reg_tpi survquar;

.                         sort hhid;

.                         tempfile spdomainreg_tpi;

.                 save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

.                                 codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           Household ID
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         restore;

.                 sort hhid;

.         merge hhid using `spdomainreg_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26        0.03        0.03
          3 |     74,947       99.97      100.00
------------+-----------------------------------
      Total |     74,973      100.00

.         drop _merge;

.         drop if product==.;
(26 observations deleted)

. codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           household id
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6749                     missing .:  0/74947

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. tab spd;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |     13,071       17.44       17.44
Central urban |      9,948       13.27       30.71
      Eastern |     16,789       22.40       53.11
     Northern |     19,525       26.05       79.17
      Western |     15,614       20.83      100.00
--------------+-----------------------------------
        Total |     74,947      100.00

. sum if spd>=3;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     51928    3.08e+09    7.88e+08   2.01e+09   4.19e+09
     product |     51928    129.9682    15.72746        101        161
        unit |     51928           1           0          1          1
    food_cat |     51928           1           0          1          1
    quantity |     51928    .9546697      3.8786   .0000286   364.2857
-------------+--------------------------------------------------------
       value |     51928    408.2792    636.9622          0      18500
       count |     51928           1           0          1          1
    descript |     51928           1           0          1          1
      numreg |     51928    4.064917    1.391233          1          5
    survquar |     51928    2.474811    1.138045          1          4
-------------+--------------------------------------------------------
    spdomain |     51928    3.977373    .7896193          3          5
     reg_tpi |     51928    2.977373    .7896193          2          4

. table spdomain, content(mean quantity count quantity count hhid) row missing;

--------------------------------------------------------------
     spdomain | mean(quantity)     N(quantity)         N(hhid)
--------------+-----------------------------------------------
Central rural |       .9857018          13,071          13,071
Central urban |       .6279621           9,948           9,948
      Eastern |       .9517529          16,789          16,789
     Northern |       .8059911          19,525          19,525
      Western |       1.143726          15,614          15,614
              | 
        Total |       .9167167          74,947          74,947
--------------------------------------------------------------

.         drop if product==. | value==. | quantity==.  ;
(0 observations deleted)

. codebook hhid;

-------------------------------------------------------------------------------------------
hhid                                                                           household id
-------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6749                     missing .:  0/74947

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. tab spd;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |     13,071       17.44       17.44
Central urban |      9,948       13.27       30.71
      Eastern |     16,789       22.40       53.11
     Northern |     19,525       26.05       79.17
      Western |     15,614       20.83      100.00
--------------+-----------------------------------
        Total |     74,947      100.00

. ********************************************************************
> * Merge in temporal price index to convert nominal value to real
> ********************************************************************;
.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path\work\temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,947      100.00      100.00
------------+-----------------------------------
      Total |     74,947      100.00

.         drop if _merge ~= 3;
(0 observations deleted)

.         drop _merge;

.         gen value_r=value/tpi_trim;

. **************************************************************************;
. * Identify relatively poor households, based on nominal temporally adjusted
> * consumption per capita. Only work with these households for the price
> * calculations.
> **************************************************************************;
.                 preserve;

.                         use "$path/work/conpc.dta", clear;

. *                       use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.         sort hhid;

.       merge hhid using "$path\work\hhdata.dta";

.       tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.       drop _m;

. *CA modified to keep bswt;
.                                 keep hhid hhweight hhsize cons_pc_nom bswt ;

.                                 sort hhid;

.                                 merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 sort reg_tpi survquar;

.                                 cap drop _merge;

.                                 merge reg_tpi survquar using "$path/work/temp_index_reg_t
> pi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 sort hhid;

.                                 merge hhid using "$path/work/conpc.dta";

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 gen food_pc_tpi  = food_pc_nom /tpi_trim;

.                                 lab var food_pc_tpi "Temp-adjusted per capita food consum
> ption/day";

.                                                                 * Non-food not TPI adjust
> ed ;
.                                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.                                 lab var cons_pc_tpi "Temp adjusted total consumption/day"
> ;

.                                 gen one=1;

.                                 tempfile contpi;

.                                 save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

.                                 collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight],
>  by(spdomain) ;

.                                 rename cons_pc_tpi pctile_60;

.                                 tempfile 60pct;

.                                 sort spdomain;

.                                 save `60pct', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

.                                 use `contpi';

.                                         sort spdomain;

.                                         merge spdomain using `60pct';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.                                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                         drop _merge;

.                                         drop one;

.                                         sort spdomain;

.                                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                                         by spdomain: tab bottom_basket [aw=hhsize*hhweigh
> t];

-------------------------------------------------------------------------------------------
-> spdomain = Central rural

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 589.244333       50.06       50.06
          1 | 587.755667       49.94      100.00
------------+-----------------------------------
      Total |      1,177      100.00

-------------------------------------------------------------------------------------------
-> spdomain = Central urban

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  404.54956       50.01       50.01
          1 |  404.45044       49.99      100.00
------------+-----------------------------------
      Total |        809      100.00

-------------------------------------------------------------------------------------------
-> spdomain = Eastern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 703.563681       50.04       50.04
          1 | 702.436319       49.96      100.00
------------+-----------------------------------
      Total |      1,406      100.00

-------------------------------------------------------------------------------------------
-> spdomain = Northern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |978.1529326       50.01       50.01
          1 |977.8470674       49.99      100.00
------------+-----------------------------------
      Total |      1,956      100.00

-------------------------------------------------------------------------------------------
-> spdomain = Western

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 713.861728       50.03       50.03
          1 | 713.138272       49.97      100.00
------------+-----------------------------------
      Total |      1,427      100.00


.                                         lab var bottom_basket "=1 if in bottom (60%) of P
> CE";

.                                         sort hhid;

.                                                                 save "$path\work\bottom_b
> asket.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\bottom_basket.dta saved

.         restore;

.         sort hhid;

.         merge hhid using "$path\work\bottom_basket.dta";
variable hhid does not uniquely identify observations in the master data
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         26        0.03        0.03
          3 |     74,947       99.97      100.00
------------+-----------------------------------
      Total |     74,973      100.00

.         drop _merge;

.                         * Only keep price observations for the poor ;
.         keep if bottom_basket==1;
(45703 observations deleted)

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * for each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
(14 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(spdomain product);
(14 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
(14 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     29270    2.44e+09    1.15e+09   1.01e+09   4.19e+09
     product |     29256    130.5086    16.06968        101        161
        unit |     29256           1           0          1          1
    food_cat |     29256           1           0          1          1
    quantity |     29256     .854284    3.451506   .0000429        362
-------------+--------------------------------------------------------
       value |     29256    351.5733    534.2158          0      10000
       count |     29256           1           0          1          1
    descript |     29256           1           0          1          1
      numreg |     29256    4.109379    1.355594          1          5
    survquar |     29270    2.513188    1.164029          1          4
-------------+--------------------------------------------------------
    spdomain |     29270    3.170994     1.37962          1          5
     reg_tpi |     29270    2.344517    1.137238          1          4
    tpi_trim |     29270    1.006956    .0732234   .8666803   1.158773
     value_r |     29256    350.6941    531.3288          0      10000
 cons_pc_nom |     29270    1770.058    1254.323   78.55931   7497.299
-------------+--------------------------------------------------------
      hhsize |     29270    5.664298    2.604431          1         24
    hhweight |     29270    5132.164    4169.973        100      60164
        bswt |     29270           1           0          1          1
 cons_hh_nom |     29270    9245.057    7300.657   232.1918   99494.44
 food_pc_nom |     29270    794.9321    526.6051          0   6142.857
-------------+--------------------------------------------------------
   nf_pc_nom |     29270    975.1257    899.9186   23.11263   6683.425
 food_pc_tpi |     29270     785.863    497.9769          0   5590.592
 cons_pc_tpi |     29270    1760.989    1222.805   82.64046   7046.959
   pctile_60 |     29270    2797.325    1851.073   1366.797   7060.442
bottom_bas~t |     29270           1           0          1          1
-------------+--------------------------------------------------------
      hhppkg |     29256    1477.004    7352.146          0   966751.8
      lower5 |     29256    549.4965    586.7083          0   4845.022
      upper5 |     29256    2570.282    2101.692          0    12916.2

. describe;

Contains data from C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp
  obs:        29,270                          
 vars:            28                          17 May 2013 14:58
 size:     3,746,560                          
-------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
-------------------------------------------------------------------------------------------
hhid            double %9.0g                  household id
product         float  %10.0g      HS10A2     Food product code: numerical
unit            float  %10.0g                 set equal to one since all observations are
                                                converted into kg
food_cat        float  %9.0g                  food category equals 1, if product is food
                                                and 0 if non food
quantity        float  %9.0g                  daily quantity consumed in Kgs per household
value           float  %9.0g                  daily value of consumption in UGX per per
                                                household
count           float  %9.0g                  
descript        float  %9.0g       descrip    product description including product code
                                                but equals 2 for all non-foods
numreg          double %9.0g                  number of goods in the basket
survquar        float  %11.0g      lsurvquar
                                              Sequential Survey Quarter May-Jun 09=1)
spdomain        float  %13.0g      spdomain_original
                                              
reg_tpi         float  %9.0g       REG_TPI    
tpi_trim        float  %9.0g                  TRIMMED Temporal price index (Q4=1)
value_r         float  %9.0g                  
cons_pc_nom     float  %9.0g                  
hhsize          double %9.0g                  Household Size
hhweight        float  %9.0g                  Household sample weight
bswt            float  %9.0g                  
cons_hh_nom     double %9.0g                  (sum) cod_hh_nom
food_pc_nom     float  %9.0g                  nominal food consumption per capita
nf_pc_nom       float  %9.0g                  nominal non-food consumption per capita
food_pc_tpi     float  %9.0g                  Temp-adjusted per capita food consumption/day
cons_pc_tpi     float  %9.0g                  Temp adjusted total consumption/day
pctile_60       float  %9.0g                  (p 50) cons_pc_tpi
bottom_basket   float  %9.0g                  =1 if in bottom (60%) of PCE
hhppkg          float  %9.0g                  
lower5          float  %9.0g                  
upper5          float  %9.0g                  
-------------------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

. keep if hhppkg-lower5>=0 & hhppkg-upper5<=0;
(2228 observations deleted)

. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_unitw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_unitt. Last we take the median, price_unitm. But in the end
> * we only use price_unitw
> *********************************************************************;
.         gen price_unitt=value_r/(quantity*1000);

.         gen price_unitm=price_unitt;

.                 *CA modified to count the boot sample weight bswt;
.         collapse (sum) quantity value_r count bswt 
>                  (mean) price_unitt 
>                  (median) price_unitm [aw=hhweight], by(spdomain product);

.         *Generate weighted price per gram ;
.         gen price_unitw=value_r/(quantity*1000);

.         drop value_r quantity;

.         sort spdomain product;

.         lab var price_unitt "simple average of calculated prices - transaction weighted";

.         lab var price_unitm "median of prices";

.         lab var price_unitw "value share weighted mean prices";

. * Get an idea of the difference between the price measures;
.         gen ratiotw=price_unitt/price_unitw;
(1 missing value generated)

.         gen ratiomw=price_unitm/price_unitw;
(1 missing value generated)

.         sum ratiotw ratiomw;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     ratiotw |       228    1.234897    .3907424   .9129278   3.470273
     ratiomw |       228     1.09016    .3749053   .2799477   3.711278

.         sort product;

.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        229      100.00      100.00
------------+-----------------------------------
      Total |        229      100.00

.         count if _merge~=3;
    0

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         sort product spdomain;

. save "$path\work\price_unit_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex.dta saved

. ****************************************************************************************
> * 110_price_unit_flex.do                (end)
> ****************************************************************************************;
. cap log close;

. 
end of do-file

.                                 do "$path/new/120_povline_food_flex.do" /* Flexible baske
> t: Poverty line */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/120_povline_food_flex.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/120_povline_food_flex.l
> og
  log type:  text
 opened on:  17 May 2013, 14:58:14

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information.
> **************************************************************************;
. /*
> This file uses:
>         work\food_basket_flex.dta
>         work\price_unit_flex.dta
>         work\calperg.dta
>         work\calpp.dta
> 
> This file creates:
>         work\povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path\work\price_unit_flex.dta";
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         84       36.68       36.68
          3 |        145       63.32      100.00
------------+-----------------------------------
      Total |        229      100.00

.         list product spdomain descript if _merge==1;

.         drop if _merge ~=3;
(84 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path\work\calperg.dta";
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         16        9.94        9.94
          3 |        145       90.06      100.00
------------+-----------------------------------
      Total |        161      100.00

.         * This tells where we are lacking calorie info or are lacking quantity info due t
> o 
>         * missing price info above;
.         list product spdomain descript if _merge==1;

.         drop if _merge~=3;
(16 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price observations;
.         by spdomain: count if round(bswt)<10;

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    0
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

.         drop if round(bswt) < 10;
(1 observation deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(15 observations deleted)

.         * reobtain the share represented from the average basket- should be slightly more
>  than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

-------------------------------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .9015974           0   .9015974   .9015974

-------------------------------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        20    .9055901           0   .9055901   .9055901

-------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .9036159           0   .9036159   .9036159

-------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        27    .9059228           0   .9059228   .9059228

-------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        28    .9069368           0   .9069368   .9069368


.         * obtain quantities and calories provided by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path\work\calpp.dta";
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        129      100.00      100.00
------------+-----------------------------------
      Total |        129      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie requirements;
.         gen ratio=.95*calpp/calreg;

.                         replace quan=quan*ratio;
(129 real changes made)

.         replace cal_ir=quan*calperg;
(123 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(129 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

-------------------------------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27   -.0000771           0  -.0000771  -.0000771

-------------------------------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        20   -.0000128           0  -.0000128  -.0000128

-------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27   -.0000899           0  -.0000899  -.0000899

-------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        27    .0001413           0   .0001413   .0001413

-------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        28    .0001285           0   .0001285   .0001285


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;

.         * the sum of the value of the goods in the bundle is assumed to represent 90% of 
> expenditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.                                 *************** we change the poverty line for Kampala ur
> ban, to try if it works ************;
. ***             replace povline_f_flex90=povline_f_flex90 + 6000;
.                         replace povline_f_flex=povline_f_flex90/.9;
(129 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path\work\povline_food_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex.dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> **************************************************************************
> * 120_povline_food_flex.do      (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/120_povline_food_flex.l
> og
  log type:  text
 closed on:  17 May 2013, 14:58:14
-------------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/130_povmeas_flex.do"              /* Flexib
> le basket: Poverty rates */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/130_povmeas_flex.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.log
  log type:  text
 opened on:  17 May 2013, 14:58:14

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before any iteration)
> **************************************************************************;
. *CA modified to add work\hhdata.dta for bootstrap;
. /*
> This file uses:
>         in\foodshr96.dta
>         work\povline_f_flex.dta
>         work\consump_nom.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\foodshr96.dta
>         work\povmeas.dta
>         work\povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news rural survmon survquar;

.         tab reg_tpi, miss;

    reg_tpi |      Freq.     Percent        Cum.
------------+-----------------------------------
    central |      1,986       29.31       29.31
    eastern |      1,406       20.75       50.07
   northern |      1,956       28.87       78.94
    western |      1,427       21.06      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         tab survquar, miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |      1,749       25.82       25.82
Sept-Oct 09 |      1,731       25.55       51.37
Nov09-Jan10 |      1,458       21.52       72.89
 Feb-Apr 10 |      1,837       27.11      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path\work\hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(332 real changes made)

.                                         * Nearness to poverty line and population weights
>  ;
.         gen tripopwt=triwt*hhweight*hhsize;

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

.                 tab spdomain;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |          1       20.00       20.00
Central urban |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. **************************************************************************;
. * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.         gen povline_flex=povline_f_flex + povline_na_flex;

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path\work\povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta saved

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path\work\povlines.dta";
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;

.         * Poverty line;
.         gen linpob=povline_flex;

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
         cr2 |    6775   200636622    9416.597   305912.3   84.59628   6.26e+07
      linpob |    6775   200636622    972.5242   203.3228   768.5243    1507.71
     linpobr |    6775   200636622     1162.09   .0000451    1162.09   1162.091

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.         gen h = 100     if cr <=(linpob);
(5940 missing values generated)

.         replace  h = 0 if cr > (linpob);
(5940 real changes made)

.                         gen             pg      = ((linpob - cr )/linpob) *100;

.         replace         pg      = 0             if h==0;
(5940 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;

.         replace         spg     = 0             if h==0;
(5940 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;

.         gen spg_flex=spg;

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path\work\hhdata.dta";
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |   10.64383   .7183087      9.233536    12.05412
     pg_flex |   2.847239   .2301319      2.395409     3.29907
    spg_flex |   1.160688   .1236742      .9178722    1.403505
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
       Urban |   3.415127   1.014682      1.422946    5.407308
       Rural |   11.74798   .7975071      10.18219    13.31377
-------------+------------------------------------------------
pg_flex      |
       Urban |   .7949736   .2336944      .3361487    1.253798
       Rural |   3.160712    .260382       2.64949    3.671934
-------------+------------------------------------------------
spg_flex     |
       Urban |    .247158   .0745631      .1007643    .3935518
       Rural |   1.300225   .1414875      1.022435    1.578015
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

            1: news = 1
            2: news = 2
            3: news = 3
            4: news = 4

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
           1 |    5.85527   1.056141      3.781691    7.928848
           2 |   7.564058   1.320862      4.970739    10.15738
           3 |   20.05523   1.819486      16.48294    23.62753
           4 |   11.88273    1.47859      8.979738    14.78573
-------------+------------------------------------------------
pg_flex      |
           1 |   1.242779   .2633442      .7257408    1.759817
           2 |   1.383358   .2140039      .9631926    1.803523
           3 |   7.022313   .8624984      5.328923    8.715703
           4 |    2.99275   .5015668      2.007997    3.977503
-------------+------------------------------------------------
spg_flex     |
           1 |   .3899434   .0994254      .1947361    .5851507
           2 |   .3536218   .0579814      .2397838    .4674599
           3 |   3.405928    .490854      2.442208    4.369648
           4 |   1.170894   .2908952      .5997633    1.742024
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      central: reg_tpi = central
      eastern: reg_tpi = eastern
     northern: reg_tpi = northern
      western: reg_tpi = western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     central |    5.85527   1.056141      3.781691    7.928848
     eastern |   7.564058   1.320862      4.970739    10.15738
    northern |   20.05523   1.819486      16.48294    23.62753
     western |   11.88273    1.47859      8.979738    14.78573
-------------+------------------------------------------------
pg_flex      |
     central |   1.242779   .2633442      .7257408    1.759817
     eastern |   1.383358   .2140039      .9631926    1.803523
    northern |   7.022313   .8624984      5.328923    8.715703
     western |    2.99275   .5015668      2.007997    3.977503
-------------+------------------------------------------------
spg_flex     |
     central |   .3899434   .0994254      .1947361    .5851507
     eastern |   .3536218   .0579814      .2397838    .4674599
    northern |   3.405928    .490854      2.442208    4.369648
     western |   1.170894   .2908952      .5997633    1.742024
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     KAMPALA |   4.874973   2.339743        .28123    9.468715
   _subpop_2 |   4.815216    1.42435      2.018713    7.611719
   _subpop_3 |   7.336596   1.868566      3.667939    11.00525
   _subpop_4 |   5.450948   1.171204       3.15146    7.750436
     EASTERN |    9.28854   2.149875      5.067575     13.5095
   _subpop_6 |    11.3821   2.080189      7.297956    15.46625
   _subpop_7 |   69.04124   6.131256      57.00341    81.07906
   _subpop_8 |   9.436877   1.618277      6.259627    12.61413
   _subpop_9 |   15.13404   2.510779       10.2045    20.06359
  _subpop_10 |   8.436528    1.29171      5.900445    10.97261
-------------+------------------------------------------------
pg_flex      |
     KAMPALA |   1.156125   .5364251      .1029326    2.209317
   _subpop_2 |   1.054924   .4136337      .2428149    1.867033
   _subpop_3 |   1.472113   .4259365      .6358493    2.308377
   _subpop_4 |   1.078487   .2343785      .6183188    1.538655
     EASTERN |   1.632159   .3314862      .9813346    2.282984
   _subpop_6 |   3.762759   .8867794      2.021697     5.50382
   _subpop_7 |   28.09699   3.531683      21.16305    35.03094
   _subpop_8 |   1.754495   .4095893      .9503265    2.558664
   _subpop_9 |   4.321979   .8772222      2.599681    6.044276
  _subpop_10 |   1.583842   .3230622      .9495568    2.218128
-------------+------------------------------------------------
spg_flex     |
     KAMPALA |   .3262199    .149928      .0318582    .6205817
   _subpop_2 |   .3440746   .1768297     -.0031046    .6912538
   _subpop_3 |   .4639362   .1493101      .1707877    .7570848
   _subpop_4 |    .318168   .0858767      .1495616    .4867744
     EASTERN |   .3825553   .0781365      .2291458    .5359648
   _subpop_6 |   1.667829   .4831084      .7193161    2.616342
   _subpop_7 |   14.74936   2.180789       10.4677    19.03102
   _subpop_8 |   .5462792   .1756408      .2014342    .8911242
   _subpop_9 |   1.823119   .5209048      .8003987    2.845839
  _subpop_10 |   .4795711   .1404659      .2037869    .7553553
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   6.798742   1.382219      4.084957    9.512527
   _subpop_2 |   3.920949   1.470722      1.033401    6.808497
     Eastern |   7.564058   1.320862      4.970739    10.15738
    Northern |   20.05523   1.819486      16.48294    23.62753
     Western |   11.88273    1.47859      8.979738    14.78573
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   1.361359   .3492406      .6756756    2.047041
   _subpop_2 |   .9996648   .3584817      .2958383    1.703491
     Eastern |   1.383358   .2140039      .9631926    1.803523
    Northern |   7.022313   .8624984      5.328923    8.715703
     Western |    2.99275   .5015668      2.007997    3.977503
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |     .43199    .137666      .1617029    .7022771
   _subpop_2 |   .3037389   .1081926      .0913186    .5161592
     Eastern |   .3536218   .0579814      .2397838    .4674599
    Northern |   3.405928    .490854      2.442208    4.369648
     Western |   1.170894   .2908952      .5997633    1.742024
--------------------------------------------------------------

.         compress;
survquar was float now byte
spdomain was float now byte
reg_tpi was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
rmult was float now int
poor09 was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
hhsize was double now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize], by(strata);

. save "$path\work\povmeas.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povmeas.dta saved

. **************************************************************************
> * 130_povmeas_flex.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.log
  log type:  text
 closed on:  17 May 2013, 14:58:14
-------------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/140_iterate.do" $it_n $bottom     /* Flexib
> le basket: Iterations */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/140_iterate.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/140_iterate.log
  log type:  text
 opened on:  17 May 2013, 14:58:14

. clear

. set more off

. #delimit ;
delimiter now ;
. *global povline_initial "$path\in\povlines_first_iof.dta";
. **************************************************************************
> * 140_iterate.do        (start)
> *
> * Purpose: Create flexible food basket and poverty line with iterative procedure
> *
> * This program will take the results from the first pass at the
> * poverty lines and applies the corresponding spatial deflator to
> * re-select the relatively poor, their consumption bundles, and
> * their prices.
> *
> * Welfare indicator is here always temporally and spatially adjusted per capita
> * expenditure. Here called cr_it< >.
> *
> * We will iterate this process 5 times which here assures convergence.
> *
> * CA, Mar 2010: Relatively poor are those below last iterated poverty line
> * MAH, Apr 2010: Cleaning
> * URB, feb 2012: Commented out "drop if unit~=2"
> **************************************************************************;
. /*
> This file uses:
>             in/povlines_first_new.dta
>         work\hhdata.dta
>         work\consump_nom.dta
>         work\own.dta
>         work\daily.dta
>         work\temp_index_reg_tpi.dta
>         work\cons_cod.dta
>         work\food_cat.dta
>         work\cons_real.dta
>         work\products.dta
>         work\match96_02.dta
>         new\conversions.do
>         
> This file creates (where `pass' is the number of the iteration):
>         work\codes_food_basket_flex_it`pass'.dta
>         work\price_unit_flex_it`pass'.dta
>         work\quan_flex_it`pass'.dta
>         work\match_cod_flex_it`pass'.csv
>         work\relpoor_it`pass'.dta
>         work\povlines_it`pass'.dta
>         work\foodshares_it`pass'.dta
>         work\nat_pov_flex.csv
>         work\rur_pov_flex.csv
>         work\strata_pov_flex.csv
>         work\spdomain_pov_flex.csv
>         work\reg_tpi_pov_flex.csv
> */
> 
> **************************************************************************;
. * Make a key file that will be used over and over, without change
> * in every iteration. This will include the TEMPORALLY deflated consumption
> * and various HH data such as hhweight, spdomain, etc.
> **************************************************************************;
. use "$path/work/conpc.dta";

.         sort hhid;

.         merg hhid using "$path\work\hhdata.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.                 gen food_pc_tpi = food_pc_nom /tpi_trim;

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         tempfile contpi;

.         sort hhid;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. *use "$path\in\povlines_first_iterate.dta", clear;
. *save "$path/work/povlines_first.dta", replace;
. **************************************************************************;
. * Now set some information pertaining to the iterations. For now we'll
> * manually set the number of iterations. Also specify the percentile
> * cutpoint that we will use for defining the relatively poor.
> **************************************************************************;
. local lastpass=0;

. local pass=1;

. * Use these two lines to manually specify the number of iterations
> * and the cutpoint here in the do file.;
.   *local maxit=5;
.   *local cutpt=50;
. * Use these few lines if you want to specify the number of iterations
> * and percentile cutpoint by passing them as parameters on the command
> * line, e.g.:   wstata do new\iterate1.do 5 50;
. if "`1'"=="" | "`2'"=="" {      ;
.         di in red "Error: you need to specify number of iterations as first parameter";
.         di in red "       and percentile cutpoint as second parameter on command line.";
. };

. local maxit=`1';

. local cutpt=`2';

. tempfile cutoff;

. while `pass' <= `maxit' {;
  2.         **************************************************************************;
. **************************************************************************;
. * Pick out the bottom X percent in real consumption per capita 
> * (temporally & spatially adjusted), as ranked by the previous iteration.
> * The percentile to use is defined by "cutpt". This produces a file that
> * has the hhid, and a dummy variable indicating if they were below the
> * cutpoint on the last iteration.
> **************************************************************************;
. **************************************************************************;
. /*
> * Comment out if IOF 2008/09. (This code included instead of below code in order to repli
> cate published figures 2002/03). ( START ) ;
> 
>         if "`pass'"=="1" {      ;
>               use `contpi', clear;
>               sort spdomain;
>               merge spdomain using "$path/work/povlines_first.dta";
>               tab _m;
>               drop _m;
> *              gen relpoor`pass'= cons_pc_tpi<=cutoff;
>                gen relpoor`pass'= cons_pc_tpi if cons_pc_tpi<=cutoff;
>               rename cons_pc_tpi cr_it0;
>               sort hhid;
>          save "$path\work\relpoor_it`pass'.dta", replace;
> *        use "$path/work/cons_real.dta", clear;
> *              gen cr_it0=cr2;
>         };
>         
> 
> * Comment out if IOF 2008/09. (This code included instead of below code in order to repli
> cate published figures 2002/03). ( END ) ;
> */
> 
> 
> 
> * Comment out if IAF 2002/03. (This code below excluded in order to replicate published f
> igures 2002/03). ( START ) ;
.         if "`pass'"=="1" { ;
  3. * Find real income at cut point initially;
.                 use "$path/work/cons_real.dta", clear;
  4.                                     gen cr_it0=cr2;
  5.                         cap drop one;
  6.             gen one=1;
  7.                                     collapse (p`cutpt') one cr_it`lastpass' [aw=popwt]
>  ;
  8.                                     rename cr_it`lastpass' cutoff;
  9.                                     sort one;
 10.             save `cutoff', replace;
 11.  * Find relatively poor initially;
.             use "$path/work/cons_real.dta", clear;
 12.                                                 gen cr_it`lastpass'=cr2;
 13.             cap drop one;
 14.             gen one=1;
 15.                                     sort one;
 16.             merge one using `cutoff';
 17.             tab _merge;
 18.             drop _merge;
 19.                                     drop one;
 20.                            gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 21.             *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                     tab relpoor`pass' [aw=popwt];
 22.                                     keep hhid cr_it`lastpass' relpoor`pass' popwt;
 23.             sort hhid;
 24.         save $path\work\relpoor_it`pass'.dta, replace;
 25.         };
 26. * Comment out if IAF 2002/03. (This code below excluded in order to replicate publishe
> d figures 2002/03). ( END ) ;
.                 if `pass'>1 {   ;
 27. * Find real income at cut point in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta" , clear;
 28.                                                 cap drop one;
 29.                 gen one=1;
 30.                                                                 *CA modified from hhwe
> ight*hhsize to popwt;
.                 collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
 31.                         rename cr_it`lastpass' cutoff;
 32.                                                                         sort one;
 33.         save `cutoff', replace;
 34.         * Find relatively poor in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta", clear;
 35.                                                 cap drop one;
 36.                 gen one=1;
 37.                                                 sort one;
 38.                 merge one using `cutoff';
 39.                 tab _merge;
 40.                 drop _merge;
 41.                                                 drop one;
 42.                 gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 43.                 *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                                 tab relpoor`pass' [aw=popwt];
 44. *CA modified to popwt above and to keep popwt below;
.                 keep hhid cr_it`lastpass' relpoor`pass' popwt;
 45.                 sort hhid;
 46.         save "$path\work\relpoor_it`pass'.dta", replace;
 47.         };
 48.         **************************************************************************;
. * Get the consumption file, and select only those codes that are food,
> * using our definition of "food", which includes alcoholic beverages.
> **************************************************************************;
.         use "$path/work/cons_cod.dta", clear;
 49. *CA modified to merge in work\hhdata.dta for bootstrap;
.     sort hhid;
 50.     merge hhid using "$path\work\hhdata.dta";
 51.     tab _m;
 52.     drop _m;
 53.         /*
>                 sort product;
>                 merge product using "$path/work/food_cat.dta";
>                 tab _merge;
>                 keep if _merge==3;
>                 drop _merge;
> */
> 
>                                 * Only food transactions ;
.                 keep if food_cat;
 54.                 sort hhid;
 55. **************************************************************************;
. * Merge with file that has temporally AND spatially adjusted consumption
> * per capita from the previous iteration, and also identifies those below 
> * the cutoff. Then select only those who are below the cutoff.
> **************************************************************************;
.                 merge hhid using "$path\work\relpoor_it`pass'.dta";
 56.                 tab _merge;
 57.                 drop _merge;
 58.                                 * Keep only transactions by the poor ;
.                 keep if relpoor`pass';
 59. **************************************************************************;
. * Calculate HH level food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.                 gen  food_expenditure = cod_hh_nom3;
 60.                 *gen  food_expenditure= own_valued + daily_valued + monthly_valued + e
> duc_valued;
.                 egen tot_food_expen= sum (food_expen), by (hhid) ;
 61.                 count if food_expenditure==.;
 62.                 count if tot_food_expen==.;
 63.                 gen food_share= food_expenditure/tot_food_expen;
 64.                 count if food_share==.;
 65.                 drop if food_share==.;
 66.                 sort hhid product;
 67.                 tempfile foodshares;
 68.         save `foodshares', replace;
 69. ********************************************************************************;
. * Now find the total (economy wise, e.g. not by HH) shares by each product in
> * order to select the most important goods in each domain's basket.
> ********************************************************************************;
.                 collapse (mean) hhweight spdomain, by (hhid);
 70.                 sort hhid ;
 71.                  collapse (sum) hhweight , by(spdomain);
 72.                 rename hhweight tothhweight;
 73.                 tempfile tothhweight;
 74.                 sort spdomain;
 75.         save `tothhweight', replace;
 76.         use `foodshares', clear;
 77.                 sort spdomain;
 78.                 merge spdomain using `tothhweight';
 79.                 tab _merge;
 80.                 drop _merge;
 81.                 sort spdomain product;
 82.                 gen f_share_w`pass'=(food_share*hhweight)/tothhweight;
 83.                 collapse (sum) f_share_w`pass', by(spdomain product descript);
 84.                                sort spdomain f_share_w`pass';
 85.                 by spdomain: gen cumshr`pass'= sum(f_share_w`pass');
 86.                 count if cumshr`pass'<=.075;
 87.                 drop if cumshr`pass'<=.075;
 88.                 lab var f_share_w`pass' "average food share for the 13 spatial domains
> ";
 89.         save `foodshares', replace;
 90.                                                 * Number of spatials domains a food pr
> oduct appears ;
.                 gen numreg=1;
 91.                 collapse (sum) numreg cumshr`pass', by (product descript);
 92.                 keep product numreg descript;
 93.                 display _N;
 94.                 sort product;
 95.                                 * Include food product labels ;
. *                merge product using "$path\work\products.dta";
. *                tab _merge;
. *                keep if _merge==3;
.                 keep product descript numreg;
 96.                   sort product;
 97.                      display _N;
 98.           save "$path\work\codes_food_basket_flex_it`pass'.dta", replace;
 99. **************************************************************************;
. **************************************************************************;
. * That is pretty much the part equivalent to "100_food_basket_flex.do",
> * which figures out the food shares for the relevant reference group. Now
> * we figure out the prices with a code stream that is adapted from
> * "110_price_unit_flex.do".
> **************************************************************************;
. **************************************************************************;
. **************************************************************************************
> * Create sorted data set with daily + own expenditure and the matched codes
> **************************************************************************************;
. use "$path/in/cons_cod_trans.dta", clear;
100. *save "$path/work/cons_cod_trans.dta", replace;
. *drop value   ;
. *drop quantity;
. keep hhid product food_cat valuez quantityz unit;
101. rename valuez    value;
102. rename quantityz quantity;
103. *drop count;
. drop if quantity==0 ;
104.         tempfile dd_acsort;
105.         save    `dd_acsort', replace;
106. /*
>         use "$path\work\daily.dta", clear;
>                 drop days;
>                 sort product;
>                 tempfile dd_acsort;
>         save `dd_acsort', replace;
>         
>         use "$path\work\own.dta", clear;
>                 keep hhid product valued quantityd unit;
>                 rename valued value;
>                 rename quantityd quantity;
>         
>                 *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>                 drop if quantity==0;
>         
>                 append using `dd_acsort';
> */
> 
>                 *CA modified to insert work\hhdata.dta for bootstrap;
.                 sort hhid;
107.                 merge hhid using "$path\work\hhdata.dta";
108.                 tab _m;
109.                  drop if _m==2;
110.                 drop _m;
111.                                 sort product;
112.                 gen count=1;
113.         save `dd_acsort', replace;
114.         **************************************************************************;
. * Merge the basket codes with the dd  and own data sets.
> * Drop all codes not a part of the flexible food basket
> **************************************************************************;
.                 merge product using "$path\work\codes_food_basket_flex_it`pass'.dta";
115.                         tab _merge;
116.                 drop if _merge~=3;
117.                 drop _merge;
118. **************************************************************************************
> * Drop observations where product code, quantity or value information is unavailable
> **************************************************************************************;
.                 drop if product==. | value==. | quantity==.  ;
119.         ******************************************************************************
> ********
> * Convert non-KG quantities (units, liters) into kilograms
> **************************************************************************************;
. *do "$path\new\110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped.
> ********************************************************************;
. *                $MZ drop if unit~=2;
.         **************************************************************************;
. * Bring in the spdomain and reg_tpi variables, and also the information on
> * relatively poor households.
> **************************************************************************;
.                 preserve;
120.                                                 * Temporally adjusted expenditure ;
.                         use `contpi', clear;
121.                                 keep hhid hhweight spdomain reg_tpi survquar tpi_trim 
> cons_pc_tpi ;
122.                                 sort hhid;
123.                                 tempfile hhd2;
124.                         save `hhd2', replace;
125.                 restore;
126.                                 compress;
127.                 sort hhid;
128.                 merge hhid using `hhd2';
129.                 tab _merge;
130.                 drop _merge;
131.                 sort hhid;
132.                 merge hhid using "$path\work\relpoor_it`pass'.dta";
133.                 tab _merge;
134.                 drop _merge;
135.                                                 * Keep nominal food transactions by po
> or people ;
.                 keep if relpoor`pass';
136.                 drop if product==.;
137.                                                                 * Temporally deflate t
> ransaction values ;
.                 gen value_r=value/tpi_trim;
138. **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
139.                 egen lower5=pctile(hhppkg), p(5)  by(spdomain product);
140.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
141.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
142. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_uw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_ut. Last we take the median, price_um. But in the end
> * we only use price_unitw
> *********************************************************************;
.                 gen price_ut`pass'=value_r/(quantity*1000);
143.                 gen price_um`pass'=price_ut;
144.                 collapse (sum) 
>                         quantity value_r count bswt (mean) price_ut (median) price_um [aw
> =hhweight], 
>                         by(spdomain product);
145.                 *Generate weighted price per gram ;
.                 gen price_uw`pass'=value_r/(quantity*1000);
146.                 drop value_r quantity;
147.                 sort spdomain product;
148.                 lab var price_ut`pass' "Average of calculated prices - transaction wei
> ghted";
149.                 lab var price_um`pass' "Median of prices";
150.                 lab var price_uw`pass' "Value share weighted mean prices";
151. * Get an idea of the difference between the price measures;
.                 gen ratiotw`pass'=price_ut`pass'/price_uw`pass';
152.                 gen ratiomw`pass'=price_um`pass'/price_uw`pass';
153.                 sum ratiotw`pass' ratiomw`pass';
154.                 sort product;
155.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.dta";
156.                 tab _m;
157.                 count if _merge~=3;
158.                 drop if _merge~=3;
159.                 drop _merge;
160.                 sort product spdomain;
161.         save "$path\work\price_unit_flex_it`pass'.dta", replace;
162. **************************************************************************;
. **************************************************************************;
. * That concludes the prices part. Now we move to calculating the food
> * poverty lines, which draws code from "120_povline_flex.do" with very few
> * changes:
> * - The changes facilitate accumulating vectors
> *   of intermediate results across iterations, rather than generating a
> *   bunch of new files.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************;
. * Use the file with the food basket (`foodshares'), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information, but list them out.
> **************************************************************************;
.         use `foodshares', clear;
163.                 sort product spdomain;
164.                 merge product spdomain using "$path\work\price_unit_flex_it`pass'.dta"
> ;
165.                         tab _merge;
166.                 list product spdomain descript if _merge==1;
167.                         drop if _merge ~=3;
168.                 drop _merge;
169.                 sort product;
170.                         merge product using "$path\work\calperg.dta";
171.                 tab _merge;
172.                                                 * This tells where we are lacking calo
> rie info or are lacking quantity info due to 
>                 * missing price info above;
.                 list product spdomain descript if _merge==1;
173.                         drop if _merge~=3;
174.                 drop _merge;
175.                 sort spdomain f_share_w`pass';
176.                                 *CA modified to change count bswt;
.                 by spdomain: count if round(bswt)<10;
177.                                 sum bswt;
178.                                                 drop if round(bswt) < 10;
179.                                                                 * Total food share in 
> spatial domain ;
.                 by spdomain: egen baskshr=sum(f_share_w`pass');
180.                                 * Cumulated food share in spatial domain ;
.                 by spdomain: gen  cumshr =sum(f_share_w`pass');
181.                 drop if cumshr<=baskshr-.9;
182.                         drop baskshr;
183.                 by spdomain: egen baskshr=sum(f_share_w`pass');
184.                 tabstat baskshr , by(spdomain) st(n mean sd min max);
185.                                                                 * How many grams in 1 
> MT exp on food item ;
.                                 gen quan`pass'=f_share_w`pass'/price_uw`pass';
186.                                 * How many calories in 1 MT exp on food item ;
.                 gen cal_ir`pass'=quan`pass'*calperg;
187.                                 * how many calories in 1 MT exp in food basket ;
.                 by spdomain: egen calreg=sum(cal_ir);
188.                         sort spdomain;
189.                 merge spdomain using "$path\work\calpp.dta";
190.                 tab _merge;
191.                 drop _merge;
192.                                                         * get the expansion factor to 
> hit 95% of calorie requirements ;
.                 gen ratio=.95*calpp/calreg;
193.                         replace quan`pass'=quan`pass'*ratio;
194.                 replace cal_ir`pass'=quan`pass'*calperg;
195.                         sort spdomain product;
196.                 by spdomain: egen chkcal=sum(cal_ir`pass');
197.                 replace chkcal=chkcal/.95-calpp ;
198.                                                 tabstat chkcal , by(spdomain) st(n mea
> n sd min max);
199.                         gen val_ir`pass'=quan`pass'*price_uw`pass';
200.                         by spdomain: egen povline_f_flex90_`pass'=sum(val_ir`pass');
201.                 replace povline_f=povline_f_flex90_`pass'/.9;
202.                 *drop product96;
. keep product spdomain quan`pass'  price_uw`pass' val_ir`pass' povline_f_flex90_`pass' cal
> pp calperg;
203.                     save "$path\work\quan_flex_it`pass'.dta", replace;
204.                         collapse (mean) povline_f_flex90_`pass', by (spdomain);
205.                                                 keep spdomain povline_f_flex90_`pass';
206.                 sort spdomain;
207.                 save "$path\work\povline_food_flex_it`pass'.dta", replace;
208.         **************************************************************************;
. **************************************************************************;
. * Now comes the part that draws the non-food and total poverty lines,
> * and generates estimates of poverty measures. This is drawn from 
> * "130_povmeas_flex.do" with a few changes.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
.         use `contpi', clear;
209.                 sort spdomain;
210.                 merge spdomain using "$path/work/povline_food_flex_it`pass'.dta";
211.                 tab _merge;
212.                 drop _merge;
213.                 gen triwt=0 ;
214.                 replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex90_`pass'-
> 1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex90_`pass'-1)<=0.2;
215.                                                                 * Nearness to poverty 
> line and population weights ;
.                 gen tripopwt=triwt*hhweight*hhsize;
216.                                                 preserve;
217.                         collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                                 by(spdomain);
218.                         rename nf_pc_nom povline_nf_flex`pass';
219.                         lab var povline_nf_flex`pass' "Nonfood poverty line. Flexible 
> bundle";
220.                         tempfile znf;
221.                         sort spdomain;
222.                         save `znf', replace;
223.                                                                 restore;
224.                                 sort spdomain;
225.                 merge spdomain using `znf';
226.                 tab _merge;
227.                 drop _merge;
228. **************************************************************************
> * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.                 gen povline_flex`pass'=povline_f_flex90_`pass' + povline_nf_flex`pass';
229. keep spdomain povline_flex`pass';
230.                 sort spdomain;
231.         save "$path\work\povlines_it`pass'.dta", replace;
232. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
.         use `contpi', clear;
233.                 sort spdomain;
234.                 merge spdomain using "$path\work\povlines_it`pass'.dta";
235.                 tab _merge;
236.                 drop _merge;
237.                 gen cr= cons_pc_tpi ;
238.                 gen linpob`pass'=povline_flex`pass';
239.                 qui sum linpob`pass' if spdomain==1, meanonly;
240.                 global spi_base=r(mean);
241.                 gen spi`pass'=linpob`pass'/$spi_base;
242.                 gen cr_it`pass'=cr/spi`pass';
243.                 qui sum cr [aw=hhweight*hhsize];
244.                 global sumcr=r(sum);
245.                 qui sum cr_it`pass' [aw=hhweight*hhsize];
246.                 global sumcr2=r(sum);
247.                 replace spi`pass'=spi`pass'*$sumcr2/$sumcr;
248.                 gen linpobr`pass'=linpob`pass'/spi`pass';
249.                 replace cr_it`pass'=cr/spi`pass';
250.                 su cr cr_it`pass' linpob`pass' linpobr`pass' [aw=hhweight*hhsize];
251.                 lab var cr "Temporally-adjusted cons pc";
252.                 lab var cr_it`pass' "Spatially & temporally adjusted cons pc";
253.                 lab var linpob`pass' "Poverty line";
254.                 lab var linpobr`pass' "Real poverty line";
255.                 lab var spi`pass' "Spatial price index";
256.                 gen linpob=linpob`pass';
257. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.                 gen h=100 if cr_it`pass'<=linpobr`pass' & linpobr`pass'~=. & cr_it`pass'~
> =.;
258.                 replace  h   = 0 if cr_it`pass' > linpobr`pass' & linpobr`pass'~=. & c
> r_it`pass'~=.;
259.                 gen      pg  = ((linpobr`pass' - cr_it`pass' )/linpobr`pass') *100;
260.                 replace  pg  = 0             if h==0;
261.                 gen      spg = ((( linpobr`pass' - cr_it`pass' )/ linpobr`pass' )^2)*1
> 00;
262.                 replace  spg = 0             if h==0;
263.                 gen h_flex`pass'  =h;
264.                 gen pg_flex`pass' =pg;
265.                 gen spg_flex`pass'=spg;
266.                                 lab var h_flex`pass'   "Poverty headcount. Flexible bu
> ndle";
267.                 lab var pg_flex`pass'  "Poverty gap. Flexible bundle";
268.                 lab var spg_flex`pass' "Squared poverty gap. Flexible bundle";
269.                 gen popwt=hhsize*hhweight;
270.                         * Stata 10.1 syntax ;
.                         svyset , clear;
271.                         svyset [pweight=popwt] , str(strata) psu(psu);
272.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass';
273.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(rural);
274.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata);
275.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata rura
> l);
276.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(spdomain);
277. *preserve;
. keep hhid popwt cr_it`pass' h_flex`pass' pg_flex`pass' spg_flex`pass' rural news reg_tpi 
> strata spdomain;
278.                 compress;
279.                 sort hhid;
280.         save "$path/work/cons_real_it`pass'.dta" , replace;
281. *restore;
.                                 * New cutoff point (percentile) to use in next iteration 
> is equal to the poverty ;
.                 * rate in this iteration ;
.                                                 sum h_flex`pass' [aw=popwt] ;
282.                                 * Comment out next line for IAF 2002/03 in order to re
> plicate official figures ( START );
.                 * URB: In this case, we just use the poorest 50% as there are too few act
> ually poor to calculate the bundle and prices..;
.                 local cutpt= $tpi_bottom;
283. *               local cutpt= round(r(mean));
.                 * Comment out next line for IAF 2002/03 in order to replicate official fi
> gures ( END );
. *       save foodshares tempfile to disk;
.         use `foodshares', clear;
284.         save "$path/work/foodshares_it`pass'.dta", replace;
285.         local lastpass = `pass';
286.         local pass = `pass' + 1;
287.         };
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |3,385.27023       49.97       49.97
          1 |3,389.72977       50.03      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it1.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(236943 observations deleted)
    0
    0
(1056 missing values generated)
 1056
(1056 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    174,046      100.00      100.00
------------+-----------------------------------
      Total |    174,046      100.00
  157
(157 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
44
44
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_it1.dta
>  saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,946       12.85       12.85
          3 |     74,258       87.15      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(10946 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         31        0.04        0.04
          3 |     74,258       99.96      100.00
------------+-----------------------------------
      Total |     74,289      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,289      100.00      100.00
------------+-----------------------------------
      Total |     74,289      100.00
(45609 observations deleted)
(12 observations deleted)
(2152 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw1 |       217    1.251191     .448038   .8475722   3.914069
    ratiomw1 |       217    1.074148    .3540401    .245101   3.711278
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        217      100.00      100.00
------------+-----------------------------------
      Total |        217      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it1.dta saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         66       30.41       30.41
          3 |        151       69.59      100.00
------------+-----------------------------------
      Total |        217      100.00
(66 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         18       10.65       10.65
          3 |        151       89.35      100.00
------------+-----------------------------------
      Total |        169      100.00
(18 observations deleted)

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       151    164.1457    155.3981          3       1009
(4 observations deleted)
(13 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9029499         0  .9029499  .9029499
Central urban |        26  .8966053         0  .8966053  .8966053
      Eastern |        27  .9070574         0  .9070574  .9070574
     Northern |        26  .9010552         0  .9010552  .9010552
      Western |        28  .9008005         0  .9008005  .9008005
--------------+--------------------------------------------------
        Total |       134  .9017297  .0033866  .8966053  .9070574
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        134      100.00      100.00
------------+-----------------------------------
      Total |        134      100.00
(134 real changes made)
(128 real changes made)
(134 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0000771         0 -.0000771 -.0000771
Central urban |        26 -.0000128         0 -.0000128 -.0000128
      Eastern |        27 -.0000899         0 -.0000899 -.0000899
     Northern |        26 -.0001156         0 -.0001156 -.0001156
      Western |        28  .0001285         0  .0001285  .0001285
--------------+--------------------------------------------------
        Total |       134 -.0000317  .0000892 -.0001156  .0001285
-----------------------------------------------------------------
(134 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it1.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it1.dta save
> d
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(345 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000009.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000009.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it1.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
      cr_it1 |    6775   200636622    9416.597   340357.7   79.80023   6.97e+07
     linpob1 |    6775   200636622    986.9416   149.2447   804.5524   1295.862
    linpobr1 |    6775   200636622    1113.147    .000061   1113.147   1113.147
(5887 missing values generated)
(5887 real changes made)
(5887 real changes made)
(5887 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex1 |   12.07186   .8211121      10.45972    13.68399
    pg_flex1 |   3.126904   .2439756      2.647894    3.605915
   spg_flex1 |   1.280613   .1306726      1.024057     1.53717
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
       Urban |    3.09348   1.002434      1.125347    5.061614
       Rural |   13.44326    .909319      11.65794    15.22857
-------------+------------------------------------------------
pg_flex1     |
       Urban |   .5691306    .155945      .2629553    .8753059
       Rural |   3.517591   .2758792      2.975942    4.059239
-------------+------------------------------------------------
spg_flex1    |
       Urban |    .156755   .0509944       .056635     .256875
       Rural |   1.452277   .1493321      1.159085    1.745469
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
     KAMPALA |   4.167031   2.378903     -.5035977     8.83766
   _subpop_2 |   4.687181   1.414427       1.91016    7.464201
   _subpop_3 |   7.466226   1.867819      3.799037    11.13341
   _subpop_4 |   8.127774   1.612551      4.961766    11.29378
     EASTERN |   11.80657   2.253825      7.381518    16.23163
   _subpop_6 |    12.6968   2.422978      7.939638    17.45397
   _subpop_7 |   70.68732   6.344248      58.23131    83.14332
   _subpop_8 |   14.91821   4.568717      5.948203    23.88822
   _subpop_9 |   15.53387   2.493286      10.63867    20.42907
  _subpop_10 |   8.565702   1.297511      6.018228    11.11318
-------------+------------------------------------------------
pg_flex1     |
     KAMPALA |   .6018409   .2806061      .0509117     1.15277
   _subpop_2 |   1.010567   .4124794       .200724     1.82041
   _subpop_3 |   1.476493    .430482      .6313045    2.321681
   _subpop_4 |   1.403492    .283686      .8465165    1.960468
     EASTERN |   2.179866   .4358687      1.324101     3.03563
   _subpop_6 |   4.130648   .9415078      2.282135    5.979161
   _subpop_7 |   29.97953   3.635916      22.84094    37.11812
   _subpop_8 |   2.229238   .4344902       1.37618    3.082296
   _subpop_9 |    4.48949   .8965312      2.729282    6.249699
  _subpop_10 |   1.689167   .3324043       1.03654    2.341795
-------------+------------------------------------------------
spg_flex1    |
     KAMPALA |   .1262102   .0718565     -.0148695    .2672899
   _subpop_2 |    .325635    .178179     -.0241934    .6754635
   _subpop_3 |   .4549592   .1506456      .1591886    .7507297
   _subpop_4 |   .4290395   .1033595      .2261083    .6319707
     EASTERN |   .5661022   .1102924      .3495592    .7826453
   _subpop_6 |   1.867352   .5188536      .8486593    2.886046
   _subpop_7 |   16.00189   2.301123      11.48397     20.5198
   _subpop_8 |   .6711484   .1940692       .290122    1.052175
   _subpop_9 |   1.901125   .5303656      .8598298    2.942421
  _subpop_10 |   .5145209    .145442      .2289668    .8000751
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   4.167031   2.378903     -.5035977     8.83766
   _subpop_2 |   2.604401   1.859877     -1.047195    6.255998
   _subpop_3 |   5.219631   1.655129      1.970027    8.469236
   _subpop_4 |   2.403186   1.706288     -.9468601    5.753233
   _subpop_5 |   8.511507   2.164837      4.261165    12.76185
   _subpop_6 |          0  (omitted)
   _subpop_7 |   8.582742   1.691107        5.2625    11.90298
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   12.44788    2.37598      7.782995    17.11278
  _subpop_10 |          0  (omitted)
  _subpop_11 |   14.08018   2.606576      8.962552    19.19781
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   73.05174   6.462656      60.36326    85.74022
  _subpop_14 |   4.767413    4.38237      -3.83673    13.37156
  _subpop_15 |   16.42196   4.948369      6.706559    26.13736
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   16.12309    2.58123      11.05522    21.19095
  _subpop_18 |          0  (omitted)
  _subpop_19 |   9.002203   1.347625      6.356338    11.64807
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   .6018409   .2806061      .0509117     1.15277
   _subpop_2 |   .4430265   .3644822      -.272581    1.158634
   _subpop_3 |   1.155656   .4982427       .177429    2.133882
   _subpop_4 |   .6128374   .4276291     -.2267498    1.452425
   _subpop_5 |   1.654797   .5035542      .6661424    2.643453
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.482056   .2987972       .895411      2.0687
   _subpop_8 |   1.005186   .6345417     -.2406436    2.251016
   _subpop_9 |   2.272861   .4607755      1.368195    3.177526
  _subpop_10 |          0  (omitted)
  _subpop_11 |   4.580703   1.022901      2.572386     6.58902
  _subpop_12 |    5.05295   2.860079     -.5623967     10.6683
  _subpop_13 |    30.9025   3.755212      23.52969    38.27531
  _subpop_14 |   .4071471   .3686013     -.3165476    1.130842
  _subpop_15 |   2.499164   .4876904      1.541655    3.456673
  _subpop_16 |   1.153102   1.134055     -1.073449    3.379653
  _subpop_17 |   4.698029   .9351123      2.862072    6.533985
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.775246    .346993      1.093976    2.456516
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .1262102   .0718565     -.0148695    .2672899
   _subpop_2 |   .0863861   .0799939     -.0706701    .2434424
   _subpop_3 |   .3867977   .2193717     -.0439067     .817502
   _subpop_4 |   .1992658   .1429841     -.0814625    .4799941
   _subpop_5 |   .5077479   .1773066      .1596323    .8558635
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .4530559     .10902      .2390111    .6671006
   _subpop_8 |   .2735389   .1722445      -.064638    .6117158
   _subpop_9 |   .5892634     .11673      .3600811    .8184457
  _subpop_10 |          0  (omitted)
  _subpop_11 |    2.07081   .5678711      .9558781    3.185742
  _subpop_12 |   3.737353   2.115422     -.4159699    7.890676
  _subpop_13 |   16.45601   2.384544      11.77431    21.13772
  _subpop_14 |   .0400301   .0358629     -.0303815    .1104417
  _subpop_15 |   .7646429   .2262934      .3203489    1.208937
  _subpop_16 |   .2957981   .2909121     -.2753652    .8669615
  _subpop_17 |   2.001465   .5562213      .9094056    3.093524
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .5407404     .15238      .2415646    .8399162
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   6.877505   1.381672      4.164794    9.590216
   _subpop_2 |   3.384492   1.450191       .537255    6.231729
     Eastern |   10.15345   1.452561      7.301557    13.00534
    Northern |   22.83015   2.194077       18.5224     27.1379
     Western |   12.15117   1.472407      9.260317    15.04203
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   1.407036   .3554693      .7091243    2.104948
   _subpop_2 |   .5628675   .2022758      .1657285    .9600064
     Eastern |    1.83099   .2765017       1.28812    2.373861
    Northern |    7.67136   .8918584      5.920326    9.422393
     Western |   3.130073    .512863      2.123142    4.137005
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .4477113   .1409541      .1709685    .7244542
   _subpop_2 |   .1314229   .0536291        .02613    .2367157
     Eastern |    .504511   .0770385      .3532572    .6557647
    Northern |   3.750636   .5236829      2.722461    4.778811
     Western |   1.227998   .2965709      .6457244    1.810271
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex1 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it1.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex1 |    6775   200636622    12.07186    32.5824          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it1.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 3,383.9009       49.95       49.95
          1 | 3,391.0991       50.05      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it2.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(239636 observations deleted)
    0
    0
(961 missing values generated)
  961
(961 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000b.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000b.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    171,448      100.00      100.00
------------+-----------------------------------
      Total |    171,448      100.00
  154
(154 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved
45
45
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_it2.dta
>  saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,440       12.25       12.25
          3 |     74,764       87.75      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(10440 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         31        0.04        0.04
          3 |     74,764       99.96      100.00
------------+-----------------------------------
      Total |     74,795      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,795      100.00      100.00
------------+-----------------------------------
      Total |     74,795      100.00
(46445 observations deleted)
(11 observations deleted)
(2128 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw2 |       220    1.299956    .5770647   .9367496   5.086008
    ratiomw2 |       220    1.094258    .4340351          0   4.571821
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        220      100.00      100.00
------------+-----------------------------------
      Total |        220      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it2.dta saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         71       32.27       32.27
          3 |        149       67.73      100.00
------------+-----------------------------------
      Total |        220      100.00
(71 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         17       10.24       10.24
          3 |        149       89.76      100.00
------------+-----------------------------------
      Total |        166      100.00
(17 observations deleted)

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       149    163.3221    159.2556          3       1013
(4 observations deleted)
(13 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9016237         0  .9016237  .9016237
Central urban |        24   .887368         0   .887368   .887368
      Eastern |        27  .9049115         0  .9049115  .9049115
     Northern |        26  .9009634         0  .9009634  .9009634
      Western |        28  .9012133         0  .9012133  .9012133
--------------+--------------------------------------------------
        Total |       132  .8994872  .0059146   .887368  .9049115
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        132      100.00      100.00
------------+-----------------------------------
      Total |        132      100.00
(132 real changes made)
(126 real changes made)
(132 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0000771         0 -.0000771 -.0000771
Central urban |        24 -.0000128         0 -.0000128 -.0000128
      Eastern |        27 -.0000899         0 -.0000899 -.0000899
     Northern |        26  .0001413         0  .0001413  .0001413
      Western |        28  .0001285         0  .0001285  .0001285
--------------+--------------------------------------------------
        Total |       132  .0000186  .0001003 -.0000899  .0001413
-----------------------------------------------------------------
(132 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it2.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it2.dta save
> d
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(328 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it2.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
      cr_it2 |    6775   200636622    9416.597   353051.3   76.14498   7.23e+07
     linpob2 |    6775   200636622    957.3001   141.4629    804.249   1185.045
    linpobr2 |    6775   200636622    1056.399   .0000516   1056.399   1056.399
(5917 missing values generated)
(5917 real changes made)
(5917 real changes made)
(5917 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex2 |   11.03792    .798673      9.469841      12.606
    pg_flex2 |   2.946653   .2376808      2.480002    3.413305
   spg_flex2 |   1.220436   .1295978      .9659893    1.474882
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
       Urban |   2.143004   .6487767      .8692255    3.416782
       Rural |   12.39657   .8877841      10.65354     14.1396
-------------+------------------------------------------------
pg_flex2     |
       Urban |   .4032605   .1245237      .1587765    .6477446
       Rural |   3.335143   .2690595      2.806884    3.863402
-------------+------------------------------------------------
spg_flex2    |
       Urban |    .111714   .0426182      .0280393    .1953887
       Rural |   1.389787   .1482838      1.098653     1.68092
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   4.596846   1.414618       1.81945    7.374241
   _subpop_3 |   6.936931   1.852727      3.299373    10.57449
   _subpop_4 |   5.450948   1.171204       3.15146    7.750436
     EASTERN |    9.28854   2.149875      5.067575     13.5095
   _subpop_6 |    12.6968   2.422978      7.939638    17.45397
   _subpop_7 |   70.68732   6.344248      58.23131    83.14332
   _subpop_8 |   14.91821   4.568717      5.948203    23.88822
   _subpop_9 |     15.421   2.497656      10.51722    20.32478
  _subpop_10 |   8.512285   1.293816      5.972066     11.0525
-------------+------------------------------------------------
pg_flex2     |
     KAMPALA |   .2953662   .1929501     -.0834631    .6741954
   _subpop_2 |   .9403086   .4035669      .1479639    1.732653
   _subpop_3 |   1.400256   .4194401      .5767471    2.223766
   _subpop_4 |   1.090376   .2363367      .6263629    1.554388
     EASTERN |   1.652977   .3358824      .9935211    2.312433
   _subpop_6 |   4.127417   .9410278      2.279847    5.974988
   _subpop_7 |   29.96418   3.635036      22.82732    37.10104
   _subpop_8 |   2.224452   .4341273      1.372107    3.076798
   _subpop_9 |   4.429747   .8897274      2.682897    6.176596
  _subpop_10 |   1.651767   .3290279      1.005769    2.297765
-------------+------------------------------------------------
spg_flex2    |
     KAMPALA |   .0639966   .0438279      -.022053    .1500463
   _subpop_2 |   .3044591   .1739223     -.0370119      .64593
   _subpop_3 |    .426892   .1453941      .1414318    .7123521
   _subpop_4 |   .3223293   .0865433      .1524143    .4922444
     EASTERN |    .389398   .0792776      .2337479     .545048
   _subpop_6 |   1.865646   .5185519      .8475454    2.883747
   _subpop_7 |   15.99135   2.300136      11.47536    20.50733
   _subpop_8 |   .6699748   .1939304      .2892207    1.050729
   _subpop_9 |   1.873146   .5269817      .8384948    2.907798
  _subpop_10 |   .5018799   .1436653      .2198141    .7839456
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   2.160705   1.755188     -1.285349    5.606759
   _subpop_3 |   5.219631   1.655129      1.970027    8.469236
   _subpop_4 |   2.008124   1.395066      -.730883    4.747132
   _subpop_5 |     7.9545   2.158816      3.715979    12.19302
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.756075   1.232853      3.335549    8.176601
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.730508   2.280927      5.252241    14.20877
  _subpop_10 |          0  (omitted)
  _subpop_11 |   14.08018   2.606576      8.962552    19.19781
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   73.05174   6.462656      60.36326    85.74022
  _subpop_14 |   4.767413    4.38237      -3.83673    13.37156
  _subpop_15 |   16.42196   4.948369      6.706559    26.13736
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   16.00316   2.586355      10.92523    21.08109
  _subpop_18 |          0  (omitted)
  _subpop_19 |   8.946063   1.343837      6.307635    11.58449
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   .2953662   .1929501     -.0834631    .6741954
   _subpop_2 |   .2410085   .2356361     -.2216285    .7036456
   _subpop_3 |   1.119081   .4907318      .1556005    2.082561
   _subpop_4 |   .4646927    .331054     -.1852834    1.114669
   _subpop_5 |   1.593407   .4924892       .626476    2.560337
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.151411   .2491408      .6622598    1.640563
   _subpop_8 |   .8328933   .5252248     -.1983089    1.864095
   _subpop_9 |     1.7179   .3554163      1.020092    2.415708
  _subpop_10 |          0  (omitted)
  _subpop_11 |    4.57712   1.022392      2.569803    6.584438
  _subpop_12 |   5.052279   2.859699     -.5623221    10.66688
  _subpop_13 |   30.88661   3.754329      23.51553    38.25768
  _subpop_14 |   .4055026   .3670878     -.3152206    1.126226
  _subpop_15 |   2.493913   .4874812      1.536815    3.451011
  _subpop_16 |   1.126089   1.107488     -1.048302    3.300479
  _subpop_17 |   4.636239   .9281603      2.813932    6.458546
  _subpop_18 |          0  (omitted)
  _subpop_19 |    1.73594   .3435268      1.061475    2.410404
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .0639966   .0438279      -.022053    .1500463
   _subpop_2 |   .0354669   .0370815     -.0373372    .1082709
   _subpop_3 |   .3732254   .2146661     -.0482402    .7946909
   _subpop_4 |    .133016   .0973925     -.0581999    .3242319
   _subpop_5 |   .4875636   .1719254      .1500133     .825114
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3403723   .0913194        .16108    .5196647
   _subpop_8 |    .188197   .1185137     -.0444874    .4208813
   _subpop_9 |   .4053263   .0841519      .2401065    .5705462
  _subpop_10 |          0  (omitted)
  _subpop_11 |   2.068918   .5675464      .9546234    3.183212
  _subpop_12 |   3.736361   2.114861     -.4158595    7.888581
  _subpop_13 |   16.44512    2.38353      11.76541    21.12483
  _subpop_14 |   .0397538   .0356125     -.0301662    .1096737
  _subpop_15 |   .7633363   .2261396      .3193442    1.207328
  _subpop_16 |   .2865705   .2818368      -.266775    .8399159
  _subpop_17 |   1.972314   .5527338       .887102    3.057526
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .5274552    .150531      .2319097    .8230007
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   6.596982   1.376322      3.894775    9.299188
   _subpop_2 |   1.799244   .7005769      .4237641    3.174725
     Eastern |   7.564058   1.320862      4.970739    10.15738
    Northern |   22.83015   2.194077       18.5224     27.1379
     Western |   12.06716   1.473889      9.173396    14.96093
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   1.357963   .3487661      .6732122    2.042715
   _subpop_2 |   .3173199   .1392332      .0439559     .590684
     Eastern |   1.400163   .2166064      .9748884    1.825438
    Northern |   7.665643   .8916711      5.914977    9.416309
     Western |   3.081176   .5088672       2.08209    4.080263
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .4308091   .1374163      .1610122     .700606
   _subpop_2 |   .0712872   .0329651      .0065651    .1360094
     Eastern |   .3592596   .0586618      .2440857    .4744336
    Northern |    3.74768   .5234158       2.72003     4.77533
     Western |   1.207465   .2945415      .6291756    1.785754
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex2 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it2.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex2 |    6775   200636622    11.03792   31.33849          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it2.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 3,387.3592       50.00       50.00
          1 | 3,387.6408       50.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it3.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(238289 observations deleted)
    0
    0
(925 missing values generated)
  925
(925 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000i.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000i.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    172,831      100.00      100.00
------------+-----------------------------------
      Total |    172,831      100.00
  153
(153 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp saved
44
44
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_it3.dta
>  saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,946       12.85       12.85
          3 |     74,258       87.15      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(10946 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000l.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000l.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         31        0.04        0.04
          3 |     74,258       99.96      100.00
------------+-----------------------------------
      Total |     74,289      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,289      100.00      100.00
------------+-----------------------------------
      Total |     74,289      100.00
(45875 observations deleted)
(11 observations deleted)
(2130 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw3 |       213    1.265078    .4905348    .938451   4.989788
    ratiomw3 |       213    1.085698    .3652393          0   3.711278
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        213      100.00      100.00
------------+-----------------------------------
      Total |        213      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it3.dta saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         65       30.52       30.52
          3 |        148       69.48      100.00
------------+-----------------------------------
      Total |        213      100.00
(65 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         18       10.84       10.84
          3 |        148       89.16      100.00
------------+-----------------------------------
      Total |        166      100.00
(18 observations deleted)

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       148    165.5743    162.8502          3       1040
(4 observations deleted)
(12 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9029344         0  .9029344  .9029344
Central urban |        23  .8846528         0  .8846528  .8846528
      Eastern |        27  .9070634         0  .9070634  .9070634
     Northern |        27  .9096122         0  .9096122  .9096122
      Western |        28  .9012103         0  .9012103  .9012103
--------------+--------------------------------------------------
        Total |       132  .9015937   .008379  .8846528  .9096122
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        132      100.00      100.00
------------+-----------------------------------
      Total |        132      100.00
(132 real changes made)
(126 real changes made)
(132 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0000771         0 -.0000771 -.0000771
Central urban |        23 -.0000128         0 -.0000128 -.0000128
      Eastern |        27 -.0000899         0 -.0000899 -.0000899
     Northern |        27 -.0001156         0 -.0001156 -.0001156
      Western |        28 -.0001285         0 -.0001285 -.0001285
--------------+--------------------------------------------------
        Total |       132 -.0000873   .000039 -.0001285 -.0000128
-----------------------------------------------------------------
(132 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it3.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it3.dta save
> d
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(349 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000n.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000n.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it3.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
      cr_it3 |    6775   200636622    9416.597   358966.3   77.08961   7.36e+07
     linpob3 |    6775   200636622    976.8385   126.2728   813.7832   1175.265
    linpobr3 |    6775   200636622    1065.445          0   1065.445   1065.445
(5884 missing values generated)
(5884 real changes made)
(5884 real changes made)
(5884 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex3 |   12.04174   .8213922      10.42906    13.65443
    pg_flex3 |   3.122904   .2450628      2.641759    3.604049
   spg_flex3 |    1.28575   .1315706      1.027431     1.54407
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
       Urban |   2.514697   .7369867      1.067731    3.961662
       Rural |   13.49695    .910283      11.70974    15.28416
-------------+------------------------------------------------
pg_flex3     |
       Urban |   .4162668   .1275498      .1658414    .6666923
       Rural |   3.536329   .2768086      2.992856    4.079802
-------------+------------------------------------------------
spg_flex3    |
       Urban |   .1183589   .0439069      .0321541    .2045637
       Rural |   1.464063   .1503556      1.168862    1.759264
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   4.596846   1.414618       1.81945    7.374241
   _subpop_3 |   7.398621    1.86434      3.738261    11.05898
   _subpop_4 |   8.127774   1.612551      4.961766    11.29378
     EASTERN |   11.80657   2.253825      7.381518    16.23163
   _subpop_6 |   13.57109   2.453822      8.753372    18.38882
   _subpop_7 |   70.87902   6.355412       58.4011    83.35694
   _subpop_8 |   15.24684   4.522476      6.367618    24.12606
   _subpop_9 |     15.421   2.497656      10.51722    20.32478
  _subpop_10 |   8.512285   1.293816      5.972066     11.0525
-------------+------------------------------------------------
pg_flex3     |
     KAMPALA |   .2850407   .1874341     -.0829588    .6530403
   _subpop_2 |   .9662464   .4098536      .1615587    1.770934
   _subpop_3 |   1.449052   .4290112      .6067516    2.291353
   _subpop_4 |   1.405935   .2839541      .8484326    1.963437
     EASTERN |   2.183363    .436454      1.326449    3.040276
   _subpop_6 |    4.23203    .956338      2.354401     6.10966
   _subpop_7 |   30.44189   3.662491      23.25113    37.63266
   _subpop_8 |   2.375972   .4479886      1.496412    3.255532
   _subpop_9 |   4.387872   .8849727      2.650358    6.125387
  _subpop_10 |    1.62563   .3267169      .9841693    2.267091
-------------+------------------------------------------------
spg_flex3    |
     KAMPALA |   .0602158   .0413903      -.021048    .1414795
   _subpop_2 |   .3146192   .1777995     -.0344642    .6637025
   _subpop_3 |   .4427283    .149934      .1483547    .7371018
   _subpop_4 |   .4297482    .103468       .226604    .6328924
     EASTERN |   .5672757   .1105028      .3503196    .7842318
   _subpop_6 |   1.919541   .5280469      .8827984    2.956284
   _subpop_7 |   16.32243   2.330928      11.74599    20.89886
   _subpop_8 |   .7079542   .1981629      .3188902    1.097018
   _subpop_9 |   1.853789   .5246343       .823746    2.883831
  _subpop_10 |   .4932011   .1424309       .213559    .7728433
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   2.160705   1.755188     -1.285349    5.606759
   _subpop_3 |   5.219631   1.655129      1.970027    8.469236
   _subpop_4 |   2.008124   1.395066      -.730883    4.747132
   _subpop_5 |   8.511507   2.164837      4.261165    12.76185
   _subpop_6 |          0  (omitted)
   _subpop_7 |   8.582742   1.691107        5.2625    11.90298
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   12.44788    2.37598      7.782995    17.11278
  _subpop_10 |   5.029093   4.275589     -3.365401    13.42359
  _subpop_11 |   14.50179   2.654047      9.290955    19.71262
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   73.25054   6.475744      60.53636    85.96472
  _subpop_14 |   4.767413    4.38237      -3.83673    13.37156
  _subpop_15 |   16.79927   4.885104      7.208081    26.39046
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   16.00316   2.586355      10.92523    21.08109
  _subpop_18 |          0  (omitted)
  _subpop_19 |   8.946063   1.343837      6.307635    11.58449
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   .2850407   .1874341     -.0829588    .6530403
   _subpop_2 |   .2250333   .2241939     -.2151386    .6652051
   _subpop_3 |   1.155733   .4982588       .177475    2.133992
   _subpop_4 |   .4518486   .3227634     -.1818501    1.085547
   _subpop_5 |   1.654928   .5035779      .6662267     2.64363
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.484635   .2990758      .8974431    2.071827
   _subpop_8 |   1.006167   .6351645     -.2408854     2.25322
   _subpop_9 |   2.276557   .4613891      1.370687    3.182427
  _subpop_10 |   .0093897   .0079828     -.0062834    .0250627
  _subpop_11 |   4.692109    1.03874      2.652694    6.731523
  _subpop_12 |   5.073125   2.871498     -.5646423    10.71089
  _subpop_13 |   31.38124   3.781898      23.95604    38.80644
  _subpop_14 |   .4566063   .4141224     -.3564626    1.269675
  _subpop_15 |   2.660309   .4968505      1.684815    3.635802
  _subpop_16 |   1.107112   1.088825     -1.030636    3.244861
  _subpop_17 |   4.592934   .9233021      2.780165    6.405703
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.708471   .3411553      1.038662    2.378279
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .0602158   .0413903      -.021048    .1414795
   _subpop_2 |   .0321646   .0338697     -.0343336    .0986628
   _subpop_3 |    .386827   .2193818     -.0438971    .8175512
   _subpop_4 |   .1275796   .0935794     -.0561498    .3113091
   _subpop_5 |   .5077917   .1773182      .1596534    .8559301
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .4538042   .1091341      .2395353     .668073
   _subpop_8 |   .2740707   .1725798     -.0647644    .6129058
   _subpop_9 |   .5904877   .1169512      .3608711    .8201042
  _subpop_10 |   .0000175   .0000149     -.0000117    .0000468
  _subpop_11 |   2.128683   .5777612      .9943334    3.263033
  _subpop_12 |   3.767259    2.13235     -.4192984    7.953816
  _subpop_13 |   16.78732   2.415204      12.04541    21.52922
  _subpop_14 |   .0488724   .0438843     -.0372881    .1350329
  _subpop_15 |   .8055911   .2307757      .3524968    1.258685
  _subpop_16 |   .2802338   .2756048      -.260876    .8213436
  _subpop_17 |   1.952143    .550314      .8716814    3.032604
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .5183342    .149246      .2253115     .811357
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   6.877505   1.381672      4.164794    9.590216
   _subpop_2 |   1.799244   .7005769      .4237641    3.174725
     Eastern |   10.15345   1.452561      7.301557    13.00534
    Northern |   23.40979   2.180005      19.12967    27.68991
     Western |   12.06716   1.473889      9.173396    14.96093
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   1.407141   .3554837      .7092005    2.105081
   _subpop_2 |   .3049877   .1349429      .0400471    .5699284
     Eastern |   1.834013   .2768478      1.290463    2.377564
    Northern |   7.846463   .8977835      6.083796    9.609129
     Western |   3.046942   .5060806      2.053326    4.040557
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |    .447748   .1409617      .1709902    .7245057
   _subpop_2 |    .067278   .0312721      .0058798    .1286762
     Eastern |   .5054756   .0771629      .3539775    .6569736
    Northern |   3.841054   .5317294      2.797081    4.885027
     Western |   1.193291   .2931333      .6177669    1.768816
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex3 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it3.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex3 |    6775   200636622    12.04174   32.54731          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it3.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 3,385.9819       49.98       49.98
          1 | 3,389.0181       50.02      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it4.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(240194 observations deleted)
    0
    0
(925 missing values generated)
  925
(925 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000p.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000p.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    170,926      100.00      100.00
------------+-----------------------------------
      Total |    170,926      100.00
  153
(153 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp saved
45
45
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_it4.dta
>  saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,440       12.25       12.25
          3 |     74,764       87.75      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(10440 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000s.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000s.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         31        0.04        0.04
          3 |     74,764       99.96      100.00
------------+-----------------------------------
      Total |     74,795      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,795      100.00      100.00
------------+-----------------------------------
      Total |     74,795      100.00
(46570 observations deleted)
(11 observations deleted)
(2124 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw4 |       218     1.30385    .5805333   .9367496    5.06082
    ratiomw4 |       218    1.093956    .3831518          0   3.690952
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        218      100.00      100.00
------------+-----------------------------------
      Total |        218      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it4.dta saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         70       32.11       32.11
          3 |        148       67.89      100.00
------------+-----------------------------------
      Total |        218      100.00
(70 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         17       10.30       10.30
          3 |        148       89.70      100.00
------------+-----------------------------------
      Total |        165      100.00
(17 observations deleted)

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    4
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       148    163.5338    160.7022          3       1023
(5 observations deleted)
(13 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9016237         0  .9016237  .9016237
Central urban |        22   .876273         0   .876273   .876273
      Eastern |        27  .9046936         0  .9046936  .9046936
     Northern |        26  .9002259         0  .9002259  .9002259
      Western |        28  .9008598         0  .9008598  .9008598
--------------+--------------------------------------------------
        Total |       130  .8975271  .0097561   .876273  .9046936
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        130      100.00      100.00
------------+-----------------------------------
      Total |        130      100.00
(130 real changes made)
(124 real changes made)
(130 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0000771         0 -.0000771 -.0000771
Central urban |        22 -.0000128         0 -.0000128 -.0000128
      Eastern |        27 -.0000899         0 -.0000899 -.0000899
     Northern |        26  .0001413         0  .0001413  .0001413
      Western |        28 -.0001285         0 -.0001285 -.0001285
--------------+--------------------------------------------------
        Total |       130 -.0000363  .0000962 -.0001285  .0001413
-----------------------------------------------------------------
(130 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it4.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it4.dta save
> d
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(329 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000u.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000u.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it4.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
      cr_it4 |    6775   200636622    9416.597   357688.9   74.53012   7.33e+07
     linpob4 |    6775   200636622    959.2149   143.6842   804.5471   1162.682
    linpobr4 |    6775   200636622    1048.577   .0000547   1048.577   1048.577
(5912 missing values generated)
(5912 real changes made)
(5912 real changes made)
(5912 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex4 |   11.11909   .7975126       9.55329    12.68489
    pg_flex4 |   2.975137   .2391435      2.505613     3.44466
   spg_flex4 |    1.23274   .1304217       .976676    1.488804
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
       Urban |   2.086973   .6451699      .8202762     3.35367
       Rural |    12.4987   .8860347       10.7591     14.2383
-------------+------------------------------------------------
pg_flex4     |
       Urban |   .3888317   .1222938      .1487258    .6289376
       Rural |   3.370181   .2706866      2.838728    3.901635
-------------+------------------------------------------------
spg_flex4    |
       Urban |   .1071954   .0420308      .0246741    .1897167
       Rural |   1.404661   .1492098      1.111709    1.697613
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
     KAMPALA |   1.358707   .8594353     -.3286689    3.046082
   _subpop_2 |   4.596846   1.414618       1.81945    7.374241
   _subpop_3 |   6.936931   1.852727      3.299373    10.57449
   _subpop_4 |   5.450948   1.171204       3.15146    7.750436
     EASTERN |    9.28854   2.149875      5.067575     13.5095
   _subpop_6 |    12.6968   2.422978      7.939638    17.45397
   _subpop_7 |   70.68732   6.344248      58.23131    83.14332
   _subpop_8 |   14.91821   4.568717      5.948203    23.88822
   _subpop_9 |   15.53387   2.493286      10.63867    20.42907
  _subpop_10 |   9.175563   1.278453      6.665507    11.68562
-------------+------------------------------------------------
pg_flex4     |
     KAMPALA |   .2704303    .179127     -.0812594      .62212
   _subpop_2 |   .9321519   .4031354      .1406545    1.723649
   _subpop_3 |   1.394744   .4192107      .5716851    2.217803
   _subpop_4 |   1.090548   .2363652      .6264794    1.554616
     EASTERN |   1.653279   .3359462      .9936975     2.31286
   _subpop_6 |   4.130593   .9414996      2.282096    5.979089
   _subpop_7 |   29.97927   3.635901      22.84071    37.11783
   _subpop_8 |   2.229156   .4344839       1.37611    3.082201
   _subpop_9 |    4.58369   .9072344      2.802467    6.364912
  _subpop_10 |   1.751074   .3375204      1.088402    2.413746
-------------+------------------------------------------------
spg_flex4    |
     KAMPALA |   .0547742   .0378497     -.0195381    .1290866
   _subpop_2 |   .3028643   .1738864     -.0385362    .6442649
   _subpop_3 |   .4246132   .1452956      .1393465    .7098799
   _subpop_4 |   .3223901    .086553      .1524559    .4923242
     EASTERN |   .3894979   .0792943       .233815    .5451807
   _subpop_6 |   1.867323   .5188484      .8486402    2.886006
   _subpop_7 |    16.0017   2.301106      11.48382    20.51959
   _subpop_8 |   .6711282   .1940668      .2901065     1.05215
   _subpop_9 |   1.945893    .535759      .8940089    2.997778
  _subpop_10 |   .5349915    .148268       .243889    .8260939
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   1.358707   .8594353     -.3286689    3.046082
   _subpop_2 |   2.160705   1.755188     -1.285349    5.606759
   _subpop_3 |   5.219631   1.655129      1.970027    8.469236
   _subpop_4 |   2.008124   1.395066      -.730883    4.747132
   _subpop_5 |     7.9545   2.158816      3.715979    12.19302
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.756075   1.232853      3.335549    8.176601
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.730508   2.280927      5.252241    14.20877
  _subpop_10 |          0  (omitted)
  _subpop_11 |   14.08018   2.606576      8.962552    19.19781
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   73.05174   6.462656      60.36326    85.74022
  _subpop_14 |   4.767413    4.38237      -3.83673    13.37156
  _subpop_15 |   16.42196   4.948369      6.706559    26.13736
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   16.12309    2.58123      11.05522    21.19095
  _subpop_18 |          0  (omitted)
  _subpop_19 |   9.643141   1.323678      7.044293    12.24199
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   .2704303    .179127     -.0812594      .62212
   _subpop_2 |   .2009467    .207247     -.2059525    .6078459
   _subpop_3 |    1.11908   .4907317      .1556004     2.08256
   _subpop_4 |   .4324831   .3103404      -.176825    1.041791
   _subpop_5 |   1.593406   .4924891      .6264757    2.560336
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.151593   .2491708      .6623831    1.640804
   _subpop_8 |   .8330068   .5252968     -.1983367     1.86435
   _subpop_9 |   1.718217   .3554838      1.020276    2.416157
  _subpop_10 |          0  (omitted)
  _subpop_11 |   4.580642   1.022893      2.572341    6.588942
  _subpop_12 |   5.052938   2.860072     -.5623954    10.66827
  _subpop_13 |   30.90223   3.755197      23.52945    38.27501
  _subpop_14 |   .4071188   .3685752     -.3165248    1.130762
  _subpop_15 |   2.499074   .4876867      1.541572    3.456575
  _subpop_16 |   1.195355    1.17561     -1.112783    3.503493
  _subpop_17 |   4.795475   .9460473      2.938049    6.652901
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.840307   .3522235      1.148767    2.531846
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .0547742   .0378497     -.0195381    .1290866
   _subpop_2 |   .0276346   .0293227     -.0299364    .0852055
   _subpop_3 |   .3732253   .2146661     -.0482402    .7946907
   _subpop_4 |   .1197003   .0880228     -.0531196    .2925202
   _subpop_5 |   .4875635   .1719253      .1500132    .8251137
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3404365   .0913297       .161124    .5197489
   _subpop_8 |   .1882479   .1185457     -.0444993    .4209952
   _subpop_9 |   .4054301   .0841694      .2401759    .5706844
  _subpop_10 |          0  (omitted)
  _subpop_11 |   2.070778   .5678655      .9558565    3.185698
  _subpop_12 |   3.737336   2.115413     -.4159681    7.890641
  _subpop_13 |   16.45582   2.384527      11.77415    21.13749
  _subpop_14 |   .0400253   .0358586     -.0303778    .1104285
  _subpop_15 |   .7646204   .2262907      .3203316    1.208909
  _subpop_16 |   .3107203   .3055878     -.2892566    .9106973
  _subpop_17 |   2.048099   .5617784      .9451289    3.151069
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .5622541   .1553198      .2573064    .8672018
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   6.596982   1.376322      3.894775    9.299188
   _subpop_2 |   1.705794   .6914442      .3482441    3.063343
     Eastern |   7.564058   1.320862      4.970739    10.15738
    Northern |   22.83015   2.194077       18.5224     27.1379
     Western |   12.44723    1.46256      9.575707    15.31875
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   1.357963    .348766      .6732119    2.042714
   _subpop_2 |   .2868983   .1285487      .0345118    .5392848
     Eastern |   1.400407   .2166442      .9750577    1.825756
    Northern |   7.671262   .8918551      5.920234    9.422289
     Western |   3.208596    .519072      2.189474    4.227718
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .4308089   .1374163      .1610121    .7006058
   _subpop_2 |   .0615539   .0288287       .004953    .1181548
     Eastern |   .3593419   .0586718      .2441485    .4745354
    Northern |   3.750585   .5236783      2.722419    4.778751
     Western |   1.260971   .2998036      .6723505    1.849591
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex4 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it4.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex4 |    6775   200636622    11.11909   31.43916          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it4.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor5 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |3,387.20082       50.00       50.00
          1 |3,387.79918       50.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it5.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(238428 observations deleted)
    0
    0
(925 missing values generated)
  925
(925 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000w.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000w.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    172,692      100.00      100.00
------------+-----------------------------------
      Total |    172,692      100.00
  153
(153 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp saved
44
44
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_it5.dta
>  saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,946       12.85       12.85
          3 |     74,258       87.15      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(10946 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000011.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000011.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         31        0.04        0.04
          3 |     74,258       99.96      100.00
------------+-----------------------------------
      Total |     74,289      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     74,289      100.00      100.00
------------+-----------------------------------
      Total |     74,289      100.00
(45911 observations deleted)
(11 observations deleted)
(2125 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw5 |       213    1.265089    .4929497    .938451    5.06082
    ratiomw5 |       213    1.085062    .3655071          0   3.711278
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        213      100.00      100.00
------------+-----------------------------------
      Total |        213      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it5.dta saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         65       30.52       30.52
          3 |        148       69.48      100.00
------------+-----------------------------------
      Total |        213      100.00
(65 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         18       10.84       10.84
          3 |        148       89.16      100.00
------------+-----------------------------------
      Total |        166      100.00
(18 observations deleted)

-------------------------------------------------------------------------------------------
-> spdomain = Central rural
    1
-------------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       148    165.4324    162.9127          3       1039
(4 observations deleted)
(11 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9027917         0  .9027917  .9027917
Central urban |        23  .8832131         0  .8832131  .8832131
      Eastern |        27  .9070574         0  .9070574  .9070574
     Northern |        27   .909593         0   .909593   .909593
      Western |        29  .9070321         0  .9070321  .9070321
--------------+--------------------------------------------------
        Total |       133  .9025772  .0091585  .8832131   .909593
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        133      100.00      100.00
------------+-----------------------------------
      Total |        133      100.00
(133 real changes made)
(127 real changes made)
(133 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0000771         0 -.0000771 -.0000771
Central urban |        23 -.0000128         0 -.0000128 -.0000128
      Eastern |        27 -.0000899         0 -.0000899 -.0000899
     Northern |        27  .0001413         0  .0001413  .0001413
      Western |        29  .0001285         0  .0001285  .0001285
--------------+--------------------------------------------------
        Total |       133  .0000206  .0001009 -.0000899  .0001413
-----------------------------------------------------------------
(133 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it5.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it5.dta save
> d
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(349 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000013.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000013.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it5.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9416.597   395671.8   82.64046   8.12e+07
      cr_it5 |    6775   200636622    9416.597   357959.2   77.03606   7.34e+07
     linpob5 |    6775   200636622    978.2903   128.5878   813.7241   1182.364
    linpobr5 |    6775   200636622    1068.843          0   1068.843   1068.843
(5884 missing values generated)
(5884 real changes made)
(5884 real changes made)
(5884 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex5 |   12.04174   .8213922      10.42906    13.65443
    pg_flex5 |   3.130397   .2453841      2.648622    3.612173
   spg_flex5 |   1.288869   .1317601      1.030177     1.54756
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
       Urban |   2.514697   .7369867      1.067731    3.961662
       Rural |   13.49695    .910283      11.70974    15.28416
-------------+------------------------------------------------
pg_flex5     |
       Urban |   .4225311   .1291678       .168929    .6761332
       Rural |    3.54401   .2771584      2.999849     4.08817
-------------+------------------------------------------------
spg_flex5    |
       Urban |   .1203835   .0443277      .0333524    .2074145
       Rural |   1.467348   .1505683       1.17173    1.762967
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   4.596846   1.414618       1.81945    7.374241
   _subpop_3 |   7.398621    1.86434      3.738261    11.05898
   _subpop_4 |   8.127774   1.612551      4.961766    11.29378
     EASTERN |   11.80657   2.253825      7.381518    16.23163
   _subpop_6 |   13.57109   2.453822      8.753372    18.38882
   _subpop_7 |   70.87902   6.355412       58.4011    83.35694
   _subpop_8 |   15.24684   4.522476      6.367618    24.12606
   _subpop_9 |     15.421   2.497656      10.51722    20.32478
  _subpop_10 |   8.512285   1.293816      5.972066     11.0525
-------------+------------------------------------------------
pg_flex5     |
     KAMPALA |   .2925525   .1914458     -.0833233    .6684284
   _subpop_2 |   .9680601   .4098586      .1633626    1.772758
   _subpop_3 |   1.449681   .4288909      .6076167    2.291746
   _subpop_4 |   1.403493    .283686      .8465169    1.960469
     EASTERN |   2.179867   .4358689      1.324102    3.035632
   _subpop_6 |   4.231352   .9562465      2.353902    6.108803
   _subpop_7 |   30.43896   3.662322      23.24852    37.62939
   _subpop_8 |   2.375038   .4478871      1.495677    3.254399
   _subpop_9 |    4.43059   .8898235      2.683551    6.177628
  _subpop_10 |   1.652293   .3290748      1.006203    2.298384
-------------+------------------------------------------------
spg_flex5    |
     KAMPALA |   .0629525   .0431566     -.0217791    .1476841
   _subpop_2 |   .3148945   .1777363     -.0340647    .6638536
   _subpop_3 |   .4430777   .1498745      .1488211    .7373343
   _subpop_4 |   .4290397   .1033595      .2261084    .6319709
     EASTERN |   .5661025   .1102925      .3495594    .7826457
   _subpop_6 |   1.919205   .5279879      .8825783    2.955833
   _subpop_7 |   16.32038   2.330739      11.74431    20.89644
   _subpop_8 |    .707712   .1981374      .3186981    1.096726
   _subpop_9 |   1.873539   .5270293      .8387938    2.908284
  _subpop_10 |   .5020563   .1436902      .2199416    .7841711
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   2.160705   1.755188     -1.285349    5.606759
   _subpop_3 |   5.219631   1.655129      1.970027    8.469236
   _subpop_4 |   2.008124   1.395066      -.730883    4.747132
   _subpop_5 |   8.511507   2.164837      4.261165    12.76185
   _subpop_6 |          0  (omitted)
   _subpop_7 |   8.582742   1.691107        5.2625    11.90298
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   12.44788    2.37598      7.782995    17.11278
  _subpop_10 |   5.029093   4.275589     -3.365401    13.42359
  _subpop_11 |   14.50179   2.654047      9.290955    19.71262
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   73.25054   6.475744      60.53636    85.96472
  _subpop_14 |   4.767413    4.38237      -3.83673    13.37156
  _subpop_15 |   16.79927   4.885104      7.208081    26.39046
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   16.00316   2.586355      10.92523    21.08109
  _subpop_18 |          0  (omitted)
  _subpop_19 |   8.946063   1.343837      6.307635    11.58449
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   .2925525   .1914458     -.0833233    .6684284
   _subpop_2 |   .2366553   .2325039     -.2198321    .6931428
   _subpop_3 |    1.15504   .4981149      .1770638    2.133015
   _subpop_4 |   .4611928    .328791     -.1843404    1.106726
   _subpop_5 |   1.653758   .5033658      .6654729    2.642043
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.482056   .2987973      .8954114    2.068701
   _subpop_8 |   1.005186   .6345418     -.2406437    2.251017
   _subpop_9 |   2.272862   .4607757      1.368196    3.177528
  _subpop_10 |   .0090255   .0076732     -.0060398    .0240908
  _subpop_11 |   4.691396   1.038639       2.65218    6.730612
  _subpop_12 |   5.072997   2.871426     -.5646281    10.71062
  _subpop_13 |    31.3782   3.781728      23.95333    38.80307
  _subpop_14 |   .4562932   .4138343     -.3562099    1.268796
  _subpop_15 |   2.659282   .4967745      1.683938    3.634626
  _subpop_16 |   1.126471   1.107864     -1.048657    3.301599
  _subpop_17 |   4.637111   .9282584      2.814612    6.459611
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.736493   .3435749      1.061934    2.411052
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .0629525   .0431566     -.0217791    .1476841
   _subpop_2 |   .0345435   .0361906     -.0365116    .1055985
   _subpop_3 |   .3865646   .2192918     -.0439829    .8171121
   _subpop_4 |    .131518   .0963433      -.057638    .3206739
   _subpop_5 |   .5074002   .1772148      .1594648    .8553356
   _subpop_6 |          0  (omitted)
   _subpop_7 |    .453056     .10902      .2390112    .6671009
   _subpop_8 |    .273539   .1722446      -.064638    .6117161
   _subpop_9 |   .5892637   .1167301      .3600813    .8184461
  _subpop_10 |   .0000162   .0000138     -.0000108    .0000432
  _subpop_11 |   2.128311   .5776978      .9940856    3.262536
  _subpop_12 |   3.767069   2.132242     -.4192773    7.953415
  _subpop_13 |    16.7852   2.415009      12.04368    21.52671
  _subpop_14 |   .0488132   .0438306     -.0372417    .1348682
  _subpop_15 |   .8053218   .2307481      .3522816    1.258362
  _subpop_16 |   .2866992   .2819635     -.2668949    .8402934
  _subpop_17 |   1.972723   .5527828      .8874147    3.058031
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .5276407   .1505569      .2320441    .8232372
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   6.877505   1.381672      4.164794    9.590216
   _subpop_2 |   1.799244   .7005769      .4237641    3.174725
     Eastern |   10.15345   1.452561      7.301557    13.00534
    Northern |   23.40979   2.180005      19.12967    27.68991
     Western |   12.06716   1.473889      9.173396    14.96093
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   1.406207   .3553552      .7085191    2.103895
   _subpop_2 |   .3139595   .1380611      .0428968    .5850222
     Eastern |   1.830991   .2765018       1.28812    2.373862
    Northern |   7.845333   .8977457       6.08274    9.607925
     Western |   3.081866   .5089235      2.082669    4.081063
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .4474206   .1408939       .170796    .7240451
   _subpop_2 |   .0701778    .032498      .0063727    .1339829
     Eastern |   .5045112   .0770385      .3532574     .655765
    Northern |   3.840472   .5316783      2.796599    4.884345
     Western |   1.207752   .2945701      .6294072    1.786098
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex5 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it5.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex5 |    6775   200636622    12.04174   32.54731          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it5.dta saved

. **************************************************************************
> * Send results to one big csv-file
> **************************************************************************;
. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         gen dum=1;

.         collapse (mean) dum h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=pop
> wt];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000014.tmp saved

.         use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt],
>  by(rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000015.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt],
>  by(news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000016.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt],
>  by(reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000017.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt],
>  by(strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000018.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt],
>  by(spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000019.tmp saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001a.tmp saved

. use          `nat';

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' dum rural news r
> eg_tpi strata spdomain using "$path\work\poverty_flexBask.csv", replace c;

. **************************************************************************
> * Convergence graph (based on 5 iterations)
> **************************************************************************;
. #delimit cr
delimiter now cr
. 
. clear

. set obs 1
obs was 0, now 1

. gen iteration=.
(1 missing value generated)

. tempfile converg

. save `converg'
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved

. 
. forvalues X = 1/5 {
  2.         use "$path/work/cons_real_it`X'.dta", clear
  3.         collapse (mean) h_flex`X' pg_flex`X' spg_flex`X' [aw=popwt], by(strata)
  4.         rename h_flex`X' h_flex
  5.         rename pg_flex`X' pg_flex
  6.         rename spg_flex`X' spg_flex
  7.         gen iteration=`X'
  8.         order iteration
  9.         *sum
.         if `X' != 1     {
 10.                 append using `converg'
 11.                         }
 12.         save `converg', replace
 13.         }
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved

. 
. use `converg', clear

. sum

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   iteration |        50           3    1.428571          1          5
      strata |        50         5.5    2.901442          1         10
      h_flex |        50    15.47076    19.09625   1.358707   70.87902
     pg_flex |        50    4.875141    8.607972   .2704303   30.44189
    spg_flex |        50    2.280654    4.702109   .0547742   16.32243

. 
. twoway (connected h_flex iteration), by(, title(Convergence graph: Poverty rate. %) subti
> tle(After iterative procedure)) by(strata)

. graph export "$path/work/converge_pov_rate.tif", replace
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/converge_pov_rate.tif written
>  in TIFF format)

. 
. sort strata iteration

. 
. for var h_flex pg_flex spg_flex: replace X = round(X,0.01)

->  replace h_flex = round(h_flex,0.01)
(50 real changes made)

->  replace pg_flex = round(pg_flex,0.01)
(50 real changes made)

->  replace spg_flex = round(spg_flex,0.01)
(50 real changes made)

. 
. list strata iteration h_flex pg_flex spg_flex

     +--------------------------------------------------------+
     |        strata   iterat~n   h_flex   pg_flex   spg_flex |
     |--------------------------------------------------------|
  1. |       KAMPALA          1     4.17        .6        .13 |
  2. |       KAMPALA          2     1.54        .3        .06 |
  3. |       KAMPALA          3     1.54       .29        .06 |
  4. |       KAMPALA          4     1.36       .27        .05 |
  5. |       KAMPALA          5     1.54       .29        .06 |
     |--------------------------------------------------------|
  6. |     CENTRAL 1          1     4.69      1.01        .33 |
  7. |     CENTRAL 1          2      4.6       .94         .3 |
  8. |     CENTRAL 1          3      4.6       .97        .31 |
  9. |     CENTRAL 1          4      4.6       .93         .3 |
 10. |     CENTRAL 1          5      4.6       .97        .31 |
     |--------------------------------------------------------|
 11. |     CENTRAL 2          1     7.47      1.48        .45 |
 12. |     CENTRAL 2          2     6.94       1.4        .43 |
 13. |     CENTRAL 2          3      7.4      1.45        .44 |
 14. |     CENTRAL 2          4     6.94      1.39        .42 |
 15. |     CENTRAL 2          5      7.4      1.45        .44 |
     |--------------------------------------------------------|
 16. |  EAST CENTRAL          1     8.13       1.4        .43 |
 17. |  EAST CENTRAL          2     5.45      1.09        .32 |
 18. |  EAST CENTRAL          3     8.13      1.41        .43 |
 19. |  EAST CENTRAL          4     5.45      1.09        .32 |
 20. |  EAST CENTRAL          5     8.13       1.4        .43 |
     |--------------------------------------------------------|
 21. |       EASTERN          1    11.81      2.18        .57 |
 22. |       EASTERN          2     9.29      1.65        .39 |
 23. |       EASTERN          3    11.81      2.18        .57 |
 24. |       EASTERN          4     9.29      1.65        .39 |
 25. |       EASTERN          5    11.81      2.18        .57 |
     |--------------------------------------------------------|
 26. |   MID-NOTHERN          1     12.7      4.13       1.87 |
 27. |   MID-NOTHERN          2     12.7      4.13       1.87 |
 28. |   MID-NOTHERN          3    13.57      4.23       1.92 |
 29. |   MID-NOTHERN          4     12.7      4.13       1.87 |
 30. |   MID-NOTHERN          5    13.57      4.23       1.92 |
     |--------------------------------------------------------|
 31. |    NORTH-EAST          1    70.69     29.98         16 |
 32. |    NORTH-EAST          2    70.69     29.96      15.99 |
 33. |    NORTH-EAST          3    70.88     30.44      16.32 |
 34. |    NORTH-EAST          4    70.69     29.98         16 |
 35. |    NORTH-EAST          5    70.88     30.44      16.32 |
     |--------------------------------------------------------|
 36. |     WEST-NILE          1    14.92      2.23        .67 |
 37. |     WEST-NILE          2    14.92      2.22        .67 |
 38. |     WEST-NILE          3    15.25      2.38        .71 |
 39. |     WEST-NILE          4    14.92      2.23        .67 |
 40. |     WEST-NILE          5    15.25      2.38        .71 |
     |--------------------------------------------------------|
 41. |   MID-WESTERN          1    15.53      4.49        1.9 |
 42. |   MID-WESTERN          2    15.42      4.43       1.87 |
 43. |   MID-WESTERN          3    15.42      4.39       1.85 |
 44. |   MID-WESTERN          4    15.53      4.58       1.95 |
 45. |   MID-WESTERN          5    15.42      4.43       1.87 |
     |--------------------------------------------------------|
 46. | SOUTH-WESTERN          1     8.57      1.69        .51 |
 47. | SOUTH-WESTERN          2     8.51      1.65         .5 |
 48. | SOUTH-WESTERN          3     8.51      1.63        .49 |
 49. | SOUTH-WESTERN          4     9.18      1.75        .53 |
 50. | SOUTH-WESTERN          5     8.51      1.65         .5 |
     +--------------------------------------------------------+

.         
. #delimit ;
delimiter now ;
. **************************************************************************
> * 140_iterate.do        (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 
. $no_temp_rev    do "$path/new/150_price_unit_fix.do"    /* Fixed basket: Prices */

. $no_temp_rev    do "$path/new/160_food_basket_fix.do"   /* Fixed food basket */

. 
.                                 do "$path/new/170_pref_r_price.do"              /* Reveal
> ed preference tests */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/170_pref_r_price.log", replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/170_pref_r_price.log
  log type:  text
 opened on:  17 May 2013, 14:58:39

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparisons so that
> * we can check the quality of the regional baskets.
> * It also exports the price and quantity data for work in GAMS
> * Rather than make up for missing prices with shares, we estimate
> * a missing price in this case
> **************************************************************************;
. *global n_spdom "13";
. *global it_n "5";
. /*
> This file uses:
>         work\quan_flex_it$it_n.dta
>         work\povline_food_flex_it$it_n.dta
>         work\price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work\pref_r_price.dta
>         work\revpref_price_`i'.dta
>         work\product_flex.inc
>         work\price_unit_flex.inc
>         work\quan_flex.inc
> */
> 
> 
> 
> ***************************************************************************;
. * Export price, codes and quantity data to text
> ***************************************************************************;
. use "$path\work\price_unit_flex_it$it_n.dta";

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n using "$path\work\price_unit_flex.inc",  non
> ame replace ;

. collapse (min) spdomain, by(product);

. outsheet product  using "$path\work\product_flex.inc", noquote noname replace;

. use "$path\work\quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  calpp povline_f_flex90_$it_n using "$path\w
> ork\quan_flex.inc", noname noquote replace;

. clear;

. **************************************************************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> **************************************************************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path\work\pref_r_price.dta", replace;
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path\work\revpref_price_`i'.dta", replace;
  5.         clear;
  6.                 use "$path\work\quan_flex_it$it_n.dta", clear;
  7.                 keep product spdomain quan$it_n price_uw$it_n val_ir$it_n povline_f_fl
> ex90_$it_n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90_$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quantities to hit constant calorie target;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescaled to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **************************************************************************;
. * Now get the prices in other regions so that you can use them 
> * to build  a new poverty line
> **************************************************************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path\work\price_unit_flex_it$it_n.dta";
 19.                                 keep product spdomain price_uw$it_n descript count bsw
> t;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with the fact that not all commodities are c
> onsumed in every region;
.                 *so we might have a quantity from region i but no price in region j;
.                 *these will have _merge value=2;
.                 *alternatively the number of observations might be too small;
.                 *deal with these problems by TAKING THE MAX PRICE OBSERVED ELSEWHERE (exc
> luding Maputo)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified to handle the counting of bswt instead of
>  count
>                   replace price_uw$it_n=. if round(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==2 ;
 27.                   replace pricemiss=1 if _m==2 | round(bswt)<5;
 28.                         lab var pricemiss "identify those items with no price observat
> ion";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing observed quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             sort product;
 35.                                             *this file contains the price codes that a
> re missing for the region in question;
.                             save `codmiss', replace;
 36. *browse;
.                                   use "$path\work\price_unit_flex_it$it_n.dta", clear;
 37.                         sort product;
 38. *browse;
.                         merge product using `codmiss';
 39.                                                 tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maputo province and city from other price cal
> culation;
.                                 drop if spdomain>10;
 42.                         collapse (max) price_uw$it_n, by(product);
 43.                   *this file contains the code and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product using `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                                             else use `getmiss', clear;
 50.                         gen val_q=quan_s*price_uw$it_n;
 51.                                                 collapse (sum) val_q pricemiss (mean) 
> spdomainq ratquan, by(spdomain);
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path\work\revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path\work\revpref_price_`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path\work\pref_r_price.dta";
 59.       sort spdomain spdomainq;
 60.       save "$path\work\pref_r_price.dta", replace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
(106 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
(175 observations deleted)
(label spdomain_original already defined)
(12 observations deleted)
(1 real change made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        204       95.77       95.77
          3 |          9        4.23      100.00
------------+-----------------------------------
      Total |        213      100.00
(204 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25       92.59       92.59
          3 |          2        7.41      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
(170 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       97.65       97.65
          3 |          5        2.35      100.00
------------+-----------------------------------
      Total |        213      100.00
(208 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(110 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(169 observations deleted)
(label spdomain_original already defined)
(21 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(175 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(21 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(170 observations deleted)
(label spdomain_original already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(21 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta saved
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(106 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       97.65       97.65
          3 |          5        2.35      100.00
------------+-----------------------------------
      Total |        213      100.00
(208 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(175 observations deleted)
(label spdomain_original already defined)
(13 observations deleted)
(2 real changes made)
(3 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(24 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        200       93.90       93.90
          3 |         13        6.10      100.00
------------+-----------------------------------
      Total |        213      100.00
(200 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       88.89       88.89
          3 |          3       11.11      100.00
------------+-----------------------------------
      Total |         27      100.00
(2 missing values generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(170 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta saved
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(106 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(4 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        194       91.08       91.08
          3 |         19        8.92      100.00
------------+-----------------------------------
      Total |        213      100.00
(194 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       85.19       85.19
          3 |          4       14.81      100.00
------------+-----------------------------------
      Total |         27      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(175 observations deleted)
(label spdomain_original already defined)
(14 observations deleted)
(3 real changes made)
(7 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(20 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        181       84.98       84.98
          3 |         32       15.02      100.00
------------+-----------------------------------
      Total |        213      100.00
(181 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       74.07       74.07
          3 |          7       25.93      100.00
------------+-----------------------------------
      Total |         27      100.00
(3 missing values generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(170 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        209       98.12       98.12
          3 |          4        1.88      100.00
------------+-----------------------------------
      Total |        213      100.00
(209 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta saved
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(104 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(169 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(28 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        209       98.12       98.12
          3 |          4        1.88      100.00
------------+-----------------------------------
      Total |        213      100.00
(209 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         28       96.55       96.55
          3 |          1        3.45      100.00
------------+-----------------------------------
      Total |         29      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(175 observations deleted)
(label spdomain_original already defined)
(11 observations deleted)
(2 real changes made)
(3 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        200       93.90       93.90
          3 |         13        6.10      100.00
------------+-----------------------------------
      Total |        213      100.00
(200 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       89.66       89.66
          3 |          3       10.34      100.00
------------+-----------------------------------
      Total |         29      100.00
(2 missing values generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(29 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(170 observations deleted)
(label spdomain_original already defined)
(14 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(28 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       97.65       97.65
          3 |          5        2.35      100.00
------------+-----------------------------------
      Total |        213      100.00
(208 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         28       96.55       96.55
          3 |          1        3.45      100.00
------------+-----------------------------------
      Total |         29      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(169 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(29 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta saved
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. *bring in actual flexible bundle numbers;
. use "$path\work\povline_food_flex_it$it_n.dta", clear;

.         merge spdomain using "$path\work\pref_r_price.dta";
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta
(label spdomain_original already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

.          drop crap;

.         drop _m;

.         order spdomainq spdomain;

.       sort spdomainq spdomain;

.         *rescale expenditures to hit a constant calorie target;
.         gen povline_f5_s=ratquan*povline_f_flex90_$it_n;

.       compress;
spdomainq was float now byte
spdomain was float now byte
pricemiss was double now byte

. *browse;
.         *categorize revealed preference performance;
.       gen pref_r=0;

.       replace pref_r=1 if float(linf_q)>float(povline_f5_s);
(14 real changes made)

.       replace pref_r=2 if float(linf_q)<float(povline_f5_s);
(6 real changes made)

.       lab var pref_r "Fails or passes revealed preference test";

.       lab def pref_r
>                         0 "comparison of the same region with itself"
>                         1 "passes revealed preference test"
>                         2 "fails revealed preference test" ;

.         lab val pref_r pref_r;

.       drop if spdomainq==spdomain;
(5 observations deleted)

.         tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         14       70.00       70.00
         fails revealed preference test |          6       30.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

.              sort spdomainq ;

.       by spdomainq: tab pref_r;

-------------------------------------------------------------------------------------------
-> spdomainq = 1

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          3       75.00       75.00
         fails revealed preference test |          1       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------------
-> spdomainq = 2

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------------
-> spdomainq = 3

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          2       50.00       50.00
         fails revealed preference test |          2       50.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------------
-> spdomainq = 4

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          1       25.00       25.00
         fails revealed preference test |          3       75.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------------
-> spdomainq = 5

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00


. save "$path\work\pref_r_price.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. *drop comparisons with Maputo this does not matter since in the case of Uganda, we have o
> nly 5 spatial domains****
> drop if spdomain>=11;
. drop if spdomainq>=11;
(0 observations deleted)

. display "this is with maputo dropped";
this is with maputo dropped

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         14       70.00       70.00
         fails revealed preference test |          6       30.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. *further drop Nampula rural and urban I set these to missing becuase they were deleting m
> aputo and yet we have none missing for Uganda***
> drop if spdomain==. | spdomain==.;
. display "this is with maputo and nampula dropped (MAH: Actually not - experimenting with 
> 6 spatial domains)";
this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 spatial d
> omains)

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         14       70.00       70.00
         fails revealed preference test |          6       30.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. **************************************************************************
> * 170_pref_r_price.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/170_pref_r_price.log
  log type:  text
 closed on:  17 May 2013, 14:58:40
-------------------------------------------------------------------------------------------

. 
end of do-file

.                                 di  "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
> @@@@@@@@@@@@@@@@@@@@@@@@@@here"                                
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@here

. 
. $no_temp_rev    do "$path/new/180_povline_food_fix.do"  /* Inflating year t1's poverty li
> nes to year t2 */

. 
.                                 shell "$path/new/$revpref"                              /
> * Adjusting flexible basket: inside pref. constraints */

. 
. $no_temp_rev    do "$path/new/200_povmeas_fix.do"               /* Fixed basket: Poverty 
> rates */

.                                 do "$path/new/210_povmeas_ent_flex.do"  /* Flexible baske
> t, adjusted: Poverty rates */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/210_povmeas_ent_flex.log" , replace
-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/210_povmeas_ent_flex.lo
> g
  log type:  text
 opened on:  17 May 2013, 14:58:40

. clear

. set more off

. #delimit ;
delimiter now ;
. *********************************************************************************
> * 210_povmeas_ent_flex.do               (start)
> *
> * This file produces poverty measures taking the entropy adjusted poverty 
> * lines as a base. It produces two sets of poverty measures. In one, 
> * Maputo is treated with the logic of the fixed bundle. In the second, the revealed prefe
> rence logic
> * is maintained. Here, the flexible bundle is viewed as being determined by the 
> * lower constraint on the value of the food bundle dictated by P_t2*Q_t1. In this case,
> * the year t2 food shares are calculated and applied.
> *
> * Fixed poverty lines/etc. are mentioned here and there. But there are NO fixed
> * calculations for Maputo (or other provinces) anymore
> *
> *********************************************************************************;
. /*
> This file uses:
>         work\povline_food_ent.csv
>         work\conpc.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\povlines_ent.dta
>         work\povmeas_ent_flex.dta
>         work\povlines_ent.dta
>       work\nat_pov_ent_m.csv
>       work\rur_pov_ent_m.csv
>       work\news_pov_ent_m.csv
>       work\reg_tpi_pov_ent_m.csv
>       work\strata_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>         work\povlines_ent.csv
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. **************************************************************************;
. * Calculate the food shares for people near the food poverty line
> **************************************************************************;
. *Bring in entropy estimated flexible lines;
. clear;

. insheet using "$path\work\povline_food_ent.csv";
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_ent.csv not
    found
r(601);

end of do-file
r(601);

end of do-file

r(601);

. exit, clear
