-------------------------------------------------------------------------------------
      name:  log_000_boom
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/000_boom.log
  log type:  text
 opened on:  20 May 2013, 17:27:41

. 
. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. display ""


. display "Generel information:"
Generel information:

. display "   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10"
   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10

. display "   Poverty rate estimation"
   Poverty rate estimation

. display "   Methodology: Iterative procedure and revealed preferences tests"
   Methodology: Iterative procedure and revealed preferences tests

. display ""


. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. 
. 
. **************************************************************************
. * 000_boom.do   (start)
. *
. * Reminders:
. *       1) Check very top of this file to make sure you are on the right path! 
. *       2) GAMS 22.5 must be placed onto the path. See 190_revpref13_m1.bat.
. *          Typically this needs to be edited.
. *   3) In case of implementing a new survey the user must make necessary
. *      changes in 010_initial.do, 020_hhdata.do and 030_rawdata.do.
. *
. * Process:
. * - The do-file prefix indicates first time a do-file is called
. *
. * KS, 2003
. * CA, 2009-2010
. * MAH, Apr. 2012
. **************************************************************************
. 
. clear all

. set more off

. set mem 700m

. 
. noisily display "Start time: " "$S_TIME"
Start time: 17:27:41

. 
. 
. 
. **************************************************************************
. * Macros. Region definitions. Demographic definitions.
. **************************************************************************
. do "$path/new/010_initial.do"

. cap log close

. log using "$path/rep/010_initial.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/010_initial.log
  log type:  text
 opened on:  20 May 2013, 17:27:41

. clear

. set more off

. #delimit ;
delimiter now ;
. ******************************************************************************
> * 010_initial.do                (start)
> ******************************************************************************;
. ******************************************************************************
> * Purpose: Set some globals
> ******************************************************************************;
. ******************************************************************************
> * TPI basket
> ******************************************************************************;
. * Number of items for Uganda i primarily set it to 30 on considering a product for 
> appearing over 1000 times on households menu min was 1085 and max was 6157 however 
> the relevant code in new is atvivated to take care of this automatically;
. global product_tpi_n "30";

. * Code choose $product_tpi_n ;
. global product_tpi   "product_tpi==1";

. * Initial (arbitrary) quantile defining poor for price index calculations.
> * Mozambique: bottom 60%. Vietnam: bottom 20%. Tanzania: bottom 40% . Uganda: headc
> ount 2009 24.5% ;
. global tpi_bottom "30";

.  * Set the number of regions in the TPI calc for Uganda are set to 4 as east centra
> l north and east;
. global n_tpi "4";

. * To reproduce the mozambique 10 numbers, the following global should be commented 
> out. It controls a line in 140_iterate.do 
> * where observations not measured in kg are dropped. For all other datasets, all ob
> servations should be converted to kg's before
> * the toolkit is run. For all other datasets, this line should therefore be include
> d.
> global MZ "*";
. ******************************************************************************
> * Initial (arbitrary) quantile defining the (relatively) poor.
> ******************************************************************************;
. global bottom "30";

. ******************************************************************************
> * Number of iterations in 140_iterate.do
> ******************************************************************************;
. global it_n "5";

. ******************************************************************************
> * Set the number of regions in the spatial domain;
. ******************************************************************************;
. global n_spdom "5";

. ******************* we deleted East urban, North urban and West urban because too f
> ew observations were in those spatial domains;
.  ******************************************************************************
> * Revealed preferences choices
> ******************************************************************************;
. * Activate GAMS program according to number of regions in spatial domain;
. *global revpref "190_revpref13_m1.bat";
. *global no_temp_rev " ";
. * k spatial regions and no intertemporal revealed preference condition:
>   Activate the next two lines below;
. global no_temp_rev "*";

. global revpref "190_revpref13_r.bat";

.  **************************************************************************
> * 010_initial.do                (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/010_initial.log
  log type:  text
 closed on:  20 May 2013, 17:27:41
-------------------------------------------------------------------------------------

. 
end of do-file

. 
. *do "C:\user\gapp\z_data_preb/new/100_collect_expen_moz.do"
. *s;
. 
. *do "C:\user\gapp\z_data_preb/new/000_boom.do"
. 
. *global path "C:\user\gapp"
. 
. /*
> 
> **************************************************************************;
> **************************************************************************;
> * This is the block of do files to set up the data to get nominal
> * consumption. These DO NOT need to be bootstrapped.
> **************************************************************************;
> **************************************************************************;
>         
>         * This code produces some once for all data for the in-folder. Don't
>         * run it unless you know what you are doing!!!
>                 * Produces education expenditure
>                 *do "$path\new\Create/education_Create.do"
>                 * Imputation of missing recepts-in-kind. Run the code without this 
> first...
>                 *do "$path\new\Create/0_code_chain.do"
>                 * First poverty lines dependent on IAF
>                 *do "$path\new\Create/povlines_first_iof_Create.do"
>                 * Match product codes for different surveys
>                 *do "$path\new\Create/match96_02_Create.do"
>                 * Basket from previous survey
>                 *do "$path\new\Create/smallbasket_iof_Create.do"
>                 * Match product codes between surveys
>                 *do "$path\new\Create/rev_pref_matchcodes_02-96_iof_Create.do"
>                 * Update poverty lines
>                 *do "$path\new\Create/povlines-96-v1-vers7_iof_Create.do"          
>      
>                 * Food share
>                 *do "$path\new\Create/foodshr96_iof_Create.do"
>                 
>                 *do "$path\new\Create/.do"
>                 *do "$path\new\Create/.do"
> 
> */
.         * This set of files takes the raw data and creates more handy data 
.         * sets in the work-folder
.         do "$path/new/020_in_2_work_folder.do"

. clear all

. global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"

. set mem 999m

. 
. cap log close

. log using "$path/rep/020_hhdata.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/020_hhdata.log
  log type:  text
 opened on:  20 May 2013, 17:27:41

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 020_hhdata.do         (start)
> *
> * Organize the hhid identifier in the HHData file the same way, and keep
> * only the relevant variables.
> *
> * This file sets:
> * - interview month, quarter and year
> * - regions: make all needed regions. But in the end only the one specified
> *            in initial.do are kept. These are
> *            - rural: 0=urban, 1=rural
> *            - news: speficifying North, East, West, South. But combinations
> *                    are also possible, eg. North-East, Center,...
> *            - reg_tpi: regions with own TPI
> *            - strata: strata regions
> *            - spdomain: spatial domains (regions with own poverty line)
> *            - news_ru_ur: combination of news and rural
> **************************************************************************;
. use "$path\in\hhdata.dta", clear;

. *recode spdomain 10=1 11=2 20=3 30=4 40=5 these have been set to five for Uganda to
>  ensure hwe have at least 1000 households per domain;
. tab spdomain, missing;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |      1,177       17.37       17.37
Central urban |        809       11.94       29.31
      Eastern |      1,406       20.75       50.07
     Northern |      1,956       28.87       78.94
      Western |      1,427       21.06      100.00
--------------+-----------------------------------
        Total |      6,775      100.00

.         sort hhid;

.         save "$path\work\hhdata.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\hhdata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
      strata |      6775    5.551734    2.873672          1         10
        mult |      6775    919.0598    636.8381   26.67222   10279.15
      region |      6775    2.416827    1.118389          1          4
       urban |      6775    .1800738    .3842773          0          1
-------------+--------------------------------------------------------
    district |      6775    250.5169    112.9571        101        419
       rmult |      6775    919.0713    636.8355         27      10279
      hhsize |      6775        4.96     2.75857          1         24
     welfare |      6775    73089.98    95260.67   2034.431    1932420
    hhweight |      6775    4533.332    4304.242         54      92511
-------------+--------------------------------------------------------
      poor09 |      6775      .23631    .4248461          0          1
         day |      6775    14.08576    7.581748          1         31
       month |      6775    6.686199    3.405931          1         12
        Year |      6775    2009.336    .4722506       2009       2010
       h1bq8 |      6775    1.005018    .0706683          1          2
-------------+--------------------------------------------------------
         psu |      6775     365.894     201.698          1        712
    survquar |      6775    2.499336    1.144024          1          4
     survmon |      6775    6.713948     3.34507          1         12
       rural |      6775    .8199262    .3842773          0          1
        news |      6775    2.416827    1.118389          1          4
-------------+--------------------------------------------------------
        bswt |      6775           1           0          1          1
    spdomain |      6775      3.2431    1.373578          1          5
     reg_tpi |      6775    2.416827    1.118389          1          4

. use "$path\in\indata.dta", clear;

.         *sort hhid;
.         save "$path\work\indata.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\indata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98

. use "$path\in\calperg.dta", clear;

.         *sort hhid;
.         save "$path\work\calperg.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\calperg.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
    descript |         0
     calperg |        62    1.980716    2.136812          0       8.84

. use "$path\in\cons_cod.dta", clear;

.         *sort hhid;
.         save "$path\work\cons_cod.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\cons_cod.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    food_cat |    412045    1.782558    .4125064          1          2
    prod_cat |    412045    1.782558    .4125064          1          2
    descript |    412045    1.782558    .4125064          1          2
-------------+--------------------------------------------------------
   quantityd |     89596     .779464    3.170331          0   364.2857
 cod_hh_nom3 |     89596     383.356    648.4919          0      18500
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
 cod_hh_nom2 |    252585    2614.436    786487.2   .0027397   3.95e+08

. use "$path\in\cons_cod_trans.dta", clear;

.         *sort hhid;
.         save "$path\work\cons_cod_trans.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\cons_cod_trans.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     89596    2.45e+09    1.13e+09   1.01e+09   4.19e+09
     product |     89596    131.0155     15.7293        100        161
       untcd |     88138    44.41037    30.53397          1         85
        unit |     89596           1           0          1          1
    food_cat |     89596           1           0          1          1
-------------+--------------------------------------------------------
   quantityz |     89596     .779464    3.170331          0   364.2857
      valuez |     89596     383.356    648.4919          0      18500

. /*
> use "$path\in\cons_cod_trans.dta", clear;
>         *sort hhid;
>         sum;
> for var value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3: replace X=0 if X==.;
> collapse food_cat prod_cat (sum) value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3
> , by(hhid product descript);
>         save "$path\work\cons_cod.dta", replace;
>         sum;
> */
>  
> **************************************************************************
> * 020_hhdata.do         (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.         
. /*
>         * All kind of raw expenditure is handled: daily, own and monthly, rent and 
> use value, education etc.
>         do "$path/new/030_rawdata.do"
> 
>         * Data set specific changes to each processed raw data set takes place here
>         do "$path/new/040_specifities.do"
> 
>         * These files summarizes and checks the data. But no temporal deflation don
> e here yet
>         do "$path/new/050_consump_nom.do"
> 
>         * Bring in data on food product's calories per gram
>         do "$path/new/060_calperg.do"
> */
. **********************************************************************;
. **********************************************************************;
. 
.                                 do "$path/new/070_calpp.do"                        
>      /* Calories per person in spatial domains*/

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path\rep\070_calpp.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\070_calpp.log
  log type:  text
 opened on:  20 May 2013, 17:27:41

. clear

. set more off

. #delimit ;
delimiter now ;
. *global fert_rate "fert_rate";
. ***********************************************************************
> * 070_calpp.do          (start)
> *
> * Purpose: Determine calories required for each person per domain per day.
> ***********************************************************************;
. /*
> This file uses:
>         work\indata.dta
>         work\hhdata.dta
> 
> This file creates:
>         work\calpp.dta
> */
> 
> *-------------------------------------------------------------------------*
> * Include fertility rates from csv-file
> *-------------------------------------------------------------------------*;
. clear;

. insheet sex rural age fert_rate using "$path/in/fert_rate_Uganda.csv";
(4 vars, 96 obs)

. ***************************************** check for Ugandan fertility rates *******
> ******************************
> ***********************************************************************************
> **************************;
. sort sex rural age;

. tempfile fert_rate;

. save `fert_rate';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. list;

     +------------------------------+
     | sex   rural   age   fert_r~e |
     |------------------------------|
  1. |   2       0    12       .008 |
  2. |   2       0    13       .008 |
  3. |   2       0    14       .008 |
  4. |   2       0    15       .134 |
  5. |   2       0    16       .134 |
     |------------------------------|
  6. |   2       0    17       .134 |
  7. |   2       0    18       .134 |
  8. |   2       0    19       .134 |
  9. |   2       0    20       .313 |
 10. |   2       0    21       .313 |
     |------------------------------|
 11. |   2       0    22       .313 |
 12. |   2       0    23       .313 |
 13. |   2       0    24       .313 |
 14. |   2       0    25       .291 |
 15. |   2       0    26       .291 |
     |------------------------------|
 16. |   2       0    27       .291 |
 17. |   2       0    28       .291 |
 18. |   2       0    29       .291 |
 19. |   2       0    30       .232 |
 20. |   2       0    31       .232 |
     |------------------------------|
 21. |   2       0    32       .232 |
 22. |   2       0    33       .232 |
 23. |   2       0    34       .232 |
 24. |   2       0    35       .172 |
 25. |   2       0    36       .172 |
     |------------------------------|
 26. |   2       0    37       .172 |
 27. |   2       0    38       .172 |
 28. |   2       0    39       .172 |
 29. |   2       0    40       .074 |
 30. |   2       0    41       .074 |
     |------------------------------|
 31. |   2       0    42       .074 |
 32. |   2       0    43       .074 |
 33. |   2       0    44       .074 |
 34. |   2       0    45       .023 |
 35. |   2       0    46       .023 |
     |------------------------------|
 36. |   2       0    47       .023 |
 37. |   2       0    48       .023 |
 38. |   2       0    49       .023 |
 39. |   2       0    50       .006 |
 40. |   2       0    51       .006 |
     |------------------------------|
 41. |   2       0    52       .006 |
 42. |   2       0    53       .006 |
 43. |   2       0    54       .006 |
 44. |   2       0    55       .006 |
 45. |   2       0    56       .006 |
     |------------------------------|
 46. |   2       0    57       .006 |
 47. |   2       0    58       .006 |
 48. |   2       0    59       .006 |
 49. |   2       1    12       .008 |
 50. |   2       1    13       .008 |
     |------------------------------|
 51. |   2       1    14       .008 |
 52. |   2       1    15       .134 |
 53. |   2       1    16       .134 |
 54. |   2       1    17       .134 |
 55. |   2       1    18       .134 |
     |------------------------------|
 56. |   2       1    19       .134 |
 57. |   2       1    20       .313 |
 58. |   2       1    21       .313 |
 59. |   2       1    22       .313 |
 60. |   2       1    23       .313 |
     |------------------------------|
 61. |   2       1    24       .313 |
 62. |   2       1    25       .291 |
 63. |   2       1    26       .291 |
 64. |   2       1    27       .291 |
 65. |   2       1    28       .291 |
     |------------------------------|
 66. |   2       1    29       .291 |
 67. |   2       1    30       .232 |
 68. |   2       1    31       .232 |
 69. |   2       1    32       .232 |
 70. |   2       1    33       .232 |
     |------------------------------|
 71. |   2       1    34       .232 |
 72. |   2       1    35       .172 |
 73. |   2       1    36       .172 |
 74. |   2       1    37       .172 |
 75. |   2       1    38       .172 |
     |------------------------------|
 76. |   2       1    39       .172 |
 77. |   2       1    40       .074 |
 78. |   2       1    41       .074 |
 79. |   2       1    42       .074 |
 80. |   2       1    43       .074 |
     |------------------------------|
 81. |   2       1    44       .074 |
 82. |   2       1    45       .023 |
 83. |   2       1    46       .023 |
 84. |   2       1    47       .023 |
 85. |   2       1    48       .023 |
     |------------------------------|
 86. |   2       1    49       .023 |
 87. |   2       1    50       .006 |
 88. |   2       1    51       .006 |
 89. |   2       1    52       .006 |
 90. |   2       1    53       .006 |
     |------------------------------|
 91. |   2       1    54       .006 |
 92. |   2       1    55       .006 |
 93. |   2       1    56       .006 |
 94. |   2       1    57       .006 |
 95. |   2       1    58       .006 |
     |------------------------------|
 96. |   2       1    59       .006 |
     +------------------------------+

. *-------------------------------------------------------------------------*
> * Now do the calorie needs for individuals
> *-------------------------------------------------------------------------*;
. use "$path\work\indata.dta";

. * CA bootstrap modification;
. sort hhid;

. merge hhid using "$path\work\hhdata.dta";
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     35,945      100.00      100.00
------------+-----------------------------------
      Total |     35,945      100.00

.  drop _m;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98
-------------+--------------------------------------------------------
      strata |     35945    5.710586    2.766681          1         10
        mult |     35945    917.2863    619.3906   26.67222   10279.15
      region |     35945    2.480234    1.085821          1          4
       urban |     35945    .1471693    .3542795          0          1
    district |     35945    257.0191    109.5067        101        419
-------------+--------------------------------------------------------
       rmult |     35945    917.2973    619.3847         27      10279
      hhsize |     35945    6.416497    2.935303          1         24
     welfare |     35945    62735.83     78270.9   2034.431    1932420
    hhweight |     35945     5917.96    5136.521         54      92511
      poor09 |     35945    .2781472    .4480925          0          1
-------------+--------------------------------------------------------
         day |     35945     14.0508    7.502636          1         31
       month |     35945     6.71398    3.387719          1         12
        Year |     35945    2009.329    .4700192       2009       2010
       h1bq8 |     35945     1.00498     .070393          1          2
         psu |     35945    377.7054    193.8014          1        712
-------------+--------------------------------------------------------
    survquar |     35945    2.484852    1.142574          1          4
     survmon |     35945    6.667353    3.350374          1         12
       rural |     35945    .8528307    .3542795          0          1
        news |     35945    2.480234    1.085821          1          4
        bswt |     35945           1           0          1          1
-------------+--------------------------------------------------------
    spdomain |     35945    3.321575    1.334996          1          5
     reg_tpi |     35945    2.480234    1.085821          1          4

. * Include fertility rates;
. sort sex rural age;

. merge sex rural age using `fert_rate';
variables sex rural age do not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     35945    2.57e+11    1.10e+11   1.01e+11   4.19e+11
    motherhh |     35945    .8787592    .3264114          0          1
        hhid |     35945    2.57e+09    1.10e+09   1.01e+09   4.19e+09
         sex |     35945     1.50861    .4999328          1          2
         age |     35945    18.94194    17.44062          0         98
-------------+--------------------------------------------------------
      strata |     35945    5.710586    2.766681          1         10
        mult |     35945    917.2863    619.3906   26.67222   10279.15
      region |     35945    2.480234    1.085821          1          4
       urban |     35945    .1471693    .3542795          0          1
    district |     35945    257.0191    109.5067        101        419
-------------+--------------------------------------------------------
       rmult |     35945    917.2973    619.3847         27      10279
      hhsize |     35945    6.416497    2.935303          1         24
     welfare |     35945    62735.83     78270.9   2034.431    1932420
    hhweight |     35945     5917.96    5136.521         54      92511
      poor09 |     35945    .2781472    .4480925          0          1
-------------+--------------------------------------------------------
         day |     35945     14.0508    7.502636          1         31
       month |     35945     6.71398    3.387719          1         12
        Year |     35945    2009.329    .4700192       2009       2010
       h1bq8 |     35945     1.00498     .070393          1          2
         psu |     35945    377.7054    193.8014          1        712
-------------+--------------------------------------------------------
    survquar |     35945    2.484852    1.142574          1          4
     survmon |     35945    6.667353    3.350374          1         12
       rural |     35945    .8528307    .3542795          0          1
        news |     35945    2.480234    1.085821          1          4
        bswt |     35945           1           0          1          1
-------------+--------------------------------------------------------
    spdomain |     35945    3.321575    1.334996          1          5
     reg_tpi |     35945    2.480234    1.085821          1          4
   fert_rate |      9790    .1596475    .1158504       .006       .313
      _merge |     35945    1.544721    .8903613          1          3

. * Do calorie calculations ;
.     gen num=1;

.     gen cal = .;
(35945 missing values generated)

. * Same assumptions about sex/age specific calories need in IAF 1997, IAF 2003 and I
> OF 2009;
. * Children (no difference between boys and girls)   ;
.      replace cal =  820 if age < 1;
(1196 real changes made)

. * Add 500 cal per day for mothers in first six months of breast feeding
> * We assume that 60% of children under 1 are under six months old
> * And that all of them breast feed
> * We add these mother requirements of 300 on average to each child under 1 whose mo
> ther is alive;
.     replace cal = 1120 if age <  1 & motherhh==1;
(1168 real changes made)

.     replace cal = 1150 if age >= 1 & age <2;
(2318 real changes made)

.     replace cal = 1350 if age >= 2 & age <3;
(1288 real changes made)

.     replace cal = 1550 if age >= 3 & age <5;
(2746 real changes made)

. * Males ;
.     replace cal = 1850 if age >=  5 & age <7  & sex==1;
(1272 real changes made)

.     replace cal = 2100 if age >=  7 & age <10 & sex==1;
(1776 real changes made)

.     replace cal = 2200 if age >= 10 & age <12 & sex==1;
(1048 real changes made)

.     replace cal = 2400 if age >= 12 & age <14 & sex==1;
(1122 real changes made)

.     replace cal = 2650 if age >= 14 & age <16 & sex==1;
(932 real changes made)

.     replace cal = 2850 if age >= 16 & age <18 & sex==1;
(792 real changes made)

.     replace cal = 3000 if age >= 18 & age <30 & sex==1;
(3012 real changes made)

.     replace cal = 2900 if age >= 30 & age <60 & sex==1;
(3276 real changes made)

.     replace cal = 2450 if age>=60 & age~=. & sex==1;
(669 real changes made)

. * Girls 5-12 years (probability of pregnancy assumed = 0) ;
.     replace cal = 1750 if age >=  5 & age < 7 & sex==2;
(1202 real changes made)

.     replace cal = 1800 if age >=  7 & age <10 & sex==2;
(1698 real changes made)

.     replace cal = 1950 if age >= 10 & age <12 & sex==2;
(1025 real changes made)

. * Women with a correction for pregnancy. We add 285 calories per for the final trim
> ester.
> * To do this we find the probability that rural and urban women are pregnant from
> * live births data in the 1997 census over the past 12 months (no correction for st
> ill births).
> * 3/4*probability of birth gives probability of preganancy. Probability of final tr
> imester is one
> * third of that of that or 1/4 of the probability of birth
> 
> * Women urban;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural=
> =0;
(135 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural=
> =0;
(267 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural=
> =0;
(874 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural=
> =0;
(491 real changes made)

. * Women rural;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural=
> =1;
(941 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural=
> =1;
(1392 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural=
> =1;
(2824 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural=
> =1;
(2866 real changes made)

. * Women 60+ are not pregnant ;
.     replace cal = 1950 if age>=60 & age~=. & sex==2;
(783 real changes made)

.     count if cal ==.;
    0

.     *Fill in these two observations for IAF 2002/03:;
.     * 1) this one is a child;
.     *replace cal = 1500 if cal ==. & age==.;
.     * 2) this one is 21 years old;
.     *replace cal = 2500 if cal ==. & b2==.;
.     collapse (sum) cal num (max) psu hhsize hhweight strata rural spdomain, by (hhi
> d);

.     gen chk=hhsize - num;

.     sum chk;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
         chk |      6775   -.3455351    .8928498        -11          0

.     drop chk;

.     gen calpp = cal / hhsize;

.     sort spdomain;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
         cal |      6775    11156.05    6182.897       1950   50725.72
         num |      6775    5.305535    2.940196          1         24
         psu |      6775     365.894     201.698          1        712
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
    hhweight |      6775    4533.332    4304.242         54      92511
      strata |      6775    5.551734    2.873672          1         10
       rural |      6775    .8199262    .3842773          0          1
    spdomain |      6775      3.2431    1.373578          1          5
       calpp |      6775    2347.186    704.3686   1463.578   26456.36

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
         cal |      6775    11156.05    6182.897       1950   50725.72
         num |      6775    5.305535    2.940196          1         24
         psu |      6775     365.894     201.698          1        712
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
    hhweight |      6775    4533.332    4304.242         54      92511
      strata |      6775    5.551734    2.873672          1         10
       rural |      6775    .8199262    .3842773          0          1
    spdomain |      6775      3.2431    1.373578          1          5
       calpp |      6775    2347.186    704.3686   1463.578   26456.36

.  codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     Household ID
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. collapse (mean) calpp[aw=hhsize*hhweight], by (spdomain);

. sort spdomain;

. save "$path\work\calpp.dta",replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\calpp.dta saved

. ***********************************************************************
> * 070_calpp.do          (end)
> ***********************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\070_calpp.log
  log type:  text
 closed on:  20 May 2013, 17:27:42
-------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/080_conpc.do"                        
>      /* Nominal food/non-food expenditure */

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 100m

. 
. clear

. cap log close

. log using "$path/rep/080_conpc.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/080_conpc.log
  log type:  text
 opened on:  20 May 2013, 17:27:42

. set more off

. #delimit ;
delimiter now ;
. ***************************************************************************
> * 080_conpc.do          (start)
> *
> * Creates a file with per capita nominal consumption divided between food
> * and non-food categories based on the calorie definition of food
> * rather than the COICOP (INE) definition of food. ready for 
> * temporal deflation when necessary
> ****************************************************************************;
. /*
> This file uses:
>         work\hhdata.dta
>         work\consump_nom.dta
>       
> This file creates:
>         work\conpc.dta
> */
> 
> 
> 
> ***************************************************************************
> * Food expenditure
> ****************************************************************************;
. *use "$path\in\cons_cod.dta";
. use "$path\work\cons_cod.dta";

.             *sort product;
.             *merge product using "$path\work\food_cat.dta";
.             *tab _m;
.             *drop _m;
.             keep if food_cat==1;
(322449 observations deleted)

.             collapse (sum) cod_hh_nom, by(hhid);

.             rename cod_hh_nom food_hh_nom;

.                 sort hhid;

.             keep hhid food_hh_nom;

.             tempfile foodexp;

. save `foodexp';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. ***************************************************************************
> * Food expenditure merged with all expenditure
> ****************************************************************************;
. use "$path\work\cons_cod.dta";

. *use "$path\in\cons_cod.dta";
. *use "$path\in\cons_cat.dta";
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    food_cat |    412045    1.782558    .4125064          1          2
    prod_cat |    412045    1.782558    .4125064          1          2
    descript |    412045    1.782558    .4125064          1          2
-------------+--------------------------------------------------------
   quantityd |     89596     .779464    3.170331          0   364.2857
 cod_hh_nom3 |     89596     383.356    648.4919          0      18500
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
 cod_hh_nom2 |    252585    2614.436    786487.2   .0027397   3.95e+08

. collapse (sum) cod_hh_nom, by(hhid);

. *gen cons_pc_nom = cons_hh_nom/hhsize;
. rename cod_hh_nom cons_hh_nom;

. *keep  hhid cons_pc_nom cons_hh_nom ;
. *keep hhid cod_hh_nom;
. *use "$path\in\cons_cod.dta";
. *use "$path\in\consump_nom.dta";
. *use "$path\work\consump_nom.dta";
. *            keep  hhid cons_hh_nom ;
.             display _N;
6775

.             keep  hhid cons_hh_nom ;

.             sort hhid;

.             merge hhid using "$path\work\hhdata.dta";

.             tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.             drop _m;

. gen cons_pc_nom = cons_hh_nom/hhsize;

.             sort hhid;

.             merge hhid using `foodexp';

.             tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 drop if _merge==2;
(0 observations deleted)

.             replace food_hh_nom=0 if _merge==1 & food_hh_nom==.;
(0 real changes made)

.             drop _m;

.                 gen food_pc_nom=food_hh_nom/hhsize;

.                 gen nf_hh_nom=cons_hh_nom-food_hh_nom;

.             gen nf_pc_nom=nf_hh_nom/hhsize;

.              keep hhid cons_hh_nom food_pc_nom nf_pc_nom cons_pc_nom survquar spdom
> ain news reg_tpi rural hhweight hhsize;

.             lab var food_pc_nom "nominal food consumption per capita";

.             lab var nf_pc_nom "nominal non-food consumption per capita";

. keep hhid cons_hh_nom cons_pc_nom food_pc_nom nf_pc_nom;

.             sort hhid;

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
 cons_hh_nom |      6775    97487.28     4938495   232.1918   4.06e+08
 cons_pc_nom |      6775    20773.97    987396.4   78.55931   8.12e+07
 food_pc_nom |      6775    1257.269    1252.965          0   17857.14
   nf_pc_nom |      6775     19516.7    987342.9   23.11263   8.12e+07

.  codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                   Household Code
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. save "$path\work\conpc.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\conpc.dta saved

. ***************************************************************************
> * 080_conpc.do          (end)
> ****************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/080_conpc.log
  log type:  text
 closed on:  20 May 2013, 17:27:43
-------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/090_temp_index.do"                /* 
> Temporal price index */

. *global path "C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/090_temp_index.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/090_temp_index.lo
> g
  log type:  text
 opened on:  20 May 2013, 17:27:43

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 090_temp_index.do     (start)
> **************************************************************************;
. *do "$path/new/010_initial.do";
. **************************************************************************
> * Program to compute the temporal price index (intra-survey)
> * 
> * The index is based on 6 regions (North/Center/South by rural/urban) 
> * and four quarters. For IAF 2002/03 (t=t1) it is based on the same 9
> * commodities used for the analysis of the 1996 IAF (t=t0), 
> * except that we have to go to 8 commodities because the 2002-03 survey 
> * does not distinguish between large and small groundnuts, which were 
> * separate items in the old index. For IOF 2008/09 (t=t2) we expand the
> * the food basket to include the 15 most important food products among
> * the poorest.
> *
> * The commodity weights for the items vary by the 6 regions, and are 
> * calculated from the observations in the IAF2002, using the relatively 
> * poor households (below median nominal consumption per capita).
> *
> * The unit values (prices) calculated here are also based on the prices 
> * paid by the relatively poor, using the same definition.
> *
> * K Simler, Sep 2003
> * CA
> * MAH, April 2010
> * URB, Feb 2013 (automatization to any number of n_tpi's)
> **************************************************************************;
. /*
> This file uses:
>         work\own.dta
>         work\receipts.dta
>         work\daily.dta
>         work\hhdata
>         work\cons_cat.dta
> 
> This file creates:
>         work\tpi_unit_val_quarterly.dta
>         work\tpi_unit_val_monthly.dta
>         work\tpi_news_share.dta
>         work\tpi_reg_tpi_share.dta
>         work\temp_index_news.dta
>         work\temp_index_reg_tpi.dta
> */      
> 
> 
> **************************************************************************
> * Either the products used for intertemporal price index is specified
> * explicitly, or they are automatically found as the the n_tpi products
> * with the highest weighted expenditure shares among the $bottom % poorest
> * part of the population
> **************************************************************************;
. * Generating the n_tpi most important food items for the poorest $bottom % ;
. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (start)
> **************************************************************************;
. *------------------------------------------------------------------------*
> * Population weights for each HH
> *------------------------------------------------------------------------*;
. use "$path/work\hhdata.dta", clear;

. keep hhid hhweight hhsize;

. gen popwt = hhweight*hhsize;

. lab var popwt "Population weights = hhsize X hhweight";

. sort hhid;

. tempfile popwt;

. save `popwt', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
      hhsize |      6775        4.96     2.75857          1         24
    hhweight |      6775    4533.332    4304.242         54      92511
       popwt |      6775    29614.26    44555.51         62     832599

. *------------------------------------------------------------------------*
> * Make list of all consumed products
> *------------------------------------------------------------------------*;
. *use "$path/in\cons_cod.dta", clear;
. *save "$path/work\cons_cod.dta", replace;
. use "$path/work\cons_cod.dta", clear;

. keep product descript;

. collapse product, by(descript);

. sort product;

. tempfile descript;

. save `descript', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    descript |         2         1.5    .7071068          1          2
     product |         2    565.0077    613.7578   131.0155        999

. *------------------------------------------------------------------------*
> * Find the poorest part of the population
> *------------------------------------------------------------------------*;
. use
> "$path/work\cons_cod.dta", clear;

. *use
> *"$path/work\cons_cod.dta", clear;
. ********************************************check the COICOP categories to create t
> he variable prod_cat, for the moment it is equal to food_cat******;
. keep hhid prod_cat product cod_hh_nom;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08

. merge hhid using `popwt';
variable hhid does not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
      hhsize |    412045    5.313592    2.837438          1         24
-------------+--------------------------------------------------------
    hhweight |    412045    4940.193    4557.506         54      92511
       popwt |    412045    33954.53     49935.3         62     832599
      _merge |    412045           3           0          3          3

. drop _merge;

. preserve;

. collapse (sum) cod_hh_nom (mean) popwt hhweight hhsize, by(hhid);

. gen cod_pc_nom = cod_hh_nom/hhsize;

.         sum cod_pc_nom [aw=popwt] , detail;

                         cod_pc_nom
-------------------------------------------------------------
      Percentiles      Smallest
 1%     332.3661       78.55931
 5%     680.3636       103.0936
10%     872.9067       107.7462       Obs                6775
25%     1328.983       145.4659       Sum of Wgt.   200636622

50%     2175.789                      Mean           9412.851
                        Largest       Std. Dev.        395673
75%     3972.618        1528531
90%      9057.59        1552604       Variance       1.57e+11
95%     17758.21        1790269       Skewness       202.1632
99%     88724.46       8.12e+07       Kurtosis       41456.83

.         global medcpc_= r(p$tpi_bottom);

.         gen bottom_ = cod_pc_nom <= $medcpc_;

. sum [aw=popwt];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    6775   200636622    2.52e+09   1.10e+09   1.01e+09   4.19e+09
  cod_hh_nom |    6775   200636622    67821.64    2005057   232.1918   4.06e+08
       popwt |    6775   200636622    96639.42   125478.2         62     832599
    hhweight |    6775   200636622    10417.53   10233.19         54      92511
      hhsize |    6775   200636622    7.911641   3.294698          1         24
-------------+-----------------------------------------------------------------
  cod_pc_nom |    6775   200636622    9412.851     395673   78.55931   8.12e+07
     bottom_ |    6775   200636622           1          0          1          1

. sum [aw=hhweight];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    6775    30713326    2.51e+09   1.12e+09   1.01e+09   4.19e+09
  cod_hh_nom |    6775    30713326    61490.01    2271154   232.1918   4.06e+08
       popwt |    6775    30713326    68053.16   97418.28         62     832599
    hhweight |    6775    30713326    8619.458   9115.422         54      92511
      hhsize |    6775    30713326    6.532559   3.001711          1         24
-------------+-----------------------------------------------------------------
  cod_pc_nom |    6775    30713326    10464.25   451493.4   78.55931   8.12e+07
     bottom_ |    6775    30713326           1          0          1          1

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
  cod_hh_nom |      6775    97487.28     4938495   232.1918   4.06e+08
       popwt |      6775    29614.26    44555.51         62     832599
    hhweight |      6775    4533.332    4304.242         54      92511
      hhsize |      6775        4.96     2.75857          1         24
-------------+--------------------------------------------------------
  cod_pc_nom |      6775    20773.97    987396.4   78.55931   8.12e+07
     bottom_ |      6775           1           0          1          1

. keep if bottom_==1;
(0 observations deleted)

. keep hhid;

. sort hhid;

. tempfile hhid;

. save `hhid';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

. restore;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
      hhsize |    412045    5.313592    2.837438          1         24
-------------+--------------------------------------------------------
    hhweight |    412045    4940.193    4557.506         54      92511
       popwt |    412045    33954.53     49935.3         62     832599

. merge hhid using `hhid';
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00

. keep if _m==3;
(0 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    412045    2.48e+09    1.13e+09   1.01e+09   4.19e+09
     product |    412045    810.2635    358.1243        100        999
    prod_cat |    412045    1.782558    .4125064          1          2
  cod_hh_nom |    412045    1602.923    615777.4          0   3.95e+08
      hhsize |    412045    5.313592    2.837438          1         24
-------------+--------------------------------------------------------
    hhweight |    412045    4940.193    4557.506         54      92511
       popwt |    412045    33954.53     49935.3         62     832599
      _merge |    412045           3           0          3          3

. *------------------------------------------------------------------------*
> * Keep only food product expenditure by the poor. Calculate food product
> * share of total food expenditure by the poor
> *------------------------------------------------------------------------*;
. keep if prod_cat==1;
(322449 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     89596    2.45e+09    1.13e+09   1.01e+09   4.19e+09
     product |     89596    131.0155     15.7293        100        161
    prod_cat |     89596           1           0          1          1
  cod_hh_nom |     89596     383.356    648.4919          0      18500
      hhsize |     89596    5.132807    2.743211          1         24
-------------+--------------------------------------------------------
    hhweight |     89596    4792.901    4413.167         54      92511
       popwt |     89596    31755.96    47010.28         62     832599
      _merge |     89596           3           0          3          3

. sort product;

. *preserve;
. collapse (sum) cod_hh_nom [aw=hhweight], by(product);

. sort cod;

. egen total=sum(cod_hh_nom);

. gen sh=100*cod_hh_nom/total;

. *------------------------------------------------------------------------*
> * Include product labels
> *------------------------------------------------------------------------*;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
  cod_hh_nom |        62    638077.8    715958.5   17319.09    3153092
       total |        62    3.96e+07           0   3.96e+07   3.96e+07
          sh |        62    1.612903    1.809766   .0437784   7.970237

. sort product;

. merge product using `descript';

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         62       96.88       96.88
          2 |          2        3.13      100.00
------------+-----------------------------------
      Total |         64      100.00

. keep if _merge==1 | _merge==3;
(2 observations deleted)

. drop _merge;

. sort sh;

. *list;
. list in -$product_tpi_n/-1;

     +-----------------------------------------------------+
     | product   cod_hh~m      total         sh   descript |
     |-----------------------------------------------------|
 33. |     132   405723.3   3.96e+07   1.025568          . |
 34. |     134   406314.1   3.96e+07   1.027062          . |
 35. |     138   430628.1   3.96e+07   1.088521          . |
 36. |     119   483520.1   3.96e+07   1.222219          . |
 37. |     153     492023   3.96e+07   1.243713          . |
     |-----------------------------------------------------|
 38. |     144   508887.7   3.96e+07   1.286343          . |
 39. |     109   513852.6   3.96e+07   1.298893          . |
 40. |     102   520426.1   3.96e+07   1.315509          . |
 41. |     115   540289.6   3.96e+07   1.365719          . |
 42. |     114   619598.2   3.96e+07   1.566191          . |
     |-----------------------------------------------------|
 43. |     116   624874.1   3.96e+07   1.579527          . |
 44. |     112   666715.6   3.96e+07   1.685293          . |
 45. |     136   673802.2   3.96e+07   1.703206          . |
 46. |     122   708505.5   3.96e+07   1.790927          . |
 47. |     123   727642.9   3.96e+07   1.839302          . |
     |-----------------------------------------------------|
 48. |     127   771771.9   3.96e+07   1.950849          . |
 49. |     140   815134.1   3.96e+07   2.060458          . |
 50. |     121   933622.7   3.96e+07   2.359968          . |
 51. |     110    1193071   3.96e+07   3.015789          . |
 52. |     103    1222088   3.96e+07   3.089136          . |
     |-----------------------------------------------------|
 53. |     125    1255223   3.96e+07   3.172893          . |
 54. |     104    1347143   3.96e+07   3.405246          . |
 55. |     157    1520177   3.96e+07   3.842632          . |
 56. |     147    1803996   3.96e+07   4.560056          . |
 57. |     107    1921288   3.96e+07   4.856542          . |
     |-----------------------------------------------------|
 58. |     108    1955183   3.96e+07    4.94222          . |
 59. |     117    2086078   3.96e+07   5.273091          . |
 60. |     141    2271924   3.96e+07   5.742862          . |
 61. |     105    3043549   3.96e+07   7.693342          . |
 62. |     113    3153092   3.96e+07   7.970237          . |
     +-----------------------------------------------------+

. list product descript in -$product_tpi_n/-1;

     +--------------------+
     | product   descript |
     |--------------------|
 33. |     132          . |
 34. |     134          . |
 35. |     138          . |
 36. |     119          . |
 37. |     153          . |
     |--------------------|
 38. |     144          . |
 39. |     109          . |
 40. |     102          . |
 41. |     115          . |
 42. |     114          . |
     |--------------------|
 43. |     116          . |
 44. |     112          . |
 45. |     136          . |
 46. |     122          . |
 47. |     123          . |
     |--------------------|
 48. |     127          . |
 49. |     140          . |
 50. |     121          . |
 51. |     110          . |
 52. |     103          . |
     |--------------------|
 53. |     125          . |
 54. |     104          . |
 55. |     157          . |
 56. |     147          . |
 57. |     107          . |
     |--------------------|
 58. |     108          . |
 59. |     117          . |
 60. |     141          . |
 61. |     105          . |
 62. |     113          . |
     +--------------------+

. *restore;
. *------------------------------------------------------------------------*
> * Keep the required number of most important food products
> *------------------------------------------------------------------------*;
. keep in -$product_tpi_n/-1;
(32 observations deleted)

. list;

     +-----------------------------------------------------+
     | product   cod_hh~m      total         sh   descript |
     |-----------------------------------------------------|
  1. |     132   405723.3   3.96e+07   1.025568          . |
  2. |     134   406314.1   3.96e+07   1.027062          . |
  3. |     138   430628.1   3.96e+07   1.088521          . |
  4. |     119   483520.1   3.96e+07   1.222219          . |
  5. |     153     492023   3.96e+07   1.243713          . |
     |-----------------------------------------------------|
  6. |     144   508887.7   3.96e+07   1.286343          . |
  7. |     109   513852.6   3.96e+07   1.298893          . |
  8. |     102   520426.1   3.96e+07   1.315509          . |
  9. |     115   540289.6   3.96e+07   1.365719          . |
 10. |     114   619598.2   3.96e+07   1.566191          . |
     |-----------------------------------------------------|
 11. |     116   624874.1   3.96e+07   1.579527          . |
 12. |     112   666715.6   3.96e+07   1.685293          . |
 13. |     136   673802.2   3.96e+07   1.703206          . |
 14. |     122   708505.5   3.96e+07   1.790927          . |
 15. |     123   727642.9   3.96e+07   1.839302          . |
     |-----------------------------------------------------|
 16. |     127   771771.9   3.96e+07   1.950849          . |
 17. |     140   815134.1   3.96e+07   2.060458          . |
 18. |     121   933622.7   3.96e+07   2.359968          . |
 19. |     110    1193071   3.96e+07   3.015789          . |
 20. |     103    1222088   3.96e+07   3.089136          . |
     |-----------------------------------------------------|
 21. |     125    1255223   3.96e+07   3.172893          . |
 22. |     104    1347143   3.96e+07   3.405246          . |
 23. |     157    1520177   3.96e+07   3.842632          . |
 24. |     147    1803996   3.96e+07   4.560056          . |
 25. |     107    1921288   3.96e+07   4.856542          . |
     |-----------------------------------------------------|
 26. |     108    1955183   3.96e+07    4.94222          . |
 27. |     117    2086078   3.96e+07   5.273091          . |
 28. |     141    2271924   3.96e+07   5.742862          . |
 29. |     105    3043549   3.96e+07   7.693342          . |
 30. |     113    3153092   3.96e+07   7.970237          . |
     +-----------------------------------------------------+

. gen product_tpi=1;

. keep product product_tpi;

. list;

     +--------------------+
     | product   produc~i |
     |--------------------|
  1. |     132          1 |
  2. |     134          1 |
  3. |     138          1 |
  4. |     119          1 |
  5. |     153          1 |
     |--------------------|
  6. |     144          1 |
  7. |     109          1 |
  8. |     102          1 |
  9. |     115          1 |
 10. |     114          1 |
     |--------------------|
 11. |     116          1 |
 12. |     112          1 |
 13. |     136          1 |
 14. |     122          1 |
 15. |     123          1 |
     |--------------------|
 16. |     127          1 |
 17. |     140          1 |
 18. |     121          1 |
 19. |     110          1 |
 20. |     103          1 |
     |--------------------|
 21. |     125          1 |
 22. |     104          1 |
 23. |     157          1 |
 24. |     147          1 |
 25. |     107          1 |
     |--------------------|
 26. |     108          1 |
 27. |     117          1 |
 28. |     141          1 |
 29. |     105          1 |
 30. |     113          1 |
     +--------------------+

. sort product;

. tempfile product_tpi;

. save `product_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        30    123.1333    15.69699        102        157
 product_tpi |        30           1           0          1          1

. clear;

. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (end)
> **************************************************************************;
. **************************************************************************;
. * First, need to calculate the average prices for the food items, by 
> * strata and quarter. For this, we are using the "unit values"
> * (value/quantity) for the observations in the consumption questionnaires,
> * including daily, own and receipts-in-kind.
> *
> * The unit values are constructed as sum(value)/sum(quantity), which effectively
> * weights them by the quantity and value of the transaction. Sampling
> * weights are also used.
> *
> * Get the own consumption file, and limit analysis to the observations
> * in KGs where both value and quantity are available.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. *use "$path/work/cons_cod.dta";
. keep if prod_cat==1;
(322449 observations deleted)

. drop if quantityd==0 | quantityd==.;
(4392 observations deleted)

. *keep if quantityd!=. & cod_hh_nom2!=.;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     85204    2.44e+09    1.14e+09   1.01e+09   4.19e+09
     product |     85204    131.0922    15.78502        100        161
    food_cat |     85204           1           0          1          1
    prod_cat |     85204           1           0          1          1
    descript |     85204           1           0          1          1
-------------+--------------------------------------------------------
   quantityd |     85204     .819643    3.245947   .0000286   364.2857
 cod_hh_nom3 |     85204    403.1168    658.9792          0      18500
  cod_hh_nom |     85204    403.1168    658.9792          0      18500
 cod_hh_nom2 |     84857    404.7653    659.8198   7.142857      18500

. sort product;

. merge product using `product_tpi';
variable product does not uniquely identify observations in the master data

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     30,558       35.86       35.86
          3 |     54,646       64.14      100.00
------------+-----------------------------------
      Total |     85,204      100.00

. drop _merge;

. keep if $product_tpi;
(30558 observations deleted)

. *        replace valued_ac=0 if valued_ac==.;
. *        replace quantityd_ac=0 if quantityd_ac==.;
.         gen valued_tot=cod_hh_nom2;
(136 missing values generated)

.         gen quantityd_tot=quantityd;

. *               replace quantityd_tot=0 if (valued_tot>0 & valued_tot<.) & quantity
> d_tot==.;
.         keep if quantityd_tot!=. & valued_tot!=.;
(136 observations deleted)

.                 collapse (sum) valued_tot quantityd_tot, by(hhid product);

.                 sort hhid;

. tempfile acredd;

. save `acredd' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     54510    2.43e+09    1.15e+09   1.01e+09   4.19e+09
     product |     54510    125.2252    14.92163        102        157
  valued_tot |     54510    529.8151    744.2303   7.142857      18500
quantityd_~t |     54510    1.168003    3.862691   .0000286   364.2857

. /*
> **************************************************************************;
> * Create a data set with an empty 1 observation. Used to avoid empty data
> * sets when the survey do not have the Mozambican set up
> **************************************************************************;
> use "$path/work/own.dta";
> 
> preserve;
> keep in 1;
> drop unit valued quantityd;
> gen unit=2;
> gen valued=0;
> gen quantityd=0;
> tempfile 1obs;
> save `1obs';
> restore;
> 
> **************************************************************************;
> * Own consumption
> **************************************************************************;
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_ac;
>         rename quantityd quantityd_ac;
>         compress;
>         sort hhid product;
>         tempfile ac;
> save `ac', replace;
> 
> **************************************************************************;
> * Now do a similar thing with receipts-in-kind file.
> **************************************************************************;
> use "$path/work/receipts.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> 
> 
> keep if $product_tpi;
> append using `1obs';
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_re;
>         rename quantityd quantityd_re;
>         compress;
>         sort hhid product;
>         tempfile re;
> save `re', replace;
> 
> **************************************************************************;
> * And also with the daily expenditure file.
> **************************************************************************;
> use "$path/work/daily.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> *rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> *rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         collapse (sum) value quantity days , 
>                 by(hhid product unit);
> 
>         gen valued=value/7 if days<=7;
>         replace valued=value/days if days>7 & days<.;
>         gen quantityd=quantity/7 if days<=7;
>         replace quantityd=quantity/days if days>7 & days<.;
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
> 
>         rename valued valued_dd;
>         rename quantityd quantityd_dd;
>         compress;
>         sort hhid product;
>         tempfile dd;
> save `dd', replace;
> 
> 
> 
> 
> **************************************************************************;
> * Merge the three components (own, daily, receipts) together at the HH/product leve
> l, 
> * then aggregate to the regional level, using the sample weights (hhweight).
> * We DON'T want to weight by "hhsize" because the quantity and value are
> * already for the household (i.e., other things equal, larger households
> * are buying larger quantities, and therefore already getting more weight).
> * Then calculate sum(val)/sum(quantity) to get the quantity weighted mean
> * unit value in each strata in each quarter.
> **************************************************************************;
> use `ac';
>         sort hhid product;
>         merge hhid product using `re';
>         tab _m;
>         drop _m;
>         
>         sort hhid product;
>         merge hhid product using `dd';
>         tab _m;
>         drop _m;
>         
>         replace valued_ac=0 if valued_ac==.;
>         replace valued_re=0 if valued_re==.;
>         replace valued_dd=0 if valued_dd==.;
>         replace quantityd_ac=0 if quantityd_ac==.;
>         replace quantityd_re=0 if quantityd_re==.;
>         replace quantityd_dd=0 if quantityd_dd==.;
> 
>         gen valued_tot=valued_ac+valued_re+valued_dd;
>         gen quantityd_tot=quantityd_ac+quantityd_re+quantityd_dd;
> 
>         sort hhid;
> 
>         tempfile acredd;
> save `acredd' , replace;
> */
> 
> 
> 
> use "$path/work/hhdata.dta";

.         keep strata hhid hhweight hhsize rural survmon survquar news spdomain reg_t
> pi;

.         sort hhid;

.         tempfile hhd;

. save `hhd' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp saved

. use `acredd', clear;

.         merge hhid using `hhd';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        151        0.28        0.28
          3 |     54,510       99.72      100.00
------------+-----------------------------------
      Total |     54,661      100.00

.         drop _merge;

.                 tab survquar , miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |     14,305       26.17       26.17
Sept-Oct 09 |     14,020       25.65       51.82
Nov09-Jan10 |     12,095       22.13       73.95
 Feb-Apr 10 |     14,241       26.05      100.00
------------+-----------------------------------
      Total |     54,661      100.00

.                 tab survmon survquar, miss;

Sequential |
    Survey |
Month (May |   Sequential Survey Quarter May-Jun 09=1)
   2009=1) | May-Jul 0  Sept-Oct   Nov09-Jan  Feb-Apr 1 |     Total
-----------+--------------------------------------------+----------
    May 09 |       305          0          0          0 |       305 
    Jun 09 |    10,074          0          0          0 |    10,074 
    Jul 09 |     3,926          0          0          0 |     3,926 
    Sep 09 |         0      4,930          0          0 |     4,930 
    Oct 09 |         0      9,090          0          0 |     9,090 
    Nov 09 |         0          0      5,036          0 |     5,036 
    Dec 09 |         0          0      3,520          0 |     3,520 
    Jan 10 |         0          0      3,539          0 |     3,539 
    Feb 10 |         0          0          0      3,424 |     3,424 
    Mar 10 |         0          0          0      7,202 |     7,202 
    Apr 10 |         0          0          0      3,615 |     3,615 
-----------+--------------------------------------------+----------
     Total |    14,305     14,020     12,095     14,241 |    54,661 


.         compress;
product was float now int
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
hhsize was double now byte

.         sort hhid;

. save `acredd', replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     54661    2.43e+09    1.15e+09   1.01e+09   4.19e+09
     product |     54510    125.2252    14.92163        102        157
  valued_tot |     54510    529.8151    744.2303   7.142857      18500
quantityd_~t |     54510    1.168003    3.862691   .0000286   364.2857
      strata |     54661    5.361794    2.945049          1         10
-------------+--------------------------------------------------------
      hhsize |     54661    5.199155    2.754984          1         24
    hhweight |     54661    4961.804    4422.265         54      92511
    survquar |     54661    2.480635    1.137595          1          4
     survmon |     54661    6.650555    3.318335          1         12
       rural |     54661    .7884598    .4084042          0          1
-------------+--------------------------------------------------------
        news |     54661    2.341322    1.137758          1          4
    spdomain |     54661    3.160462    1.388466          1          5
     reg_tpi |     54661    2.341322    1.137758          1          4

. **************************************************************************;
. * Need to merge with the file that has nominal consumption per household,
> * and compute nominal consumption per capita from that, so that we can
> * choose the relatively poor (i.e., below median nominal consumption per
> * capita).
> **************************************************************************;
. use "$path\work\conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta" ;
. *save "$path/work/cons_cat.dta", replace ;
. *use "$path/work/cons_cat.dta" ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path\work\hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.  drop _m;

.         collapse (mean) cons_hh_nom hhsize hhweight , by(hhid);

.         gen cpc=cons_hh_nom/hhsize;

.         sum cpc [aw=hhsize*hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     332.3661       78.55931
 5%     680.3636       103.0936
10%     872.9067       107.7462       Obs                6775
25%     1328.983       145.4659       Sum of Wgt.   200636622

50%     2175.789                      Mean           9412.851
                        Largest       Std. Dev.        395673
75%     3972.618        1528531
90%      9057.59        1552604       Variance       1.57e+11
95%     17758.21        1790269       Skewness       202.1632
99%     88724.46       8.12e+07       Kurtosis       41456.83

.         global medcpc=r(p$tpi_bottom);

.         gen bottom_tpi=cpc<=$medcpc;

.         keep hhid bottom_tpi;

.         sort hhid;

.         tempfile bottom_tpi;

. save `bottom_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000008.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000008.tmp saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      6775    2.51e+09    1.13e+09   1.01e+09   4.19e+09
  bottom_tpi |      6775           1           0          1          1

. use `acredd' ;

.         merge hhid using `bottom_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     54,661      100.00      100.00
------------+-----------------------------------
      Total |     54,661      100.00

.         drop _merge;

.         keep if bottom_tpi;
(0 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     54661    2.43e+09    1.15e+09   1.01e+09   4.19e+09
     product |     54510    125.2252    14.92163        102        157
  valued_tot |     54510    529.8151    744.2303   7.142857      18500
quantityd_~t |     54510    1.168003    3.862691   .0000286   364.2857
      strata |     54661    5.361794    2.945049          1         10
-------------+--------------------------------------------------------
      hhsize |     54661    5.199155    2.754984          1         24
    hhweight |     54661    4961.804    4422.265         54      92511
    survquar |     54661    2.480635    1.137595          1          4
     survmon |     54661    6.650555    3.318335          1         12
       rural |     54661    .7884598    .4084042          0          1
-------------+--------------------------------------------------------
        news |     54661    2.341322    1.137758          1          4
    spdomain |     54661    3.160462    1.388466          1          5
     reg_tpi |     54661    2.341322    1.137758          1          4
  bottom_tpi |     54661           1           0          1          1

. * Drop one HH with extremely high quantity and low value in IAF 2002/03 (t=t1) ;
. *        drop if hhid==263001;
.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survmon);

.                         drop if product==.;
(36 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         lab var ppkg "Unit value per kg";

.                         sort reg_tpi product ;

.                         compress;

.                         tempfile uvm;

.                 save `uvm', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved

.                 save "$path/work/tpi_unit_val_monthly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_monthly.dta
>  saved

.         restore;

.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(16 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         sort reg_tpi product survquar;

.                         list in  1/3;

     +-------------------------------------------------------------------------+
     | product      survquar   news   reg_tpi   valued~t   quanti~t       ppkg |
     |-------------------------------------------------------------------------|
  1. |     102    May-Jul 09      1   central   87863.27    265.855   330.4932 |
  2. |     102   Sept-Oct 09      1   central   48570.47   145.1329   334.6621 |
  3. |     102   Nov09-Jan10      1   central    44344.7   134.2199   330.3884 |
     +-------------------------------------------------------------------------+

.                         list in -3/-1;

     +-------------------------------------------------------------------------+
     | product      survquar   news   reg_tpi   valued~t   quanti~t       ppkg |
     |-------------------------------------------------------------------------|
478. |     157   Sept-Oct 09      4   western   78939.99         41   1925.366 |
479. |     157   Nov09-Jan10      4   western   7215.774         14   515.4124 |
480. |     157    Feb-Apr 10      4   western    75578.8         25   3023.152 |
     +-------------------------------------------------------------------------+

.                         tempfile uvq;

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_quarterly.d
> ta saved

.                 save `uvq', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

.         restore;

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each reg_tpi & product combination. This should eliminate outliers that
> * may have an undue influence on the price calculation. Then use sample
> * weighting PLUS quantity weighting on those HH-level observations.
> **************************************************************************;
.         preserve;

.                 gen hhppkg=valued_tot/quantityd_tot;
(151 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(reg_tpi product);
(151 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(reg_tpi product);
(151 missing values generated)

.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
(3596 observations deleted)

.                                 gen hhqtywt=hhweight*quantityd_tot;
(151 missing values generated)

.                                 collapse (sum) valued_tot quantityd_tot [aw=hhqtywt
> ] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(0 observations deleted)

.                         gen ppkg_trim=valued_tot/quantityd_tot;

.                         lab var ppkg_trim "90% trimmed unit value per kg";

.                         sort reg_tpi product survquar;

.                         list , nol;

     +----------------------------------------------------------------------+
     | product   survquar   news   reg_tpi   valued~t   quanti~t   ppkg_t~m |
     |----------------------------------------------------------------------|
  1. |     102          1      1         1   111066.1   339.2506   327.3867 |
  2. |     102          2      1         1   55841.23   173.8043    321.288 |
  3. |     102          3      1         1   58745.94   181.4187   323.8142 |
  4. |     102          4      1         1   93801.71   248.2849   377.7987 |
  5. |     103          1      1         1     187324   613.9128   305.1313 |
     |----------------------------------------------------------------------|
  6. |     103          2      1         1   144639.3   447.4804   323.2305 |
  7. |     103          3      1         1   126731.2    390.095   324.8726 |
  8. |     103          4      1         1   90610.97   287.0195   315.6962 |
  9. |     104          1      1         1   265383.1    452.123   586.9709 |
 10. |     104          2      1         1   112398.4   163.5117   687.4025 |
     |----------------------------------------------------------------------|
 11. |     104          3      1         1   233138.9   377.1665   618.1326 |
 12. |     104          4      1         1   271274.6   463.6059   585.1404 |
 13. |     105          1      1         1   378097.7   1848.184   204.5779 |
 14. |     105          2      1         1   299131.3    1252.46   238.8349 |
 15. |     105          3      1         1   668441.7   2574.798   259.6093 |
     |----------------------------------------------------------------------|
 16. |     105          4      1         1   698669.6    2994.18   233.3426 |
 17. |     107          1      1         1   220972.5   2203.306   100.2914 |
 18. |     107          2      1         1   179800.2   1917.136   93.78587 |
 19. |     107          3      1         1   198916.1   1857.122   107.1099 |
 20. |     107          4      1         1   142272.1   1179.584   120.6121 |
     |----------------------------------------------------------------------|
 21. |     108          1      1         1   88986.94   304.0181   292.7028 |
 22. |     108          2      1         1   84766.54   408.2228   207.6477 |
 23. |     108          3      1         1   60338.68   107.0144   563.8369 |
 24. |     108          4      1         1   32935.75     52.729    624.623 |
 25. |     109          1      1         1   97462.91   879.4846   110.8182 |
     |----------------------------------------------------------------------|
 26. |     109          2      1         1   28204.09   339.6707   83.03362 |
 27. |     109          3      1         1   144449.2   1189.594   121.4273 |
 28. |     109          4      1         1   60511.23   620.1078   97.58179 |
 29. |     110          1      1         1     157623   66.37668   2374.674 |
 30. |     110          2      1         1   214463.6   96.04734   2232.895 |
     |----------------------------------------------------------------------|
 31. |     110          3      1         1   359259.1   157.3912   2282.587 |
 32. |     110          4      1         1   242380.1     112.13   2161.599 |
 33. |     112          1      1         1     168182   319.2035   526.8803 |
 34. |     112          2      1         1    2378.99   3.805322   625.1744 |
 35. |     112          3      1         1   215675.5   469.5735   459.3008 |
     |----------------------------------------------------------------------|
 36. |     112          4      1         1   42069.66   79.83438   526.9617 |
 37. |     113          1      1         1   611650.3   545.6635   1120.929 |
 38. |     113          2      1         1   505672.2   373.1805   1355.034 |
 39. |     113          3      1         1   421691.9   324.2669   1300.447 |
 40. |     113          4      1         1   489941.7   435.1897   1125.812 |
     |----------------------------------------------------------------------|
 41. |     114          1      1         1     236669   101.3145   2335.984 |
 42. |     114          2      1         1   96875.18   44.22242   2190.635 |
 43. |     114          3      1         1   253008.7    119.026   2125.659 |
 44. |     114          4      1         1   199380.6   83.91199   2376.068 |
 45. |     115          1      1         1   20075.57   14.89757   1347.573 |
     |----------------------------------------------------------------------|
 46. |     115          2      1         1   23792.59    15.6242   1522.804 |
 47. |     115          3      1         1   16394.36   15.25242    1074.87 |
 48. |     115          4      1         1   19201.04   18.42168   1042.307 |
 49. |     116          1      1         1   1666.986   1.302065   1280.263 |
 50. |     116          2      1         1   1968.177   4.688902   419.7521 |
     |----------------------------------------------------------------------|
 51. |     116          3      1         1   2984.388   5.548357   537.8868 |
 52. |     116          4      1         1   2043.215   2.028981   1007.016 |
 53. |     117          1      1         1   267109.7   57.33815   4658.499 |
 54. |     117          2      1         1   212056.7   47.54221   4460.388 |
 55. |     117          3      1         1   320598.5   67.79522   4728.925 |
     |----------------------------------------------------------------------|
 56. |     117          4      1         1   248725.5   53.13125    4681.34 |
 57. |     119          1      1         1    19241.2   3.845657    5003.36 |
 58. |     119          2      1         1   23239.61   3.982214    5835.85 |
 59. |     119          3      1         1   52436.88   10.29153   5095.151 |
 60. |     119          4      1         1   28742.14    4.35749   6596.031 |
     |----------------------------------------------------------------------|
 61. |     121          1      1         1     102587   24.32777   4216.868 |
 62. |     121          2      1         1    71776.2   19.96744   3594.662 |
 63. |     121          3      1         1   119699.8   28.82447   4152.717 |
 64. |     121          4      1         1   75903.46   16.33784   4645.869 |
 65. |     122          1      1         1   100736.8    145.468   692.5012 |
     |----------------------------------------------------------------------|
 66. |     122          2      1         1   64724.13   54.26677   1192.703 |
 67. |     122          3      1         1    76486.7   222.6589   343.5152 |
 68. |     122          4      1         1   113504.1   127.1922   892.3825 |
 69. |     123          1      1         1   66997.41    240.388   278.7054 |
 70. |     123          2      1         1   42010.69   161.4953   260.1356 |
     |----------------------------------------------------------------------|
 71. |     123          3      1         1   148874.8   195.7373    760.585 |
 72. |     123          4      1         1   70903.75   382.3045   185.4641 |
 73. |     125          1      1         1   193165.8   2158.771   89.47953 |
 74. |     125          2      1         1   191825.1   1909.321   100.4677 |
 75. |     125          3      1         1   190746.2     2235.6   85.32214 |
     |----------------------------------------------------------------------|
 76. |     125          4      1         1   200125.1    1931.63   103.6043 |
 77. |     127          1      1         1   85085.16   75.41572   1128.215 |
 78. |     127          2      1         1   64821.47   65.96974    982.594 |
 79. |     127          3      1         1   86276.76   93.47074   923.0349 |
 80. |     127          4      1         1   88188.21   92.35265   954.9072 |
     |----------------------------------------------------------------------|
 81. |     132          1      1         1   35694.77   102.5952   347.9185 |
 82. |     132          2      1         1   3375.017   9.354495    360.791 |
 83. |     132          3      1         1   231948.5   503.4943   460.6776 |
 84. |     132          4      1         1   18502.52   35.33288    523.663 |
 85. |     134          1      1         1   75884.12   51.97449   1460.026 |
     |----------------------------------------------------------------------|
 86. |     134          2      1         1   62494.43   48.99602     1275.5 |
 87. |     134          3      1         1   106375.7   77.35232   1375.211 |
 88. |     134          4      1         1   105463.7   111.5502    945.437 |
 89. |     136          1      1         1   76039.13   71.12647   1069.069 |
 90. |     136          2      1         1   67362.27   83.65858   805.2047 |
     |----------------------------------------------------------------------|
 91. |     136          3      1         1   110006.8   106.9104   1028.963 |
 92. |     136          4      1         1   126599.6    138.911   911.3722 |
 93. |     138          1      1         1   36684.43    73.2946   500.5066 |
 94. |     138          2      1         1   50487.79    104.476   483.2478 |
 95. |     138          3      1         1   47149.72   102.4872   460.0549 |
     |----------------------------------------------------------------------|
 96. |     138          4      1         1   45352.42   125.4506   361.5163 |
 97. |     140          1      1         1   447397.8   796.9703   561.3732 |
 98. |     140          2      1         1   76866.83   66.70614    1152.32 |
 99. |     140          3      1         1   274728.4   409.8719   670.2788 |
100. |     140          4      1         1   28217.99   16.67011    1692.73 |
     |----------------------------------------------------------------------|
101. |     141          1      1         1   240715.6   177.0255   1359.779 |
102. |     141          2      1         1   141105.9   74.02929   1906.082 |
103. |     141          3      1         1   285596.6   173.1073   1649.824 |
104. |     141          4      1         1   245841.2   174.2286   1411.027 |
105. |     144          1      1         1   120910.7   54.57555   2215.473 |
     |----------------------------------------------------------------------|
106. |     144          2      1         1   109477.7   41.99524   2606.906 |
107. |     144          3      1         1   92672.33   37.34817   2481.309 |
108. |     144          4      1         1   100051.2   42.89467   2332.487 |
109. |     147          1      1         1   286163.7   127.9021   2237.365 |
110. |     147          2      1         1   237614.4   106.1663   2238.134 |
     |----------------------------------------------------------------------|
111. |     147          3      1         1   325182.9   140.7931   2309.651 |
112. |     147          4      1         1   392900.6   168.0578   2337.889 |
113. |     153          1      1         1     120619   60.41247    1996.59 |
114. |     153          2      1         1   90980.08   126.9232    716.812 |
115. |     153          3      1         1   26998.51    18.7838   1437.329 |
     |----------------------------------------------------------------------|
116. |     153          4      1         1   46202.88   31.29716   1476.265 |
117. |     157          1      1         1   260693.3         93   2803.154 |
118. |     157          2      1         1   143039.6         59     2424.4 |
119. |     157          3      1         1   219614.4         94   2336.324 |
120. |     157          4      1         1   283700.7        105   2701.912 |
     |----------------------------------------------------------------------|
121. |     102          1      2         2   29364.59   86.93306   337.7839 |
122. |     102          2      2         2   17206.62   49.69769   346.2258 |
123. |     102          3      2         2   12636.41   38.47847   328.4021 |
124. |     102          4      2         2   23771.92   65.16817   364.7781 |
125. |     103          1      2         2   37906.28   110.7934   342.1349 |
     |----------------------------------------------------------------------|
126. |     103          2      2         2    48313.5   141.5655   341.2803 |
127. |     103          3      2         2   19709.12    69.0774   285.3193 |
128. |     103          4      2         2   26492.04   78.30276   338.3282 |
129. |     104          1      2         2   12683.53   33.99248   373.1274 |
130. |     104          2      2         2   16220.43   49.21543   329.5801 |
     |----------------------------------------------------------------------|
131. |     104          3      2         2   28828.46   61.66858   467.4741 |
132. |     104          4      2         2   7465.262   8.290213    900.491 |
133. |     105          1      2         2   357220.3   1189.568   300.2942 |
134. |     105          2      2         2   618068.6   2578.645   239.6874 |
135. |     105          3      2         2   751235.6   2748.604   273.3153 |
     |----------------------------------------------------------------------|
136. |     105          4      2         2   479146.9   2223.427   215.4992 |
137. |     107          1      2         2   297593.5    4421.04     67.313 |
138. |     107          2      2         2   169997.9   2387.102   71.21517 |
139. |     107          3      2         2   376672.9   5599.926   67.26391 |
140. |     107          4      2         2   101869.2   1517.206   67.14265 |
     |----------------------------------------------------------------------|
141. |     108          1      2         2   445996.5   623.0493   715.8286 |
142. |     108          2      2         2   296907.4   370.4726   801.4286 |
143. |     108          3      2         2   282927.9   339.1859   834.1381 |
144. |     108          4      2         2   109417.6   159.3522   686.6399 |
145. |     109          1      2         2   9735.132    55.4843   175.4574 |
     |----------------------------------------------------------------------|
146. |     109          2      2         2   66708.81   606.7471    109.945 |
147. |     109          3      2         2   31370.72   393.2848   79.76591 |
148. |     109          4      2         2   4461.495   35.19706   126.7576 |
149. |     110          1      2         2   143359.5   68.01941   2107.626 |
150. |     110          2      2         2   136760.3   74.61742    1832.82 |
     |----------------------------------------------------------------------|
151. |     110          3      2         2   173522.5   94.56759   1834.904 |
152. |     110          4      2         2   63226.65   37.72474       1676 |
153. |     112          1      2         2   126529.4   287.2482    440.488 |
154. |     112          2      2         2   81136.96   197.8114   410.1732 |
155. |     112          3      2         2   158599.5   388.5548   408.1779 |
     |----------------------------------------------------------------------|
156. |     112          4      2         2   13100.11   27.05145   484.2665 |
157. |     113          1      2         2   382745.9     337.06   1135.542 |
158. |     113          2      2         2   689563.5   656.9924   1049.576 |
159. |     113          3      2         2   491485.1   430.2472   1142.332 |
160. |     113          4      2         2   266416.8   292.9142   909.5388 |
     |----------------------------------------------------------------------|
161. |     114          1      2         2   47964.09   22.05739   2174.514 |
162. |     114          2      2         2   68301.07   37.42775   1824.878 |
163. |     114          3      2         2   61957.69   38.10094   1626.146 |
164. |     114          4      2         2   32060.12   15.48739   2070.078 |
165. |     115          1      2         2   47909.89   52.54889   911.7203 |
     |----------------------------------------------------------------------|
166. |     115          2      2         2   93626.42   95.61889   979.1624 |
167. |     115          3      2         2   37367.08   36.06835   1036.007 |
168. |     115          4      2         2   106146.4   115.6465   917.8525 |
169. |     116          1      2         2   100322.1   220.6409    454.685 |
170. |     116          2      2         2   78786.27   172.1059   457.7779 |
     |----------------------------------------------------------------------|
171. |     116          3      2         2   24203.64   34.41812   703.2237 |
172. |     116          4      2         2   35498.38   77.23854   459.5941 |
173. |     117          1      2         2   128181.8   30.45034   4209.537 |
174. |     117          2      2         2   260292.3   62.45788   4167.486 |
175. |     117          3      2         2   218267.6   49.08188   4447.011 |
     |----------------------------------------------------------------------|
176. |     117          4      2         2   129224.4   30.61499   4220.952 |
177. |     119          1      2         2   25626.89   5.878972   4359.076 |
178. |     119          2      2         2   67075.94   15.98689   4195.685 |
179. |     119          3      2         2   32761.49   6.922961   4732.294 |
180. |     119          4      2         2   27754.76    6.64884   4174.376 |
     |----------------------------------------------------------------------|
181. |     121          1      2         2   54507.61   14.30812   3809.558 |
182. |     121          2      2         2    82659.5   19.60178   4216.939 |
183. |     121          3      2         2   106635.9    29.4236   3624.164 |
184. |     121          4      2         2   40805.05   10.51119   3882.057 |
185. |     122          1      2         2   96851.59   173.4525   558.3752 |
     |----------------------------------------------------------------------|
186. |     122          2      2         2   112604.1     246.15   457.4612 |
187. |     122          3      2         2   58697.58   131.7797   445.4219 |
188. |     122          4      2         2   42833.32   47.53296   901.1288 |
189. |     123          1      2         2   61298.66   234.4441   261.4639 |
190. |     123          2      2         2   92101.61   230.3934   399.7581 |
     |----------------------------------------------------------------------|
191. |     123          3      2         2   66328.42   308.0056   215.3481 |
192. |     123          4      2         2   33917.02   92.25834    367.631 |
193. |     125          1      2         2   78968.52   860.0106   91.82272 |
194. |     125          2      2         2   106363.1   1227.473   86.65208 |
195. |     125          3      2         2   118668.6   1592.723   74.50675 |
     |----------------------------------------------------------------------|
196. |     125          4      2         2    78879.7   978.1732   80.63982 |
197. |     127          1      2         2   61383.81   63.68324   963.8926 |
198. |     127          2      2         2   82727.36   117.9509   701.3709 |
199. |     127          3      2         2   84782.69   132.5824   639.4717 |
200. |     127          4      2         2   35638.85   55.54654   641.6035 |
     |----------------------------------------------------------------------|
201. |     132          1      2         2   126896.1   562.9168   225.4259 |
202. |     132          2      2         2   7803.022   17.58225   443.8012 |
203. |     132          3      2         2   94703.77   522.9926   181.0805 |
204. |     132          4      2         2   497.6712    1.60098   310.8541 |
205. |     134          1      2         2    15491.6   21.34178   725.8815 |
     |----------------------------------------------------------------------|
206. |     134          2      2         2   27712.49   19.18386   1444.573 |
207. |     134          3      2         2   82150.38   45.09989   1821.521 |
208. |     134          4      2         2   107489.2    72.0636   1491.588 |
209. |     136          1      2         2   68809.45   81.14402   847.9917 |
210. |     136          2      2         2   72599.34   92.38659   785.8212 |
     |----------------------------------------------------------------------|
211. |     136          3      2         2   65526.31   75.67856   865.8503 |
212. |     136          4      2         2   32966.32   29.73886   1108.527 |
213. |     138          1      2         2   56376.97   168.8026   333.9816 |
214. |     138          2      2         2   121418.6     481.87   251.9738 |
215. |     138          3      2         2   69640.65    274.449   253.7472 |
     |----------------------------------------------------------------------|
216. |     138          4      2         2   33469.82   93.31537   358.6742 |
217. |     140          1      2         2   187855.6   153.5642   1223.303 |
218. |     140          2      2         2   265817.5    206.895   1284.794 |
219. |     140          3      2         2    85701.2   49.81609   1720.352 |
220. |     140          4      2         2    2739.18   1.250496   2190.474 |
     |----------------------------------------------------------------------|
221. |     141          1      2         2   94178.44   63.40778   1485.282 |
222. |     141          2      2         2   112183.6   76.16437   1472.914 |
223. |     141          3      2         2   144774.7   97.33558   1487.377 |
224. |     141          4      2         2   83330.26   55.76326   1494.358 |
225. |     144          1      2         2   24525.44    16.7763    1461.91 |
     |----------------------------------------------------------------------|
226. |     144          2      2         2   68129.55   48.23926   1412.326 |
227. |     144          3      2         2   30792.37   21.57819   1427.013 |
228. |     144          4      2         2   39750.93   69.68451   570.4414 |
229. |     147          1      2         2   183363.4    84.8359   2161.389 |
230. |     147          2      2         2   249999.3   112.4125   2223.946 |
     |----------------------------------------------------------------------|
231. |     147          3      2         2   173990.5   78.76805   2208.897 |
232. |     147          4      2         2   135277.5   58.73138   2303.326 |
233. |     153          1      2         2   31883.68   80.36708   396.7256 |
234. |     153          2      2         2   53805.12    104.484   514.9606 |
235. |     153          3      2         2    58834.3   107.6005   546.7849 |
     |----------------------------------------------------------------------|
236. |     153          4      2         2   34146.19   90.49024   377.3466 |
237. |     157          1      2         2   18576.79         33    562.933 |
238. |     157          2      2         2   29919.74         50   598.3947 |
239. |     157          3      2         2   20269.43         28   723.9081 |
240. |     157          4      2         2   13285.93         28   474.4976 |
     |----------------------------------------------------------------------|
241. |     102          1      3         3   2114.591   7.142858   296.0428 |
242. |     102          2      3         3   3672.339   10.71429   342.7516 |
243. |     102          3      3         3   1085.714   3.571429        304 |
244. |     102          4      3         3   2064.132   7.142858   288.9785 |
245. |     103          1      3         3   2811.979   8.524909   329.8545 |
     |----------------------------------------------------------------------|
246. |     103          2      3         3   10952.85   27.71841    395.147 |
247. |     103          3      3         3   11896.86   44.11667   269.6682 |
248. |     103          4      3         3   1689.238   6.303331   267.9912 |
249. |     104          1      3         3     2656.2   4.465622   594.8109 |
250. |     104          2      3         3   10449.81   9.255874   1128.993 |
     |----------------------------------------------------------------------|
251. |     104          3      3         3   1936.129   6.940541   278.9594 |
252. |     104          4      3         3   9307.124   20.65042   450.6991 |
253. |     105          1      3         3   53356.14   128.6237   414.8234 |
254. |     105          2      3         3   412741.1   869.8284   474.5086 |
255. |     105          3      3         3   232241.5   557.5908   416.5089 |
     |----------------------------------------------------------------------|
256. |     105          4      3         3   358483.1   943.7106   379.8655 |
257. |     107          1      3         3   268716.3   3781.404   71.06258 |
258. |     107          2      3         3   196957.5   2757.818   71.41786 |
259. |     107          3      3         3     130018   1835.504   70.83503 |
260. |     107          4      3         3   382003.5   5982.463   63.85387 |
     |----------------------------------------------------------------------|
261. |     108          1      3         3     220463   204.3706   1078.741 |
262. |     108          2      3         3   196460.2   378.2299   519.4202 |
263. |     108          3      3         3   245844.8   290.1383   847.3368 |
264. |     108          4      3         3   408400.2    565.879   721.7094 |
265. |     109          1      3         3   2404.484   12.87966   186.6884 |
     |----------------------------------------------------------------------|
266. |     109          2      3         3   12680.22   114.7808   110.4734 |
267. |     109          3      3         3   4466.336   13.08654   341.2923 |
268. |     109          4      3         3   5367.666   68.23963   78.65907 |
269. |     110          1      3         3   22828.12   11.33169   2014.537 |
270. |     110          2      3         3   90841.05    38.3687   2367.583 |
     |----------------------------------------------------------------------|
271. |     110          3      3         3   34873.17   21.20598   1644.497 |
272. |     110          4      3         3   77588.54   57.31623   1353.692 |
273. |     112          1      3         3      57077   102.2375   558.2784 |
274. |     112          2      3         3   77115.84   315.7154   244.2574 |
275. |     112          3      3         3   90991.51   361.0983   251.9854 |
     |----------------------------------------------------------------------|
276. |     112          4      3         3   6405.819   23.04664   277.9502 |
277. |     113          1      3         3   169556.7   125.9982   1345.708 |
278. |     113          2      3         3   244567.7   226.9371    1077.69 |
279. |     113          3      3         3   115755.5   105.0785    1101.61 |
280. |     113          4      3         3   223305.8   384.3986   580.9227 |
     |----------------------------------------------------------------------|
281. |     114          1      3         3   78894.25   39.41334   2001.714 |
282. |     114          2      3         3   35943.55   26.62773   1349.854 |
283. |     114          3      3         3   11846.29   6.088944   1945.541 |
284. |     114          4      3         3      74219   66.82891   1110.582 |
285. |     115          1      3         3   24201.49   32.59959   742.3862 |
     |----------------------------------------------------------------------|
286. |     115          2      3         3   44703.18   46.32046   965.0849 |
287. |     115          3      3         3   19887.03   28.61039    695.098 |
288. |     115          4      3         3   62053.24   80.65774   769.3401 |
289. |     116          1      3         3     165694   279.2927   593.2628 |
290. |     116          2      3         3   55139.22   118.0678   467.0131 |
     |----------------------------------------------------------------------|
291. |     116          3      3         3   177373.9   334.9526   529.5493 |
292. |     116          4      3         3   339273.5   757.1875   448.0706 |
293. |     117          1      3         3   82667.25   20.42086   4048.177 |
294. |     117          2      3         3   324343.7   77.98995   4158.789 |
295. |     117          3      3         3   82005.13   19.67075   4168.887 |
     |----------------------------------------------------------------------|
296. |     117          4      3         3   138327.4   32.96321   4196.417 |
297. |     119          1      3         3   27471.77   6.606604   4158.229 |
298. |     119          2      3         3   51692.51   12.02134   4300.062 |
299. |     119          3      3         3   32296.23   6.658126   4850.649 |
300. |     119          4      3         3   221653.4   51.63623   4292.594 |
     |----------------------------------------------------------------------|
301. |     121          1      3         3   61614.82   17.37919   3545.321 |
302. |     121          2      3         3   78079.21   21.58798    3616.79 |
303. |     121          3      3         3   41384.03   11.40547   3628.437 |
304. |     121          4      3         3   81825.66   21.92575   3731.944 |
305. |     122          1      3         3   28791.55   37.52918   767.1777 |
     |----------------------------------------------------------------------|
306. |     122          2      3         3   48604.92   36.90298     1317.1 |
307. |     122          3      3         3   21646.17   17.71632    1221.82 |
308. |     122          4      3         3   49819.54   38.59588     1290.8 |
309. |     123          1      3         3   61097.02   230.4976   265.0657 |
310. |     123          2      3         3   71106.52   151.4003   469.6591 |
     |----------------------------------------------------------------------|
311. |     123          3      3         3   80803.46   154.5086   522.9707 |
312. |     123          4      3         3   112580.4   145.8001   772.1558 |
313. |     125          1      3         3   76201.09   953.9947    79.8758 |
314. |     125          2      3         3   62639.84   835.0872   75.00994 |
315. |     125          3      3         3   42123.24   668.2391   63.03619 |
     |----------------------------------------------------------------------|
316. |     125          4      3         3   118804.2   1414.863   83.96871 |
317. |     127          1      3         3   80425.78   53.22241   1511.126 |
318. |     127          2      3         3   95172.89   70.98695    1340.71 |
319. |     127          3      3         3   48514.16   40.49474   1198.036 |
320. |     127          4      3         3   107972.2   79.57282   1356.898 |
     |----------------------------------------------------------------------|
321. |     132          1      3         3   106583.1   333.3701   319.7141 |
322. |     132          2      3         3    8678.36   22.14551   391.8791 |
323. |     132          3      3         3   55587.12   213.6842   260.1367 |
324. |     132          4      3         3   20147.22   87.27507   230.8474 |
325. |     134          1      3         3   521.4305    1.50863   345.6317 |
     |----------------------------------------------------------------------|
326. |     134          2      3         3   18489.69   17.02182   1086.234 |
327. |     134          3      3         3    12989.5   19.90702   652.5085 |
328. |     134          4      3         3   5789.515   18.72122   309.2487 |
329. |     136          1      3         3   46928.55   41.06466   1142.797 |
330. |     136          2      3         3   53306.61   57.18856   932.1201 |
     |----------------------------------------------------------------------|
331. |     136          3      3         3   36047.22   37.85798   952.1699 |
332. |     136          4      3         3   82868.58   91.94495   901.2848 |
333. |     138          1      3         3   12729.29   40.34146   315.5386 |
334. |     138          2      3         3    22007.2   93.45449   235.4857 |
335. |     138          3      3         3   10873.57   34.76129   312.8067 |
     |----------------------------------------------------------------------|
336. |     138          4      3         3    19796.2   55.60547   356.0117 |
337. |     140          1      3         3   31312.03    31.4304   996.2341 |
338. |     140          2      3         3   38184.08   39.70475   961.7007 |
339. |     140          3      3         3   5227.928    10.0998   517.6271 |
340. |     140          4      3         3   1732.022   2.405766   719.9461 |
     |----------------------------------------------------------------------|
341. |     141          1      3         3   264260.8    132.772   1990.335 |
342. |     141          2      3         3   187887.8   93.02686   2019.716 |
343. |     141          3      3         3   149237.7   88.97171   1677.361 |
344. |     141          4      3         3   421410.7   174.3567   2416.945 |
345. |     144          1      3         3   17536.87   9.052221     1937.3 |
     |----------------------------------------------------------------------|
346. |     144          2      3         3   4957.116   3.971618   1248.135 |
347. |     144          3      3         3   750.4515   .7409956   1012.761 |
348. |     144          4      3         3   1887.388   1.440826   1309.934 |
349. |     147          1      3         3   89197.39   40.13151   2222.627 |
350. |     147          2      3         3   156060.5     67.254   2320.464 |
     |----------------------------------------------------------------------|
351. |     147          3      3         3   93330.04   39.59474   2357.132 |
352. |     147          4      3         3   146115.8   62.89139   2323.303 |
353. |     153          1      3         3   47141.96   60.43268    780.074 |
354. |     153          2      3         3   61570.09   94.82217   649.3217 |
355. |     153          3      3         3   63229.27   113.7496   555.8635 |
     |----------------------------------------------------------------------|
356. |     153          4      3         3   128803.3   242.6897   530.7327 |
357. |     157          1      3         3   13061.26         14    932.947 |
358. |     157          2      3         3   18216.06         17   1071.533 |
359. |     157          3      3         3   5546.982         10   554.6982 |
360. |     157          4      3         3   22815.81         41   556.4832 |
     |----------------------------------------------------------------------|
361. |     102          1      4         4   50574.38   177.0915   285.5833 |
362. |     102          2      4         4   211575.3   726.8001   291.1053 |
363. |     102          3      4         4   47463.22   139.0787   341.2687 |
364. |     102          4      4         4   22701.23   77.08021   294.5143 |
365. |     103          1      4         4   250440.7   811.6687   308.5504 |
     |----------------------------------------------------------------------|
366. |     103          2      4         4   324616.1   987.1757   328.8332 |
367. |     103          3      4         4   114424.4    358.283   319.3688 |
368. |     103          4      4         4   213537.1   683.4447   312.4424 |
369. |     104          1      4         4   510797.1   542.9748   940.7381 |
370. |     104          2      4         4   322768.2   364.4067   885.7363 |
     |----------------------------------------------------------------------|
371. |     104          3      4         4   111571.5   118.2316   943.6691 |
372. |     104          4      4         4     146018   167.9941   869.1851 |
373. |     105          1      4         4   289551.8   1475.235    196.275 |
374. |     105          2      4         4   369443.7   1452.304   254.3845 |
375. |     105          3      4         4   211792.1   952.0775   222.4526 |
     |----------------------------------------------------------------------|
376. |     105          4      4         4     243405   1003.434   242.5721 |
377. |     107          1      4         4   505085.7   5560.126    90.8407 |
378. |     107          2      4         4     400867   7075.632   56.65459 |
379. |     107          3      4         4   406837.5    4643.12    87.6216 |
380. |     107          4      4         4   101309.8   1387.103   73.03694 |
     |----------------------------------------------------------------------|
381. |     108          1      4         4   180265.2   651.9546   276.4996 |
382. |     108          2      4         4   133446.6   198.4393   672.4808 |
383. |     108          3      4         4   74018.83   142.8713   518.0803 |
384. |     108          4      4         4   43851.49    95.9052   457.2379 |
385. |     109          1      4         4   148350.3    1460.29   101.5896 |
     |----------------------------------------------------------------------|
386. |     109          2      4         4   105880.9   802.2593   131.9784 |
387. |     109          3      4         4   206227.1   1279.339   161.1982 |
388. |     109          4      4         4   33244.04   332.3325   100.0325 |
389. |     110          1      4         4   60723.95   28.05668   2164.331 |
390. |     110          2      4         4   78900.36   34.19142   2307.607 |
     |----------------------------------------------------------------------|
391. |     110          3      4         4   32496.47   17.69062   1836.932 |
392. |     110          4      4         4   23335.01   10.99167   2122.973 |
393. |     112          1      4         4   247033.4    426.781   578.8295 |
394. |     112          2      4         4   1720.131   2.951568   582.7856 |
395. |     112          3      4         4   89191.91   159.5971   558.8568 |
     |----------------------------------------------------------------------|
396. |     112          4      4         4   5393.006   19.11349   282.1571 |
397. |     113          1      4         4   247032.9   217.9405   1133.488 |
398. |     113          2      4         4   481742.5   407.7542   1181.453 |
399. |     113          3      4         4   300553.1   384.2893   782.1011 |
400. |     113          4      4         4   179695.2   210.9265   851.9329 |
     |----------------------------------------------------------------------|
401. |     114          1      4         4   65879.63   30.32915   2172.155 |
402. |     114          2      4         4   41914.19   19.93449   2102.596 |
403. |     114          3      4         4   6844.912   5.049122   1355.664 |
404. |     114          4      4         4   35195.41   26.22903   1341.849 |
405. |     115          1      4         4   119378.4   124.2133   961.0759 |
     |----------------------------------------------------------------------|
406. |     115          2      4         4   112994.6   90.00769   1255.389 |
407. |     115          3      4         4    28583.3   21.63304   1321.279 |
408. |     115          4      4         4   89048.72   104.0911   855.4886 |
409. |     116          1      4         4   6429.374    5.99793   1071.932 |
410. |     116          2      4         4   22554.48   24.61613   916.2479 |
     |----------------------------------------------------------------------|
411. |     116          3      4         4    6805.51    12.7653   533.1255 |
412. |     116          4      4         4    4571.43    5.77854   791.1048 |
413. |     117          1      4         4   234255.5   60.18694   3892.131 |
414. |     117          2      4         4   210976.1   56.27686   3748.896 |
415. |     117          3      4         4   49763.81   12.39388   4015.191 |
     |----------------------------------------------------------------------|
416. |     117          4      4         4   85618.86   22.50526   3804.393 |
417. |     119          1      4         4   132111.7   24.17783   5464.167 |
418. |     119          2      4         4   62900.37   12.63612   4977.822 |
419. |     119          3      4         4   17135.04   3.536517   4845.175 |
420. |     119          4      4         4    60467.7   13.06854   4626.967 |
     |----------------------------------------------------------------------|
421. |     121          1      4         4   41738.85    10.8535   3845.658 |
422. |     121          2      4         4   46482.51   12.03831   3861.215 |
423. |     121          3      4         4   24895.02   6.827045   3646.529 |
424. |     121          4      4         4    42317.1   11.00061   3846.797 |
425. |     122          1      4         4    26699.9   15.56788   1715.063 |
     |----------------------------------------------------------------------|
426. |     122          2      4         4    56613.3   73.75848   767.5496 |
427. |     122          3      4         4   20093.35    77.6041   258.9212 |
428. |     122          4      4         4    27498.7    25.4713   1079.595 |
429. |     123          1      4         4   38233.82   35.12215   1088.596 |
430. |     123          2      4         4   50912.63   198.6889   256.2429 |
     |----------------------------------------------------------------------|
431. |     123          3      4         4   12227.24   53.36464   229.1262 |
432. |     123          4      4         4   55207.01   226.1123   244.1574 |
433. |     125          1      4         4   130840.5   1798.963   72.73106 |
434. |     125          2      4         4     163777   1773.586   92.34233 |
435. |     125          3      4         4   58478.13   768.4346   76.10033 |
     |----------------------------------------------------------------------|
436. |     125          4      4         4   112844.5   1274.624   88.53163 |
437. |     127          1      4         4   29171.46   24.93191   1170.045 |
438. |     127          2      4         4   33290.21   20.63014   1613.668 |
439. |     127          3      4         4   20825.27   18.11654   1149.517 |
440. |     127          4      4         4   28236.01    16.7201   1688.747 |
     |----------------------------------------------------------------------|
441. |     132          1      4         4   129777.8   479.9669   270.3892 |
442. |     132          2      4         4   7054.213   29.07483   242.6227 |
443. |     132          3      4         4   27554.52   76.46606   360.3498 |
444. |     132          4      4         4   3228.541   6.953988   464.2719 |
445. |     134          1      4         4   39625.29   118.4858   334.4306 |
     |----------------------------------------------------------------------|
446. |     134          2      4         4   16294.92   44.08614   369.6154 |
447. |     134          3      4         4   14656.99   34.52512   424.5313 |
448. |     134          4      4         4   64578.79   223.1512   289.3947 |
449. |     136          1      4         4   85067.58   114.7494   741.3333 |
450. |     136          2      4         4   59887.71   87.32884   685.7725 |
     |----------------------------------------------------------------------|
451. |     136          3      4         4   21924.38   31.89978   687.2893 |
452. |     136          4      4         4   43128.63   53.89383   800.2518 |
453. |     138          1      4         4   36797.67   103.3901   355.9111 |
454. |     138          2      4         4   66269.23   217.6548   304.4694 |
455. |     138          3      4         4   15880.55   55.12859   288.0638 |
     |----------------------------------------------------------------------|
456. |     138          4      4         4   26687.62   93.42125   285.6697 |
457. |     140          1      4         4   239131.5    321.812   743.0782 |
458. |     140          2      4         4   102046.1   82.79775   1232.475 |
459. |     140          3      4         4   90682.35   102.8637    881.578 |
460. |     140          4      4         4   14782.63   16.84725   877.4501 |
     |----------------------------------------------------------------------|
461. |     141          1      4         4   282870.5   199.2808   1419.457 |
462. |     141          2      4         4   368970.1   238.9932   1543.852 |
463. |     141          3      4         4   147304.6   116.1563   1268.158 |
464. |     141          4      4         4   165064.2   112.4359   1468.074 |
465. |     144          1      4         4   45217.27   21.91822   2062.999 |
     |----------------------------------------------------------------------|
466. |     144          2      4         4   120485.3    59.5132   2024.514 |
467. |     144          3      4         4   49337.66   26.24553    1879.85 |
468. |     144          4      4         4    39266.8   19.33405   2030.966 |
469. |     147          1      4         4   115666.6   53.27449   2171.144 |
470. |     147          2      4         4   91657.35   39.83657   2300.834 |
     |----------------------------------------------------------------------|
471. |     147          3      4         4   32984.11    13.7591   2397.257 |
472. |     147          4      4         4   43775.56   18.40739   2378.151 |
473. |     153          1      4         4   40516.21    34.8496   1162.602 |
474. |     153          2      4         4   67954.04   53.72313   1264.893 |
475. |     153          3      4         4   34123.73   32.29235   1056.712 |
     |----------------------------------------------------------------------|
476. |     153          4      4         4    24482.3   21.57769   1134.612 |
477. |     157          1      4         4   43711.25         47   930.0266 |
478. |     157          2      4         4   61722.07         36   1714.502 |
479. |     157          3      4         4   6957.883         13   535.2217 |
480. |     157          4      4         4   17969.25         24   748.7187 |
     +----------------------------------------------------------------------+

.                         tempfile uvq2;

.                         keep reg_tpi product survquar ppkg_trim;

.                 save `uvq2', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp saved

.                                 use `uvq' ;

.                         merge reg_tpi product survquar using `uvq2';
(label REG_TPI already defined)
(label lsurvquar already defined)

.                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        480      100.00      100.00
------------+-----------------------------------
      Total |        480      100.00

.                         drop _merge;

.                 save `uvq', replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_unit_val_quarterly.d
> ta saved

.         restore;

. **************************************************************************;
. * Now calculate the weights for the temporal price index. The weights
> * will be based on the bottom 50% of the national nominal consumption
> * per capita (see below). We let the weights vary by strata (3 regions X rural/urba
> n).
> *
> * First, make a small file that has the total nominal HH daily consumption,
> * to use as our denominator. We cannot simply use the `bottom_tpi' file that
> * was created earlier because we will need some other variables from
> * the cons_cat.dta file.
> **************************************************************************;
. use "$path\work\conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta", clear ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path\work\hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         collapse (mean) cons_hh_nom hhsize strata hhweight rural news survquar reg_
> tpi,
>                 by(hhid);

.         lab var cons_hh_nom "Nominal daily HH consumption";

.         rename hhsize   cc_hhs;

.         rename strata   cc_reg;

.         rename hhweight cc_hhw;

.         rename rural    cc_rur;

.         rename news     cc_news;

.         rename survquar cc_qua;

.         rename reg_tpi  cc_reg_tpi;

.         sort hhid;

.         tempfile thhcons;

. save `thhcons', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000f.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000f.tmp saved

. **************************************************************************;
. * Merge the file with consumption on the food products with HH consumption file,
> * then use "fillin" to take care of cases where a household did not
> * consume all n_tpi commodities. Note that we need to do the merge
> * first because there are some households that are not in `acredd' at
> * all, because they did not consume *any* of the n_tpi items. Then replace
> * missing values in the "filled in" observations with the relevant values 
> * for that household.
> **************************************************************************;
. use `acredd';

.         cap drop _merge;

.         drop if product==.;
(151 observations deleted)

.         merge hhid using `thhcons';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        151        0.28        0.28
          3 |     54,510       99.72      100.00
------------+-----------------------------------
      Total |     54,661      100.00

.         for var valued_tot quantityd_tot : replace X=0 if _merge==2;

->  replace valued_tot=0 if _merge==2
(151 real changes made)

->  replace quantityd_tot=0 if _merge==2
(151 real changes made)

.                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_d
> d 
>                 valued_tot quantityd_tot : replace X=0 if _merge==2;
>                                 */
> 
>         replace hhsize  =cc_hhs     if _merge==2;
(151 real changes made)

.         replace strata  =cc_reg     if _merge==2;
(151 real changes made)

.         replace hhweight=cc_hhw     if _merge==2;
(151 real changes made)

.         replace rural   =cc_rur     if _merge==2;
(151 real changes made)

.         replace news    =cc_news        if _merge==2;
(151 real changes made)

.         replace survquar=cc_qua     if _merge==2;
(151 real changes made)

.         replace reg_tpi =cc_reg_tpi     if _merge==2;
(151 real changes made)

.         drop _merge cc_* ;

.                 fillin hhid product;

.         replace valued_tot=0 if _fillin;
(155364 real changes made)

.                 for var quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_
> nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;

->  egen tmp=mean(quantityd_tot), by(hhid)

->  replace quantityd_tot=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(strata), by(hhid)

->  replace strata=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(rural), by(hhid)

->  replace rural=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(hhweight), by(hhid)

->  replace hhweight=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(hhsize), by(hhid)

->  replace hhsize=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(survquar), by(hhid)

->  replace survquar=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(survmon), by(hhid)
(4681 missing values generated)

->  replace survmon=tmp if _fillin
(150834 real changes made)

->  drop tmp

->  egen tmp=mean(news), by(hhid)

->  replace news=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(reg_tpi), by(hhid)

->  replace reg_tpi=tmp if _fillin
(155364 real changes made)

->  drop tmp

->  egen tmp=mean(cons_hh_nom), by(hhid)

->  replace cons_hh_nom=tmp if _fillin
(155364 real changes made)

->  drop tmp

.                                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_d
> d 
>                 quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_
> nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;
>                                 */
> 
> **************************************************************************;
. * Now calculate the shares, and then the mean shares in each strata, 
> * using hhweight*hhsize weighting. 
> * Note that we are not doing quantity weighting now for the shares.
> **************************************************************************;
.         gen share = valued_tot/cons_hh_nom ;

.         gen popwt = hhsize*hhweight;

.         lab var share "HH share in total consumption";

.         lab var popwt "Population weight: hhsize*hhweight";

. **************************************************************************;
. * Select the bottom 50% (weighted) of the distribution of nominal per 
> * capita consumption.
> **************************************************************************;
.         gen cpc=cons_hh_nom/hhsize;

.         sum cpc [aw=hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%     341.2898       78.55931
 5%     695.3857       78.55931
10%     897.8539       78.55932       Obs              210025
25%     1376.486       78.55932       Sum of Wgt.   952113106

50%     2259.297                      Mean           10464.25
                        Largest       Std. Dev.      451461.1
75%     4217.707       8.12e+07
90%     9842.668       8.12e+07       Variance       2.04e+11
95%     19766.71       8.12e+07       Skewness       177.7597
99%     111655.2       8.12e+07       Kurtosis       31946.76

.         global medcpc=r(p$tpi_bottom);

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    210025    2.51e+09    1.13e+09   1.01e+09   4.19e+09
     product |    203250    123.1333    15.43319        102        157
  valued_tot |    210025    137.5085    444.6322          0      18500
quantityd_~t |    210025    1.195133    2.391138          0   364.2857
      strata |    210025    5.551734    2.873466          1         10
-------------+--------------------------------------------------------
      hhsize |    210025        4.96    2.758373          1         24
    hhweight |    210025    4533.332    4303.934         54      92511
    survquar |    210025    2.499336    1.143942          1          4
     survmon |    205344    6.715882    3.349725          1         12
       rural |    210025    .8199262    .3842498          0          1
-------------+--------------------------------------------------------
        news |    210025    2.416827    1.118309          1          4
    spdomain |     54510    3.160264    1.389057          1          5
     reg_tpi |    210025    2.416827    1.118309          1          4
 cons_hh_nom |    210025    97487.28     4938143   232.1918   4.06e+08
     _fillin |    210025    .7397405    .4387772          0          1
-------------+--------------------------------------------------------
       share |    210025    .0105519    .0345066          0   .7896302
       popwt |    210025    29614.26    44552.33         62     832599
         cpc |    210025    20773.97    987325.8   78.55931   8.12e+07

.  codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                   Household Code
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/210025

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         keep if cpc<=$medcpc;
(0 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |    210025    2.51e+09    1.13e+09   1.01e+09   4.19e+09
     product |    203250    123.1333    15.43319        102        157
  valued_tot |    210025    137.5085    444.6322          0      18500
quantityd_~t |    210025    1.195133    2.391138          0   364.2857
      strata |    210025    5.551734    2.873466          1         10
-------------+--------------------------------------------------------
      hhsize |    210025        4.96    2.758373          1         24
    hhweight |    210025    4533.332    4303.934         54      92511
    survquar |    210025    2.499336    1.143942          1          4
     survmon |    205344    6.715882    3.349725          1         12
       rural |    210025    .8199262    .3842498          0          1
-------------+--------------------------------------------------------
        news |    210025    2.416827    1.118309          1          4
    spdomain |     54510    3.160264    1.389057          1          5
     reg_tpi |    210025    2.416827    1.118309          1          4
 cons_hh_nom |    210025    97487.28     4938143   232.1918   4.06e+08
     _fillin |    210025    .7397405    .4387772          0          1
-------------+--------------------------------------------------------
       share |    210025    .0105519    .0345066          0   .7896302
       popwt |    210025    29614.26    44552.33         62     832599
         cpc |    210025    20773.97    987325.8   78.55931   8.12e+07

.                 collapse (mean) share (median) medshare=share [aw=popwt] , 
>                         by(reg_tpi product);

.                 egen sumsh=sum(share) , by(reg_tpi);

.                 replace share=share/sumsh;
(120 real changes made)

.                 drop sumsh;

.                 egen sumsh=sum(medshare) , by(reg_tpi);

.                 replace medshare=medshare/sumsh;
(24 real changes made)

.                 drop sumsh;

.                 lab var share "Reg 6: Mean HH share of total consumption";

.                 lab var medshare "Reg 6: Median HH share of total consumption";

.                 sort reg_tpi product;

.                 save "$path/work/tpi_reg_tpi_share.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/tpi_reg_tpi_share.dta sa
> ved

.                 tempfile tempwt6;

.                 save `tempwt6', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp saved

. use `uvq', clear;

.         sort reg_tpi product;

. save , replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

. use `tempwt6';

.         merge reg_tpi product using `uvq';
variables reg_tpi product do not uniquely identify observations in
    C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        0.83        0.83
          3 |        480       99.17      100.00
------------+-----------------------------------
      Total |        484      100.00

.         gen tpi1     =ppkg     *share;
(4 missing values generated)

.         gen tpi1_trim=ppkg_trim*share;
(4 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       480    123.1333    15.44925        102        157
     reg_tpi |       484         2.5    1.119191          1          4
       share |       484    .0330579    .0329701          0    .149083
    medshare |       484    .0330579    .0963407          0   .6723011
    survquar |       480         2.5      1.1192          1          4
-------------+--------------------------------------------------------
        news |       480         2.5      1.1192          1          4
  valued_tot |       480    68913.42    68735.64   421.7399   422095.6
quantityd_~t |       480    154.0182     307.653   .6235518   3353.071
        ppkg |       480    1303.353    1255.964   63.26157    6280.27
   ppkg_trim |       480    1210.636    1234.154   56.65459   6596.031
-------------+--------------------------------------------------------
      _merge |       484    2.983471    .1812526          1          3
        tpi1 |       480    39.16437     50.1109   .1747039    264.609
   tpi1_trim |       480    37.30183    49.97745   .1012088   299.6517

. keep if survquar!=.;
(4 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       480    123.1333    15.44925        102        157
     reg_tpi |       480         2.5      1.1192          1          4
       share |       480    .0333333    .0329682   .0007248    .149083
    medshare |       480    .0333333    .0966945          0   .6723011
    survquar |       480         2.5      1.1192          1          4
-------------+--------------------------------------------------------
        news |       480         2.5      1.1192          1          4
  valued_tot |       480    68913.42    68735.64   421.7399   422095.6
quantityd_~t |       480    154.0182     307.653   .6235518   3353.071
        ppkg |       480    1303.353    1255.964   63.26157    6280.27
   ppkg_trim |       480    1210.636    1234.154   56.65459   6596.031
-------------+--------------------------------------------------------
      _merge |       480           3           0          3          3
        tpi1 |       480    39.16437     50.1109   .1747039    264.609
   tpi1_trim |       480    37.30183    49.97745   .1012088   299.6517

. list in  1/3;

     +------------------------------------------------------------------------+
  1. | product | reg_tpi |    share | medshare |   survquar | news | valued~t |
     |     102 | central | .0206776 |        0 | May-Jul 09 |    1 | 87863.27 |
     |------------------------------------------------------------------------|
     | quanti~t  |     ppkg  | ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     |  265.855  | 330.4932  | 327.3867  |       3  |  6.833801  |  6.769566  |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  2. | product | reg_tpi |    share | medshare |   survquar | news | valued~t |
     |     103 | central | .0480068 |        0 | May-Jul 09 |    1 | 130912.3 |
     |------------------------------------------------------------------------|
     | quanti~t  |     ppkg  | ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     | 425.6857  | 307.5327  | 305.1313  |       3  |  14.76367  |  14.64839  |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  3. | product | reg_tpi |    share | medshare |   survquar | news | valued~t |
     |     104 | central | .0524175 |        0 | May-Jul 09 |    1 | 163908.7 |
     |------------------------------------------------------------------------|
     | quanti~t  |     ppkg  | ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     | 266.3135  | 615.4728  | 586.9709  |       3  |  32.26154  |  30.76754  |
     +------------------------------------------------------------------------+

. list in -3/-1;

     +-------------------------------------------------------------------------+
478. | product | reg_tpi |    share | medshare |    survquar | news | valued~t |
     |     157 | western | .0178493 |        0 | Sept-Oct 09 |    4 | 78939.99 |
     |-------------------------------------------------------------------------|
     | quanti~t  |     ppkg  |  ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     |       41  | 1925.366  |  1714.502  |       3  |  34.36645  |  30.60268  |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
479. | product | reg_tpi |    share | medshare |    survquar | news | valued~t |
     |     157 | western | .0178493 |        0 | Nov09-Jan10 |    4 | 7215.774 |
     |-------------------------------------------------------------------------|
     | quanti~t  |     ppkg  |  ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     |       14  | 515.4124  |  535.2217  |       3  |  9.199757  |  9.553339  |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
480. | product | reg_tpi |    share | medshare |    survquar | news | valued~t |
     |     157 | western | .0178493 |        0 |  Feb-Apr 10 |    4 |  75578.8 |
     |-------------------------------------------------------------------------|
     | quanti~t  |     ppkg  |  ppkg_t~m  |  _merge  |      tpi1  |  tpi1_t~m  |
     |       25  | 3023.152  |  748.7187  |       3  |  53.96118  |  13.36411  |
     +-------------------------------------------------------------------------+

.         **************************************************************************;
. * Find TPI level and indexes for non-trimmed and trimmed prices
> **************************************************************************;
. * Not trimmed ;
.         collapse (sum) tpi1 tpi1_trim  , by(reg_tpi survquar);

.                 for num 1/$n_tpi :
>                         sum tpi1 if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1 if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1 if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1 if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1 if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1 if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

.                 lab var tpi1 "Temporal price index before normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi=tpi1/${base`v'} if reg_t
> pi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi=tpi1/${base`v'} if r
> eg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(12 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)

.                                                                                    
>              *gen     tpi=tpi1/$base1 if reg_tpi==1;
.                 *replace tpi=tpi1/$base2 if reg_tpi==2;
.                 *replace tpi=tpi1/$base3 if reg_tpi==3;
.                 *replace tpi=tpi1/$base4 if reg_tpi==4;
.                 *replace tpi=tpi1/$base5 if reg_tpi==5;
.                 *replace tpi=tpi1/$base6 if reg_tpi==6;
.                                                                                 lab
>  var tpi "Temporal price index (Q4=1)";

. * Trimmed ;
.                 for num 1/$n_tpi :
>                         sum tpi1_trim if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1_trim if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1_trim if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1_trim if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1_trim if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1_trim if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

.                 lab var tpi1_trim "Six regions: TRIMMED Temporal price index before
>  normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi_trim=tpi1_trim/${base`v'
> } if reg_tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi_trim=tpi1_trim/${bas
> e`v'} if reg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(12 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)

.                                                 lab var tpi_trim "TRIMMED Temporal 
> price index (Q4=1)";

.                 sort reg_tpi survquar;

.             drop if reg_tpi<1 | reg_tpi>$n_tpi;
(0 observations deleted)

. gen tpi_diff = tpi - tpi_trim;

. lab var tpi_diff "TPI difference btw trimmed/untrimmed";

. twoway (connected tpi_trim survquar),yline(1) by(, title("TPI: Trimmed"))
> by(reg_tpi) sav("$path/work/reg_tpi-tpi_trim", replace);
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/reg_tpi-tpi_trim.gph sa
> ved)

. graph export "$path/work/reg_tpi-tpi_trim.tif", replace;
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/reg_tpi-tpi_trim.tif wr
> itten in TIFF format)

. list reg_tpi survquar tpi tpi_trim tpi_diff;

     +----------------------------------------------------------+
     |  reg_tpi      survquar        tpi   tpi_trim    tpi_diff |
     |----------------------------------------------------------|
  1. |  central    May-Jul 09   .9860798   .9697402    .0163396 |
  2. |  central   Sept-Oct 09   .9903705   1.010449   -.0200787 |
  3. |  central   Nov09-Jan10   1.024968    1.00246    .0225078 |
  4. |  central    Feb-Apr 10          1          1           0 |
  5. |  eastern    May-Jul 09   .9697458   1.006519   -.0367731 |
     |----------------------------------------------------------|
  6. |  eastern   Sept-Oct 09   .9794639   1.013825   -.0343608 |
  7. |  eastern   Nov09-Jan10   1.004262   1.047603    -.043341 |
  8. |  eastern    Feb-Apr 10          1          1           0 |
  9. | northern    May-Jul 09      .9855   1.054369   -.0688694 |
 10. | northern   Sept-Oct 09   1.046155   .9905532     .055602 |
     |----------------------------------------------------------|
 11. | northern   Nov09-Jan10   1.001909   .9743311    .0275775 |
 12. | northern    Feb-Apr 10          1          1           0 |
 13. |  western    May-Jul 09   .9418652   1.051592    -.109727 |
 14. |  western   Sept-Oct 09   1.048123   1.104535   -.0564119 |
 15. |  western   Nov09-Jan10   .9263657   .9857301   -.0593644 |
     |----------------------------------------------------------|
 16. |  western    Feb-Apr 10          1          1           0 |
     +----------------------------------------------------------+

.                 sort reg_tpi survquar;

. keep reg_tpi survquar tpi_trim;

. save "$path/work/temp_index_reg_tpi.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/temp_index_reg_tpi.dta s
> aved

.                        ************************************************************
> **************
> * 090_temp_index.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 do "$path/new/100_food_basket_flex.do"  /* Flexible
>  food basket */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/100_food_basket_flex.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/100_food_basket_f
> lex.log
  log type:  text
 opened on:  20 May 2013, 17:27:56

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 100_food_basket_flex.do     (start)
> *
> * This file is to get the data from the cons_cod.dta in work and then 
> * to create the do file with the 90% of the consumption expenditures 
> * using a flexible basket of goods.
> *
> * NOTE: we actually keep goods representing 95% of expenditure
> * in order to facilitate dropping of some goods (such as rats) where
> * quantity and nutrition information is unknown.
> *
> * We base our basket on the bottom 60 percent of consumption per capita
> * (weighted by hhweight*hhsize). We use the TEMPORALLY-ADJUSTED
> * NOMINAL consumption because we don't have a spatial adjustment yet.
> *
> * (Then we iterate this process to arrive at a final food bundle in later code)
> **************************************************************************;
. *CA modified to bring in hhdata into bootstrap;
. /*
> This file uses:
>                 work\cons_cod.dta
>                 work\hhdata.dta
>                 work\products.dta
>                 work/consump_nom.dta
>                 work/temp_index_reg_tpi.dta
>                 work/food_cat.dta
> 
> This file creates:
>                 work\food_basket_flex.dta
>                 work\codes_food_basket_flex.dta
> */
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************;
. * First, make a small temp file that has the temporally adjusted 
> * nominal consumption per capita, using work/consump_nom and 
> * work/temp_index_reg_tpi.dta. Make a dummy variable indicating
> * whether they are in the bottom 60%.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.         sort hhid;

.         merge hhid using "$path/work\hhdata.dta";

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _m;

.         keep hhid hhweight hhsize cons_pc_nom reg_tpi rural survquar;

.         sort reg_tpi survquar;

.         cap drop _merge;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.                 gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

.         save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

.         collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight] ;

.         rename cons_pc_tpi pctile_60;

.         tempfile 60pct;

.         sort one;

.         save `60pct', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

.                 use `contpi';

.                 sort one;

.                 merge one using `60pct';
variable one does not uniquely identify observations in the master data

.                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 drop _merge;

.                 drop one;

.                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                 tab bottom_basket [aw=hhsize*hhweight];

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 4,746.5914       70.06       70.06
          1 | 2,028.4086       29.94      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                 lab var bottom_basket "=1 if in bottom 60% of PCE";

.                                 sort hhid;

. save `contpi' , replace;
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. **************************************************************************;
. * Next, need to keep only the food products in order to calculate the 
> * food poverty line, and then calculate the food expenses by code.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. /*
>         sort product;
>         merge product using "$path/work/food_cat.dta";
>         tab _merge;
>         keep if _merge==3;
>         drop _merge;
> */
>         
>         keep if food_cat;
(0 observations deleted)

.         codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                   Household Code
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/412045

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         sort hhid;

. **************************************************************************;
. * Next, merge in the consumption information, and select those in bottom
> * 60% of nominal distribution, after making temporal adjustment. 
> **************************************************************************;
.         merge hhid using `contpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00

.         keep if _merge==3;
(0 observations deleted)

.         drop _merge;

.         keep if bottom_basket==1;
(308401 observations deleted)

.      **************************************************************************;
. * Calculate food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.           gen  food_expenditure= cod_hh_nom3;
(84474 missing values generated)

.                             *gen  food_expenditure= own_valued + daily_valued + mon
> thly_valued + educ_valued;
.           egen tot_food_expen= sum (food_expen), by (hhid) ;

.           count if food_expenditure==.;
84474

.           count if tot_food_expen==.;
    0

.                     gen food_share= food_expenditure/tot_food_expen;
(84561 missing values generated)

.           count if food_share==.;
84561

.           drop if food_share==.;
(84561 observations deleted)

.           sort hhid product;

.                         tempfile food_basket_flex;

. save `food_basket_flex', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

. ********************************************************************************;
. * Now prepare to get the variable spdomain to the using dataset, and then find the 
> * total shares by each product in order to select the most important goods in the 
> * basket.
> ********************************************************************************;
.                 preserve;

.                 use "$path/work/hhdata.dta", clear;

.                         keep hhid spdomain;

.                         sort hhid;

.                         tempfile spdomain;

.                 save `spdomain' , replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

.                 restore;

.                            collapse (mean) hhweight, by (hhid);

.            sort hhid ;

.             merge hhid using `spdomain';

.            tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      4,868       71.85       71.85
          3 |      1,907       28.15      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.            drop if _m==2;
(4868 observations deleted)

.            drop _merge;

.             collapse (sum) hhweight , by(spdomain);

.            rename hhweight tothhweight;

.            tempfile tothhweight;

. save `tothhweight';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

. use `food_basket_flex';

.           sort hhid;

.           merge hhid using `spdomain';
variable hhid does not uniquely identify observations in the master data

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      4,868       20.32       20.32
          3 |     19,083       79.68      100.00
------------+-----------------------------------
      Total |     23,951      100.00

.           sort _m;

.           drop if _m==2;
(4868 observations deleted)

.           drop _m;

.           sort spdomain;

.             merge spdomain using `tothhweight';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     19,083      100.00      100.00
------------+-----------------------------------
      Total |     19,083      100.00

.           drop _merge;

.             sort spdomain product;

.             gen f_share_w=(food_share*hhweight)/tothhweight;

.                                                 *drop descript;
.                         *gen descript = 0;
.             collapse (sum) f_share_w, by(spdomain product descript);

.                      sort spdomain f_share_w;

.           by spdomain: gen cumshr= sum(f_share_w);

.                     count if cumshr<=.075;
  142

.           drop if cumshr<=.075;
(142 observations deleted)

.             lab var f_share_w "average food share for the 13 regions";

. save "$path\work\food_basket_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\food_basket_flex.dta sav
> ed

. * List first spatial region to get an idea about contents;
. list product spdomain f_share_w cumshr if spdomain==1;

     +-----------------------------------------------+
     | product        spdomain   f_shar~w     cumshr |
     |-----------------------------------------------|
  1. |     132   Central rural   .0064902   .0767658 |
  2. |     157   Central rural   .0070342      .0838 |
  3. |     137   Central rural   .0070677   .0908678 |
  4. |     118   Central rural   .0075093   .0983771 |
  5. |     139   Central rural    .007917    .106294 |
     |-----------------------------------------------|
  6. |     153   Central rural   .0085809    .114875 |
  7. |     102   Central rural   .0087598   .1236347 |
  8. |     122   Central rural   .0098372   .1334719 |
  9. |     135   Central rural   .0104738   .1439457 |
 10. |     117   Central rural   .0119606   .1559063 |
     |-----------------------------------------------|
 11. |     150   Central rural   .0137989   .1697052 |
 12. |     125   Central rural   .0139139   .1836191 |
 13. |     123   Central rural   .0141114   .1977305 |
 14. |     134   Central rural   .0155849   .2133154 |
 15. |     127   Central rural   .0169561   .2302715 |
     |-----------------------------------------------|
 16. |     144   Central rural   .0182187   .2484902 |
 17. |     136   Central rural   .0223372   .2708274 |
 18. |     140   Central rural    .025018   .2958453 |
 19. |     108   Central rural   .0275436   .3233889 |
 20. |     112   Central rural   .0288198   .3522087 |
     |-----------------------------------------------|
 21. |     147   Central rural   .0372514   .3894601 |
 22. |     138   Central rural    .037537   .4269971 |
 23. |     103   Central rural   .0500118    .477009 |
 24. |     141   Central rural   .0610395   .5380485 |
 25. |     104   Central rural   .0611586   .5992071 |
     |-----------------------------------------------|
 26. |     107   Central rural   .0639378   .6631449 |
 27. |     113   Central rural   .1620319   .8251768 |
 28. |     105   Central rural   .1748232          1 |
     +-----------------------------------------------+

.                     gen numreg=1;

.           collapse (sum) numreg cumshr, by (product descript);

.                           keep product descript numreg;

.           display _N;
42

.                     lab var numreg "number of goods in the basket";

. /*
>           merge product using "$path\work\products.dta";
>             tab _merge;
>           keep if _merge==3;
> */
>           keep product descript numreg;

.             sort product;

.                display _N;
42

.   save "$path/work\codes_food_basket_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work\codes_food_basket_flex.d
> ta saved

. **************************************************************************
> * 100_food_basket_flex.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 do "$path/new/110_price_unit_flex.do"   /* Flexible
>  basket: Prices */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path\rep\110_price_unit_flex.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\rep\110_price_unit_fl
> ex.log
  log type:  text
 opened on:  20 May 2013, 17:27:57

. clear

. set more off

. #delimit ;
delimiter now ;
. ***********************************************************************************
> *****
> * 110_price_unit_flex.do                (start)
> *
> * Purpose: This do file creates a price_unit_flex database with the unit prices of 
> the
> * goods of the flexible food basket in order to determine the poverty lines per spa
> tial
> * domain. It uses the files work\daily.dta and work\own.dta file and draw unit pric
> es
> * by: sum of values and quantity
> ***********************************************************************************
> *****;
. *CA modified to bring in work\hhdata.dta for bootstrap
> *CA check for price calcs conditional on number of observations;
. /*
> This file uses:
>         work\daily.dta
>         work\own.dta
>         work\hhdata.dta
>         work\consump_nom.dta
>         work\codes_food_basket_flex.dta
>         work\temp_index_reg_tpi.dta
>           new\conversions.do
> 
> This file creates:
>         work\price_unit_flex.dta
>         work\bottom_basket.dta
> */
> 
> 
> 
> 
> *do "$path/new/010_initial.do";
. ***********************************************************************************
> ***
> * Create sorted data set with daily and own and the matched codes
> ***********************************************************************************
> ***;
. use "$path/work/cons_cod_trans.dta", clear;

. *use "$path/in/cons_cod_trans.dta", clear;
. *save "$path/work/cons_cod_trans.dta", replace;
. *drop if quantityd==0 ;
. keep hhid product food_cat valuez quantityz unit;

. rename valuez    value;

. rename quantityz quantity;

. drop if quantity==0 ;
(4392 observations deleted)

. *drop count;
.         sort product;

.         gen count=1;

.                 tempfile dd_acsort;

. save `dd_acsort', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. /*
> use "$path\work\daily.dta";
> tempfile dd_acsort;
>         drop days;
>         sort product;
>         tempfile dd_acsort;
> save `dd_acsort', replace;
> 
> use "$path\work\own.dta";
>         keep hhid product valued quantityd unit;
>         rename valued value;
>         rename quantityd quantity;
> 
>         *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>         drop if quantity==0;
> 
>         append using `dd_acsort';
> 
> *CA modified to merge in work\hhdata.dta for bootstrap;
>         sort hhid;
>       merge hhid using "$path\work\hhdata.dta";
>       tab _m;
> 
> * Drop observations if non existent in HH data set;
> drop if _m!=3;
> drop _m;
> 
> 
>         sort product;
>         gen count=1;
> 
> 
> save `dd_acsort', replace;
> */
> 
> 
> ***********************************************************************************
> ***;
. * Merge the flexible food basket codes with the daily and own data sets
> * Drop all codes not a part of the flexible food basket
> ***********************************************************************************
> ***;
.         merge product using "$path\work\codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     13,346       15.66       15.66
          3 |     71,858       84.34      100.00
------------+-----------------------------------
      Total |     85,204      100.00

.         drop if _merge~=3;
(13346 observations deleted)

.         drop _merge;

. ***********************************************************************************
> ***;
. * Drop observations where product code or quantity or value information is unavaila
> ble
> ***********************************************************************************
> ***;
.                                 codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     household id
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6747                     missing .:  0/71858

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. *        drop if product==. | value==. | quantity==.  ;
.                                 codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     household id
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6747                     missing .:  0/71858

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. ***********************************************************************************
> ***;
. * Convert non-KG quantities (units and liters) to kilograms;
. ***********************************************************************************
> ***;
. *do "$path\new\110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped
> ********************************************************************;
. *        drop if unit~=2;
. ********************************************************************
> * Merge in labels for the 13 spatial domains
> ********************************************************************;
.         preserve;

.                 use "$path/work/hhdata.dta", clear;

.                                                                         keep hhid s
> pdomain reg_tpi survquar;

.                         sort hhid;

.                         tempfile spdomainreg_tpi;

.                 save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

.                                 codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     Household ID
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6775                     missing .:  0/6775

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

.         restore;

.                 sort hhid;

.         merge hhid using `spdomainreg_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         28        0.04        0.04
          3 |     71,858       99.96      100.00
------------+-----------------------------------
      Total |     71,886      100.00

.         drop _merge;

.         drop if product==.;
(28 observations deleted)

. codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     household id
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6747                     missing .:  0/71858

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. tab spd;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |     12,483       17.37       17.37
Central urban |      9,125       12.70       30.07
      Eastern |     16,311       22.70       52.77
     Northern |     19,026       26.48       79.25
      Western |     14,913       20.75      100.00
--------------+-----------------------------------
        Total |     71,858      100.00

. sum if spd>=3;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     50250    3.07e+09    7.86e+08   2.01e+09   4.19e+09
     product |     50250    130.2235    15.80087        102        161
        unit |     50250           1           0          1          1
    food_cat |     50250           1           0          1          1
    quantity |     50250    .9732545    3.934012   .0000286   364.2857
-------------+--------------------------------------------------------
       value |     50250    412.0003    637.8504          0      18500
       count |     50250           1           0          1          1
    descript |     50250           1           0          1          1
      numreg |     50250    4.145254     1.29297          1          5
    survquar |     50250    2.476876    1.137676          1          4
-------------+--------------------------------------------------------
    spdomain |     50250    3.972179     .787789          3          5
     reg_tpi |     50250    2.972179     .787789          2          4

. table spdomain, content(mean quantity count quantity count hhid) row missing;

--------------------------------------------------------------
     spdomain | mean(quantity)     N(quantity)         N(hhid)
--------------+-----------------------------------------------
Central rural |       1.002078          12,483          12,483
Central urban |       .6193954           9,125           9,125
      Eastern |       .9685605          16,311          16,311
     Northern |       .8221988          19,026          19,026
      Western |       1.171105          14,913          14,913
              | 
        Total |       .9333262          71,858          71,858
--------------------------------------------------------------

.         drop if product==. | value==. | quantity==.  ;
(0 observations deleted)

. codebook hhid;

-------------------------------------------------------------------------------------
hhid                                                                     household id
-------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.193e+09]        units:  1
         unique values:  6747                     missing .:  0/71858

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+09   1.1e+09   2.2e+09   3.2e+09   4.1e+09

. tab spd;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |     12,483       17.37       17.37
Central urban |      9,125       12.70       30.07
      Eastern |     16,311       22.70       52.77
     Northern |     19,026       26.48       79.25
      Western |     14,913       20.75      100.00
--------------+-----------------------------------
        Total |     71,858      100.00

. ********************************************************************
> * Merge in temporal price index to convert nominal value to real
> ********************************************************************;
.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path\work\temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     71,858      100.00      100.00
------------+-----------------------------------
      Total |     71,858      100.00

.         drop if _merge ~= 3;
(0 observations deleted)

.         drop _merge;

.         gen value_r=value/tpi_trim;

. **************************************************************************;
. * Identify relatively poor households, based on nominal temporally adjusted
> * consumption per capita. Only work with these households for the price
> * calculations.
> **************************************************************************;
.                 preserve;

.                         use "$path/work/conpc.dta", clear;

. *                       use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.         sort hhid;

.       merge hhid using "$path\work\hhdata.dta";

.       tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.       drop _m;

. *CA modified to keep bswt;
.                                 keep hhid hhweight hhsize cons_pc_nom bswt ;

.                                 sort hhid;

.                                 merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 sort reg_tpi survquar;

.                                 cap drop _merge;

.                                 merge reg_tpi survquar using "$path/work/temp_index
> _reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 sort hhid;

.                                 merge hhid using "$path/work/conpc.dta";

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                 drop _merge;

.                                 gen food_pc_tpi  = food_pc_nom /tpi_trim;

.                                 lab var food_pc_tpi "Temp-adjusted per capita food 
> consumption/day";

.                                                                 * Non-food not TPI 
> adjusted ;
.                                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.                                 lab var cons_pc_tpi "Temp adjusted total consumptio
> n/day";

.                                 gen one=1;

.                                 tempfile contpi;

.                                 save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

.                                 collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhwe
> ight], by(spdomain) ;

.                                 rename cons_pc_tpi pctile_60;

.                                 tempfile 60pct;

.                                 sort spdomain;

.                                 save `60pct', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

.                                 use `contpi';

.                                         sort spdomain;

.                                         merge spdomain using `60pct';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.                                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.                                         drop _merge;

.                                         drop one;

.                                         sort spdomain;

.                                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                                         by spdomain: tab bottom_basket [aw=hhsize*h
> hweight];

-------------------------------------------------------------------------------------
-> spdomain = Central rural

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 824.146173       70.02       70.02
          1 | 352.853827       29.98      100.00
------------+-----------------------------------
      Total |      1,177      100.00

-------------------------------------------------------------------------------------
-> spdomain = Central urban

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 571.975583       70.70       70.70
          1 | 237.024417       29.30      100.00
------------+-----------------------------------
      Total |        809      100.00

-------------------------------------------------------------------------------------
-> spdomain = Eastern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 984.333338       70.01       70.01
          1 | 421.666662       29.99      100.00
------------+-----------------------------------
      Total |      1,406      100.00

-------------------------------------------------------------------------------------
-> spdomain = Northern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,374.0502       70.25       70.25
          1 |581.9498358       29.75      100.00
------------+-----------------------------------
      Total |      1,956      100.00

-------------------------------------------------------------------------------------
-> spdomain = Western

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 999.376658       70.03       70.03
          1 | 427.623342       29.97      100.00
------------+-----------------------------------
      Total |      1,427      100.00


.                                         lab var bottom_basket "=1 if in bottom (60%
> ) of PCE";

.                                         sort hhid;

.                                                                 save "$path\work\bo
> ttom_basket.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\bottom_basket.dta saved

.         restore;

.         sort hhid;

.         merge hhid using "$path\work\bottom_basket.dta";
variable hhid does not uniquely identify observations in the master data
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         28        0.04        0.04
          3 |     71,858       99.96      100.00
------------+-----------------------------------
      Total |     71,886      100.00

.         drop _merge;

.                         * Only keep price observations for the poor ;
.         keep if bottom_basket==1;
(56078 observations deleted)

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * for each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
(11 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(spdomain product);
(11 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
(11 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     15808    2.44e+09    1.16e+09   1.01e+09   4.19e+09
     product |     15797     131.282    16.29429        102        161
        unit |     15797           1           0          1          1
    food_cat |     15797           1           0          1          1
    quantity |     15797    .7918439    2.808665   .0000429      227.4
-------------+--------------------------------------------------------
       value |     15797     318.314    466.8461          0   8142.857
       count |     15797           1           0          1          1
    descript |     15797           1           0          1          1
      numreg |     15797      4.1606    1.291605          1          5
    survquar |     15808    2.515245    1.166049          1          4
-------------+--------------------------------------------------------
    spdomain |     15808    3.176493    1.388198          1          5
     reg_tpi |     15808     2.34957    1.147509          1          4
    tpi_trim |     15808    1.011738    .0335031   .9697402   1.104535
     value_r |     15797    314.5889    461.9914          0   8396.947
 cons_pc_nom |     15808    1349.439    889.0935   78.55931   4458.971
-------------+--------------------------------------------------------
      hhsize |     15808    5.708312    2.464065          1         18
    hhweight |     15808    5048.886    4387.586        100      60164
        bswt |     15808           1           0          1          1
 cons_hh_nom |     15808    7088.738    4779.984   232.1918   41911.81
 food_pc_nom |     15808    625.8655    396.4417          0   2984.524
-------------+--------------------------------------------------------
   nf_pc_nom |     15808    723.5738    614.4834   23.11263   3772.785
 food_pc_tpi |     15808    620.1381    397.9693          0   2984.524
 cons_pc_tpi |     15808    1343.712    892.3857   77.25769   4451.227
   pctile_60 |     15808     1928.82    1161.451   955.8005   4459.897
bottom_bas~t |     15808           1           0          1          1
-------------+--------------------------------------------------------
      hhppkg |     15797    1540.222    9693.066          0     954560
      lower5 |     15797    527.5151    546.1183          0   5937.953
      upper5 |     15797    2539.572    2208.674   78.94963   13389.88

. describe;

Contains data from C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp
  obs:        15,808                          
 vars:            28                          20 May 2013 17:27
 size:     2,023,424                          
-------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
-------------------------------------------------------------------------------------
hhid            double %9.0g                  household id
product         float  %10.0g      HS10A2     Food product code: numerical
unit            float  %10.0g                 set equal to one since all observations
                                                are converted into kg
food_cat        float  %9.0g                  food category equals 1, if product is
                                                food and 0 if non food
quantity        float  %9.0g                  daily quantity consumed in Kgs per
                                                household
value           float  %9.0g                  daily value of consumption in UGX per
                                                per household
count           float  %9.0g                  
descript        float  %9.0g       descrip    product description including product
                                                code but equals 2 for all non-foods
numreg          double %9.0g                  number of goods in the basket
survquar        float  %11.0g      lsurvquar
                                              Sequential Survey Quarter May-Jun 09=1)
spdomain        float  %13.0g      spdomain_original
                                              
reg_tpi         float  %9.0g       REG_TPI    
tpi_trim        float  %9.0g                  TRIMMED Temporal price index (Q4=1)
value_r         float  %9.0g                  
cons_pc_nom     float  %9.0g                  
hhsize          double %9.0g                  Household Size
hhweight        float  %9.0g                  Household sample weight
bswt            float  %9.0g                  
cons_hh_nom     double %9.0g                  (sum) cod_hh_nom
food_pc_nom     float  %9.0g                  nominal food consumption per capita
nf_pc_nom       float  %9.0g                  nominal non-food consumption per capita
food_pc_tpi     float  %9.0g                  Temp-adjusted per capita food
                                                consumption/day
cons_pc_tpi     float  %9.0g                  Temp adjusted total consumption/day
pctile_60       float  %9.0g                  (p 30) cons_pc_tpi
bottom_basket   float  %9.0g                  =1 if in bottom (60%) of PCE
hhppkg          float  %9.0g                  
lower5          float  %9.0g                  
upper5          float  %9.0g                  
-------------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

. keep if hhppkg-lower5>=0 & hhppkg-upper5<=0;
(1158 observations deleted)

. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_unitw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_unitt. Last we take the median, price_unitm. But in the end
> * we only use price_unitw
> *********************************************************************;
.         gen price_unitt=value_r/(quantity*1000);

.         gen price_unitm=price_unitt;

.                 *CA modified to count the boot sample weight bswt;
.         collapse (sum) quantity value_r count bswt 
>                  (mean) price_unitt 
>                  (median) price_unitm [aw=hhweight], by(spdomain product);

.         *Generate weighted price per gram ;
.         gen price_unitw=value_r/(quantity*1000);

.         drop value_r quantity;

.         sort spdomain product;

.         lab var price_unitt "simple average of calculated prices - transaction weig
> hted";

.         lab var price_unitm "median of prices";

.         lab var price_unitw "value share weighted mean prices";

. * Get an idea of the difference between the price measures;
.         gen ratiotw=price_unitt/price_unitw;

.         gen ratiomw=price_unitm/price_unitw;

.         sum ratiotw ratiomw;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     ratiotw |       208    1.242962    .4481808    .870327   3.773801
     ratiomw |       208    1.097269    .5201629          0   4.852879

.         sort product;

.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        208      100.00      100.00
------------+-----------------------------------
      Total |        208      100.00

.         count if _merge~=3;
    0

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         sort product spdomain;

. save "$path\work\price_unit_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex.dta save
> d

. ***********************************************************************************
> *****
> * 110_price_unit_flex.do                (end)
> ***********************************************************************************
> *****;
. cap log close;

. 
end of do-file

.                                 do "$path/new/120_povline_food_flex.do" /* Flexible
>  basket: Poverty line */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/120_povline_food_flex.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/120_povline_food_
> flex.log
  log type:  text
 opened on:  20 May 2013, 17:28:00

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information.
> **************************************************************************;
. /*
> This file uses:
>         work\food_basket_flex.dta
>         work\price_unit_flex.dta
>         work\calperg.dta
>         work\calpp.dta
> 
> This file creates:
>         work\povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path\work\price_unit_flex.dta";
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         71       34.13       34.13
          3 |        137       65.87      100.00
------------+-----------------------------------
      Total |        208      100.00

.         list product spdomain descript if _merge==1;

.         drop if _merge ~=3;
(71 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path\work\calperg.dta";
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         20       12.74       12.74
          3 |        137       87.26      100.00
------------+-----------------------------------
      Total |        157      100.00

.         * This tells where we are lacking calorie info or are lacking quantity info
>  due to 
>         * missing price info above;
.         list product spdomain descript if _merge==1;

.         drop if _merge~=3;
(20 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price observations;
.         by spdomain: count if round(bswt)<10;

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    0
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    1
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    1
-------------------------------------------------------------------------------------
-> spdomain = Western
    0

.         drop if round(bswt) < 10;
(2 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(12 observations deleted)

.         * reobtain the share represented from the average basket- should be slightl
> y more than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

-------------------------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        24     .901623           0    .901623    .901623

-------------------------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        21    .9074457           0   .9074457   .9074457

-------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        26      .90792           0     .90792     .90792

-------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        26    .9066816           0   .9066816   .9066816

-------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        26     .900831           0    .900831    .900831


.         * obtain quantities and calories provided by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path\work\calpp.dta";
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        123      100.00      100.00
------------+-----------------------------------
      Total |        123      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie requirements;
.         gen ratio=.95*calpp/calreg;

.                         replace quan=quan*ratio;
(123 real changes made)

.         replace cal_ir=quan*calperg;
(116 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(123 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

-------------------------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        24    .0001156           0   .0001156   .0001156

-------------------------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        21    .0000257           0   .0000257   .0000257

-------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        26   -.0000128           0  -.0000128  -.0000128

-------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        26   -.0001156           0  -.0001156  -.0001156

-------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        26   -.0000514           0  -.0000514  -.0000514


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;

.         * the sum of the value of the goods in the bundle is assumed to represent 9
> 0% of expenditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.                                 *************** we change the poverty line for Kamp
> ala urban, to try if it works ************;
. ***             replace povline_f_flex90=povline_f_flex90 + 6000;
.                         replace povline_f_flex=povline_f_flex90/.9;
(123 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path\work\povline_food_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex.dta sa
> ved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> **************************************************************************
> * 120_povline_food_flex.do      (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/120_povline_food_
> flex.log
  log type:  text
 closed on:  20 May 2013, 17:28:00
-------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/130_povmeas_flex.do"              /* 
> Flexible basket: Poverty rates */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/130_povmeas_flex.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.
> log
  log type:  text
 opened on:  20 May 2013, 17:28:00

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before any iteration)
> **************************************************************************;
. *CA modified to add work\hhdata.dta for bootstrap;
. /*
> This file uses:
>         in\foodshr96.dta
>         work\povline_f_flex.dta
>         work\consump_nom.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\foodshr96.dta
>         work\povmeas.dta
>         work\povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news rural survmon survquar;

.         tab reg_tpi, miss;

    reg_tpi |      Freq.     Percent        Cum.
------------+-----------------------------------
    central |      1,986       29.31       29.31
    eastern |      1,406       20.75       50.07
   northern |      1,956       28.87       78.94
    western |      1,427       21.06      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         tab survquar, miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |      1,749       25.82       25.82
Sept-Oct 09 |      1,731       25.55       51.37
Nov09-Jan10 |      1,458       21.52       72.89
 Feb-Apr 10 |      1,837       27.11      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path\work\hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(304 real changes made)

.                                         * Nearness to poverty line and population w
> eights ;
.         gen tripopwt=triwt*hhweight*hhsize;

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

.                 tab spdomain;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |          1       20.00       20.00
Central urban |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. **************************************************************************;
. * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.         gen povline_flex=povline_f_flex + povline_na_flex;

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path\work\povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta saved

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path\work\povlines.dta";
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;

.         * Poverty line;
.         gen linpob=povline_flex;

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
         cr2 |    6775   200636622    9398.417   343462.1   83.76179   7.03e+07
      linpob |    6775   200636622     919.668   136.8074   717.3789   1211.415
     linpobr |    6775   200636622    1049.948   .0000547   1049.948   1049.948

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.         gen h = 100     if cr <=(linpob);
(6005 missing values generated)

.         replace  h = 0 if cr > (linpob);
(6005 real changes made)

.                         gen             pg      = ((linpob - cr )/linpob) *100;

.         replace         pg      = 0             if h==0;
(6005 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;

.         replace         spg     = 0             if h==0;
(6005 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;

.         gen spg_flex=spg;

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path\work\hhdata.dta";
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |   9.775007   .6844343       8.43122    11.11879
     pg_flex |   2.565124   .2169024      2.139268    2.990981
    spg_flex |   1.024026   .1134079      .8013663    1.246686
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
       Urban |   2.012786   .5879872      .8583587    3.167212
       Rural |   10.96064   .7624384      9.463709    12.45758
-------------+------------------------------------------------
pg_flex      |
       Urban |   .3630919   .1130739      .1410877     .585096
       Rural |   2.901473   .2459022       2.41868    3.384266
-------------+------------------------------------------------
spg_flex     |
       Urban |   .1015641   .0385104      .0259546    .1771736
       Rural |   1.164927   .1297416      .9101985    1.419656
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

            1: news = 1
            2: news = 2
            3: news = 3
            4: news = 4

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
           1 |   6.053625   1.035123      4.021312    8.085937
           2 |   7.673569   1.332494      5.057412    10.28973
           3 |   18.38831   1.732566      14.98667    21.78996
           4 |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
           1 |   1.239011   .2720639      .7048536    1.773169
           2 |   1.518373   .2335571      1.059818    1.976928
           3 |    6.12452   .8045906      4.544824    7.704216
           4 |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
           1 |   .3871354   .1106459      .1698984    .6043724
           2 |   .4009155   .0635366      .2761707    .5256604
           3 |    2.91319   .4404111      2.048507    3.777873
           4 |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      central: reg_tpi = central
      eastern: reg_tpi = eastern
     northern: reg_tpi = northern
      western: reg_tpi = western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     central |   6.053625   1.035123      4.021312    8.085937
     eastern |   7.673569   1.332494      5.057412    10.28973
    northern |   18.38831   1.732566      14.98667    21.78996
     western |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
     central |   1.239011   .2720639      .7048536    1.773169
     eastern |   1.518373   .2335571      1.059818    1.976928
    northern |    6.12452   .8045906      4.544824    7.704216
     western |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
     central |   .3871354   .1106459      .1698984    .6043724
     eastern |   .4009155   .0635366      .2761707    .5256604
    northern |    2.91319   .4404111      2.048507    3.777873
     western |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |    4.92292    1.43497      2.105566    7.740274
   _subpop_3 |   9.123401   1.972289      5.251099     12.9957
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.439851   2.173988      5.171543    13.70816
   _subpop_6 |     10.461   1.988955      6.555977    14.36602
   _subpop_7 |   65.02235   5.871258      53.49499    76.54971
   _subpop_8 |   7.791329   1.560699      4.727124    10.85553
   _subpop_9 |   12.88647   2.061614      8.838789    16.93414
  _subpop_10 |   5.334378   1.069359      3.234848    7.433908
-------------+------------------------------------------------
pg_flex      |
     KAMPALA |   .2986766    .188988     -.0723737    .6697268
   _subpop_2 |   1.150472   .4518834       .263265    2.037679
   _subpop_3 |   1.727392   .4665012      .8114848    2.643298
   _subpop_4 |   1.177746   .2522045      .6825791    1.672913
     EASTERN |   1.796355   .3631121      1.083437    2.509272
   _subpop_6 |    3.18885   .8192738      1.580325    4.797374
   _subpop_7 |   25.29787    3.34131      18.73769    31.85804
   _subpop_8 |   1.287751   .3670516      .5670993    2.008404
   _subpop_9 |   3.571254   .7959142      2.008593    5.133916
  _subpop_10 |   1.086008   .2880834      .5203985    1.651618
-------------+------------------------------------------------
spg_flex     |
     KAMPALA |   .0636916   .0416943     -.0181691    .1455524
   _subpop_2 |   .3880597   .2068019     -.0179656    .7940849
   _subpop_3 |   .5229337   .1668819      .1952855     .850582
   _subpop_4 |   .3557974   .0919476      .1752718     .536323
     EASTERN |   .4377359   .0869987      .2669267    .6085451
   _subpop_6 |   1.359985   .4286935      .5183075    2.201662
   _subpop_7 |   12.94834   1.989438      9.042373    16.85432
   _subpop_8 |   .4064376   .1479538      .1159519    .6969232
   _subpop_9 |   1.510552   .4849095      .5585027      2.4626
  _subpop_10 |    .340192   .1287887      .0873342    .5930498
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   8.072413   1.437823      5.249457    10.89537
   _subpop_2 |   1.914678   .7063461      .5278702    3.301485
     Eastern |   7.673569   1.332494      5.057412    10.28973
    Northern |   18.38831   1.732566      14.98667    21.78996
     Western |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   1.689868   .3879697      .9281466     2.45159
   _subpop_2 |   .3146578   .1359886      .0476641    .5816516
     Eastern |   1.518373   .2335571      1.059818    1.976928
    Northern |    6.12452   .8045906      4.544824    7.704216
     Western |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   .5426074   .1608661      .2267703    .8584444
   _subpop_2 |   .0683844   .0307584      .0079948     .128774
     Eastern |   .4009155   .0635366      .2761707    .5256604
    Northern |    2.91319   .4404111      2.048507    3.777873
     Western |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         compress;
survquar was float now byte
spdomain was float now byte
reg_tpi was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
rmult was float now int
poor09 was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
hhsize was double now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize], by(strata);

. save "$path\work\povmeas.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povmeas.dta saved

. **************************************************************************
> * 130_povmeas_flex.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.
> log
  log type:  text
 closed on:  20 May 2013, 17:28:01
-------------------------------------------------------------------------------------

. 
end of do-file

.                                 do "$path/new/140_iterate.do" $it_n $bottom     /* 
> Flexible basket: Iterations */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/140_iterate.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/140_iterate.log
  log type:  text
 opened on:  20 May 2013, 17:28:01

. clear

. set more off

. #delimit ;
delimiter now ;
. *global povline_initial "$path\in\povlines_first_iof.dta";
. **************************************************************************
> * 140_iterate.do        (start)
> *
> * Purpose: Create flexible food basket and poverty line with iterative procedure
> *
> * This program will take the results from the first pass at the
> * poverty lines and applies the corresponding spatial deflator to
> * re-select the relatively poor, their consumption bundles, and
> * their prices.
> *
> * Welfare indicator is here always temporally and spatially adjusted per capita
> * expenditure. Here called cr_it< >.
> *
> * We will iterate this process 5 times which here assures convergence.
> *
> * CA, Mar 2010: Relatively poor are those below last iterated poverty line
> * MAH, Apr 2010: Cleaning
> * URB, feb 2012: Commented out "drop if unit~=2"
> **************************************************************************;
. /*
> This file uses:
>             in/povlines_first_new.dta
>         work\hhdata.dta
>         work\consump_nom.dta
>         work\own.dta
>         work\daily.dta
>         work\temp_index_reg_tpi.dta
>         work\cons_cod.dta
>         work\food_cat.dta
>         work\cons_real.dta
>         work\products.dta
>         work\match96_02.dta
>         new\conversions.do
>         
> This file creates (where `pass' is the number of the iteration):
>         work\codes_food_basket_flex_it`pass'.dta
>         work\price_unit_flex_it`pass'.dta
>         work\quan_flex_it`pass'.dta
>         work\match_cod_flex_it`pass'.csv
>         work\relpoor_it`pass'.dta
>         work\povlines_it`pass'.dta
>         work\foodshares_it`pass'.dta
>         work\nat_pov_flex.csv
>         work\rur_pov_flex.csv
>         work\strata_pov_flex.csv
>         work\spdomain_pov_flex.csv
>         work\reg_tpi_pov_flex.csv
> */
> 
> **************************************************************************;
. * Make a key file that will be used over and over, without change
> * in every iteration. This will include the TEMPORALLY deflated consumption
> * and various HH data such as hhweight, spdomain, etc.
> **************************************************************************;
. use "$path/work/conpc.dta";

.         sort hhid;

.         merg hhid using "$path\work\hhdata.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.                 gen food_pc_tpi = food_pc_nom /tpi_trim;

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         tempfile contpi;

.         sort hhid;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. *use "$path\in\povlines_first_iterate.dta", clear;
. *save "$path/work/povlines_first.dta", replace;
. **************************************************************************;
. * Now set some information pertaining to the iterations. For now we'll
> * manually set the number of iterations. Also specify the percentile
> * cutpoint that we will use for defining the relatively poor.
> **************************************************************************;
. local lastpass=0;

. local pass=1;

. * Use these two lines to manually specify the number of iterations
> * and the cutpoint here in the do file.;
.   *local maxit=5;
.   *local cutpt=50;
. * Use these few lines if you want to specify the number of iterations
> * and percentile cutpoint by passing them as parameters on the command
> * line, e.g.:   wstata do new\iterate1.do 5 50;
. if "`1'"=="" | "`2'"=="" {      ;
.         di in red "Error: you need to specify number of iterations as first paramet
> er";
.         di in red "       and percentile cutpoint as second parameter on command li
> ne.";
. };

. local maxit=`1';

. local cutpt=`2';

. tempfile cutoff;

. while `pass' <= `maxit' {;
  2.         ************************************************************************
> **;
. **************************************************************************;
. * Pick out the bottom X percent in real consumption per capita 
> * (temporally & spatially adjusted), as ranked by the previous iteration.
> * The percentile to use is defined by "cutpt". This produces a file that
> * has the hhid, and a dummy variable indicating if they were below the
> * cutpoint on the last iteration.
> **************************************************************************;
. **************************************************************************;
. /*
> * Comment out if IOF 2008/09. (This code included instead of below code in order to
>  replicate published figures 2002/03). ( START ) ;
> 
>         if "`pass'"=="1" {      ;
>               use `contpi', clear;
>               sort spdomain;
>               merge spdomain using "$path/work/povlines_first.dta";
>               tab _m;
>               drop _m;
> *              gen relpoor`pass'= cons_pc_tpi<=cutoff;
>                gen relpoor`pass'= cons_pc_tpi if cons_pc_tpi<=cutoff;
>               rename cons_pc_tpi cr_it0;
>               sort hhid;
>          save "$path\work\relpoor_it`pass'.dta", replace;
> *        use "$path/work/cons_real.dta", clear;
> *              gen cr_it0=cr2;
>         };
>         
> 
> * Comment out if IOF 2008/09. (This code included instead of below code in order to
>  replicate published figures 2002/03). ( END ) ;
> */
> 
> 
> 
> * Comment out if IAF 2002/03. (This code below excluded in order to replicate publi
> shed figures 2002/03). ( START ) ;
.         if "`pass'"=="1" { ;
  3. * Find real income at cut point initially;
.                 use "$path/work/cons_real.dta", clear;
  4.                                     gen cr_it0=cr2;
  5.                         cap drop one;
  6.             gen one=1;
  7.                                     collapse (p`cutpt') one cr_it`lastpass' [aw=
> popwt] ;
  8.                                     rename cr_it`lastpass' cutoff;
  9.                                     sort one;
 10.             save `cutoff', replace;
 11.  * Find relatively poor initially;
.             use "$path/work/cons_real.dta", clear;
 12.                                                 gen cr_it`lastpass'=cr2;
 13.             cap drop one;
 14.             gen one=1;
 15.                                     sort one;
 16.             merge one using `cutoff';
 17.             tab _merge;
 18.             drop _merge;
 19.                                     drop one;
 20.                            gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 21.             *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                     tab relpoor`pass' [aw=popwt];
 22.                                     keep hhid cr_it`lastpass' relpoor`pass' popw
> t;
 23.             sort hhid;
 24.         save $path\work\relpoor_it`pass'.dta, replace;
 25.         };
 26. * Comment out if IAF 2002/03. (This code below excluded in order to replicate pu
> blished figures 2002/03). ( END ) ;
.                 if `pass'>1 {   ;
 27. * Find real income at cut point in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta" , clear;
 28.                                                 cap drop one;
 29.                 gen one=1;
 30.                                                                 *CA modified fro
> m hhweight*hhsize to popwt;
.                 collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
 31.                         rename cr_it`lastpass' cutoff;
 32.                                                                         sort one
> ;
 33.         save `cutoff', replace;
 34.         * Find relatively poor in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta", clear;
 35.                                                 cap drop one;
 36.                 gen one=1;
 37.                                                 sort one;
 38.                 merge one using `cutoff';
 39.                 tab _merge;
 40.                 drop _merge;
 41.                                                 drop one;
 42.                 gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 43.                 *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                                 tab relpoor`pass' [aw=popwt];
 44. *CA modified to popwt above and to keep popwt below;
.                 keep hhid cr_it`lastpass' relpoor`pass' popwt;
 45.                 sort hhid;
 46.         save "$path\work\relpoor_it`pass'.dta", replace;
 47.         };
 48.         ************************************************************************
> **;
. * Get the consumption file, and select only those codes that are food,
> * using our definition of "food", which includes alcoholic beverages.
> **************************************************************************;
.         use "$path/work/cons_cod.dta", clear;
 49. *CA modified to merge in work\hhdata.dta for bootstrap;
.     sort hhid;
 50.     merge hhid using "$path\work\hhdata.dta";
 51.     tab _m;
 52.     drop _m;
 53.         /*
>                 sort product;
>                 merge product using "$path/work/food_cat.dta";
>                 tab _merge;
>                 keep if _merge==3;
>                 drop _merge;
> */
> 
>                                 * Only food transactions ;
.                 keep if food_cat;
 54.                 sort hhid;
 55. **************************************************************************;
. * Merge with file that has temporally AND spatially adjusted consumption
> * per capita from the previous iteration, and also identifies those below 
> * the cutoff. Then select only those who are below the cutoff.
> **************************************************************************;
.                 merge hhid using "$path\work\relpoor_it`pass'.dta";
 56.                 tab _merge;
 57.                 drop _merge;
 58.                                 * Keep only transactions by the poor ;
.                 keep if relpoor`pass';
 59. **************************************************************************;
. * Calculate HH level food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.                 gen  food_expenditure = cod_hh_nom3;
 60.                 *gen  food_expenditure= own_valued + daily_valued + monthly_valu
> ed + educ_valued;
.                 egen tot_food_expen= sum (food_expen), by (hhid) ;
 61.                 count if food_expenditure==.;
 62.                 count if tot_food_expen==.;
 63.                 gen food_share= food_expenditure/tot_food_expen;
 64.                 count if food_share==.;
 65.                 drop if food_share==.;
 66.                 sort hhid product;
 67.                 tempfile foodshares;
 68.         save `foodshares', replace;
 69. ********************************************************************************
> ;
. * Now find the total (economy wise, e.g. not by HH) shares by each product in
> * order to select the most important goods in each domain's basket.
> ********************************************************************************;
.                 collapse (mean) hhweight spdomain, by (hhid);
 70.                 sort hhid ;
 71.                  collapse (sum) hhweight , by(spdomain);
 72.                 rename hhweight tothhweight;
 73.                 tempfile tothhweight;
 74.                 sort spdomain;
 75.         save `tothhweight', replace;
 76.         use `foodshares', clear;
 77.                 sort spdomain;
 78.                 merge spdomain using `tothhweight';
 79.                 tab _merge;
 80.                 drop _merge;
 81.                 sort spdomain product;
 82.                 gen f_share_w`pass'=(food_share*hhweight)/tothhweight;
 83.                 collapse (sum) f_share_w`pass', by(spdomain product descript);
 84.                                sort spdomain f_share_w`pass';
 85.                 by spdomain: gen cumshr`pass'= sum(f_share_w`pass');
 86.                 count if cumshr`pass'<=.075;
 87.                 drop if cumshr`pass'<=.075;
 88.                 lab var f_share_w`pass' "average food share for the 13 spatial d
> omains";
 89.         save `foodshares', replace;
 90.                                                 * Number of spatials domains a f
> ood product appears ;
.                 gen numreg=1;
 91.                 collapse (sum) numreg cumshr`pass', by (product descript);
 92.                 keep product numreg descript;
 93.                 display _N;
 94.                 sort product;
 95.                                 * Include food product labels ;
. *                merge product using "$path\work\products.dta";
. *                tab _merge;
. *                keep if _merge==3;
.                 keep product descript numreg;
 96.                   sort product;
 97.                      display _N;
 98.           save "$path\work\codes_food_basket_flex_it`pass'.dta", replace;
 99. **************************************************************************;
. **************************************************************************;
. * That is pretty much the part equivalent to "100_food_basket_flex.do",
> * which figures out the food shares for the relevant reference group. Now
> * we figure out the prices with a code stream that is adapted from
> * "110_price_unit_flex.do".
> **************************************************************************;
. **************************************************************************;
. ***********************************************************************************
> ***
> * Create sorted data set with daily + own expenditure and the matched codes
> ***********************************************************************************
> ***;
. use "$path/in/cons_cod_trans.dta", clear;
100. *save "$path/work/cons_cod_trans.dta", replace;
. *drop value   ;
. *drop quantity;
. keep hhid product food_cat valuez quantityz unit;
101. rename valuez    value;
102. rename quantityz quantity;
103. *drop count;
. drop if quantity==0 ;
104.         tempfile dd_acsort;
105.         save    `dd_acsort', replace;
106. /*
>         use "$path\work\daily.dta", clear;
>                 drop days;
>                 sort product;
>                 tempfile dd_acsort;
>         save `dd_acsort', replace;
>         
>         use "$path\work\own.dta", clear;
>                 keep hhid product valued quantityd unit;
>                 rename valued value;
>                 rename quantityd quantity;
>         
>                 *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>                 drop if quantity==0;
>         
>                 append using `dd_acsort';
> */
> 
>                 *CA modified to insert work\hhdata.dta for bootstrap;
.                 sort hhid;
107.                 merge hhid using "$path\work\hhdata.dta";
108.                 tab _m;
109.                  drop if _m==2;
110.                 drop _m;
111.                                 sort product;
112.                 gen count=1;
113.         save `dd_acsort', replace;
114.         ************************************************************************
> **;
. * Merge the basket codes with the dd  and own data sets.
> * Drop all codes not a part of the flexible food basket
> **************************************************************************;
.                 merge product using "$path\work\codes_food_basket_flex_it`pass'.dta
> ";
115.                         tab _merge;
116.                 drop if _merge~=3;
117.                 drop _merge;
118. ********************************************************************************
> ******
> * Drop observations where product code, quantity or value information is unavailabl
> e
> ***********************************************************************************
> ***;
.                 drop if product==. | value==. | quantity==.  ;
119.         ************************************************************************
> **************
> * Convert non-KG quantities (units, liters) into kilograms
> ***********************************************************************************
> ***;
. *do "$path\new\110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped.
> ********************************************************************;
. *                $MZ drop if unit~=2;
.         **************************************************************************;
. * Bring in the spdomain and reg_tpi variables, and also the information on
> * relatively poor households.
> **************************************************************************;
.                 preserve;
120.                                                 * Temporally adjusted expenditur
> e ;
.                         use `contpi', clear;
121.                                 keep hhid hhweight spdomain reg_tpi survquar tpi
> _trim cons_pc_tpi ;
122.                                 sort hhid;
123.                                 tempfile hhd2;
124.                         save `hhd2', replace;
125.                 restore;
126.                                 compress;
127.                 sort hhid;
128.                 merge hhid using `hhd2';
129.                 tab _merge;
130.                 drop _merge;
131.                 sort hhid;
132.                 merge hhid using "$path\work\relpoor_it`pass'.dta";
133.                 tab _merge;
134.                 drop _merge;
135.                                                 * Keep nominal food transactions
>  by poor people ;
.                 keep if relpoor`pass';
136.                 drop if product==.;
137.                                                                 * Temporally def
> late transaction values ;
.                 gen value_r=value/tpi_trim;
138. **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
139.                 egen lower5=pctile(hhppkg), p(5)  by(spdomain product);
140.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
141.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
142. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_uw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_ut. Last we take the median, price_um. But in the end
> * we only use price_unitw
> *********************************************************************;
.                 gen price_ut`pass'=value_r/(quantity*1000);
143.                 gen price_um`pass'=price_ut;
144.                 collapse (sum) 
>                         quantity value_r count bswt (mean) price_ut (median) price_
> um [aw=hhweight], 
>                         by(spdomain product);
145.                 *Generate weighted price per gram ;
.                 gen price_uw`pass'=value_r/(quantity*1000);
146.                 drop value_r quantity;
147.                 sort spdomain product;
148.                 lab var price_ut`pass' "Average of calculated prices - transacti
> on weighted";
149.                 lab var price_um`pass' "Median of prices";
150.                 lab var price_uw`pass' "Value share weighted mean prices";
151. * Get an idea of the difference between the price measures;
.                 gen ratiotw`pass'=price_ut`pass'/price_uw`pass';
152.                 gen ratiomw`pass'=price_um`pass'/price_uw`pass';
153.                 sum ratiotw`pass' ratiomw`pass';
154.                 sort product;
155.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.
> dta";
156.                 tab _m;
157.                 count if _merge~=3;
158.                 drop if _merge~=3;
159.                 drop _merge;
160.                 sort product spdomain;
161.         save "$path\work\price_unit_flex_it`pass'.dta", replace;
162. **************************************************************************;
. **************************************************************************;
. * That concludes the prices part. Now we move to calculating the food
> * poverty lines, which draws code from "120_povline_flex.do" with very few
> * changes:
> * - The changes facilitate accumulating vectors
> *   of intermediate results across iterations, rather than generating a
> *   bunch of new files.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************;
. * Use the file with the food basket (`foodshares'), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information, but list them out.
> **************************************************************************;
.         use `foodshares', clear;
163.                 sort product spdomain;
164.                 merge product spdomain using "$path\work\price_unit_flex_it`pass
> '.dta";
165.                         tab _merge;
166.                 list product spdomain descript if _merge==1;
167.                         drop if _merge ~=3;
168.                 drop _merge;
169.                 sort product;
170.                         merge product using "$path\work\calperg.dta";
171.                 tab _merge;
172.                                                 * This tells where we are lackin
> g calorie info or are lacking quantity info due to 
>                 * missing price info above;
.                 list product spdomain descript if _merge==1;
173.                         drop if _merge~=3;
174.                 drop _merge;
175.                 sort spdomain f_share_w`pass';
176.                                 *CA modified to change count bswt;
.                 by spdomain: count if round(bswt)<10;
177.                                 sum bswt;
178.                                                 drop if round(bswt) < 10;
179.                                                                 * Total food sha
> re in spatial domain ;
.                 by spdomain: egen baskshr=sum(f_share_w`pass');
180.                                 * Cumulated food share in spatial domain ;
.                 by spdomain: gen  cumshr =sum(f_share_w`pass');
181.                 drop if cumshr<=baskshr-.9;
182.                         drop baskshr;
183.                 by spdomain: egen baskshr=sum(f_share_w`pass');
184.                 tabstat baskshr , by(spdomain) st(n mean sd min max);
185.                                                                 * How many grams
>  in 1 MT exp on food item ;
.                                 gen quan`pass'=f_share_w`pass'/price_uw`pass';
186.                                 * How many calories in 1 MT exp on food item ;
.                 gen cal_ir`pass'=quan`pass'*calperg;
187.                                 * how many calories in 1 MT exp in food basket ;
.                 by spdomain: egen calreg=sum(cal_ir);
188.                         sort spdomain;
189.                 merge spdomain using "$path\work\calpp.dta";
190.                 tab _merge;
191.                 drop _merge;
192.                                                         * get the expansion fact
> or to hit 95% of calorie requirements ;
.                 gen ratio=.95*calpp/calreg;
193.                         replace quan`pass'=quan`pass'*ratio;
194.                 replace cal_ir`pass'=quan`pass'*calperg;
195.                         sort spdomain product;
196.                 by spdomain: egen chkcal=sum(cal_ir`pass');
197.                 replace chkcal=chkcal/.95-calpp ;
198.                                                 tabstat chkcal , by(spdomain) st
> (n mean sd min max);
199.                         gen val_ir`pass'=quan`pass'*price_uw`pass';
200.                         by spdomain: egen povline_f_flex90_`pass'=sum(val_ir`pas
> s');
201.                 replace povline_f=povline_f_flex90_`pass'/.9;
202.                 *drop product96;
. keep product spdomain quan`pass'  price_uw`pass' val_ir`pass' povline_f_flex90_`pas
> s' calpp calperg;
203.                     save "$path\work\quan_flex_it`pass'.dta", replace;
204.                         collapse (mean) povline_f_flex90_`pass', by (spdomain);
205.                                                 keep spdomain povline_f_flex90_`
> pass';
206.                 sort spdomain;
207.                 save "$path\work\povline_food_flex_it`pass'.dta", replace;
208.         ************************************************************************
> **;
. **************************************************************************;
. * Now comes the part that draws the non-food and total poverty lines,
> * and generates estimates of poverty measures. This is drawn from 
> * "130_povmeas_flex.do" with a few changes.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
.         use `contpi', clear;
209.                 sort spdomain;
210.                 merge spdomain using "$path/work/povline_food_flex_it`pass'.dta"
> ;
211.                 tab _merge;
212.                 drop _merge;
213.                 gen triwt=0 ;
214.                 replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex90_`
> pass'-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex90_`pass'-1)<=0.2;
215.                                 ***since there were very small numbers of the po
> or in Kampala and central Urban, for Ugandanda we added weight 1***
>                                 * Nearness to poverty line and population weights ;
.                 gen tripopwt=(0.0001+triwt)*hhweight*hhsize;
216.                                                 preserve;
217.                         collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                                 by(spdomain);
218.                         rename nf_pc_nom povline_nf_flex`pass';
219.                         lab var povline_nf_flex`pass' "Nonfood poverty line. Fle
> xible bundle";
220.                         tempfile znf;
221.                         sort spdomain;
222.                         save `znf', replace;
223.                                                                 restore;
224.                                 sort spdomain;
225.                 merge spdomain using `znf';
226.                 tab _merge;
227.                 drop _merge;
228. **************************************************************************
> * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.                 gen povline_flex`pass'=povline_f_flex90_`pass' + povline_nf_flex`pa
> ss';
229. keep spdomain povline_flex`pass';
230.                 sort spdomain;
231.         save "$path\work\povlines_it`pass'.dta", replace;
232. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
.         use `contpi', clear;
233.                 sort spdomain;
234.                 merge spdomain using "$path\work\povlines_it`pass'.dta";
235.                 tab _merge;
236.                 drop _merge;
237.                 gen cr= cons_pc_tpi ;
238.                 gen linpob`pass'=povline_flex`pass';
239.                 qui sum linpob`pass' if spdomain==1, meanonly;
240.                 global spi_base=r(mean);
241.                 gen spi`pass'=linpob`pass'/$spi_base;
242.                 gen cr_it`pass'=cr/spi`pass';
243.                 qui sum cr [aw=hhweight*hhsize];
244.                 global sumcr=r(sum);
245.                 qui sum cr_it`pass' [aw=hhweight*hhsize];
246.                 global sumcr2=r(sum);
247.                 replace spi`pass'=spi`pass'*$sumcr2/$sumcr;
248.                 gen linpobr`pass'=linpob`pass'/spi`pass';
249.                 replace cr_it`pass'=cr/spi`pass';
250.                 su cr cr_it`pass' linpob`pass' linpobr`pass' [aw=hhweight*hhsize
> ];
251.                 lab var cr "Temporally-adjusted cons pc";
252.                 lab var cr_it`pass' "Spatially & temporally adjusted cons pc";
253.                 lab var linpob`pass' "Poverty line";
254.                 lab var linpobr`pass' "Real poverty line";
255.                 lab var spi`pass' "Spatial price index";
256.                 gen linpob=linpob`pass';
257. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.                 gen h=100 if cr_it`pass'<=linpobr`pass' & linpobr`pass'~=. & cr_it`
> pass'~=.;
258.                 replace  h   = 0 if cr_it`pass' > linpobr`pass' & linpobr`pass'~
> =. & cr_it`pass'~=.;
259.                 gen      pg  = ((linpobr`pass' - cr_it`pass' )/linpobr`pass') *1
> 00;
260.                 replace  pg  = 0             if h==0;
261.                 gen      spg = ((( linpobr`pass' - cr_it`pass' )/ linpobr`pass' 
> )^2)*100;
262.                 replace  spg = 0             if h==0;
263.                 gen h_flex`pass'  =h;
264.                 gen pg_flex`pass' =pg;
265.                 gen spg_flex`pass'=spg;
266.                                 lab var h_flex`pass'   "Poverty headcount. Flexi
> ble bundle";
267.                 lab var pg_flex`pass'  "Poverty gap. Flexible bundle";
268.                 lab var spg_flex`pass' "Squared poverty gap. Flexible bundle";
269.                 gen popwt=hhsize*hhweight;
270.                         * Stata 10.1 syntax ;
.                         svyset , clear;
271.                         svyset [pweight=popwt] , str(strata) psu(psu);
272.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass';
273.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(rural
> );
274.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strat
> a);
275.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strat
> a rural);
276.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(spdom
> ain);
277. *preserve;
. keep hhid popwt cr_it`pass' h_flex`pass' pg_flex`pass' spg_flex`pass' rural news re
> g_tpi strata spdomain;
278.                 compress;
279.                 sort hhid;
280.         save "$path/work/cons_real_it`pass'.dta" , replace;
281. *restore;
.                                 * New cutoff point (percentile) to use in next iter
> ation is equal to the poverty ;
.                 * rate in this iteration ;
.                                                 sum h_flex`pass' [aw=popwt] ;
282.                                 * Comment out next line for IAF 2002/03 in order
>  to replicate official figures ( START );
.                 * URB: In this case, we just use the poorest 50% as there are too f
> ew actually poor to calculate the bundle and prices..;
.                 local cutpt= $tpi_bottom;
283. *               local cutpt= round(r(mean));
.                 * Comment out next line for IAF 2002/03 in order to replicate offic
> ial figures ( END );
. *       save foodshares tempfile to disk;
.         use `foodshares', clear;
284.         save "$path/work/foodshares_it`pass'.dta", replace;
285.         local lastpass = `pass';
286.         local pass = `pass' + 1;
287.         };
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 4,742.3531       70.00       70.00
          1 | 2,032.6469       30.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it1.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(311718 observations deleted)
(81938 missing values generated)
81938
    0
(82025 missing values generated)
82025
(82025 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     18,302      100.00      100.00
------------+-----------------------------------
      Total |     18,302      100.00
  147
(147 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
45
45
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_i
> t1.dta saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     11,416       13.40       13.40
          3 |     73,788       86.60      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(11416 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         28        0.04        0.04
          3 |     73,788       99.96      100.00
------------+-----------------------------------
      Total |     73,816      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     73,816      100.00      100.00
------------+-----------------------------------
      Total |     73,816      100.00
(58885 observations deleted)
(10 observations deleted)
(1070 observations deleted)
(1 missing value generated)
(1 missing value generated)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw1 |       214    1.253429    .5375037    .870327    5.99957
    ratiomw1 |       214    1.083417    .4490376          0   4.757987
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        215      100.00      100.00
------------+-----------------------------------
      Total |        215      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it1.dta 
> saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         77       35.81       35.81
          3 |        138       64.19      100.00
------------+-----------------------------------
      Total |        215      100.00
(77 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         17       10.97       10.97
          3 |        138       89.03      100.00
------------+-----------------------------------
      Total |        155      100.00
(17 observations deleted)

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    2
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    6
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       138     92.8913     96.5467          2        666
(8 observations deleted)
(11 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26  .9014914         0  .9014914  .9014914
Central urban |        15  .8305768         0  .8305768  .8305768
      Eastern |        26  .9078561         0  .9078561  .9078561
     Northern |        25  .9078463         0  .9078463  .9078463
      Western |        27  .9040464         0  .9040464  .9040464
--------------+--------------------------------------------------
        Total |       119   .895858  .0250247  .8305768  .9078561
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        119      100.00      100.00
------------+-----------------------------------
      Total |        119      100.00
(119 real changes made)
(113 real changes made)
(119 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26 -.0001413         0 -.0001413 -.0001413
Central urban |        15  .0000257         0  .0000257  .0000257
      Eastern |        26  .0002441         0  .0002441  .0002441
     Northern |        25  .0001413         0  .0001413  .0001413
      Western |        27 -.0000514         0 -.0000514 -.0000514
--------------+--------------------------------------------------
        Total |       119  .0000437  .0001433 -.0001413  .0002441
-----------------------------------------------------------------
(119 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it1.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it1.dt
> a saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(301 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000009.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000009.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it1.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
      cr_it1 |    6775   200636622    9398.417   55450.64   25.20707    3286495
     linpob1 |    6775   200636622    5513.023   15702.28   746.3683   58958.19
    linpobr1 |    6775   200636622    1847.686   .0000769   1847.685   1847.686
(5268 missing values generated)
(5268 real changes made)
(5268 real changes made)
(5268 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex1 |   17.18958   1.268637      14.69879    19.68036
    pg_flex1 |   8.544676   .9363939      6.706204    10.38315
   spg_flex1 |   6.137267   .7900993      4.586023    7.688512
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
       Urban |    55.8199   5.745958      44.53855    67.10125
       Rural |     11.289    .791907      9.734208     12.8438
-------------+------------------------------------------------
pg_flex1     |
       Urban |   44.74859   4.649344      35.62028     53.8769
       Rural |   3.014722   .2522074       2.51955    3.509894
-------------+------------------------------------------------
spg_flex1    |
       Urban |   38.28541   4.068182      30.29813    46.27269
       Rural |   1.226811   .1351952      .9613747    1.492247
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
     KAMPALA |    87.6499   2.776667      82.19832    93.10148
   _subpop_2 |   23.83337    7.95237      8.220051    39.44668
   _subpop_3 |   24.63338   5.226147       14.3726    34.89415
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.439851   2.173988      5.171543    13.70816
   _subpop_6 |   10.75638   2.012631      6.804869    14.70788
   _subpop_7 |   66.94378   6.115066      54.93774    78.94981
   _subpop_8 |   8.680485   1.593061      5.552741    11.80823
   _subpop_9 |   14.15096   2.474739      9.292176    19.00975
  _subpop_10 |   5.810061   1.135876      3.579933    8.040188
-------------+------------------------------------------------
pg_flex1     |
     KAMPALA |   74.67818   3.361274      68.07881    81.27755
   _subpop_2 |   16.21287   5.939676      4.551185    27.87455
   _subpop_3 |   14.09894   4.274596      5.706392    22.49148
   _subpop_4 |   1.170598   .2510009      .6777945    1.663402
     EASTERN |   1.783741   .3603966      1.076155    2.491327
   _subpop_6 |   3.472502   .8556236       1.79261    5.152394
   _subpop_7 |   26.86846   3.436174      20.12203    33.61488
   _subpop_8 |   1.561919   .3859616      .8041393    2.319698
   _subpop_9 |   3.689823   .8084739      2.102503    5.277143
  _subpop_10 |    1.13565   .2947774      .5568981    1.714403
-------------+------------------------------------------------
spg_flex1    |
     KAMPALA |    65.9864   3.689079      58.74344    73.22937
   _subpop_2 |   12.76116   4.606281      3.717401    21.80492
   _subpop_3 |   11.02824    3.81134      3.545229    18.51125
   _subpop_4 |   .3530942   .0915102      .1734272    .5327612
     EASTERN |    .433269   .0862365      .2639563    .6025817
   _subpop_6 |   1.510269   .4584334      .6102024    2.410336
   _subpop_7 |   13.94949   2.093226      9.839746    18.05923
   _subpop_8 |   .4840135   .1635883      .1628317    .8051952
   _subpop_9 |   1.559212   .4912731      .5946694    2.523755
  _subpop_10 |   .3578855   .1321353      .0984571     .617314
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |    87.6499   2.776667      82.19832    93.10148
   _subpop_2 |   95.48657   1.516357      92.50943    98.46372
   _subpop_3 |   5.515636   1.674015      2.228952    8.802321
   _subpop_4 |   96.77758   2.186975      92.48378    101.0714
   _subpop_5 |   9.738969   2.263881       5.29417    14.18377
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.817629   1.228294      3.406054    8.229205
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.893798   2.306275      5.365764    14.42183
  _subpop_10 |          0  (omitted)
  _subpop_11 |   11.92834   2.161941      7.683683    16.17299
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   69.16959    6.24481      56.90882    81.43036
  _subpop_14 |   1.923275   1.663165     -1.342107    5.188657
  _subpop_15 |   9.681504   1.712591      6.319081    13.04393
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   14.65374   2.567312      9.613201    19.69429
  _subpop_18 |          0  (omitted)
  _subpop_19 |   6.106136   1.185365      3.778845    8.433426
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   74.67818   3.361274      68.07881    81.27755
   _subpop_2 |   74.45925   4.298931      66.01893    82.89957
   _subpop_3 |   1.322516   .5347834      .2725472    2.372485
   _subpop_4 |   73.30783   6.098908      61.33352    85.28214
   _subpop_5 |   1.875066   .5272436      .8399003    2.910232
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.236125   .2645615      .7166967    1.755552
   _subpop_8 |   .8816438   .5566215     -.2112012    1.974489
   _subpop_9 |   1.855157   .3812214      1.106684    2.603629
  _subpop_10 |          0  (omitted)
  _subpop_11 |   3.850849    .932493      2.020035    5.681662
  _subpop_12 |   4.914288   2.781593     -.5469636    10.37554
  _subpop_13 |   27.68137   3.552643      20.70628    34.65647
  _subpop_14 |   .1285471   .1165532      -.100288    .3573822
  _subpop_15 |   1.774259   .4475723      .8955166    2.653002
  _subpop_16 |   .8278169   .8141429     -.7706337    2.426268
  _subpop_17 |   3.868711   .8455704      2.208557    5.528864
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.193522   .3086271       .587578    1.799466
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |    65.9864   3.689079      58.74344    73.22937
   _subpop_2 |   60.90786   6.378963       48.3837    73.43202
   _subpop_3 |    .452732   .2470574     -.0323291    .9377931
   _subpop_4 |   61.69268   7.117541      47.71843    75.66693
   _subpop_5 |   .5683974   .1880877      .1991147    .9376801
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3728593   .0965515      .1832946    .5624241
   _subpop_8 |   .2105416   .1326677      -.049932    .4710153
   _subpop_9 |   .4509015   .0914295      .2713931    .6304099
  _subpop_10 |          0  (omitted)
  _subpop_11 |   1.674821   .5028685      .6875122     2.66213
  _subpop_12 |    3.53505   2.000914     -.3934534    7.463553
  _subpop_13 |   14.33511   2.170022      10.07459    18.59563
  _subpop_14 |   .0088103   .0082043     -.0072976    .0249182
  _subpop_15 |   .5544105   .1910643      .1792838    .9295372
  _subpop_16 |   .1944727   .1912604     -.1810391    .5699844
  _subpop_17 |   1.644514   .5160803      .6312661    2.657763
  _subpop_18 |          0  (omitted)
  _subpop_19 |    .376123   .1386215        .10396    .6482861
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   7.642616   1.431564      4.831949    10.45328
   _subpop_2 |   91.63447   1.618542       88.4567    94.81224
     Eastern |   7.673569   1.332494      5.057412    10.28973
    Northern |   19.14725   1.764155      15.68359    22.61092
     Western |   10.10187   1.448591      7.257774    12.94597
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   1.600795   .3769973      .8606155    2.340974
   _subpop_2 |    74.3291   2.467815      69.48391     79.1743
     Eastern |   1.508216   .2319506      1.052815    1.963617
    Northern |    6.61321   .8347892      4.974223    8.252196
     Western |     2.4499   .4613647      1.544078    3.355722
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   .5109841      .1551      .2064679    .8155003
   _subpop_2 |   63.74986   3.178604      57.50913    69.99058
     Eastern |   .3972412   .0630816      .2733896    .5210927
    Northern |   3.176607   .4683433      2.257083     4.09613
     Western |   .9760281   .2736612      .4387344    1.513322
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex1 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it1.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex1 |    6775   200636622    17.18958   37.73177          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it1.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  4,742.255       70.00       70.00
          1 |  2,032.745       30.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it2.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(287904 observations deleted)
(99374 missing values generated)
99374
    0
(99481 missing values generated)
99481
(99481 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000b.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000b.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     24,660      100.00      100.00
------------+-----------------------------------
      Total |     24,660      100.00
  148
(148 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved
49
49
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_i
> t2.dta saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      7,509        8.81        8.81
          3 |     77,695       91.19      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(7509 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000e.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         17        0.02        0.02
          3 |     77,695       99.98      100.00
------------+-----------------------------------
      Total |     77,712      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     77,712      100.00      100.00
------------+-----------------------------------
      Total |     77,712      100.00
(56918 observations deleted)
(13 observations deleted)
(1545 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw2 |       236    1.228664    .3939269   .7632499   3.723311
    ratiomw2 |       236    1.091864    .4172718          0   5.306202
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        236      100.00      100.00
------------+-----------------------------------
      Total |        236      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it2.dta 
> saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         89       37.71       37.71
          3 |        147       62.29      100.00
------------+-----------------------------------
      Total |        236      100.00
(89 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         13        8.13        8.13
          3 |        147       91.88      100.00
------------+-----------------------------------
      Total |        160      100.00
(13 observations deleted)

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    3
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    0
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------
-> spdomain = Western
    1

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       147    118.4014    119.0073          5        585
(4 observations deleted)
(11 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        25  .9064211         0  .9064211  .9064211
Central urban |        33  .9007655         0  .9007655  .9007655
      Eastern |        24  .9019961         0  .9019961  .9019961
     Northern |        24  .9075263         0  .9075263  .9075263
      Western |        26  .9050037         0  .9050037  .9050037
--------------+--------------------------------------------------
        Total |       132  .9041244  .0026367  .9007655  .9075263
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        132      100.00      100.00
------------+-----------------------------------
      Total |        132      100.00
(132 real changes made)
(127 real changes made)
(132 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        25 -.0001413         0 -.0001413 -.0001413
Central urban |        33  .0000257         0  .0000257  .0000257
      Eastern |        24  .0002441         0  .0002441  .0002441
     Northern |        24  .0001413         0  .0001413  .0001413
      Western |        26  .0002056         0  .0002056  .0002056
--------------+--------------------------------------------------
        Total |       132  .0000902  .0001369 -.0001413  .0002441
-----------------------------------------------------------------
(132 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it2.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it2.dt
> a saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(309 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000g.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it2.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
      cr_it2 |    6775   200636622    9398.417   266988.7   97.22625   5.44e+07
     linpob2 |    6775   200636622    967.7104   276.9813   729.8376   1839.502
    linpobr2 |    6775   200636622    1232.937   .0000488   1232.937   1232.937
(5975 missing values generated)
(5975 real changes made)
(5975 real changes made)
(5975 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex2 |   10.50835   .7379571      9.059479    11.95722
    pg_flex2 |   2.701772    .223767      2.262438    3.141105
   spg_flex2 |   1.081624   .1164169      .8530567    1.310192
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
       Urban |    5.93849   2.140476      1.735978      10.141
       Rural |   11.20637   .7868297      9.661546     12.7512
-------------+------------------------------------------------
pg_flex2     |
       Urban |   1.295969   .4722124      .3688485    2.223089
       Rural |   2.916501   .2471735      2.431212     3.40179
-------------+------------------------------------------------
spg_flex2    |
       Urban |   .4359101    .142375      .1563776    .7154427
       Rural |   1.180254   .1323017      .9204986    1.440009
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
     KAMPALA |   9.985215   5.877565     -1.554526    21.52496
   _subpop_2 |   6.382123   1.532823      3.372649    9.391596
   _subpop_3 |    9.29268   1.973999       5.41702    13.16834
   _subpop_4 |   5.450948   1.171204       3.15146    7.750436
     EASTERN |    9.28854   2.149875      5.067575     13.5095
   _subpop_6 |     10.461   1.988955      6.555977    14.36602
   _subpop_7 |   65.53581   5.935065      53.88318    77.18844
   _subpop_8 |    8.21569   1.570354      5.132529    11.29885
   _subpop_9 |   14.15096   2.474739      9.292176    19.00975
  _subpop_10 |   5.810061   1.135876      3.579933    8.040188
-------------+------------------------------------------------
pg_flex2     |
     KAMPALA |   2.431456   1.263895     -.0500176    4.912929
   _subpop_2 |   1.359614    .464365      .4479012    2.271327
   _subpop_3 |   1.820147   .4722219      .8930079    2.747285
   _subpop_4 |   1.080393   .2359904      .6170601    1.543725
     EASTERN |   1.625073   .3265775      .9838854     2.26626
   _subpop_6 |   3.312989   .8350485      1.673493    4.952484
   _subpop_7 |   25.97757   3.381588      19.33832    32.61683
   _subpop_8 |   1.404565   .3741467      .6699826    2.139147
   _subpop_9 |   3.689609   .8084512      2.102334    5.276885
  _subpop_10 |   1.135555    .294766      .5568249    1.714285
-------------+------------------------------------------------
spg_flex2    |
     KAMPALA |   .7511155     .34422      .0752898    1.426941
   _subpop_2 |    .470393   .2131241       .051955     .888831
   _subpop_3 |   .5830235   .1729465      .2434683    .9225787
   _subpop_4 |    .320314   .0861927      .1510872    .4895409
     EASTERN |   .3793271   .0772407      .2276762     .530978
   _subpop_6 |    1.42401   .4415793      .5570335    2.290986
   _subpop_7 |   13.37795   2.034601      9.383313    17.37259
   _subpop_8 |   .4382439   .1547599      .1343955    .7420923
   _subpop_9 |   1.559125   .4912618      .5946046    2.523646
  _subpop_10 |   .3578537   .1321294       .098437    .6172705
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   9.985215   5.877565     -1.554526    21.52496
   _subpop_2 |   9.771545   2.337977      5.181268    14.36182
   _subpop_3 |   5.515636   1.674015      2.228952    8.802321
   _subpop_4 |   2.997339   1.831962     -.5994499    6.594128
   _subpop_5 |   10.59237   2.263892      6.147553    15.03719
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.756075   1.232853      3.335549    8.176601
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.730508   2.280927      5.252241    14.20877
  _subpop_10 |          0  (omitted)
  _subpop_11 |   11.60078    2.13784      7.403442    15.79811
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   67.70948   6.050151       55.8309    79.58807
  _subpop_14 |   1.923275   1.663165     -1.342107    5.188657
  _subpop_15 |   9.147854   1.686736      5.836193    12.45951
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   14.65374   2.567312      9.613201    19.69429
  _subpop_18 |          0  (omitted)
  _subpop_19 |   6.106136   1.185365      3.778845    8.433426
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   2.431456   1.263895     -.0500176    4.912929
   _subpop_2 |   1.337508   .8188242     -.2701332     2.94515
   _subpop_3 |   1.365265   .5436764       .297836    2.432694
   _subpop_4 |   1.140981   .7690605     -.3689569    2.650919
   _subpop_5 |   1.960362   .5402833      .8995952     3.02113
   _subpop_6 |          0  (omitted)
   _subpop_7 |    1.14087   .2487913      .6524045    1.629335
   _subpop_8 |   .8223657    .519018     -.1966503    1.841382
   _subpop_9 |    1.68862   .3454444       1.01039     2.36685
  _subpop_10 |          0  (omitted)
  _subpop_11 |   3.673956   .9108412      1.885652    5.462259
  _subpop_12 |    4.87086   2.757012     -.5421301    10.28385
  _subpop_13 |   26.75911   3.497451      19.89237    33.62584
  _subpop_14 |   .0878968   .0816315     -.0723747    .2481683
  _subpop_15 |   1.599617   .4358483      .7438929    2.455342
  _subpop_16 |   .8277092    .814037     -.7705334    2.425952
  _subpop_17 |    3.86849   .8455473      2.208382    5.528599
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.193422   .3086153      .5875008    1.799343
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .7511155     .34422      .0752898    1.426941
   _subpop_2 |   .4687525   .3456891     -.2099576    1.147462
   _subpop_3 |   .4708124   .2525587     -.0250497    .9666746
   _subpop_4 |   .5213569   .3594655      -.184401    1.227115
   _subpop_5 |   .5957548   .1945235      .2138363    .9776733
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3382443   .0909513      .1596746    .5168139
   _subpop_8 |   .1833174   .1155206     -.0434904    .4101252
   _subpop_9 |   .3948445   .0820005      .2338484    .5558406
  _subpop_10 |          0  (omitted)
  _subpop_11 |   1.579163   .4846274      .6276679    2.530658
  _subpop_12 |   3.472847   1.965706     -.3865302    7.332224
  _subpop_13 |   13.74472   2.109551      9.602922    17.88651
  _subpop_14 |   .0042455    .004034     -.0036746    .0121656
  _subpop_15 |   .5025368   .1807631      .1476349    .8574387
  _subpop_16 |   .1944469   .1912349      -.181015    .5699087
  _subpop_17 |   1.644423   .5160686      .6311982    2.657649
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .3760896   .1386153      .1039387    .6482405
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |   8.072413   1.437823      5.249457    10.89537
   _subpop_2 |    8.44001   3.307874      1.945483    14.93454
     Eastern |   7.564058   1.320862      4.970739    10.15738
    Northern |   18.61466   1.740463      15.19751     22.0318
     Western |   10.10187   1.448591      7.257774    12.94597
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   1.664972   .3849497      .9091792    2.420764
   _subpop_2 |   1.871759   .7595843      .3804266    3.363092
     Eastern |   1.380312   .2119567      .9641662    1.796458
    Northern |   6.336082   .8176067      4.730831    7.941333
     Western |   2.449743   .4613507      1.543949    3.355538
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   .5337366   .1592665      .2210402    .8464331
   _subpop_2 |   .6286773   .2266789      .1836264    1.073728
     Eastern |   .3528087   .0576909       .239541    .4660764
    Northern |   3.025494   .4525318      2.137014    3.913974
     Western |   .9759679   .2736544      .4386875    1.513248
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex2 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it2.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex2 |    6775   200636622    10.50835   30.66836          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it2.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 4,741.0723       69.98       69.98
          1 | 2,033.9277       30.02      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it3.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(309111 observations deleted)
(83922 missing values generated)
83922
    0
(84010 missing values generated)
84010
(84010 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000i.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000i.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     18,924      100.00      100.00
------------+-----------------------------------
      Total |     18,924      100.00
  150
(150 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000h.tmp saved
43
43
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_i
> t3.dta saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000j.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     12,105       14.21       14.21
          3 |     73,099       85.79      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(12105 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000l.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000l.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         33        0.05        0.05
          3 |     73,099       99.95      100.00
------------+-----------------------------------
      Total |     73,132      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     73,132      100.00      100.00
------------+-----------------------------------
      Total |     73,132      100.00
(57829 observations deleted)
(10 observations deleted)
(1108 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw3 |       210    1.259735    .5164017    .870327   5.137167
    ratiomw3 |       210    1.088159    .4502595          0   4.757987
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        210      100.00      100.00
------------+-----------------------------------
      Total |        210      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it3.dta 
> saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         67       31.90       31.90
          3 |        143       68.10      100.00
------------+-----------------------------------
      Total |        210      100.00
(67 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         19       11.73       11.73
          3 |        143       88.27      100.00
------------+-----------------------------------
      Total |        162      100.00
(19 observations deleted)

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    2
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       143    92.86014    94.06198          3        671
(5 observations deleted)
(11 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26  .9016342         0  .9016342  .9016342
Central urban |        24  .8838862         0  .8838862  .8838862
      Eastern |        25  .9008324         0  .9008324  .9008324
     Northern |        25    .90746         0    .90746    .90746
      Western |        27  .9052241         0  .9052241  .9052241
--------------+--------------------------------------------------
        Total |       127  .9000324  .0081875  .8838862    .90746
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        127      100.00      100.00
------------+-----------------------------------
      Total |        127      100.00
(127 real changes made)
(121 real changes made)
(127 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26 -.0001413         0 -.0001413 -.0001413
Central urban |        24  .0000257         0  .0000257  .0000257
      Eastern |        25 -.0000128         0 -.0000128 -.0000128
     Northern |        25  .0001413         0  .0001413  .0001413
      Western |        27 -.0000514         0 -.0000514 -.0000514
--------------+--------------------------------------------------
        Total |       127 -9.71e-06  .0000934 -.0001413  .0001413
-----------------------------------------------------------------
(127 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it3.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it3.dt
> a saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(301 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000n.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000n.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it3.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
      cr_it3 |    6775   200636622    9398.417   269600.5   96.81543   5.49e+07
     linpob3 |    6775   200636622    970.0959   263.5507   749.1409   1813.468
    linpobr3 |    6775   200636622    1227.749   .0000606   1227.749    1227.75
(5964 missing values generated)
(5964 real changes made)
(5964 real changes made)
(5964 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex3 |   10.50195   .7407923      9.047508    11.95638
    pg_flex3 |   2.769997   .2275467      2.323243    3.216752
   spg_flex3 |    1.11789   .1189483      .8843522    1.351427
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
       Urban |   5.935582   2.140627      1.732774    10.13839
       Rural |   11.19943   .7905609      9.647282    12.75158
-------------+------------------------------------------------
pg_flex3     |
       Urban |   1.249367   .4527655      .3604276    2.138305
       Rural |   3.002266   .2521594      2.507188    3.497344
-------------+------------------------------------------------
spg_flex3    |
       Urban |   .4190843    .134241      .1555218    .6826469
       Rural |   1.224629   .1353736      .9588424    1.490415
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
     KAMPALA |   9.976007   5.878623     -1.565809    21.51782
   _subpop_2 |    6.12133   1.531294      3.114858    9.127801
   _subpop_3 |    7.98779   1.904684      4.248222    11.72736
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.439851   2.173988      5.171543    13.70816
   _subpop_6 |   10.75638   2.012631      6.804869    14.70788
   _subpop_7 |   67.18931   6.144878      55.12474    79.25388
   _subpop_8 |   8.680485   1.593061      5.552741    11.80823
   _subpop_9 |   14.15096   2.474739      9.292176    19.00975
  _subpop_10 |   5.810061   1.135876      3.579933    8.040188
-------------+------------------------------------------------
pg_flex3     |
     KAMPALA |   2.323133   1.199306     -.0315297    4.677795
   _subpop_2 |   1.220769   .4431719      .3506655    2.090872
   _subpop_3 |   1.591205   .4348202      .7374993    2.444911
   _subpop_4 |   1.177974    .252243      .6827315    1.673216
     EASTERN |   1.796756   .3631987      1.083669    2.509844
   _subpop_6 |    3.49946   .8590315      1.812877    5.186043
   _subpop_7 |    27.0176   3.445521      20.25282    33.78237
   _subpop_8 |   1.588265   .3881437      .8262014    2.350328
   _subpop_9 |   3.689794   .8084708       2.10248    5.277108
  _subpop_10 |   1.135638   .2947759      .5568882    1.714387
-------------+------------------------------------------------
spg_flex3    |
     KAMPALA |   .7040789   .3201452      .0755206    1.332637
   _subpop_2 |   .4190873   .1980656      .0302144    .8079602
   _subpop_3 |   .5078159   .1556441      .2022314    .8134004
   _subpop_4 |   .3558839   .0919616      .1753308    .5364369
     EASTERN |   .4378788   .0870231      .2670216    .6087359
   _subpop_6 |   1.524867   .4612339      .6193017    2.430432
   _subpop_7 |   14.04549   2.102927      9.916701    18.17428
   _subpop_8 |    .492075    .165052      .1680195    .8161306
   _subpop_9 |   1.559201   .4912716      .5946606    2.523741
  _subpop_10 |   .3578812   .1321345      .0984544    .6173081
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   9.976007   5.878623     -1.565809    21.51782
   _subpop_2 |   9.771545   2.337977      5.181268    14.36182
   _subpop_3 |   5.188173   1.655178      1.938474    8.437873
   _subpop_4 |   2.997339   1.831962     -.5994499    6.594128
   _subpop_5 |   9.018085   2.204341      4.690183    13.34599
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.817629   1.228294      3.406054    8.229205
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.893798   2.306275      5.365764    14.42183
  _subpop_10 |          0  (omitted)
  _subpop_11 |   11.92834   2.161941      7.683683    16.17299
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   69.42422   6.277828      57.09862    81.74981
  _subpop_14 |   1.923275   1.663165     -1.342107    5.188657
  _subpop_15 |   9.681504   1.712591      6.319081    13.04393
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   14.65374   2.567312      9.613201    19.69429
  _subpop_18 |          0  (omitted)
  _subpop_19 |   6.106136   1.185365      3.778845    8.433426
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   2.323133   1.199306     -.0315297    4.677795
   _subpop_2 |    1.21643   .8311178     -.4153479    2.848209
   _subpop_3 |   1.221878   .5141893      .2123423    2.231413
   _subpop_4 |   1.114331   .7544903         -.367    2.595663
   _subpop_5 |   1.689657   .4964869      .7148779    2.664437
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.243913   .2658664      .7219233    1.765903
   _subpop_8 |   .8864449   .5596679     -.2123812    1.985271
   _subpop_9 |   1.868822   .3841869      1.114528    2.623117
  _subpop_10 |          0  (omitted)
  _subpop_11 |   3.880744   .9360742      2.042899    5.718589
  _subpop_12 |   4.921385    2.78561     -.5477535    10.39052
  _subpop_13 |   27.83577   3.562112      20.84208    34.82945
  _subpop_14 |   .1351896   .1222658     -.1048614    .3752407
  _subpop_15 |   1.803525   .4497557      .9204951    2.686554
  _subpop_16 |   .8278024   .8141286     -.7706202    2.426225
  _subpop_17 |   3.868681   .8455672      2.208533    5.528828
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.193509   .3086255      .5875675     1.79945
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .7040789   .3201452      .0755206    1.332637
   _subpop_2 |    .445368   .3319452     -.2063578    1.097094
   _subpop_3 |   .4123688    .234349     -.0477412    .8724788
   _subpop_4 |   .5038213   .3479513     -.1793303    1.186973
   _subpop_5 |   .5086406   .1734643      .1680688    .8492123
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3758052   .0970268      .1853073     .566303
   _subpop_8 |   .2128296   .1341095     -.0504748     .476134
   _subpop_9 |   .4556951   .0922547      .2745664    .6368238
  _subpop_10 |          0  (omitted)
  _subpop_11 |   1.691009   .5058967      .6977548    2.684263
  _subpop_12 |   3.545266   2.006697     -.3945905    7.485123
  _subpop_13 |   14.43429   2.180025      10.15413    18.71445
  _subpop_14 |   .0097195   .0090255     -.0080007    .0274398
  _subpop_15 |   .5635316   .1927663      .1850632        .942
  _subpop_16 |   .1944692   .1912569     -.1810358    .5699743
  _subpop_17 |   1.644502   .5160787      .6312569    2.657747
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .3761185   .1386207      .1039571      .64828
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |   7.117016    1.39975      4.368811     9.86522
   _subpop_2 |   8.435161   3.308259      1.939877    14.93044
     Eastern |   7.673569   1.332494      5.057412    10.28973
    Northern |   19.18699   1.764637      15.72238    22.65159
     Western |   10.10187   1.448591      7.257774    12.94597
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   1.457464   .3584804      .7536397    2.161288
   _subpop_2 |   1.777528   .7292504      .3457519    3.209305
     Eastern |   1.518697   .2336083      1.060041    1.977353
    Northern |   6.659731   .8376702      5.015088    8.304374
     Western |   2.449879   .4613628       1.54406    3.355697
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   .4608537   .1455774      .1750338    .7466737
   _subpop_2 |   .5940828   .2127799      .1763206    1.011845
     Eastern |   .4010331   .0635512      .2762596    .5258066
    Northern |    3.20217   .4709665      2.277496    4.126844
     Western |     .97602   .2736602      .4387281    1.513312
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex3 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it3.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex3 |    6775   200636622    10.50195   30.66011          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it3.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 4,741.6588       69.99       69.99
          1 | 2,033.3412       30.01      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it4.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(309393 observations deleted)
(83671 missing values generated)
83671
    0
(83759 missing values generated)
83759
(83759 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000p.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000p.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     18,893      100.00      100.00
------------+-----------------------------------
      Total |     18,893      100.00
  151
(151 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000o.tmp saved
42
42
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_i
> t4.dta saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000q.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     12,221       14.34       14.34
          3 |     72,983       85.66      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(12221 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000s.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000s.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         33        0.05        0.05
          3 |     72,983       99.95      100.00
------------+-----------------------------------
      Total |     73,016      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     73,016      100.00      100.00
------------+-----------------------------------
      Total |     73,016      100.00
(57772 observations deleted)
(10 observations deleted)
(1093 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw4 |       205    1.261666    .5168811   .8739076   5.137167
    ratiomw4 |       205    1.086445    .4467243          0   4.757987
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        205      100.00      100.00
------------+-----------------------------------
      Total |        205      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it4.dta 
> saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         63       30.73       30.73
          3 |        142       69.27      100.00
------------+-----------------------------------
      Total |        205      100.00
(63 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         20       12.35       12.35
          3 |        142       87.65      100.00
------------+-----------------------------------
      Total |        162      100.00
(20 observations deleted)

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    3
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       142    93.64789    96.12729          3        694
(6 observations deleted)
(9 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27  .9010487         0  .9010487  .9010487
Central urban |        23  .8832319         0  .8832319  .8832319
      Eastern |        25  .9017419         0  .9017419  .9017419
     Northern |        25  .9071653         0  .9071653  .9071653
      Western |        27  .9053821         0  .9053821  .9053821
--------------+--------------------------------------------------
        Total |       127  .9000838  .0082794  .8832319  .9071653
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        127      100.00      100.00
------------+-----------------------------------
      Total |        127      100.00
(127 real changes made)
(121 real changes made)
(127 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        27 -.0001413         0 -.0001413 -.0001413
Central urban |        23  .0000257         0  .0000257  .0000257
      Eastern |        25  .0002441         0  .0002441  .0002441
     Northern |        25  .0001413         0  .0001413  .0001413
      Western |        27 -.0000514         0 -.0000514 -.0000514
--------------+--------------------------------------------------
        Total |       127  .0000396  .0001385 -.0001413  .0002441
-----------------------------------------------------------------
(127 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it4.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it4.dt
> a saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(304 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000u.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000u.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it4.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
      cr_it4 |    6775   200636622    9398.417   271963.4   97.19878   5.54e+07
     linpob4 |    6775   200636622    974.1847   264.9941   736.4574   1805.731
    linpobr4 |    6775   200636622    1233.459   .0000488   1233.459   1233.459
(5967 missing values generated)
(5967 real changes made)
(5967 real changes made)
(5967 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex4 |   10.48665   .7479901      9.018079    11.95522
    pg_flex4 |   2.769231   .2265971      2.324341    3.214122
   spg_flex4 |   1.109387   .1175555      .8785844    1.340191
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
       Urban |    4.94745   2.119762      .7856074    9.109292
       Rural |   11.33273    .791444      9.778846    12.88662
-------------+------------------------------------------------
pg_flex4     |
       Urban |   1.231244   .4467961      .3540252    2.108463
       Rural |   3.004151    .251152       2.51105    3.497251
-------------+------------------------------------------------
spg_flex4    |
       Urban |   .4126656    .131732       .154029    .6713022
       Rural |   1.215808   .1337694      .9531714    1.478445
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
     KAMPALA |   9.907824   5.884464     -1.645461    21.46111
   _subpop_2 |   5.145556   1.460126      2.278812      8.0123
   _subpop_3 |    9.29268   1.973999       5.41702    13.16834
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.635651   2.184211      5.347273    13.92403
   _subpop_6 |     10.461   1.988955      6.555977    14.36602
   _subpop_7 |   66.03299   5.981197      54.28979     77.7762
   _subpop_8 |   8.518069   1.600974      5.374791    11.66135
   _subpop_9 |   14.15096   2.474739      9.292176    19.00975
  _subpop_10 |   5.810061   1.135876      3.579933    8.040188
-------------+------------------------------------------------
pg_flex4     |
     KAMPALA |   2.290465   1.179786     -.0258723    4.606803
   _subpop_2 |   1.345627   .4718101      .4192968    2.271957
   _subpop_3 |   1.851721   .4772415      .9147265    2.788715
   _subpop_4 |   1.184964   .2534243      .6874023    1.682526
     EASTERN |   1.809366   .3658534      1.091067    2.527666
   _subpop_6 |   3.377241   .8433397      1.721466    5.033015
   _subpop_7 |   26.33432   3.403151      19.65273    33.01591
   _subpop_8 |   1.466722   .3785361      .7235214    2.209922
   _subpop_9 |   3.696989   .8092351      2.108174    5.285804
  _subpop_10 |   1.138852   .2951588      .5593513    1.718354
-------------+------------------------------------------------
spg_flex4    |
     KAMPALA |   .6903151   .3131721      .0754475    1.305183
   _subpop_2 |   .4718567   .2146037      .0505138    .8931997
   _subpop_3 |   .5911584   .1748609      .2478445    .9344722
   _subpop_4 |   .3585466   .0923923      .1771478    .5399453
     EASTERN |   .4422818   .0877769      .2699446    .6146189
   _subpop_6 |   1.458394   .4483612      .5781023    2.338686
   _subpop_7 |   13.60665   2.058245      9.565583    17.64771
   _subpop_8 |   .4560911   .1583187      .1452556    .7669267
   _subpop_9 |   1.562135   .4916522      .5968479    2.527422
  _subpop_10 |   .3589529   .1323346      .0991332    .6187725
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   9.907824   5.884464     -1.645461    21.46111
   _subpop_2 |   3.574867   2.438602     -1.212972    8.362705
   _subpop_3 |   5.547094   1.673964       2.26051    8.833678
   _subpop_4 |   2.997339   1.831962     -.5994499    6.594128
   _subpop_5 |   10.59237   2.263892      6.147553    15.03719
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.817629   1.228294      3.406054    8.229205
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |    10.1051   2.316319      5.557344    14.65285
  _subpop_10 |          0  (omitted)
  _subpop_11 |   11.60078    2.13784      7.403442    15.79811
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   68.22508   6.101317      56.24603    80.20412
  _subpop_14 |   1.923275   1.663165     -1.342107    5.188657
  _subpop_15 |   9.495028   1.722226      6.113689    12.87637
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   14.65374   2.567312      9.613201    19.69429
  _subpop_18 |          0  (omitted)
  _subpop_19 |   6.106136   1.185365      3.778845    8.433426
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   2.290465   1.179786     -.0258723    4.606803
   _subpop_2 |   1.183612   .8335318     -.4529059     2.82013
   _subpop_3 |   1.387045   .5482638      .3106095    2.463481
   _subpop_4 |   1.106263   .7500884     -.3664257    2.578952
   _subpop_5 |   2.005623   .5469232      .9318188    3.079426
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.251295   .2671075      .7268682    1.775721
   _subpop_8 |    .890995    .562555     -.2134996     1.99549
   _subpop_9 |    1.88207   .3869947      1.122263    2.641878
  _subpop_10 |          0  (omitted)
  _subpop_11 |   3.745208   .9195678      1.939771    5.550645
  _subpop_12 |   4.888485   2.766988     -.5440917    10.32106
  _subpop_13 |   27.12841   3.519226      20.21892     34.0379
  _subpop_14 |   .1043946   .0957943     -.0836835    .2924728
  _subpop_15 |   1.668538   .4401591        .80435    2.532726
  _subpop_16 |   .8314331   .8176994     -.7740001    2.436866
  _subpop_17 |   3.876098   .8463458      2.214422    5.537774
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.196887   .3090225      .5901667    1.803608
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .6903151   .3131721      .0754475    1.305183
   _subpop_2 |    .438901   .3276818     -.2044544    1.082256
   _subpop_3 |   .4802817   .2554013     -.0211615    .9817249
   _subpop_4 |   .4986129   .3445152     -.1777922    1.175018
   _subpop_5 |   .6102647   .1978697      .2217765    .9987528
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3786169   .0974803      .1872286    .5700052
   _subpop_8 |   .2150095   .1354833     -.0509921    .4810111
   _subpop_9 |   .4602741   .0930456      .2775926    .6429556
  _subpop_10 |          0  (omitted)
  _subpop_11 |   1.617293   .4919708      .6513808    2.583206
  _subpop_12 |   3.498025   1.979958     -.3893325    7.385382
  _subpop_13 |   13.98094   2.133944      9.791256    18.17063
  _subpop_14 |   .0058909   .0055493     -.0050044    .0167862
  _subpop_15 |   .5227842   .1849227      .1597155    .8858529
  _subpop_16 |   .1953425   .1921158     -.1818488    .5725339
  _subpop_17 |   1.647565   .5164728      .6335465    2.661584
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .3772448   .1388298      .1046728    .6498168
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |   8.088027   1.437815      5.265088    10.91097
   _subpop_2 |   6.787109   3.417767      .0768232    13.49739
     Eastern |   7.781384   1.338286      5.153855    10.40891
    Northern |   18.79718   1.745825      15.36951    22.22486
     Western |   10.10187   1.448591      7.257774    12.94597
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   1.698577   .3890315      .9347704    2.462383
   _subpop_2 |   1.750066   .7199175      .3366128    3.163518
     Eastern |   1.528781   .2351812      1.067038    1.990525
    Northern |   6.446955   .8244895      4.828191     8.06572
     Western |   2.455141   .4618327        1.5484    3.361882
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   .5457445   .1614286      .2288029     .862686
   _subpop_2 |   .5840412   .2087059      .1742776    .9938048
     Eastern |    .404654    .064001      .2789975    .5303106
    Northern |   3.085736   .4588996      2.184754    3.986718
     Western |   .9780502    .273889      .4403092    1.515791
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex4 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it4.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex4 |    6775   200636622    10.48665   30.64039          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it4.dta saved
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

   relpoor5 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 4,740.2528       69.97       69.97
          1 | 2,034.7472       30.03      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\relpoor_it5.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(0 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    412,045      100.00      100.00
------------+-----------------------------------
      Total |    412,045      100.00
(309569 observations deleted)
(83554 missing values generated)
83554
    0
(83642 missing values generated)
83642
(83642 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp saved
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000w.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000w.tmp saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     18,834      100.00      100.00
------------+-----------------------------------
      Total |     18,834      100.00
  151
(151 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000v.tmp saved
42
42
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\codes_food_basket_flex_i
> t5.dta saved
(4392 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         14        0.02        0.02
          3 |     85,204       99.98      100.00
------------+-----------------------------------
      Total |     85,218      100.00
(14 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000x.tmp saved
variable product does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     12,221       14.34       14.34
          3 |     72,983       85.66      100.00
------------+-----------------------------------
      Total |     85,204      100.00
(12221 observations deleted)
(0 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000011.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000011.tmp saved
product was float now int
unit was float now byte
food_cat was float now byte
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
count was float now byte
descript was float now byte
hhsize was double now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
reg_tpi was byte now float
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         33        0.05        0.05
          3 |     72,983       99.95      100.00
------------+-----------------------------------
      Total |     73,016      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     73,016      100.00      100.00
------------+-----------------------------------
      Total |     73,016      100.00
(57824 observations deleted)
(10 observations deleted)
(1100 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw5 |       205     1.26267    .5179618   .8739076   5.137167
    ratiomw5 |       205     1.08319    .4469374          0   4.757987
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        205      100.00      100.00
------------+-----------------------------------
      Total |        205      100.00
    0
(0 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\price_unit_flex_it5.dta 
> saved
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         63       30.73       30.73
          3 |        142       69.27      100.00
------------+-----------------------------------
      Total |        205      100.00
(63 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         20       12.35       12.35
          3 |        142       87.65      100.00
------------+-----------------------------------
      Total |        162      100.00
(20 observations deleted)

-------------------------------------------------------------------------------------
-> spdomain = Central rural
    2
-------------------------------------------------------------------------------------
-> spdomain = Central urban
    3
-------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
-------------------------------------------------------------------------------------
-> spdomain = Northern
    0
-------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       142     93.3169    93.79337          3        671
(5 observations deleted)
(11 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26    .90294         0    .90294    .90294
Central urban |        23  .8832319         0  .8832319  .8832319
      Eastern |        25  .9015438         0  .9015438  .9015438
     Northern |        25    .90746         0    .90746    .90746
      Western |        27  .9051858         0  .9051858  .9051858
--------------+--------------------------------------------------
        Total |       126  .9004435  .0084113  .8832319    .90746
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        126      100.00      100.00
------------+-----------------------------------
      Total |        126      100.00
(126 real changes made)
(120 real changes made)
(126 real changes made)

Summary for variables: chkcal
     by categories of: spdomain 

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central rural |        26  .0001156         0  .0001156  .0001156
Central urban |        23  .0000257         0  .0000257  .0000257
      Eastern |        25 -.0000128         0 -.0000128 -.0000128
     Northern |        25  .0001413         0  .0001413  .0001413
      Western |        27 -.0000514         0 -.0000514 -.0000514
--------------+--------------------------------------------------
        Total |       126   .000043  .0000751 -.0000514  .0001413
-----------------------------------------------------------------
(126 real changes made)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\quan_flex_it5.dta saved
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povline_food_flex_it5.dt
> a saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(301 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000013.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000013.tmp saved
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines_it5.dta
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00
(6775 real changes made)
(6775 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
      cr_it5 |    6775   200636622    9398.417   270132.6   96.52637   5.51e+07
     linpob5 |    6775   200636622    968.7896   261.5658   749.1409   1805.731
    linpobr5 |    6775   200636622    1225.005    .000061   1225.005   1225.005
(5967 missing values generated)
(5967 real changes made)
(5967 real changes made)
(5967 real changes made)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex5 |   10.32401   .7461413      8.859073    11.78895
    pg_flex5 |   2.764118    .227282      2.317883    3.210353
   spg_flex5 |   1.115803   .1188942      .8823718    1.349234
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
       Urban |    4.94745   2.119762      .7856074    9.109292
       Rural |   11.14525    .789792      9.594612    12.69589
-------------+------------------------------------------------
pg_flex5     |
       Urban |   1.232934   .4467914      .3557245    2.110144
       Rural |   2.997998   .2520344      2.503165     3.49283
-------------+------------------------------------------------
spg_flex5    |
       Urban |   .4130296   .1318118      .1542364    .6718227
       Rural |   1.223148   .1353564      .9573954    1.488901
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
     KAMPALA |   9.907824   5.884464     -1.645461    21.46111
   _subpop_2 |    4.85971   1.438562      2.035305    7.684116
   _subpop_3 |   7.512885   1.868625      3.844112    11.18166
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.439851   2.173988      5.171543    13.70816
   _subpop_6 |   10.75638   2.012631      6.804869    14.70788
   _subpop_7 |   67.18931   6.144878      55.12474    79.25388
   _subpop_8 |   8.680485   1.593061      5.552741    11.80823
   _subpop_9 |   14.15096   2.474739      9.292176    19.00975
  _subpop_10 |   5.810061   1.135876      3.579933    8.040188
-------------+------------------------------------------------
pg_flex5     |
     KAMPALA |   2.290466   1.179787     -.0258725    4.606805
   _subpop_2 |   1.200881   .4410062      .3350302    2.066733
   _subpop_3 |   1.565334   .4302438      .7206134    2.410055
   _subpop_4 |   1.175216    .251778      .6808865    1.669545
     EASTERN |    1.79189   .3621503      1.080861    2.502919
   _subpop_6 |    3.49946   .8590315      1.812877    5.186043
   _subpop_7 |    27.0176   3.445521      20.25282    33.78237
   _subpop_8 |   1.588265   .3881438      .8262012    2.350328
   _subpop_9 |   3.697665    .809307      2.108709    5.286621
  _subpop_10 |   1.139154   .2951948      .5595824    1.718726
-------------+------------------------------------------------
spg_flex5    |
     KAMPALA |   .6903154   .3131723      .0754475    1.305183
   _subpop_2 |   .4124241   .1961382      .0273355    .7975127
   _subpop_3 |    .498827   .1535069      .1974386    .8002154
   _subpop_4 |   .3548384   .0917924      .1746174    .5350594
     EASTERN |   .4361508   .0867279      .2658732    .6064284
   _subpop_6 |   1.524867   .4612339      .6193017    2.430432
   _subpop_7 |   14.04549   2.102927      9.916701    18.17428
   _subpop_8 |    .492075   .1650521      .1680194    .8161306
   _subpop_9 |   1.562411    .491688      .5970536    2.527769
  _subpop_10 |   .3590537   .1323534      .0991971    .6189103
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

         Over: strata rural
    _subpop_1: KAMPALA Urban
    _subpop_2: CENTRAL 1 Urban
    _subpop_3: CENTRAL 1 Rural
    _subpop_4: CENTRAL 2 Urban
    _subpop_5: CENTRAL 2 Rural
    _subpop_6: EAST CENTRAL Urban
    _subpop_7: EAST CENTRAL Rural
    _subpop_8: EASTERN Urban
    _subpop_9: EASTERN Rural
   _subpop_10: MID-NOTHERN Urban
   _subpop_11: MID-NOTHERN Rural
   _subpop_12: NORTH-EAST Urban
   _subpop_13: NORTH-EAST Rural
   _subpop_14: WEST-NILE Urban
   _subpop_15: WEST-NILE Rural
   _subpop_16: MID-WESTERN Urban
   _subpop_17: MID-WESTERN Rural
   _subpop_18: SOUTH-WESTERN Urban
   _subpop_19: SOUTH-WESTERN Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   9.907824   5.884464     -1.645461    21.46111
   _subpop_2 |   3.574867   2.438602     -1.212972    8.362705
   _subpop_3 |   5.188173   1.655178      1.938474    8.437873
   _subpop_4 |   2.997339   1.831962     -.5994499    6.594128
   _subpop_5 |   8.445135   2.167316      4.189927    12.70034
   _subpop_6 |          0  (omitted)
   _subpop_7 |   5.817629   1.228294      3.406054    8.229205
   _subpop_8 |   3.705768   2.352816     -.9136424    8.325178
   _subpop_9 |   9.893798   2.306275      5.365764    14.42183
  _subpop_10 |          0  (omitted)
  _subpop_11 |   11.92834   2.161941      7.683683    16.17299
  _subpop_12 |   6.831652   3.866863     -.7603675    14.42367
  _subpop_13 |   69.42422   6.277828      57.09862    81.74981
  _subpop_14 |   1.923275   1.663165     -1.342107    5.188657
  _subpop_15 |   9.681504   1.712591      6.319081    13.04393
  _subpop_16 |   6.107057    6.00618     -5.685199    17.89931
  _subpop_17 |   14.65374   2.567312      9.613201    19.69429
  _subpop_18 |          0  (omitted)
  _subpop_19 |   6.106136   1.185365      3.778845    8.433426
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   2.290466   1.179787     -.0258725    4.606805
   _subpop_2 |   1.183612    .833532      -.452906    2.820131
   _subpop_3 |   1.205296   .5106259      .2027567    2.207836
   _subpop_4 |   1.106263   .7500885     -.3664258    2.578953
   _subpop_5 |   1.660111   .4911945      .6957223    2.624499
   _subpop_6 |          0  (omitted)
   _subpop_7 |   1.241001   .2653779      .7199701    1.762032
   _subpop_8 |   .8846497   .5585288     -.2119399    1.981239
   _subpop_9 |   1.863713   .3830773      1.111596    2.615829
  _subpop_10 |          0  (omitted)
  _subpop_11 |   3.880744   .9360742      2.042899    5.718589
  _subpop_12 |   4.921385    2.78561     -.5477535    10.39052
  _subpop_13 |   27.83577   3.562112      20.84208    34.82945
  _subpop_14 |   .1351895   .1222657     -.1048613    .3752402
  _subpop_15 |   1.803525   .4497558      .9204948    2.686554
  _subpop_16 |   .8317741   .8180347     -.7743175    2.437866
  _subpop_17 |   3.876795    .846419      2.214975    5.538615
  _subpop_18 |          0  (omitted)
  _subpop_19 |   1.197204   .3090599      .5904106    1.803998
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .6903154   .3131723      .0754475    1.305183
   _subpop_2 |   .4389012    .327682     -.2044545    1.082257
   _subpop_3 |   .4056554   .2321708      -.050178    .8614889
   _subpop_4 |    .498613   .3445152     -.1777922    1.175018
   _subpop_5 |   .4988711   .1709946      .1631482    .8345941
   _subpop_6 |          0  (omitted)
   _subpop_7 |   .3747011   .0968487       .184553    .5648493
   _subpop_8 |   .2119726   .1335695     -.0502715    .4742168
   _subpop_9 |   .4538982    .091945      .2733775    .6344188
  _subpop_10 |          0  (omitted)
  _subpop_11 |   1.691009   .5058967      .6977548    2.684263
  _subpop_12 |   3.545266   2.006697     -.3945905    7.485123
  _subpop_13 |   14.43429   2.180025      10.15413    18.71445
  _subpop_14 |   .0097195   .0090255     -.0080007    .0274397
  _subpop_15 |   .5635316   .1927663      .1850631    .9420001
  _subpop_16 |   .1954248   .1921967     -.1819254    .5727749
  _subpop_17 |   1.647854   .5165099      .6337619    2.661945
  _subpop_18 |          0  (omitted)
  _subpop_19 |   .3773508   .1388494      .1047402    .6499613
--------------------------------------------------------------
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |   6.828463    1.38225      4.114618    9.542309
   _subpop_2 |   6.787109   3.417767      .0768232    13.49739
     Eastern |   7.673569   1.332494      5.057412    10.28973
    Northern |   19.18699   1.764637      15.72238    22.65159
     Western |   10.10187   1.448591      7.257774    12.94597
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   1.434353   .3552984      .7367762    2.131929
   _subpop_2 |   1.750066   .7199178      .3366128    3.163519
     Eastern |   1.514778    .232988       1.05734    1.972216
    Northern |   6.659731   .8376703      5.015088    8.304374
     Western |   2.455635   .4618769      1.548808    3.362463
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   .4526013   .1439603      .1699563    .7352462
   _subpop_2 |   .5840414    .208706      .1742776    .9938052
     Eastern |   .3996118    .063375      .2751842    .5240394
    Northern |    3.20217   .4709665      2.277496    4.126844
     Western |   .9782411   .2739105      .4404579    1.516024
--------------------------------------------------------------
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_flex5 was float now byte
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real_it5.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex5 |    6775   200636622    10.32401   30.42947          0        100
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/foodshares_it5.dta saved

. **************************************************************************
> * Send results to one big csv-file
> **************************************************************************;
. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         gen dum=1;

.         collapse (mean) dum h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [
> aw=popwt];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000014.tmp saved

.         use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=p
> opwt], by(rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000015.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=p
> opwt], by(news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000016.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=p
> opwt], by(reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000017.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=p
> opwt], by(strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000018.tmp saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=p
> opwt], by(spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000019.tmp saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001a.tmp saved

. use          `nat';

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' dum rural 
> news reg_tpi strata spdomain using "$path\work\poverty_flexBask.csv", replace c;

. **************************************************************************
> * Convergence graph (based on 5 iterations)
> **************************************************************************;
. #delimit cr
delimiter now cr
. 
. clear

. set obs 1
obs was 0, now 1

. gen iteration=.
(1 missing value generated)

. tempfile converg

. save `converg'
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved

. 
. forvalues X = 1/5 {
  2.         use "$path/work/cons_real_it`X'.dta", clear
  3.         collapse (mean) h_flex`X' pg_flex`X' spg_flex`X' [aw=popwt], by(strata)
  4.         rename h_flex`X' h_flex
  5.         rename pg_flex`X' pg_flex
  6.         rename spg_flex`X' spg_flex
  7.         gen iteration=`X'
  8.         order iteration
  9.         *sum
.         if `X' != 1     {
 10.                 append using `converg'
 11.                         }
 12.         save `converg', replace
 13.         }
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved
(label STRA already defined)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00001b.tmp saved

. 
. use `converg', clear

. sum

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   iteration |        50           3    1.428571          1          5
      strata |        50         5.5    2.901442          1         10
      h_flex |        50    16.71765    20.48663   4.859711    87.6499
     pg_flex |        50    6.460249    12.54333   1.080393   74.67818
    spg_flex |        50     3.77723    10.00927    .320314    65.9864

. 
. twoway (connected h_flex iteration), by(, title(Convergence graph: Poverty rate. %)
>  subtitle(After iterative procedure)) by(strata)

. graph export "$path/work/converge_pov_rate.tif", replace
(file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/converge_pov_rate.tif w
> ritten in TIFF format)

. 
. sort strata iteration

. 
. for var h_flex pg_flex spg_flex: replace X = round(X,0.01)

->  replace h_flex = round(h_flex,0.01)
(50 real changes made)

->  replace pg_flex = round(pg_flex,0.01)
(50 real changes made)

->  replace spg_flex = round(spg_flex,0.01)
(50 real changes made)

. 
. list strata iteration h_flex pg_flex spg_flex

     +--------------------------------------------------------+
     |        strata   iterat~n   h_flex   pg_flex   spg_flex |
     |--------------------------------------------------------|
  1. |       KAMPALA          1    87.65     74.68      65.99 |
  2. |       KAMPALA          2     9.99      2.43        .75 |
  3. |       KAMPALA          3     9.98      2.32         .7 |
  4. |       KAMPALA          4     9.91      2.29        .69 |
  5. |       KAMPALA          5     9.91      2.29        .69 |
     |--------------------------------------------------------|
  6. |     CENTRAL 1          1    23.83     16.21      12.76 |
  7. |     CENTRAL 1          2     6.38      1.36        .47 |
  8. |     CENTRAL 1          3     6.12      1.22        .42 |
  9. |     CENTRAL 1          4     5.15      1.35        .47 |
 10. |     CENTRAL 1          5     4.86       1.2        .41 |
     |--------------------------------------------------------|
 11. |     CENTRAL 2          1    24.63      14.1      11.03 |
 12. |     CENTRAL 2          2     9.29      1.82        .58 |
 13. |     CENTRAL 2          3     7.99      1.59        .51 |
 14. |     CENTRAL 2          4     9.29      1.85        .59 |
 15. |     CENTRAL 2          5     7.51      1.57         .5 |
     |--------------------------------------------------------|
 16. |  EAST CENTRAL          1     5.51      1.17        .35 |
 17. |  EAST CENTRAL          2     5.45      1.08        .32 |
 18. |  EAST CENTRAL          3     5.51      1.18        .36 |
 19. |  EAST CENTRAL          4     5.51      1.18        .36 |
 20. |  EAST CENTRAL          5     5.51      1.18        .35 |
     |--------------------------------------------------------|
 21. |       EASTERN          1     9.44      1.78        .43 |
 22. |       EASTERN          2     9.29      1.63        .38 |
 23. |       EASTERN          3     9.44       1.8        .44 |
 24. |       EASTERN          4     9.64      1.81        .44 |
 25. |       EASTERN          5     9.44      1.79        .44 |
     |--------------------------------------------------------|
 26. |   MID-NOTHERN          1    10.76      3.47       1.51 |
 27. |   MID-NOTHERN          2    10.46      3.31       1.42 |
 28. |   MID-NOTHERN          3    10.76       3.5       1.52 |
 29. |   MID-NOTHERN          4    10.46      3.38       1.46 |
 30. |   MID-NOTHERN          5    10.76       3.5       1.52 |
     |--------------------------------------------------------|
 31. |    NORTH-EAST          1    66.94     26.87      13.95 |
 32. |    NORTH-EAST          2    65.54     25.98      13.38 |
 33. |    NORTH-EAST          3    67.19     27.02      14.05 |
 34. |    NORTH-EAST          4    66.03     26.33      13.61 |
 35. |    NORTH-EAST          5    67.19     27.02      14.05 |
     |--------------------------------------------------------|
 36. |     WEST-NILE          1     8.68      1.56        .48 |
 37. |     WEST-NILE          2     8.22       1.4        .44 |
 38. |     WEST-NILE          3     8.68      1.59        .49 |
 39. |     WEST-NILE          4     8.52      1.47        .46 |
 40. |     WEST-NILE          5     8.68      1.59        .49 |
     |--------------------------------------------------------|
 41. |   MID-WESTERN          1    14.15      3.69       1.56 |
 42. |   MID-WESTERN          2    14.15      3.69       1.56 |
 43. |   MID-WESTERN          3    14.15      3.69       1.56 |
 44. |   MID-WESTERN          4    14.15       3.7       1.56 |
 45. |   MID-WESTERN          5    14.15       3.7       1.56 |
     |--------------------------------------------------------|
 46. | SOUTH-WESTERN          1     5.81      1.14        .36 |
 47. | SOUTH-WESTERN          2     5.81      1.14        .36 |
 48. | SOUTH-WESTERN          3     5.81      1.14        .36 |
 49. | SOUTH-WESTERN          4     5.81      1.14        .36 |
 50. | SOUTH-WESTERN          5     5.81      1.14        .36 |
     +--------------------------------------------------------+

.         
. #delimit ;
delimiter now ;
. **************************************************************************
> * 140_iterate.do        (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.                                 
. $no_temp_rev    do "$path/new/150_price_unit_fix.do"    /* Fixed basket: Prices */

. $no_temp_rev    do "$path/new/160_food_basket_fix.do"   /* Fixed food basket */

.                                 do "$path/new/170_pref_r_price.do"              /* 
> Revealed preference tests */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/170_pref_r_price.log", replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/170_pref_r_price.
> log
  log type:  text
 opened on:  20 May 2013, 17:28:21

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparisons so that
> * we can check the quality of the regional baskets.
> * It also exports the price and quantity data for work in GAMS
> * Rather than make up for missing prices with shares, we estimate
> * a missing price in this case
> **************************************************************************;
. *global n_spdom "5";
. *global it_n "5";
. /*
> This file uses:
>         work\quan_flex_it$it_n.dta
>         work\povline_food_flex_it$it_n.dta
>         work\price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work\pref_r_price.dta
>         work\revpref_price_`i'.dta
>         work\product_flex.inc
>         work\price_unit_flex.inc
>         work\quan_flex.inc
> */
> 
> 
> 
> ***************************************************************************;
. * Export price, codes and quantity data to text
> ***************************************************************************;
. use "$path\work\price_unit_flex_it$it_n.dta";

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n using "$path\work\price_unit_flex.inc"
> ,  noquote noname replace ;

. collapse (min) spdomain, by(product);

. outsheet product  using "$path\work\product_flex.inc", noname replace;

. use "$path\work\quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  calpp povline_f_flex90_$it_n using "$
> path\work\quan_flex.inc", noname noquote replace;

. clear;

. **************************************************************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> **************************************************************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path\work\pref_r_price.dta", replace;
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path\work\revpref_price_`i'.dta", replace;
  5.         clear;
  6.                 use "$path\work\quan_flex_it$it_n.dta", clear;
  7.                 keep product spdomain quan$it_n price_uw$it_n val_ir$it_n povlin
> e_f_flex90_$it_n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90_$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quantities to hit constant calorie targ
> et;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescaled to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **************************************************************************;
. * Now get the prices in other regions so that you can use them 
> * to build  a new poverty line
> **************************************************************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path\work\price_unit_flex_it$it_n.dta";
 19.                                 keep product spdomain price_uw$it_n descript cou
> nt bswt;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with the fact that not all commodities
>  are consumed in every region;
.                 *so we might have a quantity from region i but no price in region j
> ;
.                 *these will have _merge value=2;
.                 *alternatively the number of observations might be too small;
.                 *deal with these problems by TAKING THE MAX PRICE OBSERVED ELSEWHER
> E (excluding Maputo)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified to handle the counting of bswt inst
> ead of count
>                   replace price_uw$it_n=. if round(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==2 ;
 27.                   replace pricemiss=1 if _m==2 | round(bswt)<5;
 28.                         lab var pricemiss "identify those items with no price ob
> servation";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing observed quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             sort product;
 35.                                             *this file contains the price codes 
> that are missing for the region in question;
.                             save `codmiss', replace;
 36. *browse;
.                                   use "$path\work\price_unit_flex_it$it_n.dta", cle
> ar;
 37.                         sort product;
 38. *browse;
.                         merge product using `codmiss';
 39.                                                 tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maputo province and city from other pri
> ce calculation;
.                                 drop if spdomain>10;
 42.                         collapse (max) price_uw$it_n, by(product);
 43.                   *this file contains the code and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product using `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                                             else use `getmiss', 
> clear;
 50.                         gen val_q=quan_s*price_uw$it_n;
 51.                                                 collapse (sum) val_q pricemiss (
> mean) spdomainq ratquan, by(spdomain);
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path\work\revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path\work\revpref_price_`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path\work\pref_r_price.dta";
 59.       sort spdomain spdomainq;
 60.       save "$path\work\pref_r_price.dta", replace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
(100 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(163 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
(168 observations deleted)
(label spdomain_original already defined)
(11 observations deleted)
(0 real changes made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(24 observations deleted)
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        195       95.12       95.12
          3 |         10        4.88      100.00
------------+-----------------------------------
      Total |        205      100.00
(195 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       92.31       92.31
          3 |          2        7.69      100.00
------------+-----------------------------------
      Total |         26      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        200       97.56       97.56
          3 |          5        2.44      100.00
------------+-----------------------------------
      Total |        205      100.00
(200 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25       96.15       96.15
          3 |          1        3.85      100.00
------------+-----------------------------------
      Total |         26      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(3 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        190       92.68       92.68
          3 |         15        7.32      100.00
------------+-----------------------------------
      Total |        205      100.00
(190 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       88.46       88.46
          3 |          3       11.54      100.00
------------+-----------------------------------
      Total |         26      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(26 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_1.dta save
> d
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(103 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(163 observations deleted)
(label spdomain_original already defined)
(19 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(168 observations deleted)
(label spdomain_original already defined)
(14 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(19 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(22 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        200       97.56       97.56
          3 |          5        2.44      100.00
------------+-----------------------------------
      Total |        205      100.00
(200 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       95.65       95.65
          3 |          1        4.35      100.00
------------+-----------------------------------
      Total |         23      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(19 observations deleted)
(0 real changes made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(21 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        195       95.12       95.12
          3 |         10        4.88      100.00
------------+-----------------------------------
      Total |        205      100.00
(195 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(19 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_2.dta save
> d
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(101 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        196       95.61       95.61
          3 |          9        4.39      100.00
------------+-----------------------------------
      Total |        205      100.00
(196 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       92.00       92.00
          3 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(168 observations deleted)
(label spdomain_original already defined)
(13 observations deleted)
(1 real change made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        196       95.61       95.61
          3 |          9        4.39      100.00
------------+-----------------------------------
      Total |        205      100.00
(196 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       92.00       92.00
          3 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(1 missing value generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_3.dta save
> d
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(101 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(5 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(20 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        182       88.78       88.78
          3 |         23       11.22      100.00
------------+-----------------------------------
      Total |        205      100.00
(182 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         20       80.00       80.00
          3 |          5       20.00      100.00
------------+-----------------------------------
      Total |         25      100.00
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(168 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(3 real changes made)
(7 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(18 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        173       84.39       84.39
          3 |         32       15.61      100.00
------------+-----------------------------------
      Total |        205      100.00
(173 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         18       72.00       72.00
          3 |          7       28.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(3 missing values generated)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(24 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        200       97.56       97.56
          3 |          5        2.44      100.00
------------+-----------------------------------
      Total |        205      100.00
(200 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       96.00       96.00
          3 |          1        4.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(17 observations deleted)
(0 real changes made)
(1 real change made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(24 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        201       98.05       98.05
          3 |          4        1.95      100.00
------------+-----------------------------------
      Total |        205      100.00
(201 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       96.00       96.00
          3 |          1        4.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_4.dta save
> d
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved
(note: dataset contains 0 observations)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(99 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved
(163 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(168 observations deleted)
(label spdomain_original already defined)
(10 observations deleted)
(0 real changes made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        195       95.12       95.12
          3 |         10        4.88      100.00
------------+-----------------------------------
      Total |        205      100.00
(195 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25       92.59       92.59
          3 |          2        7.41      100.00
------------+-----------------------------------
      Total |         27      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(2 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(25 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        195       95.12       95.12
          3 |         10        4.88      100.00
------------+-----------------------------------
      Total |        205      100.00
(195 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25       92.59       92.59
          3 |          2        7.41      100.00
------------+-----------------------------------
      Total |         27      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(4 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(23 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved
variable product does not uniquely identify observations in the master data
(label spdomain_original already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        185       90.24       90.24
          3 |         20        9.76      100.00
------------+-----------------------------------
      Total |        205      100.00
(185 observations deleted)
(0 observations deleted)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       85.19       85.19
          3 |          4       14.81      100.00
------------+-----------------------------------
      Total |         27      100.00
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(163 observations deleted)
(label spdomain_original already defined)
(15 observations deleted)
(0 real changes made)
(0 real changes made)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved
(27 observations deleted)
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\revpref_price_5.dta save
> d
(label spdomain_original already defined)
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. *bring in actual flexible bundle numbers;
. use "$path\work\povline_food_flex_it$it_n.dta", clear;

.         merge spdomain using "$path\work\pref_r_price.dta";
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta
(label spdomain_original already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

.          drop crap;

.         drop _m;

.         order spdomainq spdomain;

.       sort spdomainq spdomain;

.         *rescale expenditures to hit a constant calorie target;
.         gen povline_f5_s=ratquan*povline_f_flex90_$it_n;

.       compress;
spdomainq was float now byte
spdomain was float now byte
pricemiss was double now byte

. *browse;
.         *categorize revealed preference performance;
.       gen pref_r=0;

.       replace pref_r=1 if float(linf_q)>float(povline_f5_s);
(15 real changes made)

.       replace pref_r=2 if float(linf_q)<float(povline_f5_s);
(8 real changes made)

.       lab var pref_r "Fails or passes revealed preference test";

.       lab def pref_r
>                         0 "comparison of the same region with itself"
>                         1 "passes revealed preference test"
>                         2 "fails revealed preference test" ;

.         lab val pref_r pref_r;

.       drop if spdomainq==spdomain;
(5 observations deleted)

.         tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         15       75.00       75.00
         fails revealed preference test |          5       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

.              sort spdomainq ;

.       by spdomainq: tab pref_r;

-------------------------------------------------------------------------------------
-> spdomainq = 1

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          3       75.00       75.00
         fails revealed preference test |          1       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------
-> spdomainq = 2

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------
-> spdomainq = 3

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          2       50.00       50.00
         fails revealed preference test |          2       50.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------
-> spdomainq = 4

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          2       50.00       50.00
         fails revealed preference test |          2       50.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

-------------------------------------------------------------------------------------
-> spdomainq = 5

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00


. save "$path\work\pref_r_price.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\pref_r_price.dta saved

. *drop comparisons with Maputo this does not matter since in the case of Uganda, we 
> have only 5 spatial domains****
> drop if spdomain>=11;
. drop if spdomainq>=11;
(0 observations deleted)

. display "this is with maputo dropped";
this is with maputo dropped

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         15       75.00       75.00
         fails revealed preference test |          5       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. *further drop Nampula rural and urban I set these to missing becuase they were dele
> ting maputo and yet we have none missing for Uganda***
> drop if spdomain==. | spdomain==.;
. display "this is with maputo and nampula dropped (MAH: Actually not - experimenting
>  with 6 spatial domains)";
this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 spa
> tial domains)

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         15       75.00       75.00
         fails revealed preference test |          5       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. **************************************************************************
> * 170_pref_r_price.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/170_pref_r_price.
> log
  log type:  text
 closed on:  20 May 2013, 17:28:21
-------------------------------------------------------------------------------------

. 
end of do-file

. $no_temp_rev    do "$path/new/180_povline_food_fix.do"  /* Inflating year t1's pove
> rty lines to year t2 */

. 
.                                 shell "$path/new/$revpref"                         
>      /* Adjusting flexible basket: inside pref. constraints */

. 
. $no_temp_rev    do "$path/new/200_povmeas_fix.do"               /* Fixed basket: Po
> verty rates */

.                                 do "$path/new/210_povmeas_ent_flex.do"  /* Flexible
>  basket, adjusted: Poverty rates */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/210_povmeas_ent_flex.log" , replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/210_povmeas_ent_f
> lex.log
  log type:  text
 opened on:  20 May 2013, 17:28:22

. clear

. set more off

. #delimit ;
delimiter now ;
. *********************************************************************************
> * 210_povmeas_ent_flex.do               (start)
> *
> * This file produces poverty measures taking the entropy adjusted poverty 
> * lines as a base. It produces two sets of poverty measures. In one, 
> * Maputo is treated with the logic of the fixed bundle. In the second, the revealed
>  preference logic
> * is maintained. Here, the flexible bundle is viewed as being determined by the 
> * lower constraint on the value of the food bundle dictated by P_t2*Q_t1. In this c
> ase,
> * the year t2 food shares are calculated and applied.
> *
> * Fixed poverty lines/etc. are mentioned here and there. But there are NO fixed
> * calculations for Maputo (or other provinces) anymore
> *
> *********************************************************************************;
. /*
> This file uses:
>         work\povline_food_ent.csv
>         work\conpc.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\povlines_ent.dta
>         work\povmeas_ent_flex.dta
>         work\povlines_ent.dta
>       work\nat_pov_ent_m.csv
>       work\rur_pov_ent_m.csv
>       work\news_pov_ent_m.csv
>       work\reg_tpi_pov_ent_m.csv
>       work\strata_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>         work\povlines_ent.csv
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. **************************************************************************;
. * Calculate the food shares for people near the food poverty line
> **************************************************************************;
. *Bring in entropy estimated flexible lines;
. clear;

. insheet using "$path\work\povline_food_ent.csv";
(3 vars, 5 obs)

.         rename ent food_povline_ent;

.      keep spdomain food_povline_ent;

.      sort spdomain;

. *Bring in fixed bundle poverty lines for Maputo ;
. *This is the same level for both entropy and fixed bundle analysis;
. *since the Q02*P02<=Q96*P02 constraint is binding;
. *$no_temp_rev   merge spdomain using "$path\work\povline_food_fix.dta";
. *$no_temp_rev    replace food_povline_ent=food_povline_w if spdomain>10;
.       keep spdomain food_povline_ent;

.       sort spdomain;

.       tempfile food_povline_ent;

. save `food_povline_ent';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. clear;

. use `contpi';

.         sort spdomain;

.         merge spdomain using `food_povline_ent';
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/food_povline_ent-1)+0.5)
>                 if abs(cons_pc_tpi/food_povline_ent-1)<=0.2;
(309 real changes made)

.         gen tripopwt=triwt*hhweight*hhsize;

.         collapse (mean) nf_pc_nom food_povline_ent [aw=tripopwt] ,
>         by(spdomain);

.         rename nf_pc_nom povline_nf;

.         lab var povline_nf "Nonfood poverty line";

.         sort spdomain;

. *       merge spdomain using "$foodshr_pastSurvey", keep(spdomain $fdshr_t1);
. *       tab _m;
. *       drop _m;
. *       gen fdshr_t1 = $fdshr_t1;
. *       drop $fdshr_t1;
. *       lab var fdshr_t1 "year t1 (e.g. 1996) poverty line food share";
.      *calculate line for all provinces with flexible food shares;
.                         gen povline_ent_m=food_povline_ent + povline_nf;

.         gen fdshr=food_povline_ent/povline_ent;

.         lab var fdshr "year t2 (e.g. 2002) poverty line food share";

.       *redo for maputo inserting the fixed food share;
.  *     gen povline_ent=povline_ent_m;
. *MAH;
. *$no_temp_rev   replace povline_ent=food_povline_ent/fdshr_t1 if spdomain >=11;
. *       lab var povline_ent   "poverty lines with Maputo regions calculated using f
> ixed bundle non-food shares";
.     lab var povline_ent   "poverty lines with all regions calculated using flexible
>  bundle non-food shares";

. *    lab var povline_ent_m "poverty lines with Maputo regions calculated using flex
> ible bundle non-food shares";
.         sort spdomain;

. tempfile povlines_ent;

. save `povlines_ent', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000003.tmp saved

. clear;

. **************************************************************************;
. * Calculate poverty measures with all regions using flexible year t2 food shares
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using `povlines_ent';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> **************************************************************************;
.         gen cr= cons_pc_tpi ;

.         gen linpob=povline_ent;

. *MAH;
.  *Now only 6 regions, so base is chosen as the 1;
.         *qui sum linpob if spdomain==7, meanonly;
.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;

.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
         cr2 |    6775   200636622    9398.417   338351.3   91.09271   6.93e+07
      linpob |    6775   200636622    919.6902   90.69877    873.335   1216.024
     linpobr |    6775   200636622    1037.735    .000033   1037.735   1037.735

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(5898 missing values generated)

.         replace  h = 0  if cr2 > (linpobr);
(5898 real changes made)

.         gen             pg      = ((linpobr - cr2 )/linpobr) *100;

.         replace         pg      = 0             if h==0;
(5898 real changes made)

.         gen             spg     = ((( linpobr - cr2 )/ linpobr )^2)*100;

.         replace         spg     = 0             if h==0;
(5898 real changes made)

.         gen h_ent  =h;

.         gen pg_ent =pg;

.         gen spg_ent=spg;

.         lab var h_ent   "Poverty headcount entropy bundle with Maputo food share fi
> xed";

.         lab var pg_ent  "Poverty gap entropy bundle with Maputo food share fixed";

.         lab var spg_ent "Squared poverty gap entropy bundle with Maputo food share 
> fixed";

.         sort hhid;

.         merge hhid using "$path\work\hhdata.dta";
(label lrural already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label STRA already defined)
(label lbreg already defined)
(label lbur already defined)
(label lbpoor already defined)
(label Q1B8 already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.         lab var popwt "Population weights = hhsize X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

. *MAH: Below at various places the original reg13 has been changed into spdomain or 
> spdomain ;
.                 svy: mean h_ent pg_ent spg_ent;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
       h_ent |   11.01053   .8014178      9.437066      12.584
      pg_ent |   2.928787   .2421104      2.453438    3.404135
     spg_ent |   1.251397   .1334246      .9894372    1.513357
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
       Urban |   2.409327   .6781872      1.077805    3.740848
       Rural |   12.32432    .893248      10.57056    14.07808
-------------+------------------------------------------------
pg_ent       |
       Urban |   .4268661   .1232403      .1849018    .6688304
       Rural |   3.310942   .2740597      2.772866    3.849018
-------------+------------------------------------------------
spg_ent      |
       Urban |   .1153442   .0428775      .0311606    .1995279
       Rural |   1.424923   .1527348       1.12505    1.724795
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   4.662128   1.413863      1.886215     7.43804
   _subpop_3 |   6.864175   1.841709      3.248248     10.4801
   _subpop_4 |   6.630724   1.413872      3.854793    9.406654
     EASTERN |   10.39386   2.211733       6.05145    14.73628
   _subpop_6 |   16.05722    2.73805      10.68146    21.43298
   _subpop_7 |   73.44685   6.393332      60.89448    85.99922
   _subpop_8 |   17.48031   4.306945      9.024254    25.93637
   _subpop_9 |   11.40555   2.080287      7.321212    15.48989
  _subpop_10 |   3.988778   .9785319      2.067574    5.909982
-------------+------------------------------------------------
pg_ent       |
     KAMPALA |   .3033664   .1915388      -.072692    .6794249
   _subpop_2 |   .8373913   .3827317      .0859535    1.588829
   _subpop_3 |   1.156283    .361987      .4455741    1.866991
   _subpop_4 |   1.261889   .2647693      .7420531    1.781725
     EASTERN |   1.933406   .3900033      1.167691     2.69912
   _subpop_6 |   4.847612   1.044499       2.79689    6.898334
   _subpop_7 |   33.23117   3.801253      25.76796    40.69437
   _subpop_8 |   3.378632   .6333498      2.135142    4.622122
   _subpop_9 |   2.717271   .6920574      1.358518    4.076025
  _subpop_10 |   .6958796   .2382293      .2281512    1.163608
-------------+------------------------------------------------
spg_ent      |
     KAMPALA |   .0654872   .0428166     -.0185769    .1495512
   _subpop_2 |    .268479   .1655906     -.0566339    .5935919
   _subpop_3 |    .341769   .1192628       .107614     .575924
   _subpop_4 |   .3839844   .0964787      .1945625    .5734064
     EASTERN |   .4843452   .0950672      .2976948    .6709957
   _subpop_6 |   2.219071   .5846773      1.071142    3.366999
   _subpop_7 |   18.33729   2.500307       13.4283    23.24627
   _subpop_8 |   1.005053   .2231112      .5670063    1.443099
   _subpop_9 |   1.164874   .4379376      .3050471      2.0247
  _subpop_10 |   .2240762   .1031612      .0215344    .4266181
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
   _subpop_1 |    6.53716   1.370998      3.845405    9.228915
   _subpop_2 |   1.914678   .7063461      .5278702    3.301485
     Eastern |   8.702839   1.394513      5.964916    11.44076
    Northern |   25.82384   2.233016      21.43964    30.20804
     Western |   7.805078    1.21593      5.417777    10.19238
-------------+------------------------------------------------
pg_ent       |
   _subpop_1 |   1.145975   .3161506        .52526    1.766691
   _subpop_2 |   .3207217   .1379697      .0498383    .5916051
     Eastern |   1.631649   .2495819      1.141632    2.121667
    Northern |   8.944441   .9386047      7.101628    10.78725
     Western |   1.735986   .3921094      .9661368    2.505836
-------------+------------------------------------------------
spg_ent      |
   _subpop_1 |   .3575418   .1240798      .1139293    .6011543
   _subpop_2 |   .0702706   .0315469      .0083328    .1322084
     Eastern |   .4392466   .0683423      .3050665    .5734266
    Northern |   4.417319   .5775701      3.283345    5.551294
     Western |   .7081634   .2415741      .2338679    1.182459
--------------------------------------------------------------

.         svy: mean h_ent pg_ent spg_ent , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent        |
   _subpop_1 |    6.53716   1.370998      3.845405    9.228915
   _subpop_2 |   1.914678   .7063461      .5278702    3.301485
     Eastern |   8.702839   1.394513      5.964916    11.44076
    Northern |   25.82384   2.233016      21.43964    30.20804
     Western |   7.805078    1.21593      5.417777    10.19238
-------------+------------------------------------------------
pg_ent       |
   _subpop_1 |   1.145975   .3161506        .52526    1.766691
   _subpop_2 |   .3207217   .1379697      .0498383    .5916051
     Eastern |   1.631649   .2495819      1.141632    2.121667
    Northern |   8.944441   .9386047      7.101628    10.78725
     Western |   1.735986   .3921094      .9661368    2.505836
-------------+------------------------------------------------
spg_ent      |
   _subpop_1 |   .3575418   .1240798      .1139293    .6011543
   _subpop_2 |   .0702706   .0315469      .0083328    .1322084
     Eastern |   .4392466   .0683423      .3050665    .5734266
    Northern |   4.417319   .5775701      3.283345    5.551294
     Western |   .7081634   .2415741      .2338679    1.182459
--------------------------------------------------------------

.                 compress;
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
spdomain was float now byte
reg_tpi was float now byte
one was float now byte
h was float now byte
h_ent was float now byte
hhsize was double now byte

.       gen dum=1;

.         sort hhid;

.         *set aside the spatial price index;
.       tempfile spi;

. *      use "$path\work\povmeas_ent.dta", clear;
.       collapse (mean) spi, by(spdomain);

.       sort spdomain;

. save `spi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

. clear;

. **************************************************************************;
. * Calculate poverty measures with Maputo regions on flexible food shares
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using `povlines_ent';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> **************************************************************************;
.         gen cr= cons_pc_tpi ;

.         gen linpob=povline_ent_m;

.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;

.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
         cr2 |    6775   200636622    9398.417   338351.3   91.09271   6.93e+07
      linpob |    6775   200636622    919.6902   90.69877    873.335   1216.024
     linpobr |    6775   200636622    1037.735    .000033   1037.735   1037.735

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(5898 missing values generated)

.         replace  h = 0 if cr2 > (linpobr);
(5898 real changes made)

.         gen             pg      = ((linpobr - cr2 )/linpobr) *100;

.         replace         pg      = 0             if h==0;
(5898 real changes made)

.         gen             spg     = ((( linpobr - cr2 )/ linpobr )^2)*100;

.         replace         spg     = 0             if h==0;
(5898 real changes made)

.         gen h_ent_m  =h;

.         gen pg_ent_m =pg;

.         gen spg_ent_m=spg;

.         lab var h_ent_m   "Poverty headcount entropy bundle. Food share flexible. F
> lexible bundle";

.         lab var pg_ent_m  "Poverty gap entropy bundle. Food share flexible. Flexibl
> e bundle";

.         lab var spg_ent_m "Squared poverty gap entropy. Food share flexible. Flexib
> le bundle";

.         sort hhid;

.         merge hhid using "$path\work\hhdata.dta";
(label lrural already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label STRA already defined)
(label lbreg already defined)
(label lbur already defined)
(label lbpoor already defined)
(label Q1B8 already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.         lab var popwt "Population weights = hhsize X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.                 svy: mean h_ent_m pg_ent_m spg_ent_m;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_ent_m |   11.01053   .8014178      9.437066      12.584
    pg_ent_m |   2.928787   .2421104      2.453438    3.404135
   spg_ent_m |   1.251397   .1334246      .9894372    1.513357
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
       Urban |   2.409327   .6781872      1.077805    3.740848
       Rural |   12.32432    .893248      10.57056    14.07808
-------------+------------------------------------------------
pg_ent_m     |
       Urban |   .4268661   .1232403      .1849018    .6688304
       Rural |   3.310942   .2740597      2.772866    3.849018
-------------+------------------------------------------------
spg_ent_m    |
       Urban |   .1153442   .0428775      .0311606    .1995279
       Rural |   1.424923   .1527348       1.12505    1.724795
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

            1: news = 1
            2: news = 2
            3: news = 3
            4: news = 4

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
           1 |   5.021698   .9787455      3.100075    6.943322
           2 |   8.702839   1.394513      5.964916    11.44076
           3 |   25.82384   2.233016      21.43964    30.20804
           4 |   7.805078    1.21593      5.417777    10.19238
-------------+------------------------------------------------
pg_ent_m     |
           1 |   .8754195   .2210692      .4413824    1.309457
           2 |   1.631649   .2495819      1.141632    2.121667
           3 |   8.944441   .9386047      7.101628    10.78725
           4 |   1.735986   .3921094      .9661368    2.505836
-------------+------------------------------------------------
spg_ent_m    |
           1 |   .2633611   .0851273      .0962261    .4304961
           2 |   .4392466   .0683423      .3050665    .5734266
           3 |   4.417319   .5775701      3.283345    5.551294
           4 |   .7081634   .2415741      .2338679    1.182459
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      central: reg_tpi = central
      eastern: reg_tpi = eastern
     northern: reg_tpi = northern
      western: reg_tpi = western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
     central |   5.021698   .9787455      3.100075    6.943322
     eastern |   8.702839   1.394513      5.964916    11.44076
    northern |   25.82384   2.233016      21.43964    30.20804
     western |   7.805078    1.21593      5.417777    10.19238
-------------+------------------------------------------------
pg_ent_m     |
     central |   .8754195   .2210692      .4413824    1.309457
     eastern |   1.631649   .2495819      1.141632    2.121667
    northern |   8.944441   .9386047      7.101628    10.78725
     western |   1.735986   .3921094      .9661368    2.505836
-------------+------------------------------------------------
spg_ent_m    |
     central |   .2633611   .0851273      .0962261    .4304961
     eastern |   .4392466   .0683423      .3050665    .5734266
    northern |   4.417319   .5775701      3.283345    5.551294
     western |   .7081634   .2415741      .2338679    1.182459
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |   4.662128   1.413863      1.886215     7.43804
   _subpop_3 |   6.864175   1.841709      3.248248     10.4801
   _subpop_4 |   6.630724   1.413872      3.854793    9.406654
     EASTERN |   10.39386   2.211733       6.05145    14.73628
   _subpop_6 |   16.05722    2.73805      10.68146    21.43298
   _subpop_7 |   73.44685   6.393332      60.89448    85.99922
   _subpop_8 |   17.48031   4.306945      9.024254    25.93637
   _subpop_9 |   11.40555   2.080287      7.321212    15.48989
  _subpop_10 |   3.988778   .9785319      2.067574    5.909982
-------------+------------------------------------------------
pg_ent_m     |
     KAMPALA |   .3033664   .1915388      -.072692    .6794249
   _subpop_2 |   .8373913   .3827317      .0859535    1.588829
   _subpop_3 |   1.156283    .361987      .4455741    1.866991
   _subpop_4 |   1.261889   .2647693      .7420531    1.781725
     EASTERN |   1.933406   .3900033      1.167691     2.69912
   _subpop_6 |   4.847612   1.044499       2.79689    6.898334
   _subpop_7 |   33.23117   3.801253      25.76796    40.69437
   _subpop_8 |   3.378632   .6333498      2.135142    4.622122
   _subpop_9 |   2.717271   .6920574      1.358518    4.076025
  _subpop_10 |   .6958796   .2382293      .2281512    1.163608
-------------+------------------------------------------------
spg_ent_m    |
     KAMPALA |   .0654872   .0428166     -.0185769    .1495512
   _subpop_2 |    .268479   .1655906     -.0566339    .5935919
   _subpop_3 |    .341769   .1192628       .107614     .575924
   _subpop_4 |   .3839844   .0964787      .1945625    .5734064
     EASTERN |   .4843452   .0950672      .2976948    .6709957
   _subpop_6 |   2.219071   .5846773      1.071142    3.366999
   _subpop_7 |   18.33729   2.500307       13.4283    23.24627
   _subpop_8 |   1.005053   .2231112      .5670063    1.443099
   _subpop_9 |   1.164874   .4379376      .3050471      2.0247
  _subpop_10 |   .2240762   .1031612      .0215344    .4266181
--------------------------------------------------------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_ent_m      |
   _subpop_1 |    6.53716   1.370998      3.845405    9.228915
   _subpop_2 |   1.914678   .7063461      .5278702    3.301485
     Eastern |   8.702839   1.394513      5.964916    11.44076
    Northern |   25.82384   2.233016      21.43964    30.20804
     Western |   7.805078    1.21593      5.417777    10.19238
-------------+------------------------------------------------
pg_ent_m     |
   _subpop_1 |   1.145975   .3161506        .52526    1.766691
   _subpop_2 |   .3207217   .1379697      .0498383    .5916051
     Eastern |   1.631649   .2495819      1.141632    2.121667
    Northern |   8.944441   .9386047      7.101628    10.78725
     Western |   1.735986   .3921094      .9661368    2.505836
-------------+------------------------------------------------
spg_ent_m    |
   _subpop_1 |   .3575418   .1240798      .1139293    .6011543
   _subpop_2 |   .0702706   .0315469      .0083328    .1322084
     Eastern |   .4392466   .0683423      .3050665    .5734266
    Northern |   4.417319   .5775701      3.283345    5.551294
     Western |   .7081634   .2415741      .2338679    1.182459
--------------------------------------------------------------

.         drop bswt one h pg spg;

.         compress;
rmult was float now int
poor09 was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
spdomain was float now byte
reg_tpi was float now byte
h_ent_m was float now byte
hhsize was double now byte

. label data "Final data set. Official published poverty rates are calculated from th
> is data set";
note: label truncated to 80 characters

.         sort hhid;

.         save "$path\work\povmeas_ent_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povmeas_ent_flex.dta sav
> ed

. gen dum=1;

.         *output the national measures;
.         collapse  (mean) dum h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000005.tmp saved

.         *output the rural/urban measures;
.         use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(rural)
> ;

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000006.tmp saved

.         *output the North South Center measures;
.         use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000007.tmp saved

.         *output the North South Center rural/urban measures;
.         use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(reg_tp
> i);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000008.tmp saved

.         *output the provincial measures;
.         use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(strata
> );

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000009.tmp saved

.                 *output the dominios espaciais measures;
.         use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_ent_m [aw=hhweight*hhsize], by(spdoma
> in);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000a.tmp saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000b.tmp saved

. use          `nat';
(Final data set. Official published poverty rates are calculated from this data s)

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_ent_m pg_ent_m spg_ent_m dum rural news reg_tpi strata spdomai
> n using "$path/work/poverty_ent_flexBask.csv", replace c ;

.         *set aside the spatial price index;
.       tempfile spi_m;

.       use "$path\work\povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.       collapse (mean) spi, by(spdomain);

.       rename spi spi_m;

.       sort spdomain;

. save `spi_m', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j00000c.tmp saved

. use `povlines_ent';

.        sort spdomain;

.        merge spdomain using `spi';
(label spdomain_original already defined)

.        tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |          5      100.00      100.00
------------+-----------------------------------
      Total |          5      100.00

.  drop _m;

.        sort spdomain;

.        merge spdomain using `spi_m';
(label spdomain_original already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |          5      100.00      100.00
------------+-----------------------------------
      Total |          5      100.00

.  drop _m;

. save "$path\work\povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta saved

. outsheet spdomain food_povline_ent povline_ent fdshr using "$path\work\povlines.csv
> ", replace c;

.  *********************************************************************************
> * 210_povmeas_ent_flex.do               (end)
> *********************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/210_povmeas_ent_f
> lex.log
  log type:  text
 closed on:  20 May 2013, 17:28:23
-------------------------------------------------------------------------------------

. 
end of do-file

. 
.                                 do "$path/new/220_gen_results.do"               /* 
> Final poverty and inequality rates */

. *global path "C:\user\gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/220_gen_results.log", text replace
-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/220_gen_results.l
> og
  log type:  text
 opened on:  20 May 2013, 17:28:24

. set more off

. #delimit ;
delimiter now ;
. *****************************************************************
> * 220_gen_results.do            (start)
> *
> * Do file to generate poverty and inequality results at various
> * levels of aggregation, and save the results for each 
> * bootstrap replication in a file.
> * NOTE: for some reason, -ineqdeco- doesn't generate results
> *       for GE(0), GE(1), GE(2), Gini, etc. when an "if" condition
> *               is used, so I'm using preserve/restore blocks for
> *               sub-groups instead.
> *               Also, saving results presented a few wrinkles, but
> *               doing it via matrices works.
> *****************************************************************;
. /*
>         This file uses:
>                 work/povmeas_ent_flex.dta (the bootstrapped version)
>                 out/bs_results.dta
>         
>         This file creates:
>                 out/bs_results.dta (updated)    
> */
> 
> 
> 
> 
> * Housecleaning;
. cap mat drop rep nat rur urb full;

. * Save the poverty lines in data file created for that purpose,;
. * and store in a matrix, for saving to a data file later.;
. use "$path/work/povmeas_ent_flex.dta", clear;
(Final data set. Official published poverty rates are calculated from this data s)

.         foreach reg of numlist 1/13 {;
  2.                 qui sum linpob if spdomain==`reg';
  3.                 global linpob`reg'=r(mean);
  4.         };

.         mat input rep=(0);

.         mat input linpob=($linpob1 $linpob2 $linpob3 $linpob4 $linpob5 $linpob6 
>                 $linpob7 $linpob8 $linpob9 $linpob10 $linpob11 $linpob12 $linpob13)
> ;

.         mat linpob = rep, linpob;

.         mat colnames linpob = rep linpob1 linpob2 linpob3 linpob4 linpob5 linpob6 
>                 linpob7 linpob8 linpob9 linpob10 linpob11 linpob12 linpob13;

.         #delimit cr
delimiter now cr
. 
.         * Change poverty measures from percentage to index terms;
.         gen h   = h_ent_   /100

.         gen pg  = pg_ent_m /100

.         gen spg = spg_ent_m/100

. 
.         * National figures;
.         sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |    6775   200636622    .1101053   .3130441          0          1

.         glob p0_nat=r(mean)

.         sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |    6775   200636622    .0292879   .1079718          0   .9122196

.         glob p1_nat=r(mean)

.         sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |    6775   200636622     .012514   .0628442          0   .8321447

.         glob p2_nat=r(mean)

.         ineqdeco cr2 [aw=hhweight*hhsize]
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
  9.867    4.039    0.409    2.859    1.786    0.625
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
          |    1.93099     1.18859     2.82141   648.03192     0.77153
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.56951     0.69535     0.79432
----------------------------------------------

.         glob gini_nat=$S_gini

.         glob ge0_nat =$S_i0

.         glob ge1_nat =$S_i1

.         glob ge2_nat =$S_i2

.         mat input nat=($p0_nat $p1_nat $p2_nat $gini_nat $ge0_nat $ge1_nat $ge2_nat
> )

. 
.         * Rural figures;
.         preserve

.                 keep if rural==1
(1220 observations deleted)

.                 sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |    5555   174051227    .1232432   .3287458          0          1

.                 glob p0_rur=r(mean)

.                 sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |    5555   174051227    .0331094   .1146968          0   .9122196

.                 glob p1_rur=r(mean)

.                 sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |    5555   174051227    .0142492   .0670197          0   .8321447

.                 glob p2_rur=r(mean)

.                 ineqdeco cr2 [aw=hhweight*hhsize]
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
  7.593    3.159    0.416    2.667    1.689    0.633
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
          |    1.03072     0.77597     1.40208    14.75368     0.65197
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.39881     0.53974     0.67336
----------------------------------------------

.                 glob gini_rur=$S_gini

.                 glob ge0_rur =$S_i0

.                 glob ge1_rur =$S_i1

.                 glob ge2_rur =$S_i2

.         restore

.         mat input rur=($p0_rur $p1_rur $p2_rur $gini_rur $ge0_rur $ge1_rur $ge2_rur
> )

. 
.         * Urban figures;
.         preserve

.                 keep if rural==0
(5555 observations deleted)

.                 sum h [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
           h |    1220    26585395    .0240933   .1534017          0          1

.                 glob p0_urb=r(mean)

.                 sum pg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          pg |    1220    26585395    .0042687   .0337069          0   .7601436

.                 glob p1_urb=r(mean)

.                 sum spg [aw=hhweight*hhsize]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
         spg |    1220    26585395    .0011534   .0158637          0   .5778184

.                 glob p2_urb=r(mean)

.                 ineqdeco cr2 [aw=hhweight*hhsize]
 
 
Percentile ratios for distribution of cr2: all valid obs.
------------------------------------------------------------
p90/p10  p90/p50  p10/p50  p75/p25  p75/p50  p25/p50
------------------------------------------------------------
 17.204    5.150    0.299    4.841    2.544    0.525
              
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
          |    4.37208     1.72611     3.54836   355.93866     0.85938
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.69733     0.82203     0.89737
----------------------------------------------

.                 glob gini_urb=$S_gini

.                 glob ge0_urb =$S_i0

.                 glob ge1_urb =$S_i1

.                 glob ge2_urb =$S_i2

.         restore

.         mat input urb=($p0_urb $p1_urb $p2_urb $gini_urb $ge0_urb $ge1_urb $ge2_urb
> )

. 
.         * Assemble the matrix pieces and save this set of estimates in the data fil
> e;
.                 #delimit;
delimiter now ;
.                 mat full= rep, nat, rur, urb;

.                 mat colnames full = rep 
>                                         p0_nat  p1_nat  p2_nat  gini_nat  ge0_nat  
> ge1_nat      ge2_nat
>                                         p0_rur  p1_rur  p2_rur  gini_rur  ge0_rur  
> ge1_rur      ge2_rur
>                                         p0_urb  p1_urb  p2_urb  gini_urb  ge0_urb  
> ge1_urb      ge2_urb;

.         #delimit cr
delimiter now cr
.         mat list full

full[1,22]
          rep     p0_nat     p1_nat     p2_nat   gini_nat    ge0_nat    ge1_nat
r1          0  .11010532  .02928787  .01251397  .77152616  1.1885883   2.821414

      ge2_nat     p0_rur     p1_rur     p2_rur   gini_rur    ge0_rur    ge1_rur
r1  648.03192   .1232432  .03310942  .01424923  .65197414  .77597272  1.4020847

      ge2_rur     p0_urb     p1_urb     p2_urb   gini_urb    ge0_urb    ge1_urb
r1  14.753678  .02409327  .00426866  .00115344  .85938072  1.7261134  3.5483627

      ge2_urb
r1  355.93866

. 
. 
. drop _all

. 
. svmat full , names(col)
number of observations will be reset to 1
Press any key to continue, or Break to abort
obs was 0, now 1

.         tempfile rep

.         compress
rep was float now byte

. 
. 
. 
. 
. 
. *****************************************************************
. * 220_gen_results.do            (end)
. *****************************************************************;
. 
. log close
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/220_gen_results.l
> og
  log type:  text
 closed on:  20 May 2013, 17:28:24
-------------------------------------------------------------------------------------

. 
end of do-file

.                 
. *quietly        do "$path/new/230_assets_possession"                    /* Extra: D
> eprivation */
. *quietly        do "$path/new/240_compare_nat_acc.do"                   /* Extra: C
> ompare survey with national accounts */
. 
. 
. 
. **********************************************************************;
. * 000_boom.do   (end)
. **********************************************************************;
. 
. log close log_000_boom
      name:  log_000_boom
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/000_boom.log
  log type:  text
 closed on:  20 May 2013, 17:28:24
-------------------------------------------------------------------------------------
