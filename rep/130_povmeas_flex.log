-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.
> log
  log type:  text
 opened on:  20 May 2013, 14:39:25

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before any iteration)
> **************************************************************************;
. *CA modified to add work\hhdata.dta for bootstrap;
. /*
> This file uses:
>         in\foodshr96.dta
>         work\povline_f_flex.dta
>         work\consump_nom.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\foodshr96.dta
>         work\povmeas.dta
>         work\povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news rural survmon survquar;

.         tab reg_tpi, miss;

    reg_tpi |      Freq.     Percent        Cum.
------------+-----------------------------------
    central |      1,986       29.31       29.31
    eastern |      1,406       20.75       50.07
   northern |      1,956       28.87       78.94
    western |      1,427       21.06      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         tab survquar, miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |      1,749       25.82       25.82
Sept-Oct 09 |      1,731       25.55       51.37
Nov09-Jan10 |      1,458       21.52       72.89
 Feb-Apr 10 |      1,837       27.11      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000001.tmp saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work\hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path\work\hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000002.tmp saved

. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(304 real changes made)

.                                         * Nearness to poverty line and population w
> eights ;
.         gen tripopwt=triwt*hhweight*hhsize;

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp not found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0j000004.tmp saved

.                 tab spdomain;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |          1       20.00       20.00
Central urban |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. **************************************************************************;
. * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.         gen povline_flex=povline_f_flex + povline_na_flex;

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path\work\povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta saved

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path\work\povlines.dta";
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povlines.dta
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;

.         * Poverty line;
.         gen linpob=povline_flex;

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    6775   200636622    9398.417   395673.3   77.25769   8.12e+07
         cr2 |    6775   200636622    9398.417   343462.1   83.76179   7.03e+07
      linpob |    6775   200636622     919.668   136.8074   717.3789   1211.415
     linpobr |    6775   200636622    1049.948   .0000547   1049.948   1049.948

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.         gen h = 100     if cr <=(linpob);
(6005 missing values generated)

.         replace  h = 0 if cr > (linpob);
(6005 real changes made)

.                         gen             pg      = ((linpob - cr )/linpob) *100;

.         replace         pg      = 0             if h==0;
(6005 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;

.         replace         spg     = 0             if h==0;
(6005 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;

.         gen spg_flex=spg;

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path\work\hhdata.dta";
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |   9.775007   .6844343       8.43122    11.11879
     pg_flex |   2.565124   .2169024      2.139268    2.990981
    spg_flex |   1.024026   .1134079      .8013663    1.246686
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
       Urban |   2.012786   .5879872      .8583587    3.167212
       Rural |   10.96064   .7624384      9.463709    12.45758
-------------+------------------------------------------------
pg_flex      |
       Urban |   .3630919   .1130739      .1410877     .585096
       Rural |   2.901473   .2459022       2.41868    3.384266
-------------+------------------------------------------------
spg_flex     |
       Urban |   .1015641   .0385104      .0259546    .1771736
       Rural |   1.164927   .1297416      .9101985    1.419656
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

            1: news = 1
            2: news = 2
            3: news = 3
            4: news = 4

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
           1 |   6.053625   1.035123      4.021312    8.085937
           2 |   7.673569   1.332494      5.057412    10.28973
           3 |   18.38831   1.732566      14.98667    21.78996
           4 |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
           1 |   1.239011   .2720639      .7048536    1.773169
           2 |   1.518373   .2335571      1.059818    1.976928
           3 |    6.12452   .8045906      4.544824    7.704216
           4 |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
           1 |   .3871354   .1106459      .1698984    .6043724
           2 |   .4009155   .0635366      .2761707    .5256604
           3 |    2.91319   .4404111      2.048507    3.777873
           4 |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      central: reg_tpi = central
      eastern: reg_tpi = eastern
     northern: reg_tpi = northern
      western: reg_tpi = western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     central |   6.053625   1.035123      4.021312    8.085937
     eastern |   7.673569   1.332494      5.057412    10.28973
    northern |   18.38831   1.732566      14.98667    21.78996
     western |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
     central |   1.239011   .2720639      .7048536    1.773169
     eastern |   1.518373   .2335571      1.059818    1.976928
    northern |    6.12452   .8045906      4.544824    7.704216
     western |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
     central |   .3871354   .1106459      .1698984    .6043724
     eastern |   .4009155   .0635366      .2761707    .5256604
    northern |    2.91319   .4404111      2.048507    3.777873
     western |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     KAMPALA |   1.536145   .8756774     -.1831199    3.255409
   _subpop_2 |    4.92292    1.43497      2.105566    7.740274
   _subpop_3 |   9.123401   1.972289      5.251099     12.9957
   _subpop_4 |   5.509239   1.167082      3.217844    7.800634
     EASTERN |   9.439851   2.173988      5.171543    13.70816
   _subpop_6 |     10.461   1.988955      6.555977    14.36602
   _subpop_7 |   65.02235   5.871258      53.49499    76.54971
   _subpop_8 |   7.791329   1.560699      4.727124    10.85553
   _subpop_9 |   12.88647   2.061614      8.838789    16.93414
  _subpop_10 |   5.334378   1.069359      3.234848    7.433908
-------------+------------------------------------------------
pg_flex      |
     KAMPALA |   .2986766    .188988     -.0723737    .6697268
   _subpop_2 |   1.150472   .4518834       .263265    2.037679
   _subpop_3 |   1.727392   .4665012      .8114848    2.643298
   _subpop_4 |   1.177746   .2522045      .6825791    1.672913
     EASTERN |   1.796355   .3631121      1.083437    2.509272
   _subpop_6 |    3.18885   .8192738      1.580325    4.797374
   _subpop_7 |   25.29787    3.34131      18.73769    31.85804
   _subpop_8 |   1.287751   .3670516      .5670993    2.008404
   _subpop_9 |   3.571254   .7959142      2.008593    5.133916
  _subpop_10 |   1.086008   .2880834      .5203985    1.651618
-------------+------------------------------------------------
spg_flex     |
     KAMPALA |   .0636916   .0416943     -.0181691    .1455524
   _subpop_2 |   .3880597   .2068019     -.0179656    .7940849
   _subpop_3 |   .5229337   .1668819      .1952855     .850582
   _subpop_4 |   .3557974   .0919476      .1752718     .536323
     EASTERN |   .4377359   .0869987      .2669267    .6085451
   _subpop_6 |   1.359985   .4286935      .5183075    2.201662
   _subpop_7 |   12.94834   1.989438      9.042373    16.85432
   _subpop_8 |   .4064376   .1479538      .1159519    .6969232
   _subpop_9 |   1.510552   .4849095      .5585027      2.4626
  _subpop_10 |    .340192   .1287887      .0873342    .5930498
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =       6775
Number of PSUs   =     711       Population size  =  200636622
                                 Design df        =        701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   8.072413   1.437823      5.249457    10.89537
   _subpop_2 |   1.914678   .7063461      .5278702    3.301485
     Eastern |   7.673569   1.332494      5.057412    10.28973
    Northern |   18.38831   1.732566      14.98667    21.78996
     Western |   9.220304   1.231211      6.803001    11.63761
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   1.689868   .3879697      .9281466     2.45159
   _subpop_2 |   .3146578   .1359886      .0476641    .5816516
     Eastern |   1.518373   .2335571      1.059818    1.976928
    Northern |    6.12452   .8045906      4.544824    7.704216
     Western |   2.364791   .4535604      1.474292    3.255291
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   .5426074   .1608661      .2267703    .8584444
   _subpop_2 |   .0683844   .0307584      .0079948     .128774
     Eastern |   .4009155   .0635366      .2761707    .5256604
    Northern |    2.91319   .4404111      2.048507    3.777873
     Western |   .9424004    .269841       .412607    1.472194
--------------------------------------------------------------

.         compress;
survquar was float now byte
spdomain was float now byte
reg_tpi was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
rmult was float now int
poor09 was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
hhsize was double now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize], by(strata);

. save "$path\work\povmeas.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\work\povmeas.dta saved

. **************************************************************************
> * 130_povmeas_flex.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA/rep/130_povmeas_flex.
> log
  log type:  text
 closed on:  20 May 2013, 14:39:26
-------------------------------------------------------------------------------------
