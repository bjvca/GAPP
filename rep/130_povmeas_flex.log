---------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 30_povmeas_flex.log
  log type:  text
 opened on:  20 May 2013, 12:16:30

. clear

. set more off

. #delimit ;
delimiter now ;
. *************************************************
> *************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexib
> le basket. (Before any iteration)
> *************************************************
> *************************;
. *CA modified to add work/hhdata.dta for bootstrap
> ;
. /*
> This file uses:
>         in/foodshr96.dta
>         work/povline_f_flex.dta
>         work/consump_nom.dta
>         work/hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work/foodshr96.dta
>         work/povmeas.dta
>         work/povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> *************************************************
> *************************;
. * Bring in data file with nominal consumption per
>  capita, and deflate it
> * by temporal price index.
> *************************************************
> *************************;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news ru
> ral survmon survquar;

.         tab reg_tpi, miss;

    reg_tpi |      Freq.     Percent        Cum.
------------+-----------------------------------
    central |      1,986       29.31       29.31
    eastern |      1,406       20.75       50.07
   northern |      1,956       28.87       78.94
    western |      1,427       21.06      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         tab survquar, miss;

 Sequential |
     Survey |
    Quarter |
    May-Jun |
      09=1) |      Freq.     Percent        Cum.
------------+-----------------------------------
 May-Jul 09 |      1,749       25.82       25.82
Sept-Oct 09 |      1,731       25.55       51.37
Nov09-Jan10 |      1,458       21.52       72.89
 Feb-Apr 10 |      1,837       27.11      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file /tmp/St02502.000007 not found)
file /tmp/St02502.000007 saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for boot
> strap;
.     sort hhid;

.     merge hhid using "$path/work/hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/
> temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely
    identify observations in the master data
(label lsurvquar already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;

.         lab var food_pc_tpi "Temp-adjusted per ca
> pita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + n
> f_pc_nom;

.         lab var cons_pc_tpi "Temp adjusted total 
> consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St02502.000008 not found)
file /tmp/St02502.000008 saved

. *************************************************
> *************************
> * Calculate non-food expenditure for HH around th
> e food poverty line
> *
> * Develop a discrete triangular weighted distribu
> tion. This gives a
> * weight of  1 to HH at +/- 18-20% from food pove
> rty line, and
> * weight of  2 to HH at +/- 16-18% from food pove
> rty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food pove
> rty line.
> * This weight is called triwt below.
> *************************************************
> *************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_
> food_flex.dta";
variable spdomain does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/pov
> line_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex
> -1)<=0.2;
(306 real changes made)

.                                         * Nearnes
> s to poverty line and population weights ;
.         gen tripopwt=triwt*hhweight*hhsize;

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tri
> popwt] ,
>                         by(spdomain);

.                                         rename nf
> _pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood 
> poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file /tmp/St02502.00000a not found)
file /tmp/St02502.00000a saved

.                 tab spdomain;

     spdomain |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central rural |          1       20.00       20.00
Central urban |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify
    observations in the master data
(label spdomain_original already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

. *************************************************
> *************************;
. * Poverty line is the sum of the food and non-foo
> d poverty lines
> *************************************************
> *************************;
.         gen povline_flex=povline_f_flex + povline
> _na_flex;

.         lab var povline_flex "Poverty line. Flexi
> ble bundle";

.         sort spdomain;

. save "$path/work/povlines.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/work/povlines
> .dta saved

. *************************************************
> *************************;
. * Create spatial price index, based on the total 
> poverty line, with
> * adjustment so that mean (and total) nominal con
> sumption equals
> * mean (and total) spatially deflated consumption
> .
> *
> * Choose arbitrary strata to be the base at first
> : we just use the first stratum.
> *************************************************
> *************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povlines
> .dta";
variable spdomain does not uniquely identify
    observations in the master data
variable spdomain does not uniquely identify
    observations in
    /home/bjvca/data/data/GAP/Haruna/work/povline
    > s.dta
(label REG_TPI already defined)
(label spdomain_original already defined)
(label lsurvquar already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflate
> d ;
.         gen cr= cons_pc_tpi ;

.         * Poverty line;
.         gen linpob=povline_flex;

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;

.         * Real consumption pc, temporally and spa
> tially deflated ;
.         gen cr2=cr/spi;

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6775 real changes made)

.         gen linpobr=linpob/spi;

.         replace cr2=cr/spi;
(6775 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hh
> size];

    Variable |     Obs      Weight        Mean   St
> d. Dev.       Min        Max
-------------+-------------------------------------
> ----------------------------
          cr |    6775   200636622    9399.102   39
> 5673.3   77.24399   8.12e+07
         cr2 |    6775   200636622    9399.102   34
> 1359.2   84.11493   6.99e+07
      linpob |    6775   200636622    920.2749    1
> 40.342   713.6486   1224.502
     linpobr |    6775   200636622    1054.704    .
> 000033   1054.704   1054.704

.         lab var cr      "Temporally-adjusted cons
>  pc";

.         lab var cr2     "Spatially & temporally a
> djusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. *************************************************
> *************************
> * calculate poverty measures with the flexible fo
> od bundle
> *************************************************
> *************************;
.         gen h = 100     if cr <=(linpob);
(6003 missing values generated)

.         replace  h = 0 if cr > (linpob);
(6003 real changes made)

.                         gen             pg      =
>  ((linpob - cr )/linpob) *100;

.         replace         pg      = 0             i
> f h==0;
(6003 real changes made)

.         gen             spg     = ((( linpob - cr
>  )/ linpob )^2)*100;

.         replace         spg     = 0             i
> f h==0;
(6003 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;

.         gen spg_flex=spg;

.         lab var h_flex   "Poverty headcount. Flex
>  bundle";

.         lab var pg_flex  "Poverty gap. Flex bundl
> e";

.         lab var spg_flex "Squared poverty gap. Fl
> ex bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lsurvquar already defined)
(label spdomain_original already defined)
(label REG_TPI already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      6,775      100.00      100.00
------------+-----------------------------------
      Total |      6,775      100.00

.         drop if _merge~=3;
(0 observations deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(
> psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

---------------------------------------------------
> -----------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
      h_flex |   9.812639   .6858461       8.46608 
>     11.1592
     pg_flex |   2.555231   .2162973      2.130563 
>    2.979899
    spg_flex |   1.018482   .1128775      .7968632 
>      1.2401
---------------------------------------------------
> -----------

.         svy: mean h_flex pg_flex spg_flex , over(
> rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

        Urban: rural = Urban
        Rural: rural = Rural

---------------------------------------------------
> -----------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
h_flex       |
       Urban |   2.012786   .5879872      .8583587 
>    3.167212
       Rural |   11.00402   .7640295      9.503964 
>    12.50409
-------------+-------------------------------------
> -----------
pg_flex      |
       Urban |   .3711761    .115079      .1452353 
>    .5971168
       Rural |   2.888834   .2452176      2.407385 
>    3.370282
-------------+-------------------------------------
> -----------
spg_flex     |
       Urban |   .1041604   .0390057      .0275784 
>    .1807423
       Rural |   1.158139     .12913      .9046115 
>    1.411667
---------------------------------------------------
> -----------

.         svy: mean h_flex pg_flex spg_flex , over(
> news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

            1: news = 1
            2: news = 2
            3: news = 3
            4: news = 4

---------------------------------------------------
> -----------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
h_flex       |
           1 |   6.064121   1.035207      4.031644 
>    8.096597
           2 |   7.781384   1.338286      5.153855 
>    10.40891
           3 |   18.38831   1.732566      14.98667 
>    21.78996
           4 |   9.220304   1.231211      6.803001 
>    11.63761
-------------+-------------------------------------
> -----------
pg_flex      |
           1 |   1.245848   .2726874      .7104657 
>     1.78123
           2 |   1.521297   .2336501      1.062559 
>    1.980035
           3 |   6.060577   .8006579      4.488603 
>    7.632552
           4 |   2.365778   .4537375      1.474931 
>    3.256626
-------------+-------------------------------------
> -----------
spg_flex     |
           1 |   .3898021   .1109849      .1718995 
>    .6077046
           2 |    .402008   .0636428      .2770546 
>    .5269614
           3 |   2.879937   .4367486      2.022445 
>    3.737429
           4 |   .9427215   .2699228      .4127675 
>    1.472676
---------------------------------------------------
> -----------

.         svy: mean h_flex pg_flex spg_flex , over(
> reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

      central: reg_tpi = central
      eastern: reg_tpi = eastern
     northern: reg_tpi = northern
      western: reg_tpi = western

---------------------------------------------------
> -----------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
h_flex       |
     central |   6.064121   1.035207      4.031644 
>    8.096597
     eastern |   7.781384   1.338286      5.153855 
>    10.40891
    northern |   18.38831   1.732566      14.98667 
>    21.78996
     western |   9.220304   1.231211      6.803001 
>    11.63761
-------------+-------------------------------------
> -----------
pg_flex      |
     central |   1.245848   .2726874      .7104657 
>     1.78123
     eastern |   1.521297   .2336501      1.062559 
>    1.980035
    northern |   6.060577   .8006579      4.488603 
>    7.632552
     western |   2.365778   .4537375      1.474931 
>    3.256626
-------------+-------------------------------------
> -----------
spg_flex     |
     central |   .3898021   .1109849      .1718995 
>    .6077046
     eastern |    .402008   .0636428      .2770546 
>    .5269614
    northern |   2.879937   .4367486      2.022445 
>    3.737429
     western |   .9427215   .2699228      .4127675 
>    1.472676
---------------------------------------------------
> -----------

.         svy: mean h_flex pg_flex spg_flex , over(
> strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

      KAMPALA: strata = KAMPALA
    _subpop_2: strata = CENTRAL 1
    _subpop_3: strata = CENTRAL 2
    _subpop_4: strata = EAST CENTRAL
      EASTERN: strata = EASTERN
    _subpop_6: strata = MID-NOTHERN
    _subpop_7: strata = NORTH-EAST
    _subpop_8: strata = WEST-NILE
    _subpop_9: strata = MID-WESTERN
   _subpop_10: strata = SOUTH-WESTERN

---------------------------------------------------
> -----------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
h_flex       |
     KAMPALA |   1.536145   .8756774     -.1831199 
>    3.255409
   _subpop_2 |   4.947974   1.435556       2.12947 
>    7.766477
   _subpop_3 |   9.123401   1.972289      5.251099 
>     12.9957
   _subpop_4 |   5.509239   1.167082      3.217844 
>    7.800634
     EASTERN |   9.635651   2.184211      5.347273 
>    13.92403
   _subpop_6 |     10.461   1.988955      6.555977 
>    14.36602
   _subpop_7 |   65.02235   5.871258      53.49499 
>    76.54971
   _subpop_8 |   7.791329   1.560699      4.727124 
>    10.85553
   _subpop_9 |   12.88647   2.061614      8.838789 
>    16.93414
  _subpop_10 |   5.334378   1.069359      3.234848 
>    7.433908
-------------+-------------------------------------
> -----------
pg_flex      |
     KAMPALA |   .3109429   .1957665      -.073416 
>    .6953018
   _subpop_2 |   1.155752   .4521289      .2680626 
>    2.043441
   _subpop_3 |   1.733529   .4679141      .8148479 
>     2.65221
   _subpop_4 |   1.180249   .2528726      .6837702 
>    1.676727
     EASTERN |   1.799622   .3629978      1.086929 
>    2.512315
   _subpop_6 |   3.150965   .8145148      1.551784 
>    4.750145
   _subpop_7 |   25.09056   3.329085      18.55439 
>    31.62673
   _subpop_8 |   1.253884   .3653045      .5366624 
>    1.971106
   _subpop_9 |   3.573783   .7962997      2.010365 
>    5.137201
  _subpop_10 |   1.085362   .2877284       .520449 
>    1.650274
-------------+-------------------------------------
> -----------
spg_flex     |
     KAMPALA |   .0684444   .0447147     -.0193464 
>    .1562351
   _subpop_2 |   .3890002   .2071312     -.0176715 
>     .795672
   _subpop_3 |   .5264891   .1676451      .1973425 
>    .8556357
   _subpop_4 |   .3568361   .0921396      .1759334 
>    .5377388
     EASTERN |   .4388722   .0871189       .267827 
>    .6099174
   _subpop_6 |   1.341063   .4248042      .5070215 
>    2.175104
   _subpop_7 |    12.8202   1.975756      8.941096 
>    16.69931
   _subpop_8 |   .3974138   .1458939      .1109726 
>    .6838551
   _subpop_9 |   1.511506   .4851388      .5590073 
>    2.464006
  _subpop_10 |   .3398414   .1283629      .0878195 
>    .5918632
---------------------------------------------------
> -----------

.         svy: mean h_flex pg_flex spg_flex , over(
> spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10       Number of obs    =
>        6775
Number of PSUs   =     711       Population size  =
>   200636622
                                 Design df        =
>         701

    _subpop_1: spdomain = Central rural
    _subpop_2: spdomain = Central urban
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

---------------------------------------------------
> -----------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf
> . Interval]
-------------+-------------------------------------
> -----------
h_flex       |
   _subpop_1 |   8.088027   1.437815      5.265088 
>    10.91097
   _subpop_2 |   1.914678   .7063461      .5278702 
>    3.301485
     Eastern |   7.781384   1.338286      5.153855 
>    10.40891
    Northern |   18.38831   1.732566      14.98667 
>    21.78996
     Western |   9.220304   1.231211      6.803001 
>    11.63761
-------------+-------------------------------------
> -----------
pg_flex      |
   _subpop_1 |   1.692854   .3885907      .9299131 
>    2.455795
   _subpop_2 |   .3293883   .1408386      .0528722 
>    .6059044
     Eastern |   1.521297   .2336501      1.062559 
>    1.980035
    Northern |   6.060577   .8006579      4.488603 
>    7.632552
     Western |   2.365778   .4537375      1.474931 
>    3.256626
-------------+-------------------------------------
> -----------
spg_flex     |
   _subpop_1 |    .544273   .1612903      .2276032 
>    .8609429
   _subpop_2 |   .0731034   .0328303      .0086459 
>    .1375609
     Eastern |    .402008   .0636428      .2770546 
>    .5269614
    Northern |   2.879937   .4367486      2.022445 
>    3.737429
     Western |   .9427215   .2699228      .4127675 
>    1.472676
---------------------------------------------------
> -----------

.         compress;
survquar was float now byte
spdomain was float now byte
reg_tpi was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
rmult was float now int
poor09 was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte
hhsize was double now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file /home/bjvca/data/data/GAP/Haruna/work/cons_rea
> l.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex 
> [aw=hhweight*hhsize], by(strata);

. save "$path/work/povmeas.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/work/povmeas.
> dta saved

. *************************************************
> *************************
> * 130_povmeas_flex.do           (end)
> *************************************************
> *************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/rep/1
> 30_povmeas_flex.log
  log type:  text
 closed on:  20 May 2013, 12:16:31
---------------------------------------------------
