GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  * Filename: 195a_spat_temp_consistent.gms
   2   
   3  * Using stata input files representing CBS poverty lines etc.,
   4  * this gams file adjusts these poverty lines such that they are
   5  * consistent across space and over time (spatial domains and years)
   6   
      This file uses:
               work\product_flex.inc
               in\price_t1.inc
               in\povline_t1_cc.inc
               work\povline_food_fix.inc
               work\price_unit_flex.inc
               work\quan_flex.inc
       
      This file creates:
               work\qent.csv
               work\povline_food_ent.csv
               work\povline_rp_inout.csv
       
  22   
  23  SETS
  24   cod        year t2 (e.g. 2002) codes for products used in basket
  25  /
INCLUDE    /home/bjvca/data/data/GAP/Haruna/work/product_flex.inc
  27  100
  28  105
  29  106
  30  107
  31  108
  32  109
  33  110
  34  111
  35  112
  36  113
  37  114
  38  115
  39  116
  40  117
  41  118
  42  119
  43  121
  44  122
  45  123
  46  125
  47  127
  48  131
  49  132
  50  134
  51  135
  52  136
  53  137
  54  138
  55  139
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


  56  140
  57  141
  58  143
  59  144
  60  145
  61  146
  62  147
  63  150
  64  154
  65  /
  66   
  67   reg        4spatial domains /1*4/
  68   r(reg)     dynamic set on spatial regions
  69   
  70   ptit       price table titles
  71  /
  72    count      number of observations making up the price average
  73    price_uw5  average price
  74  /
  75   
  76   qtit       quantity table titles
  77  /
  78    calperg          calories per gram
  79    quan5            quantities in grams
  80    calpp            calories per person by region
  81    povline_f_flex5  value of flexible food bundle
  82  /
  83   
  84   
  85    posquan(cod,reg)  mark positive quantities in each region
  86    posprice(cod,reg) mark the existence of acceptable price info in each region
  87    pmiss_t1(cod,reg) mark year t1 (e.g. 1996) missing prices
  88    chkprice(cod,reg) ensure that prices exist once all estimated
  89  ;
  90   
  91  *****************************************************
  92  *Work first on all regions
  93  *********************************************************
  94   
  95   r(reg)=yes;
  96   
  97  alias(reg,regq);
  98  alias(r,rq);
  99   
 100  SCALAR
 101     caltarg single level of calories to target across regions /2150/
 102   ;
 103   
 104  PARAMETERS
 105    price_t1(cod,reg)     price information and poverty line for year t1 (e.g. 1996)
 106  /
INCLUDE    /home/bjvca/data/data/GAP/Haruna/in/price_t1.inc
 108  100     .       1       .138133
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 109  105     .       1       .17793
 110  106     .       1       .166463
 111  107     .       1       .07832
 112  108     .       1       .433464
 113  109     .       1       .397339
 114  110     .       1       1.181096
 115  111     .       1       .408468
 116  112     .       1       .235106
 117  113     .       1       .598802
 118  114     .       1       1.221117
 119  115     .       1       .692399
 120  116     .       1       .431453
 121  117     .       1       2.333451
 122  118     .       1       1.910913
 123  119     .       1       2.368849
 124  121     .       1       3.056498
 125  122     .       1       .659818
 126  123     .       1       2.049778
 127  125     .       1       .210652
 128  127     .       1       1.853102
 129  131     .       1       .269597
 130  132     .       1       .149222
 131  134     .       1       .930507
 132  135     .       1       .627244
 133  136     .       1       .10922
 134  138     .       1       .239623
 135  139     .       1       .291155
 136  140     .       1       1.588387
 137  141     .       1       .932375
 138  143     .       1       1.803374
 139  144     .       1       1.561716
 140  145     .       1       1.365703
 141  146     .       1       1.383532
 142  147     .       1       1.708801
 143  150     .       1       .524621
 144  154     .       1       .575653
 145  100     .       2       .142498
 146  105     .       2       .160952
 147  106     .       2       .14594
 148  107     .       2       .063223
 149  108     .       2       .43769
 150  109     .       2       .340801
 151  110     .       2       1.011064
 152  111     .       2       .312087
 153  112     .       2       .212625
 154  113     .       2       .525154
 155  114     .       2       1.15942
 156  115     .       2       .505269
 157  116     .       2       .288116
 158  117     .       2       2.682296
 159  118     .       2       2.059247
 160  119     .       2       2.715838
 161  121     .       2       2.800217
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 162  122     .       2       .750924
 163  123     .       2       2.032916
 164  125     .       2       .143277
 165  127     .       2       1.772165
 166  131     .       2       .272936
 167  132     .       2       .106769
 168  134     .       2       .858808
 169  135     .       2       .379173
 170  136     .       2       .109379
 171  138     .       2       .273556
 172  139     .       2       .293454
 173  140     .       2       1.625508
 174  141     .       2       .838464
 175  143     .       2       1.73288
 176  144     .       2       1.303079
 177  145     .       2       .894289
 178  146     .       2       1.293512
 179  147     .       2       1.681167
 180  150     .       2       .475706
 181  154     .       2       1.026051
 182  100     .       3       .145245
 183  105     .       3       .082027
 184  106     .       3       .098003
 185  107     .       3       .026219
 186  108     .       3       .530015
 187  109     .       3       .905046
 188  110     .       3       1.007408
 189  111     .       3       .267167
 190  112     .       3       .170679
 191  113     .       3       .333295
 192  114     .       3       1.578027
 193  115     .       3       .352225
 194  116     .       3       .294592
 195  117     .       3       2.423799
 196  118     .       3       1.914438
 197  119     .       3       2.045556
 198  121     .       3       2.233073
 199  122     .       3       .698453
 200  123     .       3       2.504108
 201  125     .       3       .06319
 202  127     .       3       2.231234
 203  131     .       3       .445646
 204  132     .       3       .045511
 205  134     .       3       .277782
 206  135     .       3       .244367
 207  136     .       3       .100608
 208  138     .       3       .203185
 209  139     .       3       .194058
 210  140     .       3       .747075
 211  141     .       3       1.183308
 212  143     .       3       1.321482
 213  144     .       3       1.75
 214  145     .       3       .622683
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 215  146     .       3       .971427
 216  147     .       3       1.686355
 217  150     .       3       .42525
 218  154     .       3       .635597
 219  100     .       4       .103483
 220  105     .       4       .156274
 221  106     .       4       .110049
 222  107     .       4       .086952
 223  108     .       4       .394176
 224  109     .       4       .234223
 225  110     .       4       1.088738
 226  111     .       4       .389477
 227  112     .       4       .19808
 228  113     .       4       .550598
 229  114     .       4       1.258574
 230  115     .       4       .6002
 231  116     .       4       .359293
 232  117     .       4       2.232269
 233  118     .       4       1.977466
 234  119     .       4       2.611423
 235  121     .       4       2.895597
 236  122     .       4       1.174343
 237  123     .       4       3.942898
 238  125     .       4       .111473
 239  127     .       4       2.299935
 240  131     .       4       .250431
 241  132     .       4       .074629
 242  134     .       4       .347652
 243  135     .       4       .311016
 244  136     .       4       .158262
 245  138     .       4       .242848
 246  139     .       4       .316831
 247  140     .       4       1.14106
 248  141     .       4       1.14431
 249  143     .       4       2.123574
 250  144     .       4       1.508856
 251  145     .       4       .892645
 252  146     .       4       1.266919
 253  147     .       4       1.75744
 254  150     .       4       .624159
 255  154     .       4       .293994
 256  /
 257    foodpov_t1(reg)       food pov line P_t1*Q_t1 ADJUSTED to hit 2150 calories
 258  /
INCLUDE    /home/bjvca/data/data/GAP/Haruna/in/povline_t1_cc.inc
 260  1       431.3452
 261  2       395.3875
 262  3       317.3611
 263  4       417.0559
 264  /
 265    shr(cod,reg)           shares in each basket by region
 266    chkshr(reg)            check that the calculated shares sum to .9
 267    shrmiss(regq,reg)      shares missing in each region pair
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 268    povline_food(reg)      food poverty line
 269    perc_chng(reg)         percent change in line
 270    origmiss(reg)          original share of items without price obs in year t1 (e.g. 1996)
 271    finmiss(reg)           final missing shares post optimization procedure
 272    povline_food_fix(reg)  food pov line Q_t1*P_t2 NOT adjusted to 2150 calories
 273   /
INCLUDE    /home/bjvca/data/data/GAP/Haruna/work/povline_food_fix.inc
 275  1       837.8335
 276  2       496.4296
 277  3       735.1486
 278  4       710.7284
 279   /
 280   ;
 281   
 282  Table  price(cod,reg,ptit)  price and related information
 283                          count   price_uw5
INCLUDE    /home/bjvca/data/data/GAP/Haruna/work/price_unit_flex.inc
 285  100     .       1       270     .5074245
 286  100     .       2       64      .2801054
 287  100     .       3       23      .4988728
 288  100     .       4       444     .3546883
 289  105     .       1       306     .253148
 290  105     .       2       218     .2109564
 291  105     .       3       281     .4739078
 292  105     .       4       342     .1815912
 293  106     .       1       5       .1589132
 294  106     .       2       19      .0822436
 295  106     .       3       11      .1794924
 296  106     .       4       12      .1462639
 297  107     .       1       264     .0984313
 298  107     .       2       211     .0535742
 299  107     .       3       298     .0560229
 300  107     .       4       334     .0598366
 301  108     .       1       66      .4679801
 302  108     .       2       267     .4708041
 303  108     .       3       256     .6013363
 304  108     .       4       194     .3235234
 305  109     .       1       34      .2559442
 306  109     .       2       11      .3409889
 307  109     .       3       3       .9329188
 308  109     .       4       129     .2065729
 309  110     .       1       54      1.989712
 310  110     .       2       79      1.012413
 311  110     .       3       60      1.376698
 312  110     .       4       54      1.253445
 313  111     .       1       15      .2251857
 314  111     .       2       16      .1996361
 315  111     .       3       201     .4606979
 316  111     .       4       27      .343871
 317  112     .       1       108     .4104002
 318  112     .       2       120     .2174019
 319  112     .       3       87      .3240004
 320  112     .       4       108     .2550528
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 7
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 321  113     .       1       319     1.077043
 322  113     .       2       238     .6386356
 323  113     .       3       391     .8230098
 324  113     .       4       282     .6725507
 325  114     .       1       58      1.924915
 326  114     .       2       66      1.017954
 327  114     .       3       102     1.466963
 328  114     .       4       62      1.012255
 329  115     .       1       24      1.110367
 330  115     .       2       91      .6421999
 331  115     .       3       55      .7170822
 332  115     .       4       124     .7479286
 333  116     .       1       6       .8121275
 334  116     .       2       117     .3693466
 335  116     .       3       534     .5067688
 336  116     .       4       33      .4661861
 337  117     .       1       78      3.812905
 338  117     .       2       121     2.521683
 339  117     .       3       190     3.415871
 340  117     .       4       124     2.546052
 341  118     .       1       36      3.200788
 342  118     .       2       26      2.047246
 343  118     .       3       26      3.313731
 344  118     .       4       51      2.332381
 345  119     .       1       6       3.906803
 346  119     .       2       32      2.414677
 347  119     .       3       54      3.589427
 348  119     .       4       38      2.88537
 349  121     .       1       17      4.187431
 350  121     .       2       48      2.574636
 351  121     .       3       58      4.024446
 352  121     .       4       17      3.014909
 353  122     .       1       58      .820943
 354  122     .       2       108     .7156202
 355  122     .       3       56      1.469584
 356  122     .       4       54      .8338939
 357  123     .       1       133     1.416296
 358  123     .       2       198     .693288
 359  123     .       3       268     .9964128
 360  123     .       4       58      .3423894
 361  125     .       1       153     .0758141
 362  125     .       2       145     .0525396
 363  125     .       3       181     .0654769
 364  125     .       4       143     .0511846
 365  127     .       1       264     2.263896
 366  127     .       2       283     1.425161
 367  127     .       3       631     2.866398
 368  127     .       4       123     1.625753
 369  131     .       1       84      .6499739
 370  131     .       2       22      .5950614
 371  131     .       3       24      .729272
 372  131     .       4       130     .3698345
 373  132     .       1       79      .4013342
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 8
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 374  132     .       2       146     .1652309
 375  132     .       3       136     .2345183
 376  132     .       4       74      .1975535
 377  134     .       1       128     1.154731
 378  134     .       2       102     .9783617
 379  134     .       3       51      .4418103
 380  134     .       4       128     .2546878
 381  135     .       1       314     1.10213
 382  135     .       2       313     .7649037
 383  135     .       3       585     1.042901
 384  135     .       4       357     .7530327
 385  136     .       1       355     1.015713
 386  136     .       2       343     .6795771
 387  136     .       3       347     1.163813
 388  136     .       4       391     .437395
 389  137     .       1       80      .3521306
 390  137     .       2       121     .3350618
 391  137     .       3       150     .6077849
 392  137     .       4       112     .2673859
 393  138     .       1       188     .4162406
 394  138     .       2       252     .2325988
 395  138     .       3       299     .2808345
 396  138     .       4       363     .2119729
 397  140     .       1       89      .9162363
 398  140     .       2       92      1.084379
 399  140     .       3       89      1.49477
 400  140     .       4       182     .8768239
 401  141     .       1       271     1.3659
 402  141     .       2       191     1.033428
 403  141     .       3       724     2.078857
 404  141     .       4       432     1.099761
 405  144     .       1       180     2.190898
 406  144     .       2       92      .9242625
 407  144     .       3       11      1.735983
 408  144     .       4       163     1.462797
 409  145     .       1       5       2.032165
 410  145     .       2       35      1.071573
 411  145     .       3       119     1.773254
 412  145     .       4       17      1.213223
 413  146     .       2       17      1.53859
 414  146     .       3       263     1.670113
 415  146     .       4       4       1.498351
 416  147     .       1       310     2.049743
 417  147     .       2       334     1.419047
 418  147     .       3       294     2.012181
 419  147     .       4       225     1.388063
 420  150     .       1       441     .8013048
 421  150     .       2       471     .5153803
 422  150     .       3       1004    .7253575
 423  150     .       4       603     .6012651
 424  154     .       1       6       .3334954
 425  154     .       2       5       .4523052
 426  154     .       3       157     .3192458
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                         03/07/14 11:41:42 Page 9
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 427  154     .       4       34      .2526606
 428  ;
 429   
 430  Table   quan(cod,reg,qtit)   quantity and related information
 431                             calperg          quan5           calpp      povline_f_flex5
INCLUDE    /home/bjvca/data/data/GAP/Haruna/work/quan_flex.inc
 433  100     .       1       6.8900000e-01   1.5635237e+02   2.2565869e+03   658.8712
 434  105     .       1       1.0164000e+00   3.5264883e+02   2.2565869e+03   658.8712
 435  107     .       1       1.3440000e+00   5.3243719e+02   2.2565869e+03   658.8712
 436  108     .       1       3.1400000e+00   3.4897972e+01   2.2565869e+03   658.8712
 437  110     .       1       3.6100000e+00   4.9594617e+00   2.2565869e+03   658.8712
 438  112     .       1       9.4600000e-01   3.9456203e+01   2.2565869e+03   658.8712
 439  113     .       1       3.6500000e+00   8.1450729e+01   2.2565869e+03   658.8712
 440  114     .       1       2.6600000e+00   5.5625501e+00   2.2565869e+03   658.8712
 441  117     .       1       1.7982000e+00   3.7502258e+00   2.2565869e+03   658.8712
 442  122     .       1       6.1610000e-01   1.0358532e+01   2.2565869e+03   658.8712
 443  123     .       1       3.7500000e+00   8.4952021e+00   2.2565869e+03   658.8712
 444  125     .       1       6.0000000e-01   2.3335483e+02   2.2565869e+03   658.8712
 445  127     .       1       8.8400000e+00   5.1038651e+00   2.2565869e+03   658.8712
 446  132     .       1       4.3310000e-01   2.0395126e+01   2.2565869e+03   658.8712
 447  134     .       1       4.9400000e-01   1.0773477e+01   2.2565869e+03   658.8712
 448  135     .       1       3.6400000e-01   5.8261733e+00   2.2565869e+03   658.8712
 449  136     .       1       1.6380000e-01   1.3444016e+01   2.2565869e+03   658.8712
 450  138     .       1       2.0160000e-01   3.2999004e+01   2.2565869e+03   658.8712
 451  140     .       1       1.0300000e+00   1.7730484e+01   2.2565869e+03   658.8712
 452  141     .       1       3.1300000e+00   3.3212990e+01   2.2565869e+03   658.8712
 453  144     .       1       5.8800000e+00   6.4975829e+00   2.2565869e+03   658.8712
 454  147     .       1       3.8700000e+00   1.7941444e+01   2.2565869e+03   658.8712
 455  100     .       2       6.8900000e-01   2.3991013e+01   2.1924021e+03   378.6755
 456  105     .       2       1.0164000e+00   1.6883804e+02   2.1924021e+03   378.6755
 457  106     .       2       3.4300000e+00   4.5241360e+01   2.1924021e+03   378.6755
 458  107     .       2       1.3440000e+00   3.5009326e+02   2.1924021e+03   378.6755
 459  108     .       2       3.1400000e+00   1.4039172e+02   2.1924021e+03   378.6755
 460  110     .       2       3.6100000e+00   5.9871168e+00   2.1924021e+03   378.6755
 461  112     .       2       9.4600000e-01   3.4028164e+01   2.1924021e+03   378.6755
 462  113     .       2       3.6500000e+00   6.4591690e+01   2.1924021e+03   378.6755
 463  115     .       2       3.7800000e+00   1.7475002e+01   2.1924021e+03   378.6755
 464  116     .       2       3.3900000e+00   3.6342937e+01   2.1924021e+03   378.6755
 465  117     .       2       1.7982000e+00   4.8749328e+00   2.1924021e+03   378.6755
 466  121     .       2       1.4835000e+00   2.4175415e+00   2.1924021e+03   378.6755
 467  122     .       2       6.1610000e-01   1.4514835e+01   2.1924021e+03   378.6755
 468  123     .       2       3.7500000e+00   1.7042601e+01   2.1924021e+03   378.6755
 469  125     .       2       6.0000000e-01   1.3257535e+02   2.1924021e+03   378.6755
 470  127     .       2       8.8400000e+00   5.1216202e+00   2.1924021e+03   378.6755
 471  132     .       2       4.3310000e-01   5.3832085e+01   2.1924021e+03   378.6755
 472  134     .       2       4.9400000e-01   4.2576976e+00   2.1924021e+03   378.6755
 473  136     .       2       1.6380000e-01   9.2046528e+00   2.1924021e+03   378.6755
 474  138     .       2       2.0160000e-01   4.3475204e+01   2.1924021e+03   378.6755
 475  140     .       2       1.0300000e+00   7.2884512e+00   2.1924021e+03   378.6755
 476  141     .       2       3.1300000e+00   1.4190257e+01   2.1924021e+03   378.6755
 477  147     .       2       3.8700000e+00   1.3346783e+01   2.1924021e+03   378.6755
 478  150     .       2       0.0000000e+00   8.9667158e+00   2.1924021e+03   378.6755
 479  105     .       3       1.0164000e+00   5.4281929e+01   2.1999929e+03   445.9425
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 10
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 480  107     .       3       1.3440000e+00   5.4794843e+02   2.1999929e+03   445.9425
 481  108     .       3       3.1400000e+00   6.7533394e+01   2.1999929e+03   445.9425
 482  111     .       3       3.6500000e+00   3.1028055e+01   2.1999929e+03   445.9425
 483  112     .       3       9.4600000e-01   1.8621624e+01   2.1999929e+03   445.9425
 484  113     .       3       3.6500000e+00   4.0794098e+01   2.1999929e+03   445.9425
 485  116     .       3       3.3900000e+00   1.2586672e+02   2.1999929e+03   445.9425
 486  117     .       3       1.7982000e+00   2.8264091e+00   2.1999929e+03   445.9425
 487  121     .       3       1.4835000e+00   1.5944095e+00   2.1999929e+03   445.9425
 488  122     .       3       6.1610000e-01   3.7050130e+00   2.1999929e+03   445.9425
 489  123     .       3       3.7500000e+00   1.1474658e+01   2.1999929e+03   445.9425
 490  125     .       3       6.0000000e-01   1.5102534e+02   2.1999929e+03   445.9425
 491  127     .       3       8.8400000e+00   5.6074462e+00   2.1999929e+03   445.9425
 492  132     .       3       4.3310000e-01   2.4118952e+01   2.1999929e+03   445.9425
 493  135     .       3       3.6400000e-01   4.8665285e+00   2.1999929e+03   445.9425
 494  136     .       3       1.6380000e-01   5.6276121e+00   2.1999929e+03   445.9425
 495  138     .       3       2.0160000e-01   2.3981817e+01   2.1999929e+03   445.9425
 496  140     .       3       1.0300000e+00   4.0149751e+00   2.1999929e+03   445.9425
 497  141     .       3       3.1300000e+00   2.5437525e+01   2.1999929e+03   445.9425
 498  145     .       3       8.1000000e-01   3.4768729e+00   2.1999929e+03   445.9425
 499  146     .       3       5.7300000e+00   7.5197406e+00   2.1999929e+03   445.9425
 500  147     .       3       3.8700000e+00   5.9492493e+00   2.1999929e+03   445.9425
 501  150     .       3       0.0000000e+00   1.0632328e+01   2.1999929e+03   445.9425
 502  154     .       3       8.1000000e-01   2.0081942e+01   2.1999929e+03   445.9425
 503  100     .       4       6.8900000e-01   2.7360489e+02   2.2343252e+03   479.8994
 504  105     .       4       1.0164000e+00   2.5732593e+02   2.2343252e+03   479.8994
 505  107     .       4       1.3440000e+00   5.3835669e+02   2.2343252e+03   479.8994
 506  108     .       4       3.1400000e+00   6.4628952e+01   2.2343252e+03   479.8994
 507  109     .       4       6.4680000e-01   9.1317825e+01   2.2343252e+03   479.8994
 508  112     .       4       9.4600000e-01   3.0795214e+01   2.2343252e+03   479.8994
 509  113     .       4       3.6500000e+00   4.7044151e+01   2.2343252e+03   479.8994
 510  115     .       4       3.7800000e+00   1.6349913e+01   2.2343252e+03   479.8994
 511  117     .       4       1.7982000e+00   5.0376287e+00   2.2343252e+03   479.8994
 512  118     .       4       2.3534000e+00   2.3648038e+00   2.2343252e+03   479.8994
 513  119     .       4       1.2210000e+00   1.3865262e+00   2.2343252e+03   479.8994
 514  122     .       4       6.1610000e-01   7.9098606e+00   2.2343252e+03   479.8994
 515  123     .       4       3.7500000e+00   1.2369567e+01   2.2343252e+03   479.8994
 516  125     .       4       6.0000000e-01   1.8208632e+02   2.2343252e+03   479.8994
 517  134     .       4       4.9400000e-01   1.8259539e+01   2.2343252e+03   479.8994
 518  135     .       4       3.6400000e-01   5.3842325e+00   2.2343252e+03   479.8994
 519  136     .       4       1.6380000e-01   1.7952995e+01   2.2343252e+03   479.8994
 520  138     .       4       2.0160000e-01   3.8210609e+01   2.2343252e+03   479.8994
 521  140     .       4       1.0300000e+00   2.7341145e+01   2.2343252e+03   479.8994
 522  141     .       4       3.1300000e+00   4.4246002e+01   2.2343252e+03   479.8994
 523  144     .       4       5.8800000e+00   5.3176265e+00   2.2343252e+03   479.8994
 524  147     .       4       3.8700000e+00   7.2303329e+00   2.2343252e+03   479.8994
 525  150     .       4       0.0000000e+00   1.1358236e+01   2.2343252e+03   479.8994
 526  ;
 527   
 528  *CA March 2009 - adjust fixed bundle line to hit 2150 calories
 529    loop(cod$(ord(cod) eq 1),
 530      povline_food_fix(reg)= povline_food_fix(reg)*2150/quan(cod,reg,'calpp');
 531    );
 532   
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 11
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 533    shr(cod,reg)$quan(cod,reg,'povline_f_flex5')
 534                        =price(cod,reg,'price_uw5')*quan(cod,reg,'quan5')/
 535                         quan(cod,reg,'povline_f_flex5');
 536   
 537    chkshr(reg)=sum(cod,shr(cod,reg));
 538   
 539  loop(reg,
 540    abort$(abs(chkshr(reg)-.9) gt .0001) "share does not sum to .9", chkshr ;
 541  );
 542   
 543   
 544  *turn on dynamic sets to indicate positive quantities and existence of
 545  *price info for each region
 546   
 547   posprice(cod,reg)$(price(cod,reg,'price_uw5')
 548                        AND price(cod,reg,'count') gt 4) = yes;
 549   
 550   posquan(cod,reg)$quan(cod,reg,'quan5')=yes;
 551   
 552   pmiss_t1(cod,reg)$(NOT price_t1(cod,reg) AND posquan(cod,reg))=yes;
 553   
 554   display pmiss_t1;
 555   
 556    loop(reg,
 557         abort$(foodpov_t1(reg) eq 0) "missing a food poverty line", foodpov_t1;
 558   );
 559   
 560   shrmiss(regq,reg)=sum(cod$(NOT posprice(cod,reg)), shr(cod,regq));
 561   display shrmiss;
 562   
 563   origmiss(reg)=sum(cod$pmiss_t1(cod,reg), shr(cod,reg));
 564   display origmiss;
 565   
 566    povline_food(reg)=sum(cod$posquan(cod,reg),price(cod,reg,'price_uw5')*
 567                                             quan(cod,reg,'quan5'))/.9;
 568   
 569    display povline_food;
 570   
 571   
 572  *boost values so shares sum to one;
 573  shr(cod,reg)=shr(cod,reg)/chkshr(reg);
 574   
 575  *fill out price matrix with maximum observed price outside of Maputo
 576   r(reg)=no;
 577   r(reg)$(ord(reg) le 10)=yes;
 578  loop((cod,r)$(NOT posprice(cod,r) AND posquan(cod,r)),
 579           loop(rq,
 580                   price(cod,r,'price_uw5')=max(price(cod,r,'price_uw5'),
 581                                                price(cod,rq,'price_uw5'));
 582           );
 583  );
 584   
 585  *fill out price matrix with maximum observed price within Maputo
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 12
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 586   r(reg)=no;
 587   r(reg)$(ord(reg) gt 10)=yes;
 588  loop((cod,r)$(NOT posprice(cod,r) AND posquan(cod,r)),
 589           loop(rq,
 590                   price(cod,r,'price_uw5')=max(price(cod,r,'price_uw5'),
 591                                                price(cod,rq,'price_uw5'));
 592           );
 593  );
 594   
 595  *Back to r indexing all regions
 596   r(reg)=yes;
 597   
 598  chkprice(cod,reg)$(NOT price(cod,reg,'price_uw5') AND posquan(cod,reg))=yes;
 599   
 600  display 'should be an empty set', chkprice;
 601   
 602  Variables
 603     z                 objective value
 604     q(cod,reg)        revised maximum entropy quanties in grams
 605     s(cod,reg)        derived maximum entropy shares
 606     povline(regq,reg) estimated revealed preference matrix
 607     povline_t1(regq)  value of estimated bundle at year t1 (e.g. 1996) prices
 608  ;
 609   
 610   
 611  Equations
 612     obj              objective equation
 613     rev(regq,reg)    revealed preference tests
 614     deflin(regq,reg) define revealed preference matrix
 615     defshr(cod,regq) define the endogenous budget shares
 616     deflin_t1(reg)   define the value of the bundle at year t1 (e.g. 1996) prices
 617     cals(regq)       ensure that each bundle hits the calorie
 618   
 619  ;
 620   
 621     obj ..  z=e= sum((cod,rq)$posquan(cod,rq),
 622                     s(cod,rq)*log(s(cod,rq)/shr(cod,rq)));
 623   
 624     deflin(rq,r) .. povline(rq,r) =e= sum(cod$posquan(cod,rq),
 625                            q(cod,rq)*price(cod,r,'price_uw5'));
 626   
 627     rev(rq,r) ..    povline(r,rq)=g=povline(rq,rq);
 628   
 629     defshr(cod,rq)$posquan(cod,rq) ..
 630               povline(rq,rq)*s(cod,rq)=e= q(cod,rq)*price(cod,rq,'price_uw5');
 631   
 632     deflin_t1(rq) .. povline_t1(rq)*(.9-sum(cod$pmiss_t1(cod,rq),s(cod,rq))) =e=
 633                         sum(cod$(posquan(cod,rq) AND NOT pmiss_t1(cod,rq)),
 634                           q(cod,rq)*price_t1(cod,rq));
 635   
 636     cals(rq) .. sum(cod$posquan(cod,rq),
 637                      q(cod,rq)*quan(cod,rq,'calperg'))=e=.95*caltarg;
 638   
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 13
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 639  *set bounds and starting values for variables
 640   
 641    q.lo(cod,reg)=.00001;
 642    q.up(cod,reg)=inf;
 643    q.l(cod,reg)=quan(cod,reg,'quan5');
 644    q.fx(cod,reg)$(NOT posquan(cod,reg))=0;
 645   
 646    povline.l(regq,reg)= sum(cod$posquan(cod,regq),
 647                            q.l(cod,regq)*price(cod,reg,'price_uw5'));
 648   
 649    povline.up(regq,regq)=povline_food_fix(regq)*.9;
 650   
 651    display povline.l;
 652   
 653  *print the revealed preference matrix prior to optimisation;
 654  file povline_rp /work\povline_rp_inout.csv/;
 655  put povline_rp;
 656  povline_rp.pc=5;
 657  povline_rp.nd=0;
 658  put " ";
 659  loop(reg,
 660        put reg.tl;
 661  );
 662  put /;
 663  loop(regq,
 664       put regq.tl;
 665       loop(reg,
 666           put povline.l(regq,reg);
 667       );
 668       put /;
 669  );
 670  put /; put /; put /;
 671   
 672     s.l(cod,regq)= q.l(cod,regq)*price(cod,regq,'price_uw5')/povline.l(regq,regq);
 673     s.lo(cod,regq)=.0001;
 674     s.fx(cod,regq)$(NOT posquan(cod,regq))=0;
 675   
 676     povline_t1.l(reg)=1.2*foodpov_t1(reg);
 677     povline_t1.lo(reg)=foodpov_t1(reg);
 678   
 679     model revpref /obj, deflin, rev, defshr, deflin_t1, cals/;
 680     model revprefnotemp /obj, deflin, rev, defshr, cals/;
 681   
 682     revpref.holdfixed=1;
 683   
 684     option limrow=100;
 685   
 686     option nlp=conopt;
 687   
 688  *run procedure on all regions
 689     r(reg)=yes;
 690   
 691  *CAtemp
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 14
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 692  *Check without temporal conditions  ***NEED TO UNDO THIS!!!!!!!!!!!!!!!!!!!!
 693   
 694  *   solve revpref using nlp minimizing z;
 695   
 696    povline.up(regq,regq)=inf;
 697   
 698     solve revpref using nlp minimizing z;
 699   
 700   
 701     abort$(revpref.modelstat ne 2) "Model did not solve properly";
 702   
 703     povline.l(regq,reg)$(NOT rq(regq) OR NOT r(reg))=0;
 704     display "this is without adjustment for calorie target or 90%", povline.l;
 705   
 706  put /;
 707  loop(rq,
 708       put rq.tl;
 709       loop(r,
 710           put povline.l(rq,r);
 711       );
 712       put /;
 713  );
 714  put /;
 715   
 716   
 717     finmiss(r)=sum(cod$pmiss_t1(cod,r),s.l(cod,r));
 718     display finmiss;
 719   
 720  PARAMETERS
 721     qent(cod,reg)  entropy quantities with all adjustments accounted for
 722     povline_ent(reg) entropy line that hits calorie targets (100% food expen)
 723    ;
 724  *readjust quantities to hit regional calorie target and calculate line;
 725     qent(cod,r)=q.l(cod,r)*quan(cod,r,'calpp')/caltarg;
 726   
 727     povline_ent(r)=sum(cod$posquan(cod,r),price(cod,r,'price_uw5')*
 728                                             qent(cod,r))/.9;
 729   
 730     perc_chng(r)=100*(povline_ent(r)/povline_food(r)-1);
 731   
 732  *CA March 2009 - adjust fixed bundle line to hit 2150 calories
 733    loop(cod$(ord(cod) eq 1),
 734       povline_food_fix(reg)= povline_food_fix(reg)*quan(cod,reg,'calpp')/2150;
 735    );
 736     display perc_chng, povline_ent, povline_food;
 737   
 738     file res /work\qent.csv/;
 739   
 740     put res;
 741     res.pc=5;
 742     res.nd=6;
 743   
 744  *recall that the basket reflects 90% of expenditure and 95% of calories";
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 15
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


 745     put "spdomain" ;
 746     put "product" ;
 747     put "quan5";
 748     put "qent";
 749     put "price";
 750     put "calperg";
 751   
 752     put /;
 753   
 754     loop(reg,
 755         loop(cod,
 756             put reg.tl;
 757             put cod.tl;
 758             put quan(cod,reg,'quan5');
 759             put qent(cod,reg);
 760             put price(cod,reg,'price_uw5')
 761             put quan(cod,reg,'calperg');
 762             put /;
 763         );
 764     );
 765   
 766     file lin /work\povline_food_ent.csv/;
 767   
 768     put lin;
 769     lin.pc=5;
 770  *Flexible, entropy, and fixed food pov lines at 100% expenditure
 771   
 772     put "spdomain";
 773     put "flex";
 774     put "ent";
 775     put "fix";
 776     put /;
 777   
 778     loop(reg,
 779           put reg.tl;
 780           put povline_food(reg);
 781           put povline_ent(reg);
 782           put povline_food_fix(reg);
 783           put /;
 784     );
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 16
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  /home/bjvca/data/data/GAP/Haruna/new/195a_spat_temp_consistent_bjorn.gms
     2       26 INCLUDE        1      26  ./home/bjvca/data/data/GAP/Haruna/work/product_flex.inc
     3      107 INCLUDE        1      69  ./home/bjvca/data/data/GAP/Haruna/in/price_t1.inc
     4      259 INCLUDE        1      73  ./home/bjvca/data/data/GAP/Haruna/in/povline_t1_cc.inc
     5      274 INCLUDE        1      84  ./home/bjvca/data/data/GAP/Haruna/work/povline_food_fix.inc
     6      284 INCLUDE        1      90  ./home/bjvca/data/data/GAP/Haruna/work/price_unit_flex.inc
     7      432 INCLUDE        1      95  ./home/bjvca/data/data/GAP/Haruna/work/quan_flex.inc


COMPILATION TIME     =        0.004 SECONDS      3 MB  24.1.2 r40979 LEX-LEG
GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 17
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


**** Exec Error at line 530: division by zero (0)

----    554 SET pmiss_t1  mark year t1 (e.g. 1996) missing prices

                                                      ( EMPTY )


----    561 PARAMETER shrmiss  shares missing in each region pair

            1           3           4

3       0.028                   0.028
4                   0.039


----    564 PARAMETER origmiss  original share of items without price obs in year t1 (e.g. 1996)

                      ( ALL       0.000 )


----    569 PARAMETER povline_food  food poverty line

1 658.871,    2 378.675,    3 445.942,    4 479.899


----    600 should be an empty set

----    600 SET chkprice  ensure that prices exist once all estimated

                                                      ( EMPTY )


----    651 VARIABLE povline.L  estimated revealed preference matrix

            1           2           3           4

1     592.984     396.909     640.612     391.188
2     507.609     340.808     506.751     325.418
3     424.600     279.203     401.348     284.574
4     644.274     452.738     749.147     431.909

GAMS 24.1.2  r40979 Released Jun 16, 2013 LEX-LEG x86_64/Linux                                                                                                                                                                        03/07/14 11:41:42 Page 18
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Setup/Generation    SOLVE revpref Using NLP From line 698


**** SOLVE from line 698 ABORTED
**** EXECERROR=1

**** REPORT FILE SUMMARY

povline_rp /home/bjvca/data/data/GAP/Haruna/work\povline_rp_inout.csv


EXECUTION TIME       =        0.002 SECONDS      4 MB  24.1.2 r40979 LEX-LEG


USER: Computer Services                              G130401:1333CP-GEN
      International Food Policy Research Institute               DC2119


**** FILE SUMMARY

Input      /home/bjvca/data/data/GAP/Haruna/new/195a_spat_temp_consistent_bjorn.gms
Output     /home/bjvca/data/data/GAP/Haruna/new/list2.lst

**** USER ERROR(S) ENCOUNTERED
