library(foreign)
conversions <- read.dta("/home/bjvca/data/data/GAP/Haruna/conversionfactors.dta") 
conversions_cor <- conversions

data <- read.dta("/home/bjvca/data/data/GAP/Haruna/UNPS_2009_10/work/cons_cod.dta")

zz <- file("all.Rout", open = "wt")
sink(zz)
data$price <-  data$cod_hh_nom/data$quantity
for (prod in names(table(data$product))) {


datas <- subset(data,data$product==prod)
table(datas$untcd)
med <- median(datas$price[datas$untcd==names(table(datas$untcd))[table(datas$untcd)==max(table(datas$untcd))]], na.rm=T)

for (unitcode in names(table(data$untcd))) {

datass <- subset(datas,datas$untcd==unitcode)
datass$cod_hh_nom/med -> datass$quant_cor


print(c(prod,unitcode,1/median(datass$quantityd/datass$quant_cor, na.rm=T)))

}

}
*get the average price
sink()

