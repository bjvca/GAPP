-----------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_20
> 05\GAPP2/rep/070_calpp.log
  log type:  text
 opened on:   9 Jul 2013, 11:07:12

. clear

. set more off

. #delimit ;
delimiter now ;
. *global fert_rate "fert_rate";
. *********************************************************************
> **
> * 070_calpp.do          (start)
> *
> * Purpose: Determine calories required for each person per domain per
>  day.
> *********************************************************************
> **;
. /*
> This file uses:
>         work/indata.dta
>         work/hhdata.dta
> 
> This file creates:
>         work/calpp.dta
> */
> 
> *--------------------------------------------------------------------
> -----*
> * Include fertility rates from csv-file
> *--------------------------------------------------------------------
> -----*;
. clear;

. insheet sex rural age fert_rate using "$path/in/fert_rate_Uganda.csv"
> ;
(4 vars, 96 obs)

. ***************************************** check for Ugandan fertility
>  rates *************************************
> *********************************************************************
> ****************************************;
. sort sex rural age;

. tempfile fert_rate;

. save `fert_rate';
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000001.tmp saved

. list;

     +------------------------------+
     | sex   rural   age   fert_r~e |
     |------------------------------|
  1. |   2       0    12       .008 |
  2. |   2       0    13       .008 |
  3. |   2       0    14       .008 |
  4. |   2       0    15       .134 |
  5. |   2       0    16       .134 |
     |------------------------------|
  6. |   2       0    17       .134 |
  7. |   2       0    18       .134 |
  8. |   2       0    19       .134 |
  9. |   2       0    20       .313 |
 10. |   2       0    21       .313 |
     |------------------------------|
 11. |   2       0    22       .313 |
 12. |   2       0    23       .313 |
 13. |   2       0    24       .313 |
 14. |   2       0    25       .291 |
 15. |   2       0    26       .291 |
     |------------------------------|
 16. |   2       0    27       .291 |
 17. |   2       0    28       .291 |
 18. |   2       0    29       .291 |
 19. |   2       0    30       .232 |
 20. |   2       0    31       .232 |
     |------------------------------|
 21. |   2       0    32       .232 |
 22. |   2       0    33       .232 |
 23. |   2       0    34       .232 |
 24. |   2       0    35       .172 |
 25. |   2       0    36       .172 |
     |------------------------------|
 26. |   2       0    37       .172 |
 27. |   2       0    38       .172 |
 28. |   2       0    39       .172 |
 29. |   2       0    40       .074 |
 30. |   2       0    41       .074 |
     |------------------------------|
 31. |   2       0    42       .074 |
 32. |   2       0    43       .074 |
 33. |   2       0    44       .074 |
 34. |   2       0    45       .023 |
 35. |   2       0    46       .023 |
     |------------------------------|
 36. |   2       0    47       .023 |
 37. |   2       0    48       .023 |
 38. |   2       0    49       .023 |
 39. |   2       0    50       .006 |
 40. |   2       0    51       .006 |
     |------------------------------|
 41. |   2       0    52       .006 |
 42. |   2       0    53       .006 |
 43. |   2       0    54       .006 |
 44. |   2       0    55       .006 |
 45. |   2       0    56       .006 |
     |------------------------------|
 46. |   2       0    57       .006 |
 47. |   2       0    58       .006 |
 48. |   2       0    59       .006 |
 49. |   2       1    12       .008 |
 50. |   2       1    13       .008 |
     |------------------------------|
 51. |   2       1    14       .008 |
 52. |   2       1    15       .134 |
 53. |   2       1    16       .134 |
 54. |   2       1    17       .134 |
 55. |   2       1    18       .134 |
     |------------------------------|
 56. |   2       1    19       .134 |
 57. |   2       1    20       .313 |
 58. |   2       1    21       .313 |
 59. |   2       1    22       .313 |
 60. |   2       1    23       .313 |
     |------------------------------|
 61. |   2       1    24       .313 |
 62. |   2       1    25       .291 |
 63. |   2       1    26       .291 |
 64. |   2       1    27       .291 |
 65. |   2       1    28       .291 |
     |------------------------------|
 66. |   2       1    29       .291 |
 67. |   2       1    30       .232 |
 68. |   2       1    31       .232 |
 69. |   2       1    32       .232 |
 70. |   2       1    33       .232 |
     |------------------------------|
 71. |   2       1    34       .232 |
 72. |   2       1    35       .172 |
 73. |   2       1    36       .172 |
 74. |   2       1    37       .172 |
 75. |   2       1    38       .172 |
     |------------------------------|
 76. |   2       1    39       .172 |
 77. |   2       1    40       .074 |
 78. |   2       1    41       .074 |
 79. |   2       1    42       .074 |
 80. |   2       1    43       .074 |
     |------------------------------|
 81. |   2       1    44       .074 |
 82. |   2       1    45       .023 |
 83. |   2       1    46       .023 |
 84. |   2       1    47       .023 |
 85. |   2       1    48       .023 |
     |------------------------------|
 86. |   2       1    49       .023 |
 87. |   2       1    50       .006 |
 88. |   2       1    51       .006 |
 89. |   2       1    52       .006 |
 90. |   2       1    53       .006 |
     |------------------------------|
 91. |   2       1    54       .006 |
 92. |   2       1    55       .006 |
 93. |   2       1    56       .006 |
 94. |   2       1    57       .006 |
 95. |   2       1    58       .006 |
     |------------------------------|
 96. |   2       1    59       .006 |
     +------------------------------+

. *--------------------------------------------------------------------
> -----*
> * Now do the calorie needs for individuals
> *--------------------------------------------------------------------
> -----*;
. use "$path/work/indata.dta";

. * CA bootstrap modification;
. sort hhid;

. merge hhid using "$path/work/hhdata.dta";
variable hhid does not uniquely identify observations in the master
    data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         13        0.03        0.03
          3 |     41,797       99.97      100.00
------------+-----------------------------------
      Total |     41,810      100.00

.  drop _m;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     41810    2.50e+11    1.12e+11   1.01e+11   4.15e+11
    motherhh |     39374    .5007111    .5000058          0          1
        hhid |     41797    2.50e+09    1.12e+09   1.01e+09   4.15e+09
         sex |     41797    .5243199    .5348987          0          2
         age |     40470    19.68325    17.41645          0        110
-------------+--------------------------------------------------------
        comm |     41769    2.50e+07    1.12e+07   1.01e+07   4.15e+07
      region |     41797    2.432974    1.120305          1          4
    district |     41797    249.8793     112.023        101        415
    substrat |     41797    2.569826    .8217755          1          3
         psu |     41797    12.52817    9.868414          1         39
-------------+--------------------------------------------------------
        snum |     41797    6.278202    3.161775          1         17
       vtype |     39961    1.528741    .4993299          1          3
      gpsnsa |     41769    132836.4    135310.7         34    3400000
      gpsnsb |     41764     3143840     1709632       4522   8.03e+07
    inidpcmp |     41797    1.962414    .1901961          1          2
-------------+--------------------------------------------------------
    daysurve |     41712    17.22658    6.202464          1         31
    monsurve |     41797     6.36182    3.512427          1         12
     yrsurve |     41797     2005.36    .4799714       2005       2006
       scode |     39542    42.14665    21.97753          3         98
     daychks |     39328    17.55452    6.340026          1         72
-------------+--------------------------------------------------------
     monchks |     39335    5.222652    4.288041          1         30
    yearchks |     39378    2005.734    8.524417       2005       3200
    editcode |     16167    47.80095    25.98742          1         89
     dayedit |     16064    18.29071    6.849501          1         72
     monedit |     16096    9.424826    3.752378          1         30
-------------+--------------------------------------------------------
    yearedit |     16111    2005.342     13.3177       2005       3200
     strthrs |     36529    10.62167    2.092694          6         61
     strtmin |     36506    25.95088    17.61905          0         59
    respcode |     41783    1.007659    .0980336          1          8
    our_resp |     41684    1.461928    .5003317          1          3
-------------+--------------------------------------------------------
     entrant |     40995    12.27838    5.949383          1         19
    dayentry |     40995    15.56104    8.096496          1         31
    monentry |     40995    3.814026    2.044584          0         12
     yrentry |     40995    2006.099    22.31054       2005       5200
    verifier |       954    6.873166      3.6039          1         15
-------------+--------------------------------------------------------
    dayverif |       846    15.91962    8.499811          2         30
    monverif |       846    4.166667    2.578817          1         11
    yrverify |       892    2005.885    .3197686       2005       2006
      hhsize |     41748    7.637276    3.687256          1         33
    hhweight |     41797    701.3982    328.8969      60.97    4404.13
-------------+--------------------------------------------------------
    survquar |     41797    2.566428     1.08261          1          4
     survmon |     41797    6.680408    3.333466          1         12
      strata |     41797    5.707898    2.797051          1         10
       rural |     41797    .7849128    .4108877          0          1
     reg_tpi |     41797    2.432974    1.120305          1          4
-------------+--------------------------------------------------------
    spdomain |     41797    5.614398    2.340276          1          9
        news |     41797    2.432974    1.120305          1          4
        bswt |     41797           1           0          1          1

. * Include fertility rates;
. sort sex rural age;

. merge sex rural age using `fert_rate';
variables sex rural age do not uniquely identify observations in the
    master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     41810    2.50e+11    1.12e+11   1.01e+11   4.15e+11
    motherhh |     39374    .5007111    .5000058          0          1
        hhid |     41797    2.50e+09    1.12e+09   1.01e+09   4.15e+09
         sex |     41889    .5275609    .5387583          0          2
         age |     40562    19.72023    17.42655          0        110
-------------+--------------------------------------------------------
        comm |     41769    2.50e+07    1.12e+07   1.01e+07   4.15e+07
      region |     41797    2.432974    1.120305          1          4
    district |     41797    249.8793     112.023        101        415
    substrat |     41797    2.569826    .8217755          1          3
         psu |     41797    12.52817    9.868414          1         39
-------------+--------------------------------------------------------
        snum |     41797    6.278202    3.161775          1         17
       vtype |     39961    1.528741    .4993299          1          3
      gpsnsa |     41769    132836.4    135310.7         34    3400000
      gpsnsb |     41764     3143840     1709632       4522   8.03e+07
    inidpcmp |     41797    1.962414    .1901961          1          2
-------------+--------------------------------------------------------
    daysurve |     41712    17.22658    6.202464          1         31
    monsurve |     41797     6.36182    3.512427          1         12
     yrsurve |     41797     2005.36    .4799714       2005       2006
       scode |     39542    42.14665    21.97753          3         98
     daychks |     39328    17.55452    6.340026          1         72
-------------+--------------------------------------------------------
     monchks |     39335    5.222652    4.288041          1         30
    yearchks |     39378    2005.734    8.524417       2005       3200
    editcode |     16167    47.80095    25.98742          1         89
     dayedit |     16064    18.29071    6.849501          1         72
     monedit |     16096    9.424826    3.752378          1         30
-------------+--------------------------------------------------------
    yearedit |     16111    2005.342     13.3177       2005       3200
     strthrs |     36529    10.62167    2.092694          6         61
     strtmin |     36506    25.95088    17.61905          0         59
    respcode |     41783    1.007659    .0980336          1          8
    our_resp |     41684    1.461928    .5003317          1          3
-------------+--------------------------------------------------------
     entrant |     40995    12.27838    5.949383          1         19
    dayentry |     40995    15.56104    8.096496          1         31
    monentry |     40995    3.814026    2.044584          0         12
     yrentry |     40995    2006.099    22.31054       2005       5200
    verifier |       954    6.873166      3.6039          1         15
-------------+--------------------------------------------------------
    dayverif |       846    15.91962    8.499811          2         30
    monverif |       846    4.166667    2.578817          1         11
    yrverify |       892    2005.885    .3197686       2005       2006
      hhsize |     41748    7.637276    3.687256          1         33
    hhweight |     41797    701.3982    328.8969      60.97    4404.13
-------------+--------------------------------------------------------
    survquar |     41797    2.566428     1.08261          1          4
     survmon |     41797    6.680408    3.333466          1         12
      strata |     41797    5.707898    2.797051          1         10
       rural |     41889     .784287    .4113209          0          1
     reg_tpi |     41797    2.432974    1.120305          1          4
-------------+--------------------------------------------------------
    spdomain |     41797    5.614398    2.340276          1          9
        news |     41797    2.432974    1.120305          1          4
        bswt |     41797           1           0          1          1
   fert_rate |        96    .1308125    .1150995       .006       .313
      _merge |     41902    1.002387     .050713          1          3

. * Do calorie calculations ;
.     gen num=1;

.     gen cal = .;
(41902 missing values generated)

. * Same assumptions about sex/age specific calories need in IAF 1997, 
> IAF 2003 and IOF 2009;
. * Children (no difference between boys and girls)   ;
.      replace cal =  820 if age < 1;
(1505 real changes made)

. * Add 500 cal per day for mothers in first six months of breast feedi
> ng
> * We assume that 60% of children under 1 are under six months old
> * And that all of them breast feed
> * We add these mother requirements of 300 on average to each child un
> der 1 whose mother is alive;
.     replace cal = 1120 if age <  1 & motherhh==1;
(1425 real changes made)

.     replace cal = 1150 if age >= 1 & age <2;
(1457 real changes made)

.     replace cal = 1350 if age >= 2 & age <3;
(1463 real changes made)

.     replace cal = 1550 if age >= 3 & age <5;
(2666 real changes made)

. * Males ;
.     replace cal = 1850 if age >=  5 & age <7  & sex==1;
(1432 real changes made)

.     replace cal = 2100 if age >=  7 & age <10 & sex==1;
(1928 real changes made)

.     replace cal = 2200 if age >= 10 & age <12 & sex==1;
(1262 real changes made)

.     replace cal = 2400 if age >= 12 & age <14 & sex==1;
(1287 real changes made)

.     replace cal = 2650 if age >= 14 & age <16 & sex==1;
(1136 real changes made)

.     replace cal = 2850 if age >= 16 & age <18 & sex==1;
(910 real changes made)

.     replace cal = 3000 if age >= 18 & age <30 & sex==1;
(3736 real changes made)

.     replace cal = 2900 if age >= 30 & age <60 & sex==1;
(3799 real changes made)

.     replace cal = 2450 if age>=60 & age~=. & sex==1;
(819 real changes made)

. * Girls 5-12 years (probability of pregnancy assumed = 0) ;
.     replace cal = 1750 if age >=  5 & age < 7 & sex==2;
(1 real change made)

.     replace cal = 1800 if age >=  7 & age <10 & sex==2;
(0 real changes made)

.     replace cal = 1950 if age >= 10 & age <12 & sex==2;
(1 real change made)

. * Women with a correction for pregnancy. We add 285 calories per for 
> the final trimester.
> * To do this we find the probability that rural and urban women are p
> regnant from
> * live births data in the 1997 census over the past 12 months (no cor
> rection for still births).
> * 3/4*probability of birth gives probability of preganancy. Probabili
> ty of final trimester is one
> * third of that of that or 1/4 of the probability of birth
> 
> * Women urban;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & s
> ex==2 & rural==0;
(2 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & s
> ex==2 & rural==0;
(4 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & s
> ex==2 & rural==0;
(12 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & s
> ex==2 & rural==0;
(30 real changes made)

. * Women rural;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & s
> ex==2 & rural==1;
(2 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & s
> ex==2 & rural==1;
(4 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & s
> ex==2 & rural==1;
(12 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & s
> ex==2 & rural==1;
(30 real changes made)

. * Women 60+ are not pregnant ;
.     replace cal = 1950 if age>=60 & age~=. & sex==2;
(0 real changes made)

.     count if cal ==.;
18404

.     *Fill in these two observations for IAF 2002/03:;
.     * 1) this one is a child;
.     *replace cal = 1500 if cal ==. & age==.;
.     * 2) this one is 21 years old;
.     *replace cal = 2500 if cal ==. & b2==.;
.     collapse (sum) cal num (max) psu hhsize hhweight strata rural spd
> omain, by (hhid);

.     gen chk=hhsize - num;
(12 missing values generated)

.     sum chk;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
         chk |      7415    .1525287    .5954247        -11         10

.     drop chk;

.     gen calpp = cal / hhsize;
(12 missing values generated)

.     sort spdomain;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      7426    2.48e+09    1.13e+09   1.01e+09   4.15e+09
         cal |      7427    7008.596    5086.838          0   197325.6
         num |      7427    5.641847    3.433554          1        105
         psu |      7426    12.43307    9.843949          1         39
      hhsize |      7415    5.782738    3.284401          1         33
-------------+--------------------------------------------------------
    hhweight |      7426    704.6189    339.0242      60.97    4404.13
      strata |      7426    5.644762    2.836484          1         10
       rural |      7427    .7712401    .4200626          0          1
    spdomain |      7426    5.552788    2.384061          1          9
       calpp |      7415    1273.419    682.3688          0      17550

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      7426    2.48e+09    1.13e+09   1.01e+09   4.15e+09
         cal |      7427    7008.596    5086.838          0   197325.6
         num |      7427    5.641847    3.433554          1        105
         psu |      7426    12.43307    9.843949          1         39
      hhsize |      7415    5.782738    3.284401          1         33
-------------+--------------------------------------------------------
    hhweight |      7426    704.6189    339.0242      60.97    4404.13
      strata |      7426    5.644762    2.836484          1         10
       rural |      7427    .7712401    .4200626          0          1
    spdomain |      7426    5.552788    2.384061          1          9
       calpp |      7415    1273.419    682.3688          0      17550

.  codebook hhid;

-----------------------------------------------------------------------
hhid                                                       Household ID
-----------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,4.153e+09]        units:  1
         unique values:  7426                     missing .:  1/7427

                  mean:   2.5e+09
              std. dev:   1.1e+09

           percentiles:        10%       25%       50%       75%       
> 90%
                           1.1e+09   1.1e+09   2.1e+09   3.1e+09   4.1e
> +09

. collapse (mean) calpp[aw=hhsize*hhweight], by (spdomain);

. sort spdomain;

. save "$path/work/calpp.dta",replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005\GAPP2
> /work/calpp.dta saved

. *********************************************************************
> **
> * 070_calpp.do          (end)
> *********************************************************************
> **;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_20
> 05\GAPP2/rep/070_calpp.log
  log type:  text
 closed on:   9 Jul 2013, 11:07:13
-----------------------------------------------------------------------
