--------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNHS
> _2005/GAPP2//rep/210_povmeas_ent_flex.log
  log type:  text
 opened on:   2 Jul 2013, 12:13:24

. clear

. set more off

. #delimit ;
delimiter now ;
. ************************************************
> *********************************
> * 210_povmeas_ent_flex.do               (start)
> *
> * This file produces poverty measures taking the
>  entropy adjusted poverty 
> * lines as a base. It produces two sets of pover
> ty measures. In one, 
> * Maputo is treated with the logic of the fixed 
> bundle. In the second, the revealed preference l
> ogic
> * is maintained. Here, the flexible bundle is vi
> ewed as being determined by the 
> * lower constraint on the value of the food bund
> le dictated by P_t2*Q_t1. In this case,
> * the year t2 food shares are calculated and app
> lied.
> *
> * Fixed poverty lines/etc. are mentioned here an
> d there. But there are NO fixed
> * calculations for Maputo (or other provinces) a
> nymore
> *
> ************************************************
> *********************************;
. /*
> This file uses:
>         work\povline_food_ent.csv
>         work\conpc.dta
>         work\hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work\povlines_ent.dta
>         work\povmeas_ent_flex.dta
>         work\povlines_ent.dta
>       work\nat_pov_ent_m.csv
>       work\rur_pov_ent_m.csv
>       work\news_pov_ent_m.csv
>       work\reg_tpi_pov_ent_m.csv
>       work\strata_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>       work\spdomain_pov_ent_m.csv
>         work\povlines_ent.csv
> */
> 
> 
> 
> ************************************************
> **************************;
. * Bring in data file with nominal consumption pe
> r capita, and deflate it
> * by temporal price index.
> ************************************************
> **************************;
. use "$path/work/hhdata.dta", clear;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work
> /temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely
    identify observations in the master data
(label lsurvquar already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      7,426      100.00      100.00
------------+-----------------------------------
      Total |      7,426      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim
> ;
(12 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per c
> apita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_no
> m;
(13 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total
>  consumption/day";

.         gen one=1;

.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St03872.000003 not found)
file /tmp/St03872.000003 saved

. ************************************************
> **************************;
. * Calculate the food shares for people near the 
> food poverty line
> ************************************************
> **************************;
. *Bring in entropy estimated flexible lines;
. clear;

. insheet using "$path/work/povline_food_ent.csv";
(3 vars, 9 obs)

.         rename ent food_povline_ent;

.      keep spdomain food_povline_ent;

.      sort spdomain;

. *Bring in fixed bundle poverty lines for Maputo 
> ;
. *This is the same level for both entropy and fix
> ed bundle analysis;
. *since the Q02*P02<=Q96*P02 constraint is bindin
> g;
. *$no_temp_rev   merge spdomain using "$path/work
> /povline_food_fix.dta";
. *$no_temp_rev    replace food_povline_ent=food_p
> ovline_w if spdomain>10;
.       keep spdomain food_povline_ent;

.       sort spdomain;

.       tempfile food_povline_ent;

. save `food_povline_ent';
file /tmp/St03872.000004 saved

. clear;

. use `contpi';

.         sort spdomain;

.         merge spdomain using `food_povline_ent';
variable spdomain does not uniquely identify
    observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 10 - round(abs(cons_pc_tpi/food_
> povline_ent-1))
>                 if abs(cons_pc_tpi/food_povline_
> ent-1)<=10;
(6264 real changes made)

.         gen tripopwt=triwt*hhweight*hhsize;
(12 missing values generated)

.         collapse (mean) nf_pc_nom food_povline_e
> nt [aw=tripopwt] ,
>         by(spdomain);

.         rename nf_pc_nom povline_nf;

.         lab var povline_nf "Nonfood poverty line
> ";

.         sort spdomain;

. *       merge spdomain using "$foodshr_pastSurve
> y", keep(spdomain $fdshr_t1);
. *       tab _m;
. *       drop _m;
. *       gen fdshr_t1 = $fdshr_t1;
. *       drop $fdshr_t1;
. *       lab var fdshr_t1 "year t1 (e.g. 1996) po
> verty line food share";
.      *calculate line for all provinces with flex
> ible food shares;
.                         gen povline_ent_m=food_p
> ovline_ent + povline_nf;

.         gen fdshr=food_povline_ent/povline_ent;

.         lab var fdshr "year t2 (e.g. 2002) pover
> ty line food share";

.       *redo for maputo inserting the fixed food 
> share;
.  *     gen povline_ent=povline_ent_m;
. *MAH;
. *$no_temp_rev   replace povline_ent=food_povline
> _ent/fdshr_t1 if spdomain >=11;
. *       lab var povline_ent   "poverty lines wit
> h Maputo regions calculated using fixed bundle n
> on-food shares";
.     lab var povline_ent   "poverty lines with al
> l regions calculated using flexible bundle non-f
> ood shares";

. *    lab var povline_ent_m "poverty lines with M
> aputo regions calculated using flexible bundle n
> on-food shares";
.         sort spdomain;

. tempfile povlines_ent;

. save `povlines_ent', replace;
(note: file /tmp/St03872.000005 not found)
file /tmp/St03872.000005 saved

. clear;

. ************************************************
> **************************;
. * Calculate poverty measures with all regions us
> ing flexible year t2 food shares
> ************************************************
> **************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using `povlines_ent';
variable spdomain does not uniquely identify
    observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

. ************************************************
> **************************;
. * Create spatial price index, based on the total
>  poverty line, with
> * adjustment so that mean (and total) nominal co
> nsumption equals
> * mean (and total) spatially deflated consumptio
> n.
> *
> * Choose arbitrary strata to be the base at firs
> t. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> ************************************************
> **************************;
.         gen cr= cons_pc_tpi ;
(13 missing values generated)

.         gen linpob=povline_ent;
(1 missing value generated)

. *MAH;
.  *Now only 6 regions, so base is chosen as the 1
> ;
.         *qui sum linpob if spdomain==7, meanonly
> ;
.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;
(1 missing value generated)

.         gen cr2=cr/spi;
(13 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(7426 real changes made)

.         gen linpobr=linpob/spi;
(1 missing value generated)

.         replace cr2=cr/spi;
(7414 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*h
> hsize];

    Variable |     Obs      Weight        Mean   S
> td. Dev.       Min        Max
-------------+------------------------------------
> -----------------------------
          cr |    7414  30109848.2    1106.447   1
> 372.576   61.85136   113681.6
         cr2 |    7414  30109848.2    1106.447   1
> 056.805   75.09103   78132.14
      linpob |    7415  30112959.1    470.5256   1
> 69.3252   213.4354   952.4562
     linpobr |    7415  30112959.1    480.8634    
>  .00002   480.8634   480.8635

.         lab var cr      "Temporally-adjusted con
> s pc";

.         lab var cr2     "Spatially & temporally 
> adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(6523 missing values generated)

.         replace  h = 0  if cr2 > (linpobr);
(6523 real changes made)

.         gen             pg      = ((linpobr - cr
> 2 )/linpobr) *100;
(13 missing values generated)

.         replace         pg      = 0             
> if h==0;
(6523 real changes made)

.         gen             spg     = ((( linpobr - 
> cr2 )/ linpobr )^2)*100;
(13 missing values generated)

.         replace         spg     = 0             
> if h==0;
(6523 real changes made)

.         gen h_ent  =h;

.         gen pg_ent =pg;
(1 missing value generated)

.         gen spg_ent=spg;
(1 missing value generated)

.         lab var h_ent   "Poverty headcount entro
> py bundle with Maputo food share fixed";

.         lab var pg_ent  "Poverty gap entropy bun
> dle with Maputo food share fixed";

.         lab var spg_ent "Squared poverty gap ent
> ropy bundle with Maputo food share fixed";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta"
> ;
(label lspdomain already defined)
(label lrural already defined)
(label lstrata already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label VERIFIER already defined)
(label ENTRANT already defined)
(label OUR_RESP already defined)
(label RESPCODE already defined)
(label EDITCODE already defined)
(label SCODE already defined)
(label INIDPCMP already defined)
(label SUBSTRAT already defined)
(label DISTRICT already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(11 missing values generated)

.         lab var popwt "Population weights = hhsi
> ze X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu
> (psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

. *MAH: Below at various places the original reg13
>  has been changed into spdomain or spdomain ;
.                 svy: mean h_ent pg_ent spg_ent;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

--------------------------------------------------
> ------------
             |             Linearized
             |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
       h_ent |   14.06774   .6012762       12.8844
>     15.25107
      pg_ent |   3.225509   .1842856      2.862828
>      3.58819
     spg_ent |   1.123539   .0861041      .9540824
>     1.292995
--------------------------------------------------
> ------------

.         svy: mean h_ent pg_ent spg_ent , over(ru
> ral);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent        |
       Urban |   10.56387   1.244018      8.115591
>     13.01214
       Rural |   14.72632   .7010883      13.34655
>     16.10609
-------------+------------------------------------
> ------------
pg_ent       |
       Urban |   2.481764   .3933629      1.707611
>     3.255917
       Rural |   3.365303   .2094857      2.953027
>     3.777578
-------------+------------------------------------
> ------------
spg_ent      |
       Urban |   .8995865   .1827501      .5399272
>     1.259246
       Rural |   1.165632   .0968507      .9750266
>     1.356238
--------------------------------------------------
> ------------

.         svy: mean h_ent pg_ent spg_ent , over(st
> rata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Kampala: strata = Kampala
    _subpop_2: strata = Central 1
    _subpop_3: strata = Central 2
    _subpop_4: strata = East Central
      Eastern: strata = Eastern
    _subpop_6: strata = Mid Northern
    _subpop_7: strata = North East
    _subpop_8: strata = West Nile
    _subpop_9: strata = Mid Western
   _subpop_10: strata = South Western

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent        |
     Kampala |   9.890896   2.189968      5.580955
>     14.20084
   _subpop_2 |   14.91643   1.634965      11.69875
>      18.1341
   _subpop_3 |   15.69408    1.66596       12.4154
>     18.97275
   _subpop_4 |   10.64819   1.113231      8.457308
>     12.83907
     Eastern |   17.88636   1.855447      14.23477
>     21.53796
   _subpop_6 |   6.499799    1.37621      3.791366
>     9.208232
   _subpop_7 |   24.37894   3.634537      17.22604
>     31.53185
   _subpop_8 |    4.95222   1.565907      1.870455
>     8.033984
   _subpop_9 |   17.62318   1.990227      13.70634
>     21.54003
  _subpop_10 |   18.60492   1.944847      14.77738
>     22.43245
-------------+------------------------------------
> ------------
pg_ent       |
     Kampala |   2.463708   .7422564      1.002919
>     3.924497
   _subpop_2 |   3.070557   .4522347      2.180542
>     3.960572
   _subpop_3 |   3.943368   .5077479      2.944101
>     4.942635
   _subpop_4 |   2.804601   .3099946       2.19452
>     3.414683
     Eastern |   3.676317   .6216264      2.452932
>     4.899701
   _subpop_6 |    1.23314   .3867917      .4719196
>     1.994361
   _subpop_7 |   5.588347   .8662363      3.883561
>     7.293133
   _subpop_8 |   .7202368   .2695408      .1897702
>     1.250703
   _subpop_9 |   4.417826    .868522      2.708542
>     6.127111
  _subpop_10 |   4.253976   .5591331      3.153581
>     5.354371
-------------+------------------------------------
> ------------
spg_ent      |
     Kampala |   .9693272   .3944951      .1929457
>     1.745709
   _subpop_2 |   .9844101   .2004886      .5898409
>     1.378979
   _subpop_3 |   1.363375   .2139485      .9423163
>     1.784434
   _subpop_4 |    1.03974   .1665352      .7119922
>     1.367487
     Eastern |   1.202082   .2835679        .64401
>     1.760155
   _subpop_6 |   .3588422   .1343879      .0943618
>     .6233227
   _subpop_7 |   1.769303   .2529174      1.271552
>     2.267054
   _subpop_8 |   .2511025   .1240431      .0069809
>     .4952241
   _subpop_9 |   1.699687   .4695916      .7755126
>     2.623861
  _subpop_10 |   1.510136   .2558705      1.006573
>     2.013699
--------------------------------------------------
> ------------

.         svy: mean h_ent pg_ent spg_ent , over(sp
> domain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Kampala: spdomain = Kampala
    _subpop_2: spdomain = Central urban
    _subpop_3: spdomain = Central rural
    _subpop_4: spdomain = Eastern urban
    _subpop_5: spdomain = Eastern rural
    _subpop_6: spdomain = Northern urban
    _subpop_7: spdomain = Northern rural
    _subpop_8: spdomain = Western urban
    _subpop_9: spdomain = Western rural

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent        |
     Kampala |   9.890896   2.189968      5.580955
>     14.20084
   _subpop_2 |   5.512945   3.079923     -.5484608
>     11.57435
   _subpop_3 |   16.74183   1.384929      14.01623
>     19.46742
   _subpop_4 |   13.68152   2.685917      8.395531
>      18.9675
   _subpop_5 |   14.74786   1.112755      12.55792
>      16.9378
   _subpop_6 |   11.48899   2.741666      6.093283
>     16.88469
   _subpop_7 |   6.808166   1.185262      4.475526
>     9.140806
   _subpop_8 |   15.69749   1.914711      11.92926
>     19.46571
   _subpop_9 |   18.44194   1.533401      15.42414
>     21.45973
-------------+------------------------------------
> ------------
pg_ent       |
     Kampala |   2.463708   .7422564      1.002919
>     3.924497
   _subpop_2 |   1.340185    .884869     -.4012705
>     3.081641
   _subpop_3 |   3.834605   .3852318      3.076454
>     4.592756
   _subpop_4 |   3.291204   .9204621        1.4797
>     5.102709
   _subpop_5 |   3.413791   .3199737      2.784071
>     4.043511
   _subpop_6 |    2.32043   .8239892      .6987882
>     3.942072
   _subpop_7 |   1.258196   .3134767      .6412618
>      1.87513
   _subpop_8 |   3.685567   .5740603      2.555795
>      4.81534
   _subpop_9 |   4.371897   .5178641      3.352721
>     5.391073
-------------+------------------------------------
> ------------
spg_ent      |
     Kampala |   .9693272   .3944951      .1929457
>     1.745709
   _subpop_2 |   .5015933   .3519346     -.1910275
>     1.194214
   _subpop_3 |    1.27706    .166368      .9496411
>     1.604478
   _subpop_4 |   1.099222   .3549619      .4006434
>     1.797801
   _subpop_5 |   1.187607   .1490042      .8943616
>     1.480853
   _subpop_6 |    .768632   .3400331       .099434
>      1.43783
   _subpop_7 |   .3582837   .1043264      .1529653
>     .5636022
   _subpop_8 |   1.289961   .2560438      .7860573
>     1.793865
   _subpop_9 |   1.608894   .2582854      1.100579
>      2.11721
--------------------------------------------------
> ------------

.         svy: mean h_ent pg_ent spg_ent , over(sp
> domain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Kampala: spdomain = Kampala
    _subpop_2: spdomain = Central urban
    _subpop_3: spdomain = Central rural
    _subpop_4: spdomain = Eastern urban
    _subpop_5: spdomain = Eastern rural
    _subpop_6: spdomain = Northern urban
    _subpop_7: spdomain = Northern rural
    _subpop_8: spdomain = Western urban
    _subpop_9: spdomain = Western rural

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent        |
     Kampala |   9.890896   2.189968      5.580955
>     14.20084
   _subpop_2 |   5.512945   3.079923     -.5484608
>     11.57435
   _subpop_3 |   16.74183   1.384929      14.01623
>     19.46742
   _subpop_4 |   13.68152   2.685917      8.395531
>      18.9675
   _subpop_5 |   14.74786   1.112755      12.55792
>      16.9378
   _subpop_6 |   11.48899   2.741666      6.093283
>     16.88469
   _subpop_7 |   6.808166   1.185262      4.475526
>     9.140806
   _subpop_8 |   15.69749   1.914711      11.92926
>     19.46571
   _subpop_9 |   18.44194   1.533401      15.42414
>     21.45973
-------------+------------------------------------
> ------------
pg_ent       |
     Kampala |   2.463708   .7422564      1.002919
>     3.924497
   _subpop_2 |   1.340185    .884869     -.4012705
>     3.081641
   _subpop_3 |   3.834605   .3852318      3.076454
>     4.592756
   _subpop_4 |   3.291204   .9204621        1.4797
>     5.102709
   _subpop_5 |   3.413791   .3199737      2.784071
>     4.043511
   _subpop_6 |    2.32043   .8239892      .6987882
>     3.942072
   _subpop_7 |   1.258196   .3134767      .6412618
>      1.87513
   _subpop_8 |   3.685567   .5740603      2.555795
>      4.81534
   _subpop_9 |   4.371897   .5178641      3.352721
>     5.391073
-------------+------------------------------------
> ------------
spg_ent      |
     Kampala |   .9693272   .3944951      .1929457
>     1.745709
   _subpop_2 |   .5015933   .3519346     -.1910275
>     1.194214
   _subpop_3 |    1.27706    .166368      .9496411
>     1.604478
   _subpop_4 |   1.099222   .3549619      .4006434
>     1.797801
   _subpop_5 |   1.187607   .1490042      .8943616
>     1.480853
   _subpop_6 |    .768632   .3400331       .099434
>      1.43783
   _subpop_7 |   .3582837   .1043264      .1529653
>     .5636022
   _subpop_8 |   1.289961   .2560438      .7860573
>     1.793865
   _subpop_9 |   1.608894   .2582854      1.100579
>      2.11721
--------------------------------------------------
> ------------

.                 compress;
region was float now byte
psu was int now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
reg_tpi was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
one was float now byte
h was float now byte
h_ent was float now byte

.       gen dum=1;

.         sort hhid;

.         *set aside the spatial price index;
.       tempfile spi;

. *      use "$path/work/povmeas_ent.dta", clear;
.       collapse (mean) spi, by(spdomain);

.       sort spdomain;

. save `spi', replace;
(note: file /tmp/St03872.000006 not found)
file /tmp/St03872.000006 saved

. clear;

. ************************************************
> **************************;
. * Calculate poverty measures with Maputo regions
>  on flexible food shares
> ************************************************
> **************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using `povlines_ent';
variable spdomain does not uniquely identify
    observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

. ************************************************
> **************************;
. * Create spatial price index, based on the total
>  poverty line, with
> * adjustment so that mean (and total) nominal co
> nsumption equals
> * mean (and total) spatially deflated consumptio
> n.
> *
> * Choose arbitrary strata to be the base at firs
> t. The middle of the 13
> * codes is code 7 -- that's arbirtary enough.
> ************************************************
> **************************;
.         gen cr= cons_pc_tpi ;
(13 missing values generated)

.         gen linpob=povline_ent_m;
(1 missing value generated)

.         qui sum linpob if spdomain==1, meanonly;

.         global spi_base=r(mean);

.         gen spi=linpob/$spi_base;
(1 missing value generated)

.         gen cr2=cr/spi;
(13 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(7426 real changes made)

.         gen linpobr=linpob/spi;
(1 missing value generated)

.         replace cr2=cr/spi;
(7414 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*h
> hsize];

    Variable |     Obs      Weight        Mean   S
> td. Dev.       Min        Max
-------------+------------------------------------
> -----------------------------
          cr |    7414  30109848.2    1106.447   1
> 372.576   61.85136   113681.6
         cr2 |    7414  30109848.2    1106.447   1
> 056.805   75.09103   78132.14
      linpob |    7415  30112959.1    470.5256   1
> 69.3252   213.4354   952.4562
     linpobr |    7415  30112959.1    480.8634    
>  .00002   480.8634   480.8635

.         lab var cr      "Temporally-adjusted con
> s pc";

.         lab var cr2     "Spatially & temporally 
> adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

.         *calculate poverty measures;
.         gen h = 100     if cr2 <=(linpobr);
(6523 missing values generated)

.         replace  h = 0 if cr2 > (linpobr);
(6523 real changes made)

.         gen             pg      = ((linpobr - cr
> 2 )/linpobr) *100;
(13 missing values generated)

.         replace         pg      = 0             
> if h==0;
(6523 real changes made)

.         gen             spg     = ((( linpobr - 
> cr2 )/ linpobr )^2)*100;
(13 missing values generated)

.         replace         spg     = 0             
> if h==0;
(6523 real changes made)

.         gen h_ent_m  =h;

.         gen pg_ent_m =pg;
(1 missing value generated)

.         gen spg_ent_m=spg;
(1 missing value generated)

.         lab var h_ent_m   "Poverty headcount ent
> ropy bundle. Food share flexible. Flexible bundl
> e";

.         lab var pg_ent_m  "Poverty gap entropy b
> undle. Food share flexible. Flexible bundle";

.         lab var spg_ent_m "Squared poverty gap e
> ntropy. Food share flexible. Flexible bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta"
> ;
(label lspdomain already defined)
(label lrural already defined)
(label lstrata already defined)
(label lsurvmon already defined)
(label lsurvquar already defined)
(label VERIFIER already defined)
(label ENTRANT already defined)
(label OUR_RESP already defined)
(label RESPCODE already defined)
(label EDITCODE already defined)
(label SCODE already defined)
(label INIDPCMP already defined)
(label SUBSTRAT already defined)
(label DISTRICT already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(11 missing values generated)

.         lab var popwt "Population weights = hhsi
> ze X hhweight";

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu
> (psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.                 svy: mean h_ent_m pg_ent_m spg_e
> nt_m;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

--------------------------------------------------
> ------------
             |             Linearized
             |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
     h_ent_m |   14.06774   .6012762       12.8844
>     15.25107
    pg_ent_m |   3.225509   .1842856      2.862828
>      3.58819
   spg_ent_m |   1.123539   .0861041      .9540824
>     1.292995
--------------------------------------------------
> ------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , o
> ver(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent_m      |
       Urban |   10.56387   1.244018      8.115591
>     13.01214
       Rural |   14.72632   .7010883      13.34655
>     16.10609
-------------+------------------------------------
> ------------
pg_ent_m     |
       Urban |   2.481764   .3933629      1.707611
>     3.255917
       Rural |   3.365303   .2094857      2.953027
>     3.777578
-------------+------------------------------------
> ------------
spg_ent_m    |
       Urban |   .8995865   .1827501      .5399272
>     1.259246
       Rural |   1.165632   .0968507      .9750266
>     1.356238
--------------------------------------------------
> ------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , o
> ver(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent_m      |
     Central |   14.25873   1.037013      12.21785
>     16.29961
     Eastern |   14.66278    1.03148      12.63278
>     16.69277
    Northern |   7.510888   1.078779      5.387809
>     9.633967
     Western |   18.22437   1.424972      15.41997
>     21.02877
-------------+------------------------------------
> ------------
pg_ent_m     |
     Central |   3.312399   .3154608       2.69156
>     3.933238
     Eastern |    3.40401   .3031765      2.807347
>     4.000673
    Northern |   1.417667   .2855037      .8557846
>     1.979549
     Western |   4.317489   .4795057      3.373803
>     5.261174
-------------+------------------------------------
> ------------
spg_ent_m    |
     Central |   1.137778   .1442846      .8538206
>     1.421736
     Eastern |   1.180555   .1398336      .9053573
>     1.455753
    Northern |   .4198884   .1005013       .222098
>     .6176788
     Western |   1.583611   .2396239      1.112022
>       2.0552
--------------------------------------------------
> ------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , o
> ver(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent_m      |
     Central |   14.25873   1.037013      12.21785
>     16.29961
     Eastern |   14.66278    1.03148      12.63278
>     16.69277
    Northern |   7.510888   1.078779      5.387809
>     9.633967
     Western |   18.22437   1.424972      15.41997
>     21.02877
-------------+------------------------------------
> ------------
pg_ent_m     |
     Central |   3.312399   .3154608       2.69156
>     3.933238
     Eastern |    3.40401   .3031765      2.807347
>     4.000673
    Northern |   1.417667   .2855037      .8557846
>     1.979549
     Western |   4.317489   .4795057      3.373803
>     5.261174
-------------+------------------------------------
> ------------
spg_ent_m    |
     Central |   1.137778   .1442846      .8538206
>     1.421736
     Eastern |   1.180555   .1398336      .9053573
>     1.455753
    Northern |   .4198884   .1005013       .222098
>     .6176788
     Western |   1.583611   .2396239      1.112022
>       2.0552
--------------------------------------------------
> ------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , o
> ver(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Kampala: strata = Kampala
    _subpop_2: strata = Central 1
    _subpop_3: strata = Central 2
    _subpop_4: strata = East Central
      Eastern: strata = Eastern
    _subpop_6: strata = Mid Northern
    _subpop_7: strata = North East
    _subpop_8: strata = West Nile
    _subpop_9: strata = Mid Western
   _subpop_10: strata = South Western

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent_m      |
     Kampala |   9.890896   2.189968      5.580955
>     14.20084
   _subpop_2 |   14.91643   1.634965      11.69875
>      18.1341
   _subpop_3 |   15.69408    1.66596       12.4154
>     18.97275
   _subpop_4 |   10.64819   1.113231      8.457308
>     12.83907
     Eastern |   17.88636   1.855447      14.23477
>     21.53796
   _subpop_6 |   6.499799    1.37621      3.791366
>     9.208232
   _subpop_7 |   24.37894   3.634537      17.22604
>     31.53185
   _subpop_8 |    4.95222   1.565907      1.870455
>     8.033984
   _subpop_9 |   17.62318   1.990227      13.70634
>     21.54003
  _subpop_10 |   18.60492   1.944847      14.77738
>     22.43245
-------------+------------------------------------
> ------------
pg_ent_m     |
     Kampala |   2.463708   .7422564      1.002919
>     3.924497
   _subpop_2 |   3.070557   .4522347      2.180542
>     3.960572
   _subpop_3 |   3.943368   .5077479      2.944101
>     4.942635
   _subpop_4 |   2.804601   .3099946       2.19452
>     3.414683
     Eastern |   3.676317   .6216264      2.452932
>     4.899701
   _subpop_6 |    1.23314   .3867917      .4719196
>     1.994361
   _subpop_7 |   5.588347   .8662363      3.883561
>     7.293133
   _subpop_8 |   .7202368   .2695408      .1897702
>     1.250703
   _subpop_9 |   4.417826    .868522      2.708542
>     6.127111
  _subpop_10 |   4.253976   .5591331      3.153581
>     5.354371
-------------+------------------------------------
> ------------
spg_ent_m    |
     Kampala |   .9693272   .3944951      .1929457
>     1.745709
   _subpop_2 |   .9844101   .2004886      .5898409
>     1.378979
   _subpop_3 |   1.363375   .2139485      .9423163
>     1.784434
   _subpop_4 |    1.03974   .1665352      .7119922
>     1.367487
     Eastern |   1.202082   .2835679        .64401
>     1.760155
   _subpop_6 |   .3588422   .1343879      .0943618
>     .6233227
   _subpop_7 |   1.769303   .2529174      1.271552
>     2.267054
   _subpop_8 |   .2511025   .1240431      .0069809
>     .4952241
   _subpop_9 |   1.699687   .4695916      .7755126
>     2.623861
  _subpop_10 |   1.510136   .2558705      1.006573
>     2.013699
--------------------------------------------------
> ------------

.         svy: mean h_ent_m pg_ent_m spg_ent_m , o
> ver(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =      10        Number of obs   
>  =      7415
Number of PSUs   =     305        Population size 
>  =  30112959
                                  Design df       
>  =       295

      Kampala: spdomain = Kampala
    _subpop_2: spdomain = Central urban
    _subpop_3: spdomain = Central rural
    _subpop_4: spdomain = Eastern urban
    _subpop_5: spdomain = Eastern rural
    _subpop_6: spdomain = Northern urban
    _subpop_7: spdomain = Northern rural
    _subpop_8: spdomain = Western urban
    _subpop_9: spdomain = Western rural

--------------------------------------------------
> ------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Con
> f. Interval]
-------------+------------------------------------
> ------------
h_ent_m      |
     Kampala |   9.890896   2.189968      5.580955
>     14.20084
   _subpop_2 |   5.512945   3.079923     -.5484608
>     11.57435
   _subpop_3 |   16.74183   1.384929      14.01623
>     19.46742
   _subpop_4 |   13.68152   2.685917      8.395531
>      18.9675
   _subpop_5 |   14.74786   1.112755      12.55792
>      16.9378
   _subpop_6 |   11.48899   2.741666      6.093283
>     16.88469
   _subpop_7 |   6.808166   1.185262      4.475526
>     9.140806
   _subpop_8 |   15.69749   1.914711      11.92926
>     19.46571
   _subpop_9 |   18.44194   1.533401      15.42414
>     21.45973
-------------+------------------------------------
> ------------
pg_ent_m     |
     Kampala |   2.463708   .7422564      1.002919
>     3.924497
   _subpop_2 |   1.340185    .884869     -.4012705
>     3.081641
   _subpop_3 |   3.834605   .3852318      3.076454
>     4.592756
   _subpop_4 |   3.291204   .9204621        1.4797
>     5.102709
   _subpop_5 |   3.413791   .3199737      2.784071
>     4.043511
   _subpop_6 |    2.32043   .8239892      .6987882
>     3.942072
   _subpop_7 |   1.258196   .3134767      .6412618
>      1.87513
   _subpop_8 |   3.685567   .5740603      2.555795
>      4.81534
   _subpop_9 |   4.371897   .5178641      3.352721
>     5.391073
-------------+------------------------------------
> ------------
spg_ent_m    |
     Kampala |   .9693272   .3944951      .1929457
>     1.745709
   _subpop_2 |   .5015933   .3519346     -.1910275
>     1.194214
   _subpop_3 |    1.27706    .166368      .9496411
>     1.604478
   _subpop_4 |   1.099222   .3549619      .4006434
>     1.797801
   _subpop_5 |   1.187607   .1490042      .8943616
>     1.480853
   _subpop_6 |    .768632   .3400331       .099434
>      1.43783
   _subpop_7 |   .3582837   .1043264      .1529653
>     .5636022
   _subpop_8 |   1.289961   .2560438      .7860573
>     1.793865
   _subpop_9 |   1.608894   .2582854      1.100579
>      2.11721
--------------------------------------------------
> ------------

.         drop bswt one h pg spg;

.         compress;
region was float now byte
psu was int now byte
survquar was float now byte
survmon was float now byte
strata was float now byte
rural was float now byte
reg_tpi was float now byte
spdomain was float now byte
news was float now byte
h_ent_m was float now byte

. label data "Final data set. Official published p
> overty rates are calculated from this data set";
note: label truncated to 80 characters

.         sort hhid;

.         save "$path/work/povmeas_ent_flex.dta", 
> replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNHS_
> 2005/GAPP2//work/povmeas_ent_flex.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNHS_2005/GA
> PP2//work/povmeas_ent_flex.dta saved

. gen dum=1;

.         *output the national measures;
.         collapse  (mean) dum h_ent_m pg_ent_m sp
> g_ent_m [aw=hhweight*hhsize];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file /tmp/St03872.000007 saved

.         *output the rural/urban measures;
.         use "$path/work/povmeas_ent_flex.dta", c
> lear;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_en
> t_m [aw=hhweight*hhsize], by(rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file /tmp/St03872.000008 saved

.         *output the North South Center measures;
.         use "$path/work/povmeas_ent_flex.dta", c
> lear;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_en
> t_m [aw=hhweight*hhsize], by(news);

. gen geo="North/Center/South";

. gen geono=news;

. tempfile new;

. save `new';
file /tmp/St03872.000009 saved

.         *output the North South Center rural/urb
> an measures;
.         use "$path/work/povmeas_ent_flex.dta", c
> lear;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_en
> t_m [aw=hhweight*hhsize], by(reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file /tmp/St03872.00000a saved

.         *output the provincial measures;
.         use "$path/work/povmeas_ent_flex.dta", c
> lear;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_en
> t_m [aw=hhweight*hhsize], by(strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file /tmp/St03872.00000b saved

.                 *output the dominios espaciais m
> easures;
.         use "$path/work/povmeas_ent_flex.dta", c
> lear;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.         collapse  (mean) h_ent_m pg_ent_m spg_en
> t_m [aw=hhweight*hhsize], by(spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;

. tempfile r13;

. save `r13';
file /tmp/St03872.00000c saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file /tmp/St03872.00000d saved

. use          `nat';
(Final data set. Official published poverty rates 
> are calculated from this data s)

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';
(label region already defined)

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_ent_m pg_ent_m spg_ent_m du
> m rural news reg_tpi strata spdomain using "$pat
> h/work/poverty_ent_flexBask.csv", replace c ;
(note: file /home/bjvca/data/data/GAP/Haruna/UNHS_
> 2005/GAPP2//work/poverty_ent_flexBask.csv not fo
> und)

.         *set aside the spatial price index;
.       tempfile spi_m;

.       use "$path/work/povmeas_ent_flex.dta", cle
> ar;
(Final data set. Official published poverty rates 
> are calculated from this data s)

.       collapse (mean) spi, by(spdomain);

.       rename spi spi_m;

.       sort spdomain;

. save `spi_m', replace;
(note: file /tmp/St03872.00000e not found)
file /tmp/St03872.00000e saved

. use `povlines_ent';

.        sort spdomain;

.        merge spdomain using `spi';
(label lspdomain already defined)

.        tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |          9      100.00      100.00
------------+-----------------------------------
      Total |          9      100.00

.  drop _m;

.        sort spdomain;

.        merge spdomain using `spi_m';
(label lspdomain already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |          9      100.00      100.00
------------+-----------------------------------
      Total |          9      100.00

.  drop _m;

. save "$path/work/povlines.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNHS_2005/GA
> PP2//work/povlines.dta saved

. outsheet spdomain food_povline_ent povline_ent f
> dshr using "$path/work/povlines.csv", replace c;
(note: file /home/bjvca/data/data/GAP/Haruna/UNHS_
> 2005/GAPP2//work/povlines.csv not found)

.  ***********************************************
> **********************************
> * 210_povmeas_ent_flex.do               (end)
> ************************************************
> *********************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNHS
> _2005/GAPP2//rep/210_povmeas_ent_flex.log
  log type:  text
 closed on:   2 Jul 2013, 12:13:25
--------------------------------------------------
