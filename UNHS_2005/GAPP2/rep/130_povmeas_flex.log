------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UN
> HS_2005\GAPP2/rep/130_povmeas_flex.log
  log type:  text
 opened on:  25 Jun 2013, 11:33:17

. clear

. set more off

. #delimit ;
delimiter now ;
. ****************************************************************
> **********
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Bef
> ore any iteration)
> ****************************************************************
> **********;
. *CA modified to add work/hhdata.dta for bootstrap;
. /*
> This file uses:
>         in/foodshr96.dta
>         work/povline_f_flex.dta
>         work/consump_nom.dta
>         work/hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work/foodshr96.dta
>         work/povmeas.dta
>         work/povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> ****************************************************************
> **********;
. * Bring in data file with nominal consumption per capita, and de
> flate it
> * by temporal price index.
> ****************************************************************
> **********;
. use "$path/work/hhdata.dta", clear;

.         keep hhid strata reg_tpi spdomain news rural survmon sur
> vquar;

.         tab reg_tpi, miss;

    Regions |
   used for |
   temporal |
price index |
calculation |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
    Central |      2,100       28.28       28.28
    Eastern |      1,932       26.02       54.30
   Northern |      1,624       21.87       76.16
    Western |      1,770       23.84      100.00
------------+-----------------------------------
      Total |      7,426      100.00

.         tab survquar, miss;

  Sequential |
      Survey |
     Quarter |
    (May-Jul |
       05=1) |      Freq.     Percent        Cum.
-------------+-----------------------------------
  May-Jul 05 |      1,573       21.18       21.18
 Sept-Oct 05 |      2,280       30.70       51.89
 Nov05-Jan06 |      1,787       24.06       75.95
Feb-Apr 2006 |      1,786       24.05      100.00
-------------+-----------------------------------
       Total |      7,426      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000001.tmp n
> ot found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000001.tmp saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path/work/hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label llspdomain already defined)
(label lsurvquar already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_
> tpi.dta";
variables reg_tpi survquar do not uniquely identify observations
    in the master data
(label lsurvquar already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      7,427      100.00      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(12 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consu
> mption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(13 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day
> ";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000002.tmp n
> ot found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000002.tmp saved

. ****************************************************************
> **********
> * Calculate non-food expenditure for HH around the food poverty 
> line
> *
> * Develop a discrete triangular weighted distribution. This give
> s a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and .
> ..
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> ****************************************************************
> **********;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the
    master data
(label llspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      7,427      100.00      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+
> 0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(143 real changes made)

.                                         * Nearness to poverty li
> ne and population weights ;
.         gen tripopwt=triwt*hhweight*hhsize;
(12 missing values generated)

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline
> _na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. F
> lexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000004.tmp n
> ot found)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000004.tmp saved

.                 tab spdomain;

       Spatial |
 domains: each |
      with own |
  poverty line |
  (they are 9) |      Freq.     Percent        Cum.
---------------+-----------------------------------
 Central urban |          1       14.29       14.29
 Central rural |          1       14.29       28.57
 Eastern rural |          1       14.29       42.86
Northern urban |          1       14.29       57.14
Northern rural |          1       14.29       71.43
 Western urban |          1       14.29       85.71
 Western rural |          1       14.29      100.00
---------------+-----------------------------------
         Total |          7      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the
    master data
(label llspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        744       10.02       10.02
          3 |      6,683       89.98      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

. ****************************************************************
> **********;
. * Poverty line is the sum of the food and non-food poverty lines
> ****************************************************************
> **********;
.         gen povline_flex=povline_f_flex + povline_na_flex;
(744 missing values generated)

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path/work/povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005\
> GAPP2/work/povlines.dta saved

. ****************************************************************
> **********;
. * Create spatial price index, based on the total poverty line, w
> ith
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use t
> he first stratum.
> ****************************************************************
> **********;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povlines.dta";
variable spdomain does not uniquely identify observations in the
    master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005
    > \GAPP2/work/povlines.dta
(label llspdomain already defined)
(label lsurvquar already defined)
(label region already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      7,427      100.00      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;
(13 missing values generated)

.         * Poverty line;
.         gen linpob=povline_flex;
(744 missing values generated)

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;
(744 missing values generated)

.         * Real consumption pc, temporally and spatially deflated
>  ;
.         gen cr2=cr/spi;
(747 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(6683 real changes made)

.         gen linpobr=linpob/spi;
(744 missing values generated)

.         replace cr2=cr/spi;
(6680 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       M
> in        Max
-------------+----------------------------------------------------
> -------------
          cr |    7414  30109848.2    1106.447   1372.576   61.851
> 36   113681.6
         cr2 |    6680  27743664.6    1200.812   1226.345   83.673
> 21   80455.38
      linpob |    6680  27743664.6    303.1105   118.1377   110.65
> 11   472.8902
     linpobr |    6680  27743664.6    334.6765   .0000135   334.67
> 65   334.6765

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc
> ";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. ****************************************************************
> **********
> * calculate poverty measures with the flexible food bundle
> ****************************************************************
> **********;
.         gen h = 100     if cr <=(linpob);
(6400 missing values generated)

.         replace  h = 0 if cr > (linpob);
(6400 real changes made)

.                         gen             pg      = ((linpob - cr 
> )/linpob) *100;
(747 missing values generated)

.         replace         pg      = 0             if h==0;
(6400 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)
> *100;
(747 missing values generated)

.         replace         spg     = 0             if h==0;
(6400 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;
(744 missing values generated)

.         gen spg_flex=spg;
(744 missing values generated)

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label region already defined)
(label lsurvquar already defined)
(label llspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.01        0.01
          3 |      7,426       99.99      100.00
------------+-----------------------------------
      Total |      7,427      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(11 missing values generated)

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |   5.191311   .4288299      4.346904    6.035717
     pg_flex |   1.117264   .1341891      .8530331    1.381495
    spg_flex |   .3808104   .0594966       .263656    .4979649
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

        Urban: rural = Urban
        Rural: rural = Rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
       Urban |   1.460323   .4016244      .6694868     2.25116
       Rural |   5.545482   .4623704      4.635031    6.455933
-------------+------------------------------------------------
pg_flex      |
       Urban |   .3071097   .0952187       .119615    .4946044
       Rural |    1.19417   .1455542      .9075597     1.48078
-------------+------------------------------------------------
spg_flex     |
       Urban |   .1035327   .0389373      .0268615     .180204
       Rural |   .4071316   .0646234      .2798819    .5343812
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |     4.9155   .7409972      3.456406    6.374594
     Eastern |   2.194922   .4109562      1.385711    3.004134
    Northern |   .1383999   .0852394     -.0294445    .3062444
     Western |     11.981   1.168019       9.68106    14.28094
-------------+------------------------------------------------
pg_flex      |
     Central |    .811073   .1372326      .5408491    1.081297
     Eastern |   .3892973   .1127112      .1673583    .6112363
    Northern |   .0445975   .0266296     -.0078387    .0970337
     Western |   2.874385   .4235977      2.040281    3.708489
-------------+------------------------------------------------
spg_flex     |
     Central |   .2253449   .0531338      .1207194    .3299703
     Eastern |   .1285089   .0523554      .0254162    .2316016
    Northern |   .0148194   .0087207     -.0023526    .0319913
     Western |   1.031826   .1945888      .6486619    1.414989
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |     4.9155   .7409972      3.456406    6.374594
     Eastern |   2.194922   .4109562      1.385711    3.004134
    Northern |   .1383999   .0852394     -.0294445    .3062444
     Western |     11.981   1.168019       9.68106    14.28094
-------------+------------------------------------------------
pg_flex      |
     Central |    .811073   .1372326      .5408491    1.081297
     Eastern |   .3892973   .1127112      .1673583    .6112363
    Northern |   .0445975   .0266296     -.0078387    .0970337
     Western |   2.874385   .4235977      2.040281    3.708489
-------------+------------------------------------------------
spg_flex     |
     Central |   .2253449   .0531338      .1207194    .3299703
     Eastern |   .1285089   .0523554      .0254162    .2316016
    Northern |   .0148194   .0087207     -.0023526    .0319913
     Western |   1.031826   .1945888      .6486619    1.414989
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

    _subpop_1: strata = Central 1
    _subpop_2: strata = Central 2
    _subpop_3: strata = East Central
      Eastern: strata = Eastern
    _subpop_5: strata = Mid Northern
    _subpop_6: strata = North East
    _subpop_7: strata = West Nile
    _subpop_8: strata = Mid Western
    _subpop_9: strata = South Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |    4.06446      .8898       2.31236     5.81656
   _subpop_2 |   5.726106   1.120371      3.519988    7.932223
   _subpop_3 |   2.018275    .539068      .9567991    3.079751
     Eastern |   2.124579   .7734083       .601665    3.647493
   _subpop_5 |   .0755901   .0761614     -.0743789     .225559
   _subpop_6 |   2.240886   .5663054      1.125777    3.355995
   _subpop_7 |   .3191726   .2530618     -.1791299    .8174752
   _subpop_8 |   11.97649   1.995022      8.048103    15.90488
   _subpop_9 |   11.98386   1.429136      9.169755    14.79796
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |    .696897   .1855552      .3315212    1.062273
   _subpop_2 |   .9198243    .195836      .5342046    1.305444
   _subpop_3 |   .3714181   .1672239      .0421383    .7006979
     Eastern |   .3660591   .1868031     -.0017739    .7338921
   _subpop_5 |   .0214145   .0215763     -.0210713    .0639002
   _subpop_6 |   .3792851   .1242416      .1346415    .6239286
   _subpop_7 |   .1099205   .0831214     -.0537535    .2735945
   _subpop_8 |   2.942027   .8203631      1.326655      4.5574
   _subpop_9 |   2.831496   .4572645      1.931099    3.731893
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |    .191261   .0679878      .0573866    .3251354
   _subpop_2 |   .2578094   .0798705      .1005368     .415082
   _subpop_3 |   .1406245   .0895313     -.0356711    .3169202
     Eastern |   .1149554   .0654916     -.0140037    .2439146
   _subpop_5 |   .0060667   .0061125     -.0059695    .0181028
   _subpop_6 |   .0812744    .027847       .026441    .1361079
   _subpop_7 |   .0390463   .0286883     -.0174436    .0955363
   _subpop_8 |   1.123671   .3916059      .3525618     1.89478
   _subpop_9 |   .9735907   .1992814      .5811868    1.365995
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       9        Number of obs    =      6680
Number of PSUs   =     270        Population size  =  27743665
                                  Design df        =       261

    _subpop_1: spdomain = Central urban
    _subpop_2: spdomain = Central rural
    _subpop_3: spdomain = Eastern rural
    _subpop_4: spdomain = Northern urban
    _subpop_5: spdomain = Northern rural
    _subpop_6: spdomain = Western urban
    _subpop_7: spdomain = Western rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |   .4230458   .3416908     -.2497757    1.095867
   _subpop_2 |    5.56959   .8193071      3.956296    7.182883
   _subpop_3 |   2.194922   .4109562      1.385711    3.004134
   _subpop_4 |   .3341999    .328916     -.3134669    .9818666
   _subpop_5 |   .1037982   .0800482     -.0538243    .2614208
   _subpop_6 |   4.656925   1.023389      2.641775    6.672074
   _subpop_7 |   12.60794   1.220846      10.20398     15.0119
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   .1526192   .1232693     -.0901098    .3953482
   _subpop_2 |   .9069422    .152866      .6059346     1.20795
   _subpop_3 |   .3892973   .1127112      .1673583    .6112363
   _subpop_4 |   .0946779    .093181     -.0888043    .2781601
   _subpop_5 |   .0357473   .0262061      -.015855    .0873496
   _subpop_6 |   .8476985   .2554454      .3447024    1.350695
   _subpop_7 |    3.04787    .448715      2.164308    3.931433
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   .0550593    .044471     -.0325082    .1426269
   _subpop_2 |    .250138    .059645      .1326914    .3675846
   _subpop_3 |   .1285089   .0523554      .0254162    .2316016
   _subpop_4 |    .026822   .0263979      -.025158     .078802
   _subpop_5 |   .0126983   .0090226      -.005068    .0304646
   _subpop_6 |   .2876573   .1245035      .0424982    .5328164
   _subpop_7 |   1.095527   .2070049      .6879143    1.503139
--------------------------------------------------------------

.         compress;
survquar was float now byte
reg_tpi was float now byte
spdomain was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
region was float now byte
regurb was float now byte
rmult was float now int
exdis was float now byte
poor06 was float now byte
psu was int now byte
survmon was float now byte
bswt was float now byte
strata was float now byte
rural was float now byte
news was float now byte
hsize was double now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005\
> GAPP2/work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hh
> size];

. save "$path/work/povmeas.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005\
> GAPP2/work/povmeas.dta saved

. *** HARUNA, the file Povmeas.dta gives the headcount poverty rat
> es using flexible food bundle without inflicting reveales prefer
> ences
> *** therefore specifications in line 226 of this do file have be
> en changed repeatedly to generate these counts for particular
> *** classifications of interest including strata spdomain region
>  urban/rural (urban) and national (done by removing the by comma
> nd 
> ****************************************************************
> **********
> * 130_povmeas_flex.do           (end)
> ****************************************************************
> **********;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UN
> HS_2005\GAPP2/rep/130_povmeas_flex.log
  log type:  text
 closed on:  25 Jun 2013, 11:33:18
------------------------------------------------------------------
