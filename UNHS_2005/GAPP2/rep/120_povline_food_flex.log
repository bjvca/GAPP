------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UN
> HS_2005\GAPP2/rep/120_povline_food_flex.log
  log type:  text
 opened on:  25 Jun 2013, 11:33:17

. clear

. set more off

. #delimit ;
delimiter now ;
. ****************************************************************
> **********
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is
>  in shares. 
> * Then merge it with the prices file, and then with the calories
>  file.
> * Along the way, drop those observations where we have no price 
> information
> * or no calorie information.
> ****************************************************************
> **********;
. /*
> This file uses:
>         work/food_basket_flex.dta
>         work/price_unit_flex.dta
>         work/calperg.dta
>         work/calpp.dta
> 
> This file creates:
>         work/povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path/work/price_unit_flex
> .dta";
(label llspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22        5.87        5.87
          2 |        175       46.67       52.53
          3 |        178       47.47      100.00
------------+-----------------------------------
      Total |        375      100.00

.         list product spdomain descript if _merge==1;

     +-------------------------------------+
     | product         spdomain   descript |
     |-------------------------------------|
179. |     157          Kampala          1 |
180. |     157    Central rural          1 |
181. |     157    Eastern urban          1 |
182. |     157    Eastern rural          1 |
183. |     157   Northern urban          1 |
     |-------------------------------------|
184. |     157    Western urban          1 |
185. |     161    Central urban          1 |
186. |     161    Central rural          1 |
187. |     161    Eastern rural          1 |
188. |     161   Northern urban          1 |
     |-------------------------------------|
189. |     161   Northern rural          1 |
190. |     161    Western urban          1 |
191. |     999          Kampala          2 |
192. |     999    Central urban          2 |
193. |     999    Central rural          2 |
     |-------------------------------------|
194. |     999    Eastern urban          2 |
195. |     999    Eastern rural          2 |
196. |     999   Northern urban          2 |
197. |     999   Northern rural          2 |
198. |     999    Western urban          2 |
     |-------------------------------------|
199. |     999    Western rural          2 |
200. |     999                .          2 |
     +-------------------------------------+

.         drop if _merge ~=3;
(197 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path/work/calperg.dta";
variable product does not uniquely identify observations in the
    master data
(note: descript is str30 in using data but will be float now)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         22       11.00       11.00
          3 |        178       89.00      100.00
------------+-----------------------------------
      Total |        200      100.00

.         * This tells where we are lacking calorie info or are la
> cking quantity info due to 
>         * missing price info above;
.         list product spdomain descript if _merge==1;

.         drop if _merge~=3;
(22 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price obse
> rvations;
.         by spdomain: count if round(bswt)<10;

------------------------------------------------------------------
-> spdomain = Kampala
    0
------------------------------------------------------------------
-> spdomain = Central urban
    1
------------------------------------------------------------------
-> spdomain = Central rural
    0
------------------------------------------------------------------
-> spdomain = Eastern urban
    1
------------------------------------------------------------------
-> spdomain = Eastern rural
    0
------------------------------------------------------------------
-> spdomain = Northern urban
    1
------------------------------------------------------------------
-> spdomain = Northern rural
    0
------------------------------------------------------------------
-> spdomain = Western urban
    1
------------------------------------------------------------------
-> spdomain = Western rural
    0

.         drop if round(bswt) < 10;
(4 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent
>  if necessary;
.         drop if cumshr1<=baskshr-.9;
(0 observations deleted)

.         * reobtain the share represented from the average basket
> - should be slightly more than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

------------------------------------------------------------------
-> spdomain = Kampala

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        11    .3187294           0   .3187294   .318
> 7294

------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        14    .4759655           0   .4759655   .475
> 9655

------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        21    .5298333           0   .5298333   .529
> 8333

------------------------------------------------------------------
-> spdomain = Eastern urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        21    .5132776           0   .5132776   .513
> 2776

------------------------------------------------------------------
-> spdomain = Eastern rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        25      .56168           0     .56168     .5
> 6168

------------------------------------------------------------------
-> spdomain = Northern urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        17    .4622957           0   .4622957   .462
> 2957

------------------------------------------------------------------
-> spdomain = Northern rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        20    .5383102           0   .5383102   .538
> 3102

------------------------------------------------------------------
-> spdomain = Western urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        21    .4987406           0   .4987406   .498
> 7406

------------------------------------------------------------------
-> spdomain = Western rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
     baskshr |        24    .5750901           0   .5750901   .575
> 0901


.         * obtain quantities and calories provided by these quant
> ities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item *
> /
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on f
> ood item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path/work/calpp.dta";
variable spdomain does not uniquely identify observations in the
    master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.57        0.57
          3 |        174       99.43      100.00
------------+-----------------------------------
      Total |        175      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie require
> ments;
.         gen ratio=.95*calpp/calreg;
(1 missing value generated)

.                         replace quan=quan*ratio;
(174 real changes made)

.         replace cal_ir=quan*calperg;
(171 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(175 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

------------------------------------------------------------------
-> spdomain = Kampala

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        11   -.0000193           0  -.0000193  -.000
> 0193

------------------------------------------------------------------
-> spdomain = Central urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        14   -.0000707           0  -.0000707  -.000
> 0707

------------------------------------------------------------------
-> spdomain = Central rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        21   -.0000835           0  -.0000835  -.000
> 0835

------------------------------------------------------------------
-> spdomain = Eastern urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        21     .000045           0    .000045    .00
> 0045

------------------------------------------------------------------
-> spdomain = Eastern rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        25    .0000514           0   .0000514   .000
> 0514

------------------------------------------------------------------
-> spdomain = Northern urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        17    .0000321           0   .0000321   .000
> 0321

------------------------------------------------------------------
-> spdomain = Northern rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        20   -.0000899           0  -.0000899  -.000
> 0899

------------------------------------------------------------------
-> spdomain = Western urban

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        21    .0000193           0   .0000193   .000
> 0193

------------------------------------------------------------------
-> spdomain = Western rural

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |        24   -.0001156           0  -.0001156  -.000
> 1156

------------------------------------------------------------------
-> spdomain = .

    Variable |       Obs        Mean    Std. Dev.       Min       
>  Max
-------------+----------------------------------------------------
> ----
      chkcal |         1   -1253.315           .  -1253.315  -1253
> .315


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;
(1 missing value generated)

.         * the sum of the value of the goods in the bundle is ass
> umed to represent 90% of expenditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.         replace povline_f_flex=povline_f_flex90/.9;
(174 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexi
> ble basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path/work/povline_food_flex.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNHS_2005\
> GAPP2/work/povline_food_flex.dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> ****************************************************************
> **********
> * 120_povline_food_flex.do      (end)
> ****************************************************************
> **********;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UN
> HS_2005\GAPP2/rep/120_povline_food_flex.log
  log type:  text
 closed on:  25 Jun 2013, 11:33:17
------------------------------------------------------------------
