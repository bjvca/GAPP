-----------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_20
> 11\GAPP3/rep/130_povmeas_flex.log
  log type:  text
 opened on:   9 Jul 2013, 11:36:06

. clear

. set more off

. #delimit ;
delimiter now ;
. *********************************************************************
> *****
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before a
> ny iteration)
> *********************************************************************
> *****;
. *CA modified to add work/hhdata.dta for bootstrap;
. /*
> This file uses:
>         in/foodshr96.dta
>         work/povline_f_flex.dta
>         work/consump_nom.dta
>         work/hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work/foodshr96.dta
>         work/povmeas.dta
>         work/povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> *********************************************************************
> *****;
. * Bring in data file with nominal consumption per capita, and deflate
>  it
> * by temporal price index.
> *********************************************************************
> *****;
. use "$path/work/hhdata.dta", clear;
(Household master record (1 record per household))

.         keep hhid strata reg_tpi spdomain news rural survmon survquar
> ;

.         tab reg_tpi, miss;

    Regions |
   used for |
   temporal |
price index |
calculation |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
    Kampala |        184        6.77        6.77
    Central |        657       24.19       30.96
    Eastern |        647       23.82       54.79
   Northern |        693       25.52       80.30
    Western |        535       19.70      100.00
------------+-----------------------------------
      Total |      2,716      100.00

.         tab survquar, miss;

    Sequential |
Survey Quarter |
 (Oct-Dec 10 = |
            1) |      Freq.     Percent        Cum.
---------------+-----------------------------------
    Oct-Dec 10 |        690       25.41       25.41
   Jan-Marc 11 |        692       25.48       50.88
   Apr-June 11 |        676       24.89       75.77
July-Sept 2011 |        610       22.46       98.23
             . |         48        1.77      100.00
---------------+-----------------------------------
         Total |      2,716      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000001.tmp not fo
> und)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000001.tmp saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path/work/hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label lbreg already defined)
(label lsurvquar already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.d
> ta";
variables reg_tpi survquar do not uniquely identify observations in
    the master data
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225        8.28        8.28
          3 |      2,492       91.72      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(225 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumptio
> n/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(225 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000002.tmp not fo
> und)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000002.tmp saved

. *********************************************************************
> *****
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> *********************************************************************
> *****;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the
    master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(106 real changes made)

.                                         * Nearness to poverty line an
> d population weights ;
.         gen tripopwt=triwt*hhweight*hhsize;
(3 missing values generated)

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_f
> lex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexib
> le bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000004.tmp not fo
> und)
file C:\Users\TEMPLE~1\AppData\Local\Temp\ST_0l000004.tmp saved

.                 tab spdomain;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Rural |          1       25.00       25.00
      Eastern |          1       25.00       50.00
     Northern |          1       25.00       75.00
      Western |          1       25.00      100.00
--------------+-----------------------------------
        Total |          4      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the
    master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        313       11.52       11.52
          3 |      2,404       88.48      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

. *********************************************************************
> *****;
. * Poverty line is the sum of the food and non-food poverty lines
> *********************************************************************
> *****;
.         gen povline_flex=povline_f_flex + povline_na_flex;
(313 missing values generated)

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path/work/povlines.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_2011\GAPP3
> /work/povlines.dta saved

. *********************************************************************
> *****;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the fi
> rst stratum.
> *********************************************************************
> *****;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povlines.dta";
variable spdomain does not uniquely identify observations in the
    master data
variable spdomain does not uniquely identify observations in
    C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_2011\GAPP
    > 3/work/povlines.dta
(label lbreg already defined)
(label lsurvquar already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;
(225 missing values generated)

.         * Poverty line;
.         gen linpob=povline_flex;
(313 missing values generated)

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;
(313 missing values generated)

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;
(351 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(2404 real changes made)

.         gen linpobr=linpob/spi;
(313 missing values generated)

.         replace cr2=cr/spi;
(2358 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min   
>      Max
-------------+---------------------------------------------------------
> --------
          cr |    2492  34690902.7    1467.411   2339.007          0   
> 72983.64
         cr2 |    2366  33287447.6     1529.28   2098.911          0   
> 61161.88
      linpob |    2403  33844588.9    483.4337   164.8043   323.7984   
> 703.8991
     linpobr |    2403  33844588.9    491.8102          0   491.8102   
> 491.8102

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. *********************************************************************
> *****
> * calculate poverty measures with the flexible food bundle
> *********************************************************************
> *****;
.         gen h = 100     if cr <=(linpob);
(2163 missing values generated)

.         replace  h = 0 if cr > (linpob);
(2163 real changes made)

.                         gen             pg      = ((linpob - cr )/lin
> pob) *100;
(351 missing values generated)

.         replace         pg      = 0             if h==0;
(2163 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;
(351 missing values generated)

.         replace         spg     = 0             if h==0;
(2163 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;
(313 missing values generated)

.         gen spg_flex=spg;
(313 missing values generated)

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(2 missing values generated)

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |   11.03457          .             .           .
     pg_flex |   4.152206          .             .           .
    spg_flex |   2.533686          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
           0 |   3.215378          .             .           .
           1 |   11.58892          .             .           .
-------------+------------------------------------------------
pg_flex      |
           0 |     .60231          .             .           .
           1 |   4.403878          .             .           .
-------------+------------------------------------------------
spg_flex     |
           0 |   .2759845          .             .           .
           1 |   2.693747          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |    13.4672          .             .           .
     Eastern |   2.506036          .             .           .
    Northern |   7.211695          .             .           .
     Western |   21.84331          .             .           .
-------------+------------------------------------------------
pg_flex      |
     Central |   7.863899          .             .           .
     Eastern |    .881476          .             .           .
    Northern |   1.511279          .             .           .
     Western |   7.329021          .             .           .
-------------+------------------------------------------------
spg_flex     |
     Central |   6.421195          .             .           .
     Eastern |   .3858987          .             .           .
    Northern |    .538026          .             .           .
     Western |   3.790671          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |    13.4672          .             .           .
     Eastern |   2.506036          .             .           .
    Northern |   7.211695          .             .           .
     Western |   21.84331          .             .           .
-------------+------------------------------------------------
pg_flex      |
     Central |   7.863899          .             .           .
     Eastern |    .881476          .             .           .
    Northern |   1.511279          .             .           .
     Western |   7.329021          .             .           .
-------------+------------------------------------------------
spg_flex     |
     Central |   6.421195          .             .           .
     Eastern |   .3858987          .             .           .
    Northern |    .538026          .             .           .
     Western |   3.790671          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Kampala |          0  (omitted)
   _subpop_2 |   3.215378          .             .           .
   _subpop_3 |   13.53644          .             .           .
   _subpop_4 |   2.680107          .             .           .
   _subpop_5 |   7.721144          .             .           .
   _subpop_6 |   22.94611          .             .           .
-------------+------------------------------------------------
pg_flex      |
     Kampala |          0  (omitted)
   _subpop_2 |     .60231          .             .           .
   _subpop_3 |   7.904327          .             .           .
   _subpop_4 |   .9348123          .             .           .
   _subpop_5 |   1.676808          .             .           .
   _subpop_6 |   7.747521          .             .           .
-------------+------------------------------------------------
spg_flex     |
     Kampala |          0  (omitted)
   _subpop_2 |   .2759845          .             .           .
   _subpop_3 |   6.454206          .             .           .
   _subpop_4 |   .4066088          .             .           .
   _subpop_5 |    .598921          .             .           .
   _subpop_6 |   4.014982          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2403
Number of PSUs   =     288        Population size  =  33844589
                                  Design df        =       282

    _subpop_1: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |    13.4672          .             .           .
     Eastern |   2.506036          .             .           .
    Northern |   7.211695          .             .           .
     Western |   21.84331          .             .           .
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   7.863899          .             .           .
     Eastern |    .881476          .             .           .
    Northern |   1.511279          .             .           .
     Western |   7.329021          .             .           .
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   6.421195          .             .           .
     Eastern |   .3858987          .             .           .
    Northern |    .538026          .             .           .
     Western |   3.790671          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.

.         compress;
hhsize was long now byte
survquar was float now byte
spdomain was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_2011\GAPP3
> /work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize]
> ;

. save "$path/work/povmeas.dta", replace;
file C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_2011\GAPP3
> /work/povmeas.dta saved

. *** HARUNA, the file Povmeas.dta gives the headcount poverty rates us
> ing flexible food bundle without inflicting reveales preferences
> *** therefore specifications in line 226 of this do file have been ch
> anged repeatedly to generate these counts for particular
> *** classifications of interest including strata spdomain region urba
> n/rural (urban) and national (done by removing the by command 
> *********************************************************************
> *****
> * 130_povmeas_flex.do           (end)
> *********************************************************************
> *****;
. log close;
      name:  <unnamed>
       log:  C:\Users\Templeton\Desktop\GAPP\GAPP-UGANDA-HARUNA\UNPS_20
> 11\GAPP3/rep/130_povmeas_flex.log
  log type:  text
 closed on:   9 Jul 2013, 11:36:06
-----------------------------------------------------------------------
