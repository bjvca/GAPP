--------------------------------------------------------------------------------------------------------------------------
      name:  log_total
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/log_total.log
  log type:  text
 opened on:   8 Jul 2013, 20:05:21

. log using "$path/rep/log_total.smcl", name(log_tot_s) replace
--------------------------------------------------------------------------------------------------------------------------
      name:  log_tot_s
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/log_total.smcl
  log type:  smcl
 opened on:   8 Jul 2013, 20:05:21

. log using "$path/rep/000_boom.log"  , name(log_000_boom) replace
--------------------------------------------------------------------------------------------------------------------------
      name:  log_000_boom
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/000_boom.log
  log type:  text
 opened on:   8 Jul 2013, 20:05:21

. 
. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. display ""


. display "Generel information:"
Generel information:

. display "   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10"
   UGANDA HOUSEHOLD BUDGET SURVEY 2009/10

. display "   Poverty rate estimation"
   Poverty rate estimation

. display "   Methodology: Iterative procedure and revealed preferences tests"
   Methodology: Iterative procedure and revealed preferences tests

. display ""


. display "* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *"
* # * # * # * # * # * # * # * # * # * # * # * # * # * # * # * # *

. 
. 
. **************************************************************************

. * 000_boom.do(start)

. *

. * Reminders:

. *1) Check very top of this file to make sure you are on the right path! 

. *2) GAMS 22.5 must be placed onto the path. See 190_revpref13_m1.bat.

. *   Typically this needs to be edited.

. *   3) In case of implementing a new survey the user must make necessary

. *      changes in 010_initial.do, 020_hhdata.do and 030_rawdata.do.

. *

. * Process:

. * - The do-file prefix indicates first time a do-file is called

. *

. * KS, 2003

. * CA, 2009-2010

. * MAH, Apr. 2012

. **************************************************************************

. 
. clear all

. set more off

. set mem 700m

. 
. noisily display "Start time: " "$S_TIME"
Start time: 20:05:45

. 
. 
. 
. **************************************************************************

. * Macros. Region definitions. Demographic definitions.

. **************************************************************************

. do "$path/new/010_initial.do"

. cap log close

. log using "$path/rep/010_initial.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/010_initial.log
  log type:  text
 opened on:   8 Jul 2013, 20:05:45

. clear

. set more off

. #delimit ;
delimiter now ;
. ******************************************************************************
> * 010_initial.do                (start)
> ******************************************************************************;
. ******************************************************************************
> * Purpose: Set some globals
> ******************************************************************************;
. ******************************************************************************
> * TPI basket
> ******************************************************************************;
. * Number of items for Uganda i primarily set it to 30 on considering a product for appearing over 1000 times on househol
> ds menu min was 1085 and max was 6157 however the relevant code in new is atvivated to take care of this automatically;
. global product_tpi_n "30";

. * Code choose $product_tpi_n ;
. global product_tpi   "product_tpi==1";

. * Initial (arbitrary) quantile defining poor for price index calculations.
> * Mozambique: bottom 60%. Vietnam: bottom 20%. Tanzania: bottom 40% . Uganda: headcount 2009 24.5% ;
. global tpi_bottom "50";

.  * Set the number of regions in the TPI calc for Uganda are set to 4 as east central north and east;
. global n_tpi "5";

. * To reproduce the mozambique 10 numbers, the following global should be commented out. It controls a line in 140_iterat
> e.do 
> * where observations not measured in kg are dropped. For all other datasets, all observations should be converted to kg'
> s before
> * the toolkit is run. For all other datasets, this line should therefore be included.
> global MZ "*";
. ******************************************************************************
> * Initial (arbitrary) quantile defining the (relatively) poor.
> ******************************************************************************;
. global bottom "70";

. ******************************************************************************
> * Number of iterations in 140_iterate.do
> ******************************************************************************;
. global it_n "5";

. ******************************************************************************
> * Set the number of regions in the spatial domain;
. ******************************************************************************;
. global n_spdom "5";

. ******************* we deleted East urban (132 hhds), North urban (172 hhds) and West urban (107 hhds) because too few o
> bservations were in those spatial domains;
.  ******************************************************************************
> * Revealed preferences choices
> ******************************************************************************;
. * Activate GAMS program according to number of regions in spatial domain;
. *global revpref "190_revpref13_m1.bat";
. *global no_temp_rev " ";
. * k spatial regions and no intertemporal revealed preference condition:
>   Activate the next two lines below;
. global no_temp_rev "*";

. global revpref "190_revpref13_r.bat";

.  **************************************************************************
> * 010_initial.do                (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/010_initial.log
  log type:  text
 closed on:   8 Jul 2013, 20:05:45
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. 
. *do "C:\user\gapp\z_data_preb/new/100_collect_expen_moz.do"

. *s;

. 
. *do "C:\user\gapp\z_data_preb/new/000_boom.do"

. 
. *global path "C:\user\gapp"

. 
. 
. 
. **************************************************************************;

. **************************************************************************;

. * This is the block of do files to set up the data to get nominal

. * consumption. These DO NOT need to be bootstrapped.

. **************************************************************************;

. **************************************************************************;

. 
. * This code produces some once for all data for the in-folder. Don't

. * run it unless you know what you are doing!!!

. * Produces education expenditure

. *do "$path\new\Create/education_Create.do"

. * Imputation of missing recepts-in-kind. Run the code without this first...

. *do "$path\new\Create/0_code_chain.do"

. * First poverty lines dependent on IAF

. *do "$path\new\Create/povlines_first_iof_Create.do"

. * Match product codes for different surveys

. *do "$path\new\Create/match96_02_Create.do"

. * Basket from previous survey

. *do "$path\new\Create/smallbasket_iof_Create.do"

. * Match product codes between surveys

. *do "$path\new\Create/rev_pref_matchcodes_02-96_iof_Create.do"

. * Update poverty lines

. *do "$path\new\Create/povlines-96-v1-vers7_iof_Create.do"

. * Food share

. *do "$path\new\Create/foodshr96_iof_Create.do"

. 
. *do "$path\new\Create/.do"

. *do "$path\new\Create/.do"

. 
. */

. * This set of files takes the raw data and creates more handy data 

. * sets in the work-folder

. do "$path/new/020_in_2_work_folder.do"

. clear all

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. set mem 999m

. 
. cap log close

. log using "$path/rep/020_hhdata.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/020_hhdata.log
  log type:  text
 opened on:   8 Jul 2013, 20:05:46

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 020_hhdata.do         (start)
> *
> * Organize the hhid identifier in the HHData file the same way, and keep
> * only the relevant variables.
> *
> * This file sets:
> * - interview month, quarter and year
> * - regions: make all needed regions. But in the end only the one specified
> *            in initial.do are kept. These are
> *            - rural: 0=urban, 1=rural
> *            - news: speficifying North, East, West, South. But combinations
> *                    are also possible, eg. North-East, Center,...
> *            - reg_tpi: regions with own TPI
> *            - strata: strata regions
> *            - spdomain: spatial domains (regions with own poverty line)
> *            - news_ru_ur: combination of news and rural
> **************************************************************************;
. use "$path/in/hhdata.dta", clear;
(Household master record (1 record per household))

. *recode spdomain 10=1 11=2 20=3 30=4 40=5 these have been set to five for Uganda to ensure hwe have at least 1000 househ
> olds per domain;
. tab spdomain, missing;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |        304       11.19       11.19
Central Rural |        529       19.48       30.67
      Eastern |        647       23.82       54.49
     Northern |        693       25.52       80.01
      Western |        535       19.70       99.71
            . |          8        0.29      100.00
--------------+-----------------------------------
        Total |      2,716      100.00

.         sort hhid;

.         save "$path/work/hhdata.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/hhdata.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/hhdata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
      region |      2716    2.271723    1.217652          0          4
       urban |      2716    .2249632     .417635          0          1
      regurb |      2708    23.65694    11.05195         10         41
      strata |      2716    3.830265    1.511984          1          6
-------------+--------------------------------------------------------
         psu |      2716     2435254     1116982    1010002    4190035
       h1aq1 |         0
      h1aq2b |         0
      h1aq3b |         0
      h1aq4b |         0
-------------+--------------------------------------------------------
         day |      2661     18.1879    8.160423          1         31
       month |      2668    6.456147     3.54244          1         12
        year |      2668    2010.741    .4379588       2010       2011
interview_~t |      2716    1.021723    .1458049          1          2
      reason |        49    46.42857    48.00477          1         99
-------------+--------------------------------------------------------
   hh_status |      2716    1.037555    .2688009          1          3
spitoff09_10 |      2716    .0942563    .2922387          0          1
spitoff10_11 |      2716    .0180412     .133125          0          1
    hhweight |      2715    2207.802    1694.047   308.1181   8736.727
    survquar |      2668    2.452024    1.105744          1          4
-------------+--------------------------------------------------------
     survmon |      2668    6.352699    3.368011          1         12
       rural |      2716    .7750368     .417635          0          1
     reg_tpi |      2716    2.271723    1.217652          0          4
    spdomain |      2708    3.231167    1.279732          1          5
        news |      2708    2.343427    1.111882          1          4
-------------+--------------------------------------------------------
        bswt |      2716           1           0          1          1
      hhsize |      2714     7.06706    3.584677          1         29

. use "$path/in/indata.dta", clear;
(One record per person per household (i.e. The roster information) Sections 2 -5)

.         *sort hhid;
.         save "$path/work/indata.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/indata.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/indata.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16725    1.03e+13    3.30e+14   1.24e+11   4.23e+16
    motherhh |     15196    .4197157    .4935286          0          1
        hhid |     16592    5.58e+10    1.66e+12   1.01e+09   2.12e+14
         sex |     16592    .4836668    .4997482          0          1
         age |     15924    20.66874    18.32459          0        100

. use "$path/in/calperg.dta", clear;

.         *sort hhid;
.         save "$path/work/calperg.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/calperg.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/calperg.dta saved

.         sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        62       130.5    18.04162        100        161
    descript |         0
     calperg |        62    1.980935    2.136932          0       8.84

. use "$path/in/cons_cod.dta", clear;

.                 save "$path/work/cons_cod.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_cod.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_cod.dta saved

. use "$path/in/cons_cod_trans.dta", clear;
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

.                 save "$path/work/cons_cod_trans.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_cod_trans.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_cod_trans.dta saved

. /*
> use "$path/in/cons_cod_trans.dta", clear;
>         *sort hhid;
>         sum;
> for var value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3: replace X=0 if X==.;
> collapse food_cat prod_cat (sum) value quantityd cod_hh_nom cod_hh_nom2 cod_hh_nom3, by(hhid product descript);
>         save "$path/work/cons_cod.dta", replace;
>         sum;
> */
>  
> **************************************************************************
> * 020_hhdata.do         (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. 
. do "$path/new/070_calpp.do"/* Calories per person in spatial domains*/

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/070_calpp.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/070_calpp.log
  log type:  text
 opened on:   8 Jul 2013, 20:06:16

. clear

. set more off

. #delimit ;
delimiter now ;
. *global fert_rate "fert_rate";
. ***********************************************************************
> * 070_calpp.do          (start)
> *
> * Purpose: Determine calories required for each person per domain per day.
> ***********************************************************************;
. /*
> This file uses:
>         work/indata.dta
>         work/hhdata.dta
> 
> This file creates:
>         work/calpp.dta
> */
> 
> *-------------------------------------------------------------------------*
> * Include fertility rates from csv-file
> *-------------------------------------------------------------------------*;
. clear;

. insheet sex rural age fert_rate using "$path/in/fert_rate_Uganda.csv";
(4 vars, 96 obs)

. ***************************************** check for Ugandan fertility rates *************************************
> *************************************************************************************************************;
. sort sex rural age;

. tempfile fert_rate;

. save `fert_rate';
file /tmp/St02337.000001 saved

. list;

     +------------------------------+
     | sex   rural   age   fert_r~e |
     |------------------------------|
  1. |   2       0    12       .008 |
  2. |   2       0    13       .008 |
  3. |   2       0    14       .008 |
  4. |   2       0    15       .134 |
  5. |   2       0    16       .134 |
     |------------------------------|
  6. |   2       0    17       .134 |
  7. |   2       0    18       .134 |
  8. |   2       0    19       .134 |
  9. |   2       0    20       .313 |
 10. |   2       0    21       .313 |
     |------------------------------|
 11. |   2       0    22       .313 |
 12. |   2       0    23       .313 |
 13. |   2       0    24       .313 |
 14. |   2       0    25       .291 |
 15. |   2       0    26       .291 |
     |------------------------------|
 16. |   2       0    27       .291 |
 17. |   2       0    28       .291 |
 18. |   2       0    29       .291 |
 19. |   2       0    30       .232 |
 20. |   2       0    31       .232 |
     |------------------------------|
 21. |   2       0    32       .232 |
 22. |   2       0    33       .232 |
 23. |   2       0    34       .232 |
 24. |   2       0    35       .172 |
 25. |   2       0    36       .172 |
     |------------------------------|
 26. |   2       0    37       .172 |
 27. |   2       0    38       .172 |
 28. |   2       0    39       .172 |
 29. |   2       0    40       .074 |
 30. |   2       0    41       .074 |
     |------------------------------|
 31. |   2       0    42       .074 |
 32. |   2       0    43       .074 |
 33. |   2       0    44       .074 |
 34. |   2       0    45       .023 |
 35. |   2       0    46       .023 |
     |------------------------------|
 36. |   2       0    47       .023 |
 37. |   2       0    48       .023 |
 38. |   2       0    49       .023 |
 39. |   2       0    50       .006 |
 40. |   2       0    51       .006 |
     |------------------------------|
 41. |   2       0    52       .006 |
 42. |   2       0    53       .006 |
 43. |   2       0    54       .006 |
 44. |   2       0    55       .006 |
 45. |   2       0    56       .006 |
     |------------------------------|
 46. |   2       0    57       .006 |
 47. |   2       0    58       .006 |
 48. |   2       0    59       .006 |
 49. |   2       1    12       .008 |
 50. |   2       1    13       .008 |
     |------------------------------|
 51. |   2       1    14       .008 |
 52. |   2       1    15       .134 |
 53. |   2       1    16       .134 |
 54. |   2       1    17       .134 |
 55. |   2       1    18       .134 |
     |------------------------------|
 56. |   2       1    19       .134 |
 57. |   2       1    20       .313 |
 58. |   2       1    21       .313 |
 59. |   2       1    22       .313 |
 60. |   2       1    23       .313 |
     |------------------------------|
 61. |   2       1    24       .313 |
 62. |   2       1    25       .291 |
 63. |   2       1    26       .291 |
 64. |   2       1    27       .291 |
 65. |   2       1    28       .291 |
     |------------------------------|
 66. |   2       1    29       .291 |
 67. |   2       1    30       .232 |
 68. |   2       1    31       .232 |
 69. |   2       1    32       .232 |
 70. |   2       1    33       .232 |
     |------------------------------|
 71. |   2       1    34       .232 |
 72. |   2       1    35       .172 |
 73. |   2       1    36       .172 |
 74. |   2       1    37       .172 |
 75. |   2       1    38       .172 |
     |------------------------------|
 76. |   2       1    39       .172 |
 77. |   2       1    40       .074 |
 78. |   2       1    41       .074 |
 79. |   2       1    42       .074 |
 80. |   2       1    43       .074 |
     |------------------------------|
 81. |   2       1    44       .074 |
 82. |   2       1    45       .023 |
 83. |   2       1    46       .023 |
 84. |   2       1    47       .023 |
 85. |   2       1    48       .023 |
     |------------------------------|
 86. |   2       1    49       .023 |
 87. |   2       1    50       .006 |
 88. |   2       1    51       .006 |
 89. |   2       1    52       .006 |
 90. |   2       1    53       .006 |
     |------------------------------|
 91. |   2       1    54       .006 |
 92. |   2       1    55       .006 |
 93. |   2       1    56       .006 |
 94. |   2       1    57       .006 |
 95. |   2       1    58       .006 |
     |------------------------------|
 96. |   2       1    59       .006 |
     +------------------------------+

. *-------------------------------------------------------------------------*
> * Now do the calorie needs for individuals
> *-------------------------------------------------------------------------*;
. use "$path/work/indata.dta";
(One record per person per household (i.e. The roster information) Sections 2 -5)

. * CA bootstrap modification;
. sort hhid;

. merge hhid using "$path/work/hhdata.dta";
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        133        0.80        0.80
          2 |          3        0.02        0.81
          3 |     16,592       99.19      100.00
------------+-----------------------------------
      Total |     16,728      100.00

.  drop _m;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16725    1.03e+13    3.30e+14   1.24e+11   4.23e+16
    motherhh |     15196    .4197157    .4935286          0          1
        hhid |     16595    5.58e+10    1.66e+12   1.01e+09   2.12e+14
         sex |     16592    .4836668    .4997482          0          1
         age |     15924    20.66874    18.32459          0        100
-------------+--------------------------------------------------------
      region |     16595    2.282013    1.194585          0          4
       urban |     16595    .2208497    .4148318          0          1
      regurb |     16561    23.68221      10.911         10         41
      strata |     16595    3.835372    1.489108          1          6
         psu |     16595     2438344     1101801    1010002    4190035
-------------+--------------------------------------------------------
       h1aq1 |         0
      h1aq2b |         0
      h1aq3b |         0
      h1aq4b |         0
         day |     16325    18.25893    8.105742          1         31
-------------+--------------------------------------------------------
       month |     16370    6.499695    3.520885          1         12
        year |     16370     2010.74    .4387412       2010       2011
interview_~t |     16595    1.017415    .1308153          1          2
      reason |       232    48.70259    48.32307          1         99
   hh_status |     16595    1.028924    .2370061          1          3
-------------+--------------------------------------------------------
spitoff09_10 |     16595    .0800844    .2714319          0          1
spitoff10_11 |     16595    .0140404    .1176609          0          1
    hhweight |     16594    1984.054    1511.524   308.1181   8736.727
    survquar |     16370    2.461454    1.111593          1          4
     survmon |     16370    6.377642    3.380194          1         12
-------------+--------------------------------------------------------
       rural |     16595    .7791503    .4148318          0          1
     reg_tpi |     16595    2.282013    1.194585          0          4
    spdomain |     16561    3.243464    1.253747          1          5
        news |     16561    2.346296    1.096685          1          4
        bswt |     16595           1           0          1          1
-------------+--------------------------------------------------------
      hhsize |     16593     8.69686    3.864144          1         29

. * Include fertility rates;
. sort sex rural age;

. merge sex rural age using `fert_rate';
variables sex rural age do not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       indid |     16725    1.03e+13    3.30e+14   1.24e+11   4.23e+16
    motherhh |     15196    .4197157    .4935286          0          1
        hhid |     16595    5.58e+10    1.66e+12   1.01e+09   2.12e+14
         sex |     16688    .4923897    .5113346          0          2
         age |     16020    20.75762    18.33681          0        100
-------------+--------------------------------------------------------
      region |     16595    2.282013    1.194585          0          4
       urban |     16595    .2208497    .4148318          0          1
      regurb |     16561    23.68221      10.911         10         41
      strata |     16595    3.835372    1.489108          1          6
         psu |     16595     2438344     1101801    1010002    4190035
-------------+--------------------------------------------------------
       h1aq1 |         0
      h1aq2b |         0
      h1aq3b |         0
      h1aq4b |         0
         day |     16325    18.25893    8.105742          1         31
-------------+--------------------------------------------------------
       month |     16370    6.499695    3.520885          1         12
        year |     16370     2010.74    .4387412       2010       2011
interview_~t |     16595    1.017415    .1308153          1          2
      reason |       232    48.70259    48.32307          1         99
   hh_status |     16595    1.028924    .2370061          1          3
-------------+--------------------------------------------------------
spitoff09_10 |     16595    .0800844    .2714319          0          1
spitoff10_11 |     16595    .0140404    .1176609          0          1
    hhweight |     16594    1984.054    1511.524   308.1181   8736.727
    survquar |     16370    2.461454    1.111593          1          4
     survmon |     16370    6.377642    3.380194          1         12
-------------+--------------------------------------------------------
       rural |     16691    .7775448    .4159077          0          1
     reg_tpi |     16595    2.282013    1.194585          0          4
    spdomain |     16561    3.243464    1.253747          1          5
        news |     16561    2.346296    1.096685          1          4
        bswt |     16595           1           0          1          1
-------------+--------------------------------------------------------
      hhsize |     16593     8.69686    3.864144          1         29
   fert_rate |        96    .1308125    .1150995       .006       .313
      _merge |     16824    1.005706    .0753254          1          2

. * Do calorie calculations ;
.     gen num=1;

.     gen cal = .;
(16824 missing values generated)

. * Same assumptions about sex/age specific calories need in IAF 1997, IAF 2003 and IOF 2009;
. * Children (no difference between boys and girls)   ;
.      replace cal =  820 if age < 1;
(469 real changes made)

. * Add 500 cal per day for mothers in first six months of breast feeding
> * We assume that 60% of children under 1 are under six months old
> * And that all of them breast feed
> * We add these mother requirements of 300 on average to each child under 1 whose mother is alive;
.     replace cal = 1120 if age <  1 & motherhh==1;
(412 real changes made)

.     replace cal = 1150 if age >= 1 & age <2;
(455 real changes made)

.     replace cal = 1350 if age >= 2 & age <3;
(533 real changes made)

.     replace cal = 1550 if age >= 3 & age <5;
(1089 real changes made)

. * Males ;
.     replace cal = 1850 if age >=  5 & age <7  & sex==1;
(561 real changes made)

.     replace cal = 2100 if age >=  7 & age <10 & sex==1;
(761 real changes made)

.     replace cal = 2200 if age >= 10 & age <12 & sex==1;
(521 real changes made)

.     replace cal = 2400 if age >= 12 & age <14 & sex==1;
(527 real changes made)

.     replace cal = 2650 if age >= 14 & age <16 & sex==1;
(516 real changes made)

.     replace cal = 2850 if age >= 16 & age <18 & sex==1;
(407 real changes made)

.     replace cal = 3000 if age >= 18 & age <30 & sex==1;
(1301 real changes made)

.     replace cal = 2900 if age >= 30 & age <60 & sex==1;
(1517 real changes made)

.     replace cal = 2450 if age>=60 & age~=. & sex==1;
(379 real changes made)

. * Girls 5-12 years (probability of pregnancy assumed = 0) ;
.     replace cal = 1750 if age >=  5 & age < 7 & sex==2;
(0 real changes made)

.     replace cal = 1800 if age >=  7 & age <10 & sex==2;
(0 real changes made)

.     replace cal = 1950 if age >= 10 & age <12 & sex==2;
(0 real changes made)

. * Women with a correction for pregnancy. We add 285 calories per for the final trimester.
> * To do this we find the probability that rural and urban women are pregnant from
> * live births data in the 1997 census over the past 12 months (no correction for still births).
> * 3/4*probability of birth gives probability of preganancy. Probability of final trimester is one
> * third of that of that or 1/4 of the probability of birth
> 
> * Women urban;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==0;
(2 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==0;
(4 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==0;
(12 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==0;
(30 real changes made)

. * Women rural;
.     replace cal = 2100 + (fert_rate*285)/4 if age >= 12 & age <14 & sex==2 & rural==1;
(2 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 14 & age <18 & sex==2 & rural==1;
(4 real changes made)

.     replace cal = 2100 + (fert_rate*285)/4 if age >= 18 & age <30 & sex==2 & rural==1;
(12 real changes made)

.     replace cal = 2150 + (fert_rate*285)/4 if age >= 30 & age <60 & sex==2 & rural==1;
(30 real changes made)

. * Women 60+ are not pregnant ;
.     replace cal = 1950 if age>=60 & age~=. & sex==2;
(0 real changes made)

.     count if cal ==.;
 7692

.     *Fill in these two observations for IAF 2002/03:;
.     * 1) this one is a child;
.     *replace cal = 1500 if cal ==. & age==.;
.     * 2) this one is 21 years old;
.     *replace cal = 2500 if cal ==. & b2==.;
.     collapse (sum) cal num (max) psu hhsize hhweight strata rural spdomain, by (hhid);

.     gen chk=hhsize - num;
(3 missing values generated)

.     sum chk;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
         chk |      2714    .9532056    1.604116          0         27

.     drop chk;

.     gen calpp = cal / hhsize;
(3 missing values generated)

.     sort spdomain;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
         cal |      2717    7526.675    6008.854          0   205894.8
         num |      2717    6.192124    5.287038          1        229
         psu |      2716     2435254     1116982    1010002    4190035
      hhsize |      2714     7.06706    3.584677          1         29
-------------+--------------------------------------------------------
    hhweight |      2715    2207.802    1694.047   308.1181   8736.727
      strata |      2716    3.830265    1.511984          1          6
       rural |      2717    .7751196    .4175804          0          1
    spdomain |      2708    3.231167    1.279732          1          5
       calpp |      2714    1094.596     533.153          0       3000

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
         cal |      2717    7526.675    6008.854          0   205894.8
         num |      2717    6.192124    5.287038          1        229
         psu |      2716     2435254     1116982    1010002    4190035
      hhsize |      2714     7.06706    3.584677          1         29
-------------+--------------------------------------------------------
    hhweight |      2715    2207.802    1694.047   308.1181   8736.727
      strata |      2716    3.830265    1.511984          1          6
       rural |      2717    .7751196    .4175804          0          1
    spdomain |      2708    3.231167    1.279732          1          5
       calpp |      2714    1094.596     533.153          0       3000

.  codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          Household ID
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2716                     missing .:  1/2717

                  mean:   1.3e+11
              std. dev:   4.1e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   3.0e+09   4.0e+09   1.1e+11

. collapse (mean) calpp[aw=hhsize*hhweight], by (spdomain);

. sort spdomain;

. save "$path/work/calpp.dta",replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/calpp.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/calpp.dta saved

. ***********************************************************************
> * 070_calpp.do          (end)
> ***********************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/070_calpp.log
  log type:  text
 closed on:   8 Jul 2013, 20:06:16
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. 
. use "$path/work/indata.dta";
invalid ';' 
r(198);

. use "$path/work/indata.dta"
(One record per person per household (i.e. The roster information) Sections 2 -5)

. sort hhid

. merge hhid using "$path/work/hhdata.dta"
variable hhid does not uniquely identify observations in the master data

. do "$path/new/080_conpc.do"

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 100m

. 
. clear

. cap log close

. log using "$path/rep/080_conpc.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/080_conpc.log
  log type:  text
 opened on:   8 Jul 2013, 20:13:56

. set more off

. 
. 
. ***************************************************************************
. * 080_conpc.do          (start)
. *
. * Creates a file with per capita nominal consumption divided between food
. * and non-food categories based on the calorie definition of food
. * rather than the COICOP (INE) definition of food. ready for 
. * temporal deflation when necessary
. **************************************************************************** 
. 
. /*
> This file uses:
>         work/hhdata.dta
>         work/consump_nom.dta
>       
> This file creates:
>         work/conpc.dta
> */
. 
. 
. 
. ***************************************************************************
. * Food expenditure
. **************************************************************************** 
. *use "$path/in/cons_cod.dta" 
. use "$path/work/cons_cod.dta" 

.             *sort product 
.             *merge product using "$path/work/food_cat.dta" 
.             *tab _m 
.             *drop _m 
.             keep if food_cat==1 
(2995 observations deleted)

.             collapse (sum) cod_hh_nom, by(hhid) 

.             rename cod_hh_nom food_hh_nom 

.                 sort hhid 

.             keep hhid food_hh_nom 

.             tempfile foodexp 

. save `foodexp' 
file /tmp/St02337.000001 saved

. 
. ***************************************************************************
. * Food expenditure merged with all expenditure
. **************************************************************************** 
. use "$path/work/cons_cod.dta" 

. *use "$path/in/cons_cod.dta" 
. *use "$path/in/cons_cat.dta" 
. sum 

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     36833    1.34e+11    4.13e+12   1.01e+09   2.12e+14
     product |     37094    197.1675    225.8068        100        999
    food_cat |     36833     1.07363    .2611707          1          2
    prod_cat |     37116    1.073068     .260252          1          2
    descript |     37116    1.073068     .260252          1          2
-------------+--------------------------------------------------------
       untcd |     33603    55.59504    39.11441          1        133
      h15bq2 |         0
     h15bq2b |         0
     h15bq2c |     33702    5.974364     3.23507          1         12
     h15bq2d |         0
-------------+--------------------------------------------------------
     h15bq3a |     34121           1           0          1          1
     h15bq3b |     34111    4.109847    2.379586          1          7
     h15bq3c |        22    48522.68    66379.85          1     166089
     h15bq14 |     33682    6.794333    240.1296          0      28000
     h15bq15 |     33680    3284.011    6913.258          0     600000
-------------+--------------------------------------------------------
   quantityd |     34121    .5441537    1.353663          0   71.42857
      valuez |     34121    470.5371    985.3928   1.428571   85714.29
    quantity |     18998    .7658831    2.589936          0         60
  cod_hh_nom |     37116    1066.391    8498.978          0   857465.5

. collapse (sum) cod_hh_nom, by(hhid) 

. *gen cons_pc_nom = cons_hh_nom/hhsize 
. rename cod_hh_nom cons_hh_nom 

. *keep  hhid cons_pc_nom cons_hh_nom  
. *keep hhid cod_hh_nom 
. *use "$path/in/cons_cod.dta" 
. *use "$path/in/consump_nom.dta" 
. *use "$path/work/consump_nom.dta" 
. *            keep  hhid cons_hh_nom  
.             display _N 
2713

.             keep  hhid cons_hh_nom  

.             sort hhid 

.             merge hhid using "$path/work/hhdata.dta" 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          2 |          4        0.15        0.18
          3 |      2,712       99.82      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.             drop _m 

. gen cons_pc_nom = cons_hh_nom/hhsize 
(6 missing values generated)

.             sort hhid 

.             merge hhid using `foodexp' 

.             tab _m 

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61        2.25        2.25
          3 |      2,656       97.75      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                 drop if _merge==2 
(0 observations deleted)

.             replace food_hh_nom=0 if _merge==1 & food_hh_nom==. 
(61 real changes made)

.             drop _m 

.                 gen food_pc_nom=food_hh_nom/hhsize 
(3 missing values generated)

.                 gen nf_hh_nom=cons_hh_nom-food_hh_nom 
(4 missing values generated)

.             gen nf_pc_nom=nf_hh_nom/hhsize 
(6 missing values generated)

.  
.             keep hhid cons_hh_nom food_pc_nom nf_pc_nom cons_pc_nom survquar spdomain news reg_tpi rural hhweight hhsize
>  

.             lab var food_pc_nom "nominal food consumption per capita" 

.             lab var nf_pc_nom "nominal non-food consumption per capita" 

. keep hhid cons_hh_nom cons_pc_nom food_pc_nom nf_pc_nom 

.             sort hhid 

. 
. * MAH   sum  codebook hhid 
. save "$path/work/conpc.dta", replace 
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/conpc.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/conpc.dta saved

. 
. 
. ***************************************************************************
. * 080_conpc.do          (end)
. **************************************************************************** 
. 
. 
. log close 
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/080_conpc.log
  log type:  text
 closed on:   8 Jul 2013, 20:13:56
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/090_temp_index.do"

. *global path "C:/Users/Templeton/Desktop/GAPP/GAPP-UGANDA-HARUNA"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/090_temp_index.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/090_temp_index.log
  log type:  text
 opened on:   8 Jul 2013, 20:14:49

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 090_temp_index.do     (start)
> **************************************************************************;
. *do "$path/new/010_initial.do";
. **************************************************************************
> * Program to compute the temporal price index (intra-survey)
> * 
> * The index is based on 6 regions (North/Center/South by rural/urban) 
> * and four quarters. For IAF 2002/03 (t=t1) it is based on the same 9
> * commodities used for the analysis of the 1996 IAF (t=t0), 
> * except that we have to go to 8 commodities because the 2002-03 survey 
> * does not distinguish between large and small groundnuts, which were 
> * separate items in the old index. For IOF 2008/09 (t=t2) we expand the
> * the food basket to include the 15 most important food products among
> * the poorest.
> *
> * The commodity weights for the items vary by the 6 regions, and are 
> * calculated from the observations in the IAF2002, using the relatively 
> * poor households (below median nominal consumption per capita).
> *
> * The unit values (prices) calculated here are also based on the prices 
> * paid by the relatively poor, using the same definition.
> *
> * K Simler, Sep 2003
> * CA
> * MAH, April 2010
> * URB, Feb 2013 (automatization to any number of n_tpi's)
> **************************************************************************;
. /*
> This file uses:
>         work/own.dta
>         work/receipts.dta
>         work/daily.dta
>         work/hhdata
>         work/cons_cat.dta
> 
> This file creates:
>         work/tpi_unit_val_quarterly.dta
>         work/tpi_unit_val_monthly.dta
>         work/tpi_news_share.dta
>         work/tpi_reg_tpi_share.dta
>         work/temp_index_news.dta
>         work/temp_index_reg_tpi.dta
> */      
> 
> 
> **************************************************************************
> * Either the products used for intertemporal price index is specified
> * explicitly, or they are automatically found as the the n_tpi products
> * with the highest weighted expenditure shares among the $bottom % poorest
> * part of the population
> **************************************************************************;
. * Generating the n_tpi most important food items for the poorest $bottom % ;
. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (start)
> **************************************************************************;
. *------------------------------------------------------------------------*
> * Population weights for each HH
> *------------------------------------------------------------------------*;
. use "$path/work/hhdata.dta", clear;
(Household master record (1 record per household))

. keep hhid hhweight hhsize;

. gen popwt = hhweight*hhsize;
(2 missing values generated)

. lab var popwt "Population weights = hhsize X hhweight";

. sort hhid;

. tempfile popwt;

. save `popwt', replace;
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
    hhweight |      2715    2207.802    1694.047   308.1181   8736.727
      hhsize |      2714     7.06706    3.584677          1         29
       popwt |      2714       13754    11237.33   548.9749   104660.2

. *------------------------------------------------------------------------*
> * Make list of all consumed products
> *------------------------------------------------------------------------*;
. *use "$path/in/cons_cod.dta", clear;
. *save "$path/work/cons_cod.dta", replace;
. use "$path/work/cons_cod.dta", clear;

. keep product descript;

. collapse product, by(descript);

. sort product;

. tempfile descript;

. save `descript', replace;
(note: file /tmp/St02337.000002 not found)
file /tmp/St02337.000002 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    descript |         2         1.5    .7071068          1          2
     product |         2    566.4601    611.7038   133.9201        999

. *------------------------------------------------------------------------*
> * Find the poorest part of the population
> *------------------------------------------------------------------------*;
. use
> "$path/work/cons_cod.dta", clear;

. *use
> *"$path/work/cons_cod.dta", clear;
. ********************************************check the COICOP categories to create the variable prod_cat, for the moment 
> it is equal to food_cat******;
. keep hhid prod_cat product cod_hh_nom;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     36833    1.34e+11    4.13e+12   1.01e+09   2.12e+14
     product |     37094    197.1675    225.8068        100        999
    prod_cat |     37116    1.073068     .260252          1          2
  cod_hh_nom |     37116    1066.391    8498.978          0   857465.5

. merge hhid using `popwt';
variable hhid does not uniquely identify observations in the master data

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     36837    1.34e+11    4.13e+12   1.01e+09   2.12e+14
     product |     37094    197.1675    225.8068        100        999
    prod_cat |     37116    1.073068     .260252          1          2
  cod_hh_nom |     37116    1066.391    8498.978          0   857465.5
    hhweight |     36836    2108.699      1640.9   308.1181   8736.727
-------------+--------------------------------------------------------
      hhsize |     36835    7.420877    3.609826          1         29
       popwt |     36835    13937.78    11273.38   548.9749   104660.2
      _merge |     37120    2.984644    .1742655          1          3

. drop _merge;

. preserve;

. collapse (sum) cod_hh_nom (mean) popwt hhweight hhsize, by(hhid);

. gen cod_pc_nom = cod_hh_nom/hhsize;
(3 missing values generated)

.         sum cod_pc_nom [aw=popwt] , detail;

                         cod_pc_nom
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     302.5962              0
10%     493.8137              0       Obs                2714
25%     802.1614              0       Sum of Wgt.  37328356.8

50%     1313.876                      Mean           2012.671
                        Largest       Std. Dev.       5409.64
75%     2181.702       76733.53
90%     3653.682       78344.66       Variance       2.93e+07
95%     4998.947       79483.23       Skewness       33.34378
99%     10528.57       252488.6       Kurtosis       1448.419

.         global medcpc_= r(p$tpi_bottom);

.         gen bottom_ = cod_pc_nom <= $medcpc_;

. sum [aw=popwt];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    2714  37328356.8    1.47e+11   2.95e+12   1.01e+09   2.12e+14
  cod_hh_nom |    2714  37328356.8     15992.4   33602.47          0   874315.5
       popwt |    2714  37328356.8    22931.77   17291.44   548.9749   104660.2
    hhweight |    2714  37328356.8    3059.501   2065.404   308.1181   8736.727
      hhsize |    2714  37328356.8    8.214561   4.009234          1         29
-------------+-----------------------------------------------------------------
  cod_pc_nom |    2714  37328356.8    2012.671    5409.64          0   252488.6
     bottom_ |    2714  37328356.8    .5001372   .5000921          0          1

. sum [aw=hhweight];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
        hhid |    2715  5994181.97    3.93e+11   7.30e+12   1.01e+09   2.12e+14
  cod_hh_nom |    2715  5994181.97    12533.77   29053.86          0   874315.5
       popwt |    2714  5985445.24    19080.64   14826.93   548.9749   104660.2
    hhweight |    2715  5994181.97    3507.165   2259.003   308.1181   8736.727
      hhsize |    2714  5985445.24    6.236521   3.512924          1         29
-------------+-----------------------------------------------------------------
  cod_pc_nom |    2714  5985445.24    2389.193   8409.093          0   252488.6
     bottom_ |    2715  5994181.97    .4617461   .4986263          0          1

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
  cod_hh_nom |      2717    14567.59    32253.54          0   874315.5
       popwt |      2714       13754    11237.33   548.9749   104660.2
    hhweight |      2715    2207.802    1694.047   308.1181   8736.727
      hhsize |      2714     7.06706    3.584677          1         29
-------------+--------------------------------------------------------
  cod_pc_nom |      2714     2237.42    6114.131          0   252488.6
     bottom_ |      2717    .4755245    .4994925          0          1

. keep if bottom_==1;
(1425 observations deleted)

. keep hhid;

. sort hhid;

. tempfile hhid;

. save `hhid';
file /tmp/St02337.000004 saved

. restore;

. sort hhid;

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     36837    1.34e+11    4.13e+12   1.01e+09   2.12e+14
     product |     37094    197.1675    225.8068        100        999
    prod_cat |     37116    1.073068     .260252          1          2
  cod_hh_nom |     37116    1066.391    8498.978          0   857465.5
    hhweight |     36836    2108.699      1640.9   308.1181   8736.727
-------------+--------------------------------------------------------
      hhsize |     36835    7.420877    3.609826          1         29
       popwt |     36835    13937.78    11273.38   548.9749   104660.2

. merge hhid using `hhid';
variable hhid does not uniquely identify observations in the master data

. tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     23,039       62.07       62.07
          3 |     14,081       37.93      100.00
------------+-----------------------------------
      Total |     37,120      100.00

. keep if _m==3;
(23039 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     14081    3.58e+10    1.99e+11   1.02e+09   2.32e+12
     product |     14058    213.2222    250.1721        101        999
    prod_cat |     14078    1.091561    .2884159          1          2
  cod_hh_nom |     14078    522.1147    946.8067          0   13228.79
    hhweight |     14081    2039.613    1528.942   381.7499   8736.727
-------------+--------------------------------------------------------
      hhsize |     14081    7.762233    3.113957          1         29
       popwt |     14081    14693.25    11020.04   821.0083   104660.2
      _merge |     14081           3           0          3          3

. *------------------------------------------------------------------------*
> * Keep only food product expenditure by the poor. Calculate food product
> * share of total food expenditure by the poor
> *------------------------------------------------------------------------*;
. keep if prod_cat==1;
(1292 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     12789    3.56e+10    1.98e+11   1.02e+09   2.32e+12
     product |     12769    133.8998    16.65255        101        171
    prod_cat |     12789           1           0          1          1
  cod_hh_nom |     12789    340.0714    510.8613   1.428571   11428.57
    hhweight |     12789    2029.244    1520.653   381.7499   8736.727
-------------+--------------------------------------------------------
      hhsize |     12789     7.79889    3.100556          1         29
       popwt |     12789    14717.84     11009.9   821.0083   104660.2
      _merge |     12789           3           0          3          3

. sort product;

. *preserve;
. collapse (sum) cod_hh_nom [aw=hhweight], by(product);

. sort cod;

. egen total=sum(cod_hh_nom);

. gen sh=100*cod_hh_nom/total;

. *------------------------------------------------------------------------*
> * Include product labels
> *------------------------------------------------------------------------*;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        65    135.0308     20.5015        101        171
  cod_hh_nom |        66    63808.76    89487.47   428.5714   400428.9
       total |        66     4211379           0    4211379    4211379
          sh |        66    1.515151    2.124897   .0101765   9.508262

. sort product;

. merge product using `descript';

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         66       97.06       97.06
          2 |          2        2.94      100.00
------------+-----------------------------------
      Total |         68      100.00

. keep if _merge==1 | _merge==3;
(2 observations deleted)

. drop _merge;

. sort sh;

. *list;
. list in -$product_tpi_n/-1;

     +----------------------------------------------------+
     | product   cod_hh~m     total         sh   descript |
     |----------------------------------------------------|
 37. |     137   41074.22   4211379   .9753153          . |
 38. |     150   42021.38   4211379    .997806          . |
 39. |     146   42851.82   4211379   1.017525          . |
 40. |     135    46019.2   4211379   1.092735          . |
 41. |     118   48591.65   4211379   1.153818          . |
     |----------------------------------------------------|
 42. |     132   50774.41   4211379   1.205648          . |
 43. |     119   56504.61   4211379   1.341713          . |
 44. |     138    63879.3   4211379   1.516826          . |
 45. |     112   65231.24   4211379   1.548928          . |
 46. |     144   67521.51   4211379   1.603311          . |
     |----------------------------------------------------|
 47. |     139   73495.88   4211379   1.745174          . |
 48. |     115    74736.8   4211379    1.77464          . |
 49. |     136   77159.07   4211379   1.832157          . |
 50. |     110   83982.38   4211379   1.994178          . |
 51. |     122   88817.03   4211379   2.108978          . |
     |----------------------------------------------------|
 52. |     121   92049.94   4211379   2.185744          . |
 53. |     116   95493.22   4211379   2.267505          . |
 54. |     123   98410.09   4211379   2.336767          . |
 55. |     127   101368.6   4211379   2.407016          . |
 56. |     105   106746.5   4211379   2.534717          . |
     |----------------------------------------------------|
 57. |     140   111581.6   4211379   2.649527          . |
 58. |     107   116030.7   4211379   2.755172          . |
 59. |     125     130727   4211379   3.104138          . |
 60. |     157   173844.4   4211379    4.12797          . |
 61. |     147   185882.9   4211379   4.413826          . |
     |----------------------------------------------------|
 62. |     117     187859   4211379   4.460749          . |
 63. |     108   298100.1   4211379   7.078444          . |
 64. |     113   364568.8   4211379   8.656758          . |
 65. |     101   381710.4   4211379   9.063788          . |
 66. |     141   400428.9   4211379   9.508262          . |
     +----------------------------------------------------+

. list product descript in -$product_tpi_n/-1;

     +--------------------+
     | product   descript |
     |--------------------|
 37. |     137          . |
 38. |     150          . |
 39. |     146          . |
 40. |     135          . |
 41. |     118          . |
     |--------------------|
 42. |     132          . |
 43. |     119          . |
 44. |     138          . |
 45. |     112          . |
 46. |     144          . |
     |--------------------|
 47. |     139          . |
 48. |     115          . |
 49. |     136          . |
 50. |     110          . |
 51. |     122          . |
     |--------------------|
 52. |     121          . |
 53. |     116          . |
 54. |     123          . |
 55. |     127          . |
 56. |     105          . |
     |--------------------|
 57. |     140          . |
 58. |     107          . |
 59. |     125          . |
 60. |     157          . |
 61. |     147          . |
     |--------------------|
 62. |     117          . |
 63. |     108          . |
 64. |     113          . |
 65. |     101          . |
 66. |     141          . |
     +--------------------+

. *restore;
. *------------------------------------------------------------------------*
> * Keep the required number of most important food products
> *------------------------------------------------------------------------*;
. keep in -$product_tpi_n/-1;
(36 observations deleted)

. list;

     +----------------------------------------------------+
     | product   cod_hh~m     total         sh   descript |
     |----------------------------------------------------|
  1. |     137   41074.22   4211379   .9753153          . |
  2. |     150   42021.38   4211379    .997806          . |
  3. |     146   42851.82   4211379   1.017525          . |
  4. |     135    46019.2   4211379   1.092735          . |
  5. |     118   48591.65   4211379   1.153818          . |
     |----------------------------------------------------|
  6. |     132   50774.41   4211379   1.205648          . |
  7. |     119   56504.61   4211379   1.341713          . |
  8. |     138    63879.3   4211379   1.516826          . |
  9. |     112   65231.24   4211379   1.548928          . |
 10. |     144   67521.51   4211379   1.603311          . |
     |----------------------------------------------------|
 11. |     139   73495.88   4211379   1.745174          . |
 12. |     115    74736.8   4211379    1.77464          . |
 13. |     136   77159.07   4211379   1.832157          . |
 14. |     110   83982.38   4211379   1.994178          . |
 15. |     122   88817.03   4211379   2.108978          . |
     |----------------------------------------------------|
 16. |     121   92049.94   4211379   2.185744          . |
 17. |     116   95493.22   4211379   2.267505          . |
 18. |     123   98410.09   4211379   2.336767          . |
 19. |     127   101368.6   4211379   2.407016          . |
 20. |     105   106746.5   4211379   2.534717          . |
     |----------------------------------------------------|
 21. |     140   111581.6   4211379   2.649527          . |
 22. |     107   116030.7   4211379   2.755172          . |
 23. |     125     130727   4211379   3.104138          . |
 24. |     157   173844.4   4211379    4.12797          . |
 25. |     147   185882.9   4211379   4.413826          . |
     |----------------------------------------------------|
 26. |     117     187859   4211379   4.460749          . |
 27. |     108   298100.1   4211379   7.078444          . |
 28. |     113   364568.8   4211379   8.656758          . |
 29. |     101   381710.4   4211379   9.063788          . |
 30. |     141   400428.9   4211379   9.508262          . |
     +----------------------------------------------------+

. gen product_tpi=1;

. keep product product_tpi;

. list;

     +--------------------+
     | product   produc~i |
     |--------------------|
  1. |     137          1 |
  2. |     150          1 |
  3. |     146          1 |
  4. |     135          1 |
  5. |     118          1 |
     |--------------------|
  6. |     132          1 |
  7. |     119          1 |
  8. |     138          1 |
  9. |     112          1 |
 10. |     144          1 |
     |--------------------|
 11. |     139          1 |
 12. |     115          1 |
 13. |     136          1 |
 14. |     110          1 |
 15. |     122          1 |
     |--------------------|
 16. |     121          1 |
 17. |     116          1 |
 18. |     123          1 |
 19. |     127          1 |
 20. |     105          1 |
     |--------------------|
 21. |     140          1 |
 22. |     107          1 |
 23. |     125          1 |
 24. |     157          1 |
 25. |     147          1 |
     |--------------------|
 26. |     117          1 |
 27. |     108          1 |
 28. |     113          1 |
 29. |     101          1 |
 30. |     141          1 |
     +--------------------+

. sort product;

. tempfile product_tpi;

. save `product_tpi', replace;
(note: file /tmp/St02337.000005 not found)
file /tmp/St02337.000005 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |        30       126.7    15.08402        101        157
 product_tpi |        30           1           0          1          1

. clear;

. **************************************************************************
> * Find the n_tpi most important food products among the lowest $bottom %
> * (end)
> **************************************************************************;
. **************************************************************************;
. * First, need to calculate the average prices for the food items, by 
> * strata and quarter. For this, we are using the "unit values"
> * (value/quantity) for the observations in the consumption questionnaires,
> * including daily, own and receipts-in-kind.
> *
> * The unit values are constructed as sum(value)/sum(quantity), which effectively
> * weights them by the quantity and value of the transaction. Sampling
> * weights are also used.
> *
> * Get the own consumption file, and limit analysis to the observations
> * in KGs where both value and quantity are available.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. *use "$path/work/cons_cod.dta";
. keep if prod_cat==1;
(2712 observations deleted)

. drop if quantityd==0 | quantityd==.;
(1062 observations deleted)

. *keep if quantityd!=. & cod_hh_nom2!=.;
. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     33342    1.37e+11    4.18e+12   1.01e+09   2.12e+14
     product |     33320    133.3781    16.98235        101        171
    food_cat |     33342           1           0          1          1
    prod_cat |     33342           1           0          1          1
    descript |     33342           1           0          1          1
-------------+--------------------------------------------------------
       untcd |     33320    55.74619     39.1895          1        133
      h15bq2 |         0
     h15bq2b |         0
     h15bq2c |     32923    5.831789    3.135899          1         12
     h15bq2d |         0
-------------+--------------------------------------------------------
     h15bq3a |     33342           1           0          1          1
     h15bq3b |     33337     4.09425    2.381471          1          7
     h15bq3c |        22    48522.68    66379.85          1     166089
     h15bq14 |     32913    4.368152    54.27286          0       7000
     h15bq15 |     32911    3057.808    6173.454          0     600000
-------------+--------------------------------------------------------
   quantityd |     33342    .5568673    1.366798   .0071429   71.42857
      valuez |     33342    438.0954     880.029   1.428571   85714.29
    quantity |     18219    .7986303     2.63978   .0004286         60
  cod_hh_nom |     33342    438.0954     880.029   1.428571   85714.29

. sort product;

. merge product using `product_tpi';
variable product does not uniquely identify observations in the master data

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      7,781       23.34       23.34
          2 |          1        0.00       23.34
          3 |     25,561       76.66      100.00
------------+-----------------------------------
      Total |     33,343      100.00

. drop _merge;

. keep if $product_tpi;
(7781 observations deleted)

. *        replace valued_ac=0 if valued_ac==.;
. *        replace quantityd_ac=0 if quantityd_ac==.;
.         gen valued_tot=cod_hh_nom;
(1 missing value generated)

.         gen quantityd_tot=quantityd;
(1 missing value generated)

. *               replace quantityd_tot=0 if (valued_tot>0 & valued_tot<.) & quantityd_tot==.;
.         keep if quantityd_tot!=. & valued_tot!=.;
(1 observation deleted)

.                 collapse (sum) valued_tot quantityd_tot, by(hhid product);

.                 sort hhid;

. tempfile acredd;

. save `acredd' , replace;
(note: file /tmp/St02337.000006 not found)
file /tmp/St02337.000006 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     25561    1.46e+11    4.39e+12   1.01e+09   2.12e+14
     product |     25561    130.0653    14.31836        101        150
  valued_tot |     25561     487.644    964.7436   2.857143   85714.29
quantityd_~t |     25561    .5451678    1.096971   .0071429         60

. /*
> **************************************************************************;
> * Create a data set with an empty 1 observation. Used to avoid empty data
> * sets when the survey do not have the Mozambican set up
> **************************************************************************;
> use "$path/work/own.dta";
> 
> preserve;
> keep in 1;
> drop unit valued quantityd;
> gen unit=2;
> gen valued=0;
> gen quantityd=0;
> tempfile 1obs;
> save `1obs';
> restore;
> 
> **************************************************************************;
> * Own consumption
> **************************************************************************;
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_ac;
>         rename quantityd quantityd_ac;
>         compress;
>         sort hhid product;
>         tempfile ac;
> save `ac', replace;
> 
> **************************************************************************;
> * Now do a similar thing with receipts-in-kind file.
> **************************************************************************;
> use "$path/work/receipts.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> 
> 
> keep if $product_tpi;
> append using `1obs';
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
>         rename valued valued_re;
>         rename quantityd quantityd_re;
>         compress;
>         sort hhid product;
>         tempfile re;
> save `re', replace;
> 
> **************************************************************************;
> * And also with the daily expenditure file.
> **************************************************************************;
> use "$path/work/daily.dta";
> 
> sum;
> sort product;
> merge product using `product_tpi';
> tab _merge;
> drop _merge;
> 
> keep if $product_tpi;
> 
> 
> 
> * Comment out below if IAF 2002/03 ( START ) ;
> 
> *rename quantityd quantity;
> do "$path/new/110a_conversions.do";
> *rename quantity quantityd;
> 
> * Comment out below if IAF 2002/03 ( END ) ;
> 
> 
> 
>         collapse (sum) value quantity days , 
>                 by(hhid product unit);
> 
>         gen valued=value/7 if days<=7;
>         replace valued=value/days if days>7 & days<.;
>         gen quantityd=quantity/7 if days<=7;
>         replace quantityd=quantity/days if days>7 & days<.;
> 
>         keep if unit==2 & quantityd!=. & valued!=.;
>         collapse (sum) valued quantityd , by(hhid product);
> 
>         rename valued valued_dd;
>         rename quantityd quantityd_dd;
>         compress;
>         sort hhid product;
>         tempfile dd;
> save `dd', replace;
> 
> 
> 
> 
> **************************************************************************;
> * Merge the three components (own, daily, receipts) together at the HH/product level, 
> * then aggregate to the regional level, using the sample weights (hhweight).
> * We DON'T want to weight by "hhsize" because the quantity and value are
> * already for the household (i.e., other things equal, larger households
> * are buying larger quantities, and therefore already getting more weight).
> * Then calculate sum(val)/sum(quantity) to get the quantity weighted mean
> * unit value in each strata in each quarter.
> **************************************************************************;
> use `ac';
>         sort hhid product;
>         merge hhid product using `re';
>         tab _m;
>         drop _m;
>         
>         sort hhid product;
>         merge hhid product using `dd';
>         tab _m;
>         drop _m;
>         
>         replace valued_ac=0 if valued_ac==.;
>         replace valued_re=0 if valued_re==.;
>         replace valued_dd=0 if valued_dd==.;
>         replace quantityd_ac=0 if quantityd_ac==.;
>         replace quantityd_re=0 if quantityd_re==.;
>         replace quantityd_dd=0 if quantityd_dd==.;
> 
>         gen valued_tot=valued_ac+valued_re+valued_dd;
>         gen quantityd_tot=quantityd_ac+quantityd_re+quantityd_dd;
> 
>         sort hhid;
> 
>         tempfile acredd;
> save `acredd' , replace;
> */
> 
> 
> 
> use "$path/work/hhdata.dta";
(Household master record (1 record per household))

.         keep strata hhid hhweight hhsize rural survmon survquar news spdomain reg_tpi;

.         sort hhid;

.         tempfile hhd;

. save `hhd' , replace;
(note: file /tmp/St02337.000007 not found)
file /tmp/St02337.000007 saved

. use `acredd', clear;

.         merge hhid using `hhd';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        158        0.61        0.61
          3 |     25,561       99.39      100.00
------------+-----------------------------------
      Total |     25,719      100.00

.         drop _merge;

.                 tab survquar , miss;

    Sequential |
Survey Quarter |
 (Oct-Dec 10 = |
            1) |      Freq.     Percent        Cum.
---------------+-----------------------------------
    Oct-Dec 10 |      6,767       26.31       26.31
   Jan-Marc 11 |      6,361       24.73       51.04
   Apr-June 11 |      6,638       25.81       76.85
July-Sept 2011 |      5,905       22.96       99.81
             . |         48        0.19      100.00
---------------+-----------------------------------
         Total |     25,719      100.00

.                 tab survmon survquar, miss;

Sequential |
    Survey |
Month (Oct |       Sequential Survey Quarter (Oct-Dec 10 = 1)
 2010 = 1) | Oct-Dec 1  Jan-Marc   Apr-June   July-Sept          . |     Total
-----------+-------------------------------------------------------+----------
    Oct 10 |     2,114          0          0          0          0 |     2,114 
    Nov 10 |     1,849          0          0          0          0 |     1,849 
    Dec 10 |     2,804          0          0          0          0 |     2,804 
    Jan 11 |         0      2,241          0          0          0 |     2,241 
    Feb 11 |         0      2,040          0          0          0 |     2,040 
    Mac 11 |         0      2,080          0          0          0 |     2,080 
    Apr 11 |         0          0      2,461          0          0 |     2,461 
    May 11 |         0          0      2,524          0          0 |     2,524 
    Jun 11 |         0          0      1,653          0          0 |     1,653 
    Jul 11 |         0          0          0      2,026          0 |     2,026 
    Aug 11 |         0          0          0      2,087          0 |     2,087 
    Sep 11 |         0          0          0      1,792          0 |     1,792 
         . |         0          0          0          0         48 |        48 
-----------+-------------------------------------------------------+----------
     Total |     6,767      6,361      6,638      5,905         48 |    25,719 


.         compress;
product was float now int
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
hhsize was long now byte

.         sort hhid;

. save `acredd', replace;
file /tmp/St02337.000006 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     25719    1.46e+11    4.38e+12   1.01e+09   2.12e+14
     product |     25561    130.0653    14.31836        101        150
  valued_tot |     25561     487.644    964.7436   2.857143   85714.29
quantityd_~t |     25561    .5451678    1.096971   .0071429         60
      strata |     25719    3.718418    1.492715          1          6
-------------+--------------------------------------------------------
    hhweight |     25718    2115.725     1647.65   308.1181   8736.727
    survquar |     25671    2.455027    1.111435          1          4
     survmon |     25671    6.345098    3.373594          1         12
       rural |     25719    .7517011    .4320345          0          1
     reg_tpi |     25719    2.202457    1.192897          0          4
-------------+--------------------------------------------------------
    spdomain |     25711    3.150636    1.264136          1          5
        news |     25711    2.277819    1.077952          1          4
      hhsize |     25717    7.455885    3.568308          1         29

. **************************************************************************;
. * Need to merge with the file that has nominal consumption per household,
> * and compute nominal consumption per capita from that, so that we can
> * choose the relatively poor (i.e., below median nominal consumption per
> * capita).
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta" ;
. *save "$path/work/cons_cat.dta", replace ;
. *use "$path/work/cons_cat.dta" ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.  drop _m;

.         collapse (mean) cons_hh_nom hhsize hhweight , by(hhid);

.         gen cpc=cons_hh_nom/hhsize;
(6 missing values generated)

.         sum cpc [aw=hhsize*hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     302.6044              0
10%     495.2753              0       Obs                2711
25%     805.0471              0       Sum of Wgt.  37293839.4

50%     1314.064                      Mean           2014.534
                        Largest       Std. Dev.      5411.797
75%     2181.898       76733.53
90%     3655.888       78344.66       Variance       2.93e+07
95%     4998.947       79483.23       Skewness       33.33378
99%     10528.57       252488.6       Kurtosis       1447.404

.         global medcpc=r(p$tpi_bottom);

.         gen bottom_tpi=cpc<=$medcpc;

.         keep hhid bottom_tpi;

.         sort hhid;

.         tempfile bottom_tpi;

. save `bottom_tpi', replace;
(note: file /tmp/St02337.000008 not found)
file /tmp/St02337.000008 saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |      2716    1.32e+11    4.07e+12   1.01e+09   2.12e+14
  bottom_tpi |      2717    .4747884    .4994559          0          1

. use `acredd' ;

.         merge hhid using `bottom_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.00        0.00
          3 |     25,719      100.00      100.00
------------+-----------------------------------
      Total |     25,720      100.00

.         drop _merge;

.         keep if bottom_tpi;
(15339 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     10381    3.63e+10    1.99e+11   1.02e+09   2.32e+12
     product |     10293    130.6602    14.35474        101        150
  valued_tot |     10293    362.3232    521.7516   2.857143   7714.286
quantityd_~t |     10293    .5546537     1.03094   .0142857   34.28571
      strata |     10381    4.202389    1.213039          1          6
-------------+--------------------------------------------------------
    hhweight |     10381    2041.623    1531.055   381.7499   8736.727
    survquar |     10338    2.354227    1.083833          1          4
     survmon |     10338    6.063358    3.315961          1         12
       rural |     10381    .8891244    .3139932          0          1
     reg_tpi |     10381    2.464502    .9803547          0          4
-------------+--------------------------------------------------------
    spdomain |     10374    3.449586    1.011223          1          5
        news |     10374      2.4786    .9531971          1          4
      hhsize |     10381    7.759272    3.096978          1         29
  bottom_tpi |     10381           1           0          1          1

. * Drop one HH with extremely high quantity and low value in IAF 2002/03 (t=t1) ;
. *        drop if hhid==263001;
.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survmon);

.                         drop if product==.;
(23 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         lab var ppkg "Unit value per kg";

.                         sort reg_tpi product ;

.                         compress;

.                         tempfile uvm;

.                 save `uvm', replace;
(note: file /tmp/St02337.00000a not found)
file /tmp/St02337.00000a saved

.                 save "$path/work/tpi_unit_val_monthly.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_unit_val_monthly.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_unit_val_monthly.dta saved

.         restore;

.         preserve;

.                 collapse (sum) valued_tot quantityd_tot [aw=hhweight] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(16 observations deleted)

.                         gen ppkg=valued_tot/quantityd_tot;

.                         sort reg_tpi product survquar;

.                         list in  1/3;

     +----------------------------------------------------------------------------+
     | product      survquar   reg_tpi      news   valued~t   quanti~t       ppkg |
     |----------------------------------------------------------------------------|
  1. |     107    Oct-Dec 10   Kampala   Central   857.1429   .2857143       3000 |
  2. |     107   Jan-Marc 11   Kampala   Central   379.0834   .6591906    575.074 |
  3. |     108   Apr-June 11   Kampala   Central   28.57143   .0357143   799.9999 |
     +----------------------------------------------------------------------------+

.                         list in -3/-1;

     +-------------------------------------------------------------------------------+
     | product         survquar   reg_tpi      news   valued~t   quanti~t       ppkg |
     |-------------------------------------------------------------------------------|
491. |     150      Jan-Marc 11   Western   Western   3601.478   11.12012   323.8705 |
492. |     150      Apr-June 11   Western   Western   2198.346   7.189951   305.7527 |
493. |     150   July-Sept 2011   Western   Western   1696.156   7.857604   215.8618 |
     +-------------------------------------------------------------------------------+

.                         tempfile uvq;

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_unit_val_quarterly.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_unit_val_quarterly.dta saved

.                 save `uvq', replace;
(note: file /tmp/St02337.00000c not found)
file /tmp/St02337.00000c saved

.         restore;

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each reg_tpi & product combination. This should eliminate outliers that
> * may have an undue influence on the price calculation. Then use sample
> * weighting PLUS quantity weighting on those HH-level observations.
> **************************************************************************;
.         preserve;

.                 gen hhppkg=valued_tot/quantityd_tot;
(88 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(reg_tpi product);
(88 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(reg_tpi product);
(88 missing values generated)

.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
(599 observations deleted)

.                                 gen hhqtywt=hhweight*quantityd_tot;
(88 missing values generated)

.                                 collapse (sum) valued_tot quantityd_tot [aw=hhqtywt] , 
>                                 by(reg_tpi news product survquar);

.                         drop if product==.;
(0 observations deleted)

.                         gen ppkg_trim=valued_tot/quantityd_tot;

.                         lab var ppkg_trim "90% trimmed unit value per kg";

.                         sort reg_tpi product survquar;

.                         list , nol;

     +----------------------------------------------------------------------+
     | product   survquar   reg_tpi   news   valued~t   quanti~t   ppkg_t~m |
     |----------------------------------------------------------------------|
  1. |     107          1         0      1   857.1429   .2857143       3000 |
  2. |     107          2         0      1   407.1217    .771344   527.8082 |
  3. |     108          3         0      1   28.57143   .0357143   799.9999 |
  4. |     110          1         0      1   3598.358   1.799179       2000 |
  5. |     110          2         0      1   2300.655   1.150327       2000 |
     |----------------------------------------------------------------------|
  6. |     110          3         0      1   1973.699   .8830373   2235.126 |
  7. |     113          1         0      1   3350.772   3.451814    970.728 |
  8. |     113          2         0      1   1648.749   1.101152   1497.295 |
  9. |     113          3         0      1   3861.863   2.235071   1727.848 |
 10. |     115          3         0      1   186.3665   .2516307   740.6353 |
     |----------------------------------------------------------------------|
 11. |     117          1         0      1   3775.796   .7911923   4772.286 |
 12. |     117          2         0      1   428.5714   .0714286       6000 |
 13. |     117          3         0      1   1428.571   .2857143       5000 |
 14. |     119          1         0      1   857.1429   .2142857       4000 |
 15. |     122          1         0      1   571.4286   .2857143       2000 |
     |----------------------------------------------------------------------|
 16. |     122          2         0      1   142.8571   .1428571       1000 |
 17. |     123          1         0      1   142.8571   .2857143        500 |
 18. |     123          2         0      1   285.7143   .1428571       2000 |
 19. |     123          3         0      1   1450.349   2.400864   604.0945 |
 20. |     125          1         0      1   386.8408   .5906939   654.8922 |
     |----------------------------------------------------------------------|
 21. |     125          3         0      1       1200          1       1200 |
 22. |     127          1         0      1   1573.615   14.92771   105.4157 |
 23. |     127          2         0      1   676.7366   4.917112   137.6289 |
 24. |     127          3         0      1   604.1272   2.746361   219.9737 |
 25. |     132          1         0      1   214.2857   .4285714        500 |
     |----------------------------------------------------------------------|
 26. |     135          1         0      1   650.1832   5.689021   114.2874 |
 27. |     135          2         0      1   375.5209   1.019376   368.3831 |
 28. |     135          3         0      1   491.4345    2.66431   184.4509 |
 29. |     136          1         0      1   1173.866   5.643443   208.0053 |
 30. |     136          2         0      1   557.3323   2.640672    211.057 |
     |----------------------------------------------------------------------|
 31. |     136          3         0      1   629.3058   2.616377   240.5257 |
 32. |     137          1         0      1   114.2857   .1428571   799.9999 |
 33. |     137          2         0      1   191.6272   .6551563   292.4909 |
 34. |     137          3         0      1   570.6872   2.241921   254.5527 |
 35. |     138          3         0      1   42.85714   .1428571        300 |
     |----------------------------------------------------------------------|
 36. |     139          1         0      1   85.71429   .2857143        300 |
 37. |     140          1         0      1   742.8571   .5714286       1300 |
 38. |     141          1         0      1   2876.524   1.868016   1539.882 |
 39. |     141          2         0      1   1016.138   .6491459   1565.346 |
 40. |     141          3         0      1   1355.766   .8571429   1581.727 |
     |----------------------------------------------------------------------|
 41. |     144          1         0      1   285.7143   .0714286       4000 |
 42. |     144          2         0      1   283.7055   .4532841    625.889 |
 43. |     144          3         0      1   142.8571   .2169185   658.5751 |
 44. |     147          1         0      1   3196.448   1.314269   2432.111 |
 45. |     147          2         0      1   1674.621   .6977589       2400 |
     |----------------------------------------------------------------------|
 46. |     147          3         0      1   1526.507   .6194932   2464.122 |
 47. |     150          1         0      1   215.9625   .8235683   262.2278 |
 48. |     150          2         0      1   211.7416   .8719191   242.8455 |
 49. |     150          3         0      1   161.8092   .3869489   418.1669 |
 50. |     101          1         1      1   61183.82   15.68489   3900.812 |
     |----------------------------------------------------------------------|
 51. |     101          2         1      1   44178.81   14.94222   2956.642 |
 52. |     101          3         1      1   46389.69   12.38842   3744.601 |
 53. |     101          4         1      1   37843.35   8.337832   4538.751 |
 54. |     105          1         1      1   8765.177   3.206006   2733.987 |
 55. |     105          2         1      1    7326.93    1.86774   3922.886 |
     |----------------------------------------------------------------------|
 56. |     105          3         1      1   3697.255   6.087051   607.3967 |
 57. |     105          4         1      1   5553.843   1.704152   3259.007 |
 58. |     107          1         1      1    25054.9   25.93194   966.1793 |
 59. |     107          2         1      1   11969.75    6.80383   1759.267 |
 60. |     107          3         1      1   12732.38   8.542399   1490.492 |
     |----------------------------------------------------------------------|
 61. |     107          4         1      1   11002.21   6.061995   1814.948 |
 62. |     108          1         1      1   7081.627   10.60605   667.6966 |
 63. |     108          2         1      1   22037.78   25.83074   853.1611 |
 64. |     108          3         1      1   14938.54   18.96226   787.8038 |
 65. |     108          4         1      1   2117.246   2.015287   1050.593 |
     |----------------------------------------------------------------------|
 66. |     110          1         1      1   8488.324    4.95036   1714.688 |
 67. |     110          2         1      1   7364.795   3.653591   2015.769 |
 68. |     110          3         1      1   6882.737   2.893463    2378.72 |
 69. |     110          4         1      1   943.1462   .5491004   1717.621 |
 70. |     112          1         1      1   2727.982   13.01372   209.6236 |
     |----------------------------------------------------------------------|
 71. |     112          2         1      1   1241.393   8.112843   153.0157 |
 72. |     112          4         1      1   2830.457   28.30457        100 |
 73. |     113          1         1      1   52712.43   57.89247   910.5231 |
 74. |     113          2         1      1   38254.06   32.89579   1162.886 |
 75. |     113          3         1      1   39303.21   24.27087   1619.357 |
     |----------------------------------------------------------------------|
 76. |     113          4         1      1   16958.01   9.447243   1795.022 |
 77. |     115          1         1      1   3527.053   3.331188   1058.797 |
 78. |     115          2         1      1   85.71429   .0714286       1200 |
 79. |     115          3         1      1   1041.901   1.383767   752.9458 |
 80. |     117          1         1      1   15878.68   3.859207   4114.494 |
     |----------------------------------------------------------------------|
 81. |     117          2         1      1   2623.791   .5052698    5192.85 |
 82. |     117          3         1      1   10160.03   2.007406   5061.275 |
 83. |     117          4         1      1   1798.912   .3903554   4608.397 |
 84. |     118          1         1      1   7325.717   1.428992   5126.494 |
 85. |     118          2         1      1   5879.707   1.357394   4331.613 |
     |----------------------------------------------------------------------|
 86. |     118          3         1      1   7706.461   2.110944   3650.719 |
 87. |     118          4         1      1   867.8613   .1875015   4628.557 |
 88. |     119          1         1      1   857.1429   .1428571       6000 |
 89. |     119          2         1      1    1123.65   .2013378    5580.92 |
 90. |     119          3         1      1   1769.958   .2857143   6194.852 |
     |----------------------------------------------------------------------|
 91. |     119          4         1      1       1000   .1428571       7000 |
 92. |     121          1         1      1   4780.983    .973973   4908.743 |
 93. |     121          2         1      1   4675.481   .4285714   10909.46 |
 94. |     121          3         1      1   2142.857   .1428571      15000 |
 95. |     122          1         1      1   5109.192   5.312877    961.662 |
     |----------------------------------------------------------------------|
 96. |     122          2         1      1   1803.927   .9635748   1872.119 |
 97. |     122          3         1      1   6031.641   8.175878   737.7363 |
 98. |     122          4         1      1   1086.937   1.400611   776.0446 |
 99. |     123          1         1      1   2766.405    2.15432    1284.12 |
100. |     123          2         1      1   3631.161   5.930922   612.2423 |
     |----------------------------------------------------------------------|
101. |     123          3         1      1   759.0632   .6609835   1148.385 |
102. |     123          4         1      1   1080.359   2.115664   510.6476 |
103. |     125          1         1      1   9412.915   20.53923   458.2895 |
104. |     125          2         1      1   18794.56   31.47745     597.08 |
105. |     125          3         1      1    10598.2   27.91056   379.7199 |
     |----------------------------------------------------------------------|
106. |     125          4         1      1   4663.476   14.07764   331.2683 |
107. |     127          1         1      1   6314.351   53.80526   117.3556 |
108. |     127          2         1      1   4581.972   30.29646   151.2379 |
109. |     127          3         1      1   2398.542   20.41783   117.4729 |
110. |     127          4         1      1   1970.758   12.95661   152.1045 |
     |----------------------------------------------------------------------|
111. |     132          1         1      1   1779.429   17.96892   99.02814 |
112. |     132          2         1      1   2346.598   19.49998   120.3385 |
113. |     132          3         1      1   780.2601   3.655854   213.4276 |
114. |     132          4         1      1   7645.567   67.74515   112.8578 |
115. |     135          1         1      1   4523.952   31.65684    142.906 |
     |----------------------------------------------------------------------|
116. |     135          2         1      1   2762.963   18.51264   149.2474 |
117. |     135          3         1      1   3232.623   16.11324   200.6191 |
118. |     135          4         1      1   855.4415   2.400346   356.3827 |
119. |     136          1         1      1   6408.022   48.35724   132.5142 |
120. |     136          2         1      1   4002.341   28.64699   139.7125 |
     |----------------------------------------------------------------------|
121. |     136          3         1      1   4517.565    25.3608   178.1318 |
122. |     136          4         1      1   1497.614    11.7162   127.8242 |
123. |     137          1         1      1   8490.857   28.71381   295.7064 |
124. |     137          2         1      1   1851.326   5.002508   370.0796 |
125. |     137          3         1      1   1512.589    3.21747   470.1176 |
     |----------------------------------------------------------------------|
126. |     137          4         1      1   451.8953   1.387866   325.6043 |
127. |     138          1         1      1   2660.607   12.43835   213.9034 |
128. |     138          2         1      1   2584.739   13.07059   197.7524 |
129. |     138          3         1      1   4982.806   25.24613   197.3691 |
130. |     138          4         1      1   1136.881    6.11848    185.811 |
     |----------------------------------------------------------------------|
131. |     139          1         1      1    792.576   7.067476   112.1441 |
132. |     139          2         1      1   600.7182   5.496535   109.2903 |
133. |     139          3         1      1   5844.902   13.74309   425.2976 |
134. |     139          4         1      1   297.4069   2.720005   109.3406 |
135. |     140          1         1      1   36797.51   67.18647   547.6923 |
     |----------------------------------------------------------------------|
136. |     140          2         1      1   2889.947   2.103635   1373.787 |
137. |     140          3         1      1   7947.802   6.674436   1190.782 |
138. |     140          4         1      1   4787.107   2.407599   1988.333 |
139. |     141          1         1      1   13845.06   11.50694   1203.191 |
140. |     141          2         1      1   42430.03   35.60706   1191.618 |
     |----------------------------------------------------------------------|
141. |     141          3         1      1   16462.98   9.992702     1647.5 |
142. |     141          4         1      1   12690.56   10.82958   1171.843 |
143. |     144          1         1      1   8244.967   5.767156   1429.642 |
144. |     144          2         1      1   10934.98   10.44801   1046.609 |
145. |     144          3         1      1   16197.77   5.985424   2706.203 |
     |----------------------------------------------------------------------|
146. |     144          4         1      1   1663.013    .835554   1990.312 |
147. |     146          1         1      1   142.8571   .0714286       2000 |
148. |     146          2         1      1   142.8571   .0714286       2000 |
149. |     147          1         1      1   18731.19   7.576658   2472.224 |
150. |     147          2         1      1   26039.56   9.054358   2875.915 |
     |----------------------------------------------------------------------|
151. |     147          3         1      1   15383.45   5.791993   2655.985 |
152. |     147          4         1      1   2705.121   .7154486   3781.013 |
153. |     150          1         1      1   2225.382    6.31754   352.2545 |
154. |     150          2         1      1   6447.842   16.23745   397.0969 |
155. |     150          3         1      1   2098.576   4.794247    437.728 |
     |----------------------------------------------------------------------|
156. |     150          4         1      1    782.758   1.971697   396.9972 |
157. |     101          1         2      2   35610.85   11.02221   3230.828 |
158. |     101          2         2      2   25894.76   11.63327   2225.923 |
159. |     101          3         2      2   60130.53   15.28813   3933.153 |
160. |     101          4         2      2   13913.07   5.820185   2390.486 |
     |----------------------------------------------------------------------|
161. |     105          1         2      2   20710.57   10.63029    1948.26 |
162. |     105          2         2      2   4044.057    1.61369   2506.094 |
163. |     105          3         2      2   4043.407   1.246663   3243.384 |
164. |     105          4         2      2   8100.008   1.521023   5325.369 |
165. |     107          1         2      2    7220.73   7.765607   929.8347 |
     |----------------------------------------------------------------------|
166. |     107          2         2      2   5996.103    8.34439   718.5789 |
167. |     107          3         2      2   22036.15    31.3138   703.7202 |
168. |     107          4         2      2   3679.192   3.328225   1105.452 |
169. |     108          1         2      2   45082.41   84.86259   531.2401 |
170. |     108          2         2      2   53862.38   105.2229   511.8882 |
     |----------------------------------------------------------------------|
171. |     108          3         2      2   77199.74   117.9987   654.2421 |
172. |     108          4         2      2   36680.78   37.43356   979.8902 |
173. |     110          1         2      2     9021.7   6.932191   1301.421 |
174. |     110          2         2      2   6204.229   3.165736   1959.806 |
175. |     110          3         2      2    14353.6    6.63855   2162.159 |
     |----------------------------------------------------------------------|
176. |     110          4         2      2   29594.49   14.69297   2014.194 |
177. |     112          1         2      2   8026.776   78.83954   101.8115 |
178. |     112          2         2      2   1388.169   4.677974   296.7457 |
179. |     112          3         2      2   19667.43   194.3671    101.187 |
180. |     112          4         2      2   28023.84   191.1113   146.6362 |
     |----------------------------------------------------------------------|
181. |     113          1         2      2    33886.5    55.5631   609.8741 |
182. |     113          2         2      2   59871.63   60.82225   984.3705 |
183. |     113          3         2      2   38698.06   29.51314   1311.215 |
184. |     113          4         2      2   138764.5   148.7131   933.1019 |
185. |     115          1         2      2   3215.237   4.095737   785.0204 |
     |----------------------------------------------------------------------|
186. |     115          2         2      2   15270.31   17.89433   853.3605 |
187. |     115          3         2      2   7569.979    11.4053   663.7247 |
188. |     115          4         2      2    7485.15   11.64548   642.7517 |
189. |     116          1         2      2   23924.02   34.54507    692.545 |
190. |     116          2         2      2   22779.73   98.59449   231.0446 |
     |----------------------------------------------------------------------|
191. |     116          3         2      2    8345.99   13.57754    614.691 |
192. |     116          4         2      2   3683.191   5.768276   638.5254 |
193. |     117          1         2      2   25894.55   6.051853    4278.78 |
194. |     117          2         2      2   14436.74   3.054201   4726.846 |
195. |     117          3         2      2   23142.15   4.417496   5238.747 |
     |----------------------------------------------------------------------|
196. |     117          4         2      2   14881.78   2.767347   5377.633 |
197. |     118          1         2      2   5369.401   1.633896   3286.257 |
198. |     118          2         2      2   2908.327   .7941739   3662.078 |
199. |     118          3         2      2   6657.192   1.692754   3932.757 |
200. |     118          4         2      2   714.2857   .1428571       5000 |
     |----------------------------------------------------------------------|
201. |     119          1         2      2   13975.41   3.416974   4089.998 |
202. |     119          2         2      2   8130.199    1.79769   4522.581 |
203. |     119          3         2      2   8225.682    1.51886   5415.694 |
204. |     119          4         2      2   5974.481   1.020931   5851.991 |
205. |     121          1         2      2   7858.358   1.142857   6876.063 |
     |----------------------------------------------------------------------|
206. |     121          2         2      2   9103.506    1.47835   6157.884 |
207. |     121          3         2      2   8064.646          1   8064.646 |
208. |     121          4         2      2   3571.428   .2857143      12500 |
209. |     122          1         2      2   5661.253   17.89177   316.4166 |
210. |     122          2         2      2   18666.49    32.4875   574.5745 |
     |----------------------------------------------------------------------|
211. |     122          3         2      2   13492.26   14.45222   933.5771 |
212. |     122          4         2      2   8331.856    8.77039   949.9984 |
213. |     123          1         2      2   7850.718   11.99976   654.2396 |
214. |     123          2         2      2   5422.113   7.889865    687.225 |
215. |     123          3         2      2   9204.772   9.527148   966.1624 |
     |----------------------------------------------------------------------|
216. |     123          4         2      2   4069.779   4.086731   995.8519 |
217. |     125          1         2      2   37197.22   122.1611   304.4931 |
218. |     125          2         2      2   25160.36   82.52043   304.8985 |
219. |     125          3         2      2   22313.88   49.20964   453.4453 |
220. |     125          4         2      2   18316.91   36.65964   499.6479 |
     |----------------------------------------------------------------------|
221. |     127          1         2      2   9430.823   91.54885   103.0141 |
222. |     127          2         2      2    9871.31   109.1083   90.47259 |
223. |     127          3         2      2   14697.89    96.4172   152.4405 |
224. |     127          4         2      2    8061.38   61.46597   131.1519 |
225. |     132          1         2      2   4676.561     86.731   53.92029 |
     |----------------------------------------------------------------------|
226. |     132          2         2      2   4019.257   33.17253   121.1622 |
227. |     132          3         2      2   24704.61    277.963   88.87734 |
228. |     132          4         2      2   883.7887   1.767577        500 |
229. |     135          1         2      2   3140.275   36.81636   85.29565 |
230. |     135          2         2      2   4033.833   38.18739   105.6326 |
     |----------------------------------------------------------------------|
231. |     135          3         2      2   3149.645    24.8141   126.9297 |
232. |     135          4         2      2   2690.282   19.59386   137.3023 |
233. |     136          1         2      2   10540.92   65.83214   160.1181 |
234. |     136          2         2      2       9937   52.69078   188.5909 |
235. |     136          3         2      2   7242.051    39.2385   184.5649 |
     |----------------------------------------------------------------------|
236. |     136          4         2      2   7407.505   38.70135   191.4017 |
237. |     137          1         2      2   3696.387   9.052724   408.3177 |
238. |     137          2         2      2   8043.224   24.30675    330.905 |
239. |     137          3         2      2   3204.917   6.834064   468.9621 |
240. |     137          4         2      2   6665.167   18.74246   355.6186 |
     |----------------------------------------------------------------------|
241. |     138          1         2      2   8040.259   36.29096   221.5499 |
242. |     138          2         2      2   5622.262   21.05486   267.0292 |
243. |     138          3         2      2   19958.09   68.95907   289.4193 |
244. |     138          4         2      2    9297.17    41.0909   226.2586 |
245. |     139          1         2      2   8316.443   32.39323    256.734 |
     |----------------------------------------------------------------------|
246. |     139          2         2      2   11965.69   56.32352   212.4457 |
247. |     139          3         2      2    14711.5   29.25366   502.8944 |
248. |     139          4         2      2   5488.171   26.32952   208.4418 |
249. |     140          1         2      2   14616.19   22.54646     648.27 |
250. |     140          2         2      2   1862.453   2.394912   777.6708 |
     |----------------------------------------------------------------------|
251. |     140          3         2      2   13916.09   41.58488   334.6429 |
252. |     140          4         2      2   15711.85   48.26757   325.5156 |
253. |     141          1         2      2   15198.06    17.4745   869.7278 |
254. |     141          2         2      2   14062.97   18.13512   775.4549 |
255. |     141          3         2      2   12038.72   12.43926   967.8005 |
     |----------------------------------------------------------------------|
256. |     141          4         2      2   22539.83   23.56055   956.6768 |
257. |     144          1         2      2   4284.601   8.211622   521.7728 |
258. |     144          2         2      2   7133.506    22.6219   315.3362 |
259. |     144          3         2      2   1252.493   2.464385   508.2375 |
260. |     144          4         2      2   21972.79   26.18251   839.2164 |
     |----------------------------------------------------------------------|
261. |     146          1         2      2    288.604   .4285714   673.4094 |
262. |     146          2         2      2    211.044   .4723901   446.7578 |
263. |     146          3         2      2   642.8571   .4285714       1500 |
264. |     146          4         2      2   2253.895   1.664292   1354.267 |
265. |     147          1         2      2   35789.85   15.08015   2373.309 |
     |----------------------------------------------------------------------|
266. |     147          2         2      2   22736.27   15.69151   1448.954 |
267. |     147          3         2      2   22312.53   9.900102   2253.768 |
268. |     147          4         2      2    14843.9   6.674133   2224.094 |
269. |     150          1         2      2   2567.651   11.77341   218.0891 |
270. |     150          2         2      2   2655.197   11.46342   231.6235 |
     |----------------------------------------------------------------------|
271. |     150          3         2      2   2903.421   10.31683   281.4257 |
272. |     150          4         2      2   3089.061    10.2028   302.7662 |
273. |     101          1         3      3   4967.888   1.142857   4346.901 |
274. |     101          2         3      3   7437.076   1.562128   4760.862 |
275. |     101          3         3      3   6178.359    1.65877   3724.663 |
     |----------------------------------------------------------------------|
276. |     101          4         3      3   826.8876   .4661054   1774.036 |
277. |     105          2         3      3   4663.914   1.833247   2544.073 |
278. |     105          3         3      3   112.8174   .2857143   394.8608 |
279. |     105          4         3      3   259.5653   .5191305        500 |
280. |     107          1         3      3   6536.571   8.183124   798.7867 |
     |----------------------------------------------------------------------|
281. |     107          2         3      3   6469.697   11.56867   559.2427 |
282. |     107          3         3      3   47862.56   90.35747   529.7023 |
283. |     107          4         3      3   19521.81   37.12429     525.85 |
284. |     108          1         3      3   15160.09    7.01026   2162.557 |
285. |     108          2         3      3   33235.07   90.19969    368.461 |
     |----------------------------------------------------------------------|
286. |     108          3         3      3   35154.78   67.57202   520.2565 |
287. |     108          4         3      3   26881.13   25.03152   1073.891 |
288. |     110          1         3      3   4385.336   3.647362   1202.331 |
289. |     110          2         3      3   2789.987   2.288352   1219.213 |
290. |     110          3         3      3   5648.036   5.368416   1052.086 |
     |----------------------------------------------------------------------|
291. |     110          4         3      3   1142.857   1.142857       1000 |
292. |     112          1         3      3   9937.259   121.6747   81.67068 |
293. |     112          3         3      3   635.2629   1.994179   318.5585 |
294. |     112          4         3      3   16274.03   144.7483   112.4299 |
295. |     113          1         3      3   17074.18   36.73992   464.7309 |
     |----------------------------------------------------------------------|
296. |     113          2         3      3   35845.78   47.20774     759.32 |
297. |     113          3         3      3   14419.73   29.70137   485.4902 |
298. |     113          4         3      3   14950.95   46.15514   323.9283 |
299. |     115          1         3      3   1101.454   4.332984   254.2022 |
300. |     115          2         3      3   2459.487   10.56822    232.725 |
     |----------------------------------------------------------------------|
301. |     115          3         3      3   3338.151   10.40891   320.7015 |
302. |     115          4         3      3   26326.49   87.10557   302.2366 |
303. |     116          1         3      3   20837.36   31.30208    665.686 |
304. |     116          2         3      3   26816.47   81.97037   327.1484 |
305. |     116          3         3      3   31286.45   85.50703   365.8933 |
     |----------------------------------------------------------------------|
306. |     116          4         3      3   20032.46   72.24566   277.2826 |
307. |     117          1         3      3   18494.53   5.388734   3432.073 |
308. |     117          2         3      3      23006   4.919659    4676.34 |
309. |     117          3         3      3   24811.79   5.078369   4885.779 |
310. |     117          4         3      3   4578.561   .8571429   5341.654 |
     |----------------------------------------------------------------------|
311. |     118          1         3      3   2907.122   .6466722   4495.511 |
312. |     118          2         3      3   7787.872   1.859051   4189.165 |
313. |     118          3         3      3   6361.434   1.400197   4543.244 |
314. |     118          4         3      3   5282.972   1.395173   3786.605 |
315. |     119          1         3      3   5964.879   1.517105   3931.752 |
     |----------------------------------------------------------------------|
316. |     119          2         3      3   2023.566   .4285714   4721.653 |
317. |     119          3         3      3   6914.688   1.341015   5156.309 |
318. |     119          4         3      3   8495.891   1.637535   5188.218 |
319. |     121          1         3      3   18343.81   3.688892   4972.717 |
320. |     121          2         3      3   7230.792   1.142857   6326.943 |
     |----------------------------------------------------------------------|
321. |     121          3         3      3    12966.2   1.714286   7563.618 |
322. |     121          4         3      3   9987.496   1.142857   8739.059 |
323. |     122          1         3      3   6187.694   9.680598   639.1851 |
324. |     122          2         3      3   13773.38   10.16585   1354.867 |
325. |     122          3         3      3   4137.343   3.751785   1102.767 |
     |----------------------------------------------------------------------|
326. |     122          4         3      3   11018.22    5.47283   2013.258 |
327. |     123          1         3      3   8312.434   7.742247   1073.646 |
328. |     123          2         3      3   18527.47   18.06921   1025.361 |
329. |     123          3         3      3   21918.96   22.69214   965.9274 |
330. |     123          4         3      3   12891.19   11.45553   1125.325 |
     |----------------------------------------------------------------------|
331. |     125          1         3      3   4866.717   17.39224   279.8211 |
332. |     125          2         3      3   13304.69   44.24602    300.698 |
333. |     125          3         3      3   14786.08   53.63977   275.6551 |
334. |     125          4         3      3   4685.511   15.66692   299.0703 |
335. |     127          1         3      3   19314.17   144.4477   133.7105 |
     |----------------------------------------------------------------------|
336. |     127          2         3      3   9262.747    46.2803   200.1445 |
337. |     127          3         3      3   15453.55   45.64319   338.5729 |
338. |     127          4         3      3   12123.83   33.91972   357.4271 |
339. |     132          1         3      3    1556.66   9.710485   160.3072 |
340. |     132          2         3      3   1818.749   17.74215   102.5101 |
     |----------------------------------------------------------------------|
341. |     132          3         3      3   10678.61   249.9236   42.72749 |
342. |     132          4         3      3   171.4286   .5714286        300 |
343. |     135          1         3      3   4767.914   38.97139    122.344 |
344. |     135          2         3      3   3856.345   27.99683   137.7422 |
345. |     135          3         3      3   4502.882   28.70368   156.8747 |
     |----------------------------------------------------------------------|
346. |     135          4         3      3   4968.949   39.61509   125.4307 |
347. |     136          1         3      3   6281.047   29.30536    214.331 |
348. |     136          2         3      3   5481.669   32.99029     166.16 |
349. |     136          3         3      3   7757.902   27.92799   277.7823 |
350. |     136          4         3      3   6823.918   27.34502   249.5489 |
     |----------------------------------------------------------------------|
351. |     137          1         3      3   2713.126   5.215378   520.2167 |
352. |     137          2         3      3   2398.447   4.537549   528.5777 |
353. |     137          3         3      3   5863.697    9.59765   610.9513 |
354. |     137          4         3      3   8674.195   16.88633   513.6815 |
355. |     138          1         3      3   2373.378   16.35827   145.0874 |
     |----------------------------------------------------------------------|
356. |     138          2         3      3   3218.361   15.82931   203.3165 |
357. |     138          3         3      3   4963.437   43.69847   113.5838 |
358. |     138          4         3      3   7342.165   50.77223   144.6099 |
359. |     139          1         3      3   11360.67   56.38173   201.4956 |
360. |     139          2         3      3   15339.91   107.8578   142.2234 |
     |----------------------------------------------------------------------|
361. |     139          3         3      3   15485.57    83.4904   185.4773 |
362. |     139          4         3      3   8484.824   56.07034   151.3246 |
363. |     140          1         3      3   4966.273   20.20681   245.7723 |
364. |     140          2         3      3   142.8571   .2857143        500 |
365. |     140          3         3      3   1868.141   4.741264   394.0175 |
     |----------------------------------------------------------------------|
366. |     140          4         3      3   9912.569   19.08087   519.5031 |
367. |     141          1         3      3   50973.42   104.9896   485.5091 |
368. |     141          2         3      3   57004.01   81.01371   703.6341 |
369. |     141          3         3      3   64156.37   85.07708   754.0969 |
370. |     141          4         3      3   74697.11   131.1912   569.3758 |
     |----------------------------------------------------------------------|
371. |     144          1         3      3    366.955   1.473307   249.0689 |
372. |     144          2         3      3   510.1722   .7123278   716.2043 |
373. |     144          3         3      3   213.2845   .4285714   497.6637 |
374. |     144          4         3      3   71.42857   .1428571        500 |
375. |     146          1         3      3   11006.61   15.73418    699.535 |
     |----------------------------------------------------------------------|
376. |     146          2         3      3    10723.2   16.67012   643.2584 |
377. |     146          3         3      3   15230.91   19.43355   783.7434 |
378. |     146          4         3      3    10666.1   10.89046   979.3984 |
379. |     147          1         3      3   15850.81   20.85188   760.1624 |
380. |     147          2         3      3   26857.35   62.59761   429.0476 |
     |----------------------------------------------------------------------|
381. |     147          3         3      3   13636.03   12.31874   1106.934 |
382. |     147          4         3      3   3800.285   3.732512   1018.158 |
383. |     150          1         3      3   3049.827   9.099812   335.1527 |
384. |     150          2         3      3   3225.872   9.598372   336.0853 |
385. |     150          3         3      3   4084.397   11.26374   362.6147 |
     |----------------------------------------------------------------------|
386. |     150          4         3      3   4013.825   11.70919   342.7929 |
387. |     101          1         4      4   49713.25   16.66596    2982.92 |
388. |     101          2         4      4   57993.32   19.85145   2921.365 |
389. |     101          3         4      4   55534.15   12.93994   4291.686 |
390. |     101          4         4      4   28912.37   9.743103    2967.47 |
     |----------------------------------------------------------------------|
391. |     105          1         4      4   15423.99   8.899301   1733.169 |
392. |     105          2         4      4   29807.22   10.82014   2754.791 |
393. |     105          3         4      4   22268.69   7.106473   3133.579 |
394. |     105          4         4      4   17772.14   8.946219   1986.553 |
395. |     107          1         4      4   3582.676   3.582676       1000 |
     |----------------------------------------------------------------------|
396. |     107          2         4      4    3191.14   3.396227   939.6134 |
397. |     107          3         4      4   3247.528   3.247528   999.9999 |
398. |     107          4         4      4   3494.029   2.990711   1168.293 |
399. |     108          1         4      4   14341.79   97.10511   147.6934 |
400. |     108          2         4      4   17223.81   83.99698   205.0528 |
     |----------------------------------------------------------------------|
401. |     108          3         4      4   17383.52   75.18237    231.218 |
402. |     108          4         4      4   4693.262   25.64843   182.9844 |
403. |     110          1         4      4    1142.35   .6009132   1901.023 |
404. |     110          2         4      4   6135.005   4.808774   1275.794 |
405. |     110          4         4      4   285.7143   .2857143       1000 |
     |----------------------------------------------------------------------|
406. |     112          1         4      4    2998.53   9.107293    329.245 |
407. |     112          2         4      4    621.719   5.529422   112.4383 |
408. |     112          3         4      4   399.7506   2.947166    135.639 |
409. |     112          4         4      4   57.14286   .5714286   99.99999 |
410. |     113          1         4      4   15080.41   18.63489   809.2563 |
     |----------------------------------------------------------------------|
411. |     113          2         4      4   25332.89   24.98225   1014.035 |
412. |     113          3         4      4   29252.98   22.08986   1324.272 |
413. |     113          4         4      4   4400.616   3.106781   1416.455 |
414. |     115          1         4      4   1372.861   2.001275   685.9929 |
415. |     115          2         4      4   21323.35   36.89885   577.8865 |
     |----------------------------------------------------------------------|
416. |     115          3         4      4   10023.14   12.65059    792.306 |
417. |     115          4         4      4   8778.819   11.32324   775.2922 |
418. |     116          1         4      4   1903.096    2.56921   740.7319 |
419. |     116          2         4      4   14502.23   35.89775   403.9873 |
420. |     116          3         4      4   1363.626   3.115075   437.7505 |
     |----------------------------------------------------------------------|
421. |     116          4         4      4   1178.152   1.207613   975.6038 |
422. |     117          1         4      4   5510.875   1.216076   4531.685 |
423. |     117          2         4      4   10666.36    2.19079   4868.725 |
424. |     117          3         4      4   12206.75   2.018177   6048.405 |
425. |     117          4         4      4   8081.661   1.346944       6000 |
     |----------------------------------------------------------------------|
426. |     118          2         4      4   1291.808   .2857143   4521.327 |
427. |     118          3         4      4   1285.714   .2142857       6000 |
428. |     118          4         4      4   942.8133   .1428571   6599.692 |
429. |     119          1         4      4   3828.304   .8724113   4388.187 |
430. |     119          2         4      4   714.2857   .1428571       5000 |
     |----------------------------------------------------------------------|
431. |     119          3         4      4   857.1429   .1428571       6000 |
432. |     119          4         4      4   2931.146   .4444352   6595.216 |
433. |     121          3         4      4   714.2857   .1428571       5000 |
434. |     122          1         4      4   1650.287   1.520221   1085.558 |
435. |     122          2         4      4   2125.521    1.06276       2000 |
     |----------------------------------------------------------------------|
436. |     122          3         4      4   3225.621   1.511335   2134.286 |
437. |     122          4         4      4   571.4286   .2857143       2000 |
438. |     123          1         4      4   709.3217   .4285714   1655.084 |
439. |     123          2         4      4    1562.57   1.070804   1459.249 |
440. |     123          3         4      4   2227.963   4.961765   449.0263 |
     |----------------------------------------------------------------------|
441. |     123          4         4      4   714.2857   .2857143       2500 |
442. |     125          1         4      4   22122.31   69.35778   318.9592 |
443. |     125          2         4      4    2633.35   6.039391   436.0291 |
444. |     125          3         4      4   12489.72   35.82612   348.6204 |
445. |     125          4         4      4   2729.434   8.406087   324.6973 |
     |----------------------------------------------------------------------|
446. |     127          1         4      4   857.4753    3.79559   225.9135 |
447. |     127          2         4      4   950.3602   10.48977   90.59873 |
448. |     127          3         4      4   1541.437   5.256469   293.2456 |
449. |     127          4         4      4   978.0741   .3622416    2700.06 |
450. |     132          1         4      4     4940.5   92.66317   53.31676 |
     |----------------------------------------------------------------------|
451. |     132          2         4      4   721.2561   10.93984   65.92928 |
452. |     132          3         4      4   5461.326   56.51178   96.64048 |
453. |     132          4         4      4   342.8571   1.714286        200 |
454. |     135          1         4      4   1492.429   7.302239   204.3797 |
455. |     135          2         4      4   2285.028   9.994683   228.6244 |
     |----------------------------------------------------------------------|
456. |     135          3         4      4   1510.614   5.893722    256.309 |
457. |     135          4         4      4    1802.09   3.131497   575.4724 |
458. |     136          1         4      4   3965.484   14.83919   267.2305 |
459. |     136          2         4      4   3803.155   14.08406   270.0326 |
460. |     136          3         4      4   4449.067   17.96481   247.6545 |
     |----------------------------------------------------------------------|
461. |     136          4         4      4   2254.381   8.788265   256.5217 |
462. |     137          1         4      4   1247.667   3.569555   349.5303 |
463. |     137          2         4      4   1590.299   4.231922   375.7866 |
464. |     137          3         4      4   753.9571   2.048531   368.0477 |
465. |     137          4         4      4   840.9837   2.056099    409.019 |
     |----------------------------------------------------------------------|
466. |     138          1         4      4   3914.174   22.05731   177.4547 |
467. |     138          2         4      4   3317.699   22.45145   147.7722 |
468. |     138          3         4      4   4959.341   20.50866   241.8169 |
469. |     138          4         4      4   1107.162   5.542194   199.7696 |
470. |     139          1         4      4   1056.743   6.530907   161.8064 |
     |----------------------------------------------------------------------|
471. |     139          2         4      4   1285.235   2.815099   456.5507 |
472. |     139          3         4      4   1048.108   2.337052   448.4743 |
473. |     139          4         4      4   219.6491   1.246245   176.2487 |
474. |     140          1         4      4   28464.36   60.20312   472.8054 |
475. |     140          2         4      4   3623.574     6.2562   579.1973 |
     |----------------------------------------------------------------------|
476. |     140          3         4      4   20870.28   51.28834   406.9206 |
477. |     140          4         4      4   571.4286   .5714286       1000 |
478. |     141          1         4      4    12226.1   15.74737   776.3903 |
479. |     141          2         4      4   79038.79   88.76166    890.461 |
480. |     141          3         4      4   35785.28   34.39193   1040.514 |
     |----------------------------------------------------------------------|
481. |     141          4         4      4   29464.24   34.89855   844.2828 |
482. |     144          1         4      4    3907.61   5.387311   725.3359 |
483. |     144          2         4      4   13878.42   13.11095   1058.537 |
484. |     144          3         4      4   1596.692   1.469606   1086.476 |
485. |     144          4         4      4   4783.617   4.035596   1185.356 |
     |----------------------------------------------------------------------|
486. |     147          1         4      4   5402.363    2.15405   2508.002 |
487. |     147          2         4      4   6151.034    2.28928   2686.886 |
488. |     147          3         4      4   2248.612   1.103284   2038.109 |
489. |     147          4         4      4    1456.49   .5599361   2601.173 |
490. |     150          1         4      4   2297.742   6.884213   333.7697 |
     |----------------------------------------------------------------------|
491. |     150          2         4      4   8817.374   23.24019    379.402 |
492. |     150          3         4      4   2525.998   6.325019   399.3661 |
493. |     150          4         4      4   2007.251    4.50429    445.631 |
     +----------------------------------------------------------------------+

.                         tempfile uvq2;

.                         keep reg_tpi product survquar ppkg_trim;

.                 save `uvq2', replace;
(note: file /tmp/St02337.00000e not found)
file /tmp/St02337.00000e saved

.                                 use `uvq' ;

.                         merge reg_tpi product survquar using `uvq2';
(label lbreg already defined)
(label lsurvquar already defined)

.                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |        493      100.00      100.00
------------+-----------------------------------
      Total |        493      100.00

.                         drop _merge;

.                 save `uvq', replace;
file /tmp/St02337.00000c saved

.                 save "$path/work/tpi_unit_val_quarterly.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_unit_val_quarterly.dta saved

.         restore;

. **************************************************************************;
. * Now calculate the weights for the temporal price index. The weights
> * will be based on the bottom 50% of the national nominal consumption
> * per capita (see below). We let the weights vary by strata (3 regions X rural/urban).
> *
> * First, make a small file that has the total nominal HH daily consumption,
> * to use as our denominator. We cannot simply use the `bottom_tpi' file that
> * was created earlier because we will need some other variables from
> * the cons_cat.dta file.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. keep hhid cons_hh_nom;

. *use "$path/in/cons_cat.dta", clear ;
. *CA modified to merge in hhdata for bootstrap;
.        sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.           tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         collapse (mean) cons_hh_nom hhsize strata hhweight rural news survquar reg_tpi,
>                 by(hhid);

.         lab var cons_hh_nom "Nominal daily HH consumption";

.         rename hhsize   cc_hhs;

.         rename strata   cc_reg;

.         rename hhweight cc_hhw;

.         rename rural    cc_rur;

.         rename news     cc_news;

.         rename survquar cc_qua;

.         rename reg_tpi  cc_reg_tpi;

.         sort hhid;

.         tempfile thhcons;

. save `thhcons', replace;
(note: file /tmp/St02337.00000f not found)
file /tmp/St02337.00000f saved

. **************************************************************************;
. * Merge the file with consumption on the food products with HH consumption file,
> * then use "fillin" to take care of cases where a household did not
> * consume all n_tpi commodities. Note that we need to do the merge
> * first because there are some households that are not in `acredd' at
> * all, because they did not consume *any* of the n_tpi items. Then replace
> * missing values in the "filled in" observations with the relevant values 
> * for that household.
> **************************************************************************;
. use `acredd';

.         cap drop _merge;

.         drop if product==.;
(158 observations deleted)

.         merge hhid using `thhcons';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        159        0.62        0.62
          3 |     25,561       99.38      100.00
------------+-----------------------------------
      Total |     25,720      100.00

.         for var valued_tot quantityd_tot : replace X=0 if _merge==2;

->  replace valued_tot=0 if _merge==2
(159 real changes made)

->  replace quantityd_tot=0 if _merge==2
(159 real changes made)

.                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 valued_tot quantityd_tot : replace X=0 if _merge==2;
>                                 */
> 
>         replace hhsize  =cc_hhs     if _merge==2;
(156 real changes made)

.         replace strata  =cc_reg     if _merge==2;
(158 real changes made)

.         replace hhweight=cc_hhw     if _merge==2;
(157 real changes made)

.         replace rural   =cc_rur     if _merge==2;
(158 real changes made)

.         replace news    =cc_news        if _merge==2;
(150 real changes made)

.         replace survquar=cc_qua     if _merge==2;
(110 real changes made)

.         replace reg_tpi =cc_reg_tpi     if _merge==2;
(158 real changes made)

.         drop _merge cc_* ;

.                 fillin hhid product;

.         replace valued_tot=0 if _fillin;
(55790 real changes made)

.                 for var quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;

->  egen tmp=mean(quantityd_tot), by(hhid)

->  replace quantityd_tot=tmp if _fillin
(55790 real changes made)

->  drop tmp

->  egen tmp=mean(strata), by(hhid)
(30 missing values generated)

->  replace strata=tmp if _fillin
(55761 real changes made)

->  drop tmp

->  egen tmp=mean(rural), by(hhid)
(30 missing values generated)

->  replace rural=tmp if _fillin
(55761 real changes made)

->  drop tmp

->  egen tmp=mean(hhweight), by(hhid)
(60 missing values generated)

->  replace hhweight=tmp if _fillin
(55732 real changes made)

->  drop tmp

->  egen tmp=mean(hhsize), by(hhid)
(90 missing values generated)

->  replace hhsize=tmp if _fillin
(55703 real changes made)

->  drop tmp

->  egen tmp=mean(survquar), by(hhid)
(1470 missing values generated)

->  replace survquar=tmp if _fillin
(54369 real changes made)

->  drop tmp

->  egen tmp=mean(survmon), by(hhid)
(4770 missing values generated)

->  replace survmon=tmp if _fillin
(51179 real changes made)

->  drop tmp

->  egen tmp=mean(news), by(hhid)
(270 missing values generated)

->  replace news=tmp if _fillin
(55529 real changes made)

->  drop tmp

->  egen tmp=mean(reg_tpi), by(hhid)
(30 missing values generated)

->  replace reg_tpi=tmp if _fillin
(55761 real changes made)

->  drop tmp

->  egen tmp=mean(cons_hh_nom), by(hhid)
(120 missing values generated)

->  replace cons_hh_nom=tmp if _fillin
(55674 real changes made)

->  drop tmp

.                                 /*
>         for var valued_ac quantityd_ac valued_re quantityd_re valued_dd quantityd_dd 
>                 quantityd_tot 
>                 strata rural hhweight hhsize survquar survmon news reg_tpi cons_hh_nom :
>                 egen tmp=mean(X), by(hhid) \
>                 replace X=tmp if _fillin \
>                 drop tmp;
>                                 */
> 
> **************************************************************************;
. * Now calculate the shares, and then the mean shares in each strata, 
> * using hhweight*hhsize weighting. 
> * Note that we are not doing quantity weighting now for the shares.
> **************************************************************************;
.         gen share = valued_tot/cons_hh_nom ;
(1770 missing values generated)

.         gen popwt = hhsize*hhweight;
(90 missing values generated)

.         lab var share "HH share in total consumption";

.         lab var popwt "Population weight: hhsize*hhweight";

. **************************************************************************;
. * Select the bottom 50% (weighted) of the distribution of nominal per 
> * capita consumption.
> **************************************************************************;
.         gen cpc=cons_hh_nom/hhsize;
(180 missing values generated)

.         sum cpc [aw=hhweight] , detail;

                             cpc
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     324.6641              0
10%     513.4186              0       Obs               81330
25%     857.0879              0       Sum of Wgt.   179111489

50%     1412.666                      Mean           2395.221
                        Largest       Std. Dev.      8417.337
75%     2417.119       252488.6
90%     4215.398       252488.6       Variance       7.09e+07
95%     6013.398       252488.6       Skewness       25.87545
99%      12224.3       252488.6       Kurtosis       753.8105

.         global medcpc=r(p$tpi_bottom);

. * MAH ;
.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     81480    1.32e+11    4.07e+12   1.01e+09   2.12e+14
     product |     78793    125.6552    13.95636        101        150
  valued_tot |     81510     152.922    585.7047          0   85714.29
quantityd_~t |     81510    .5202694    .7101384          0         60
      strata |     81480    3.830265    1.511715          1          6
-------------+--------------------------------------------------------
    hhweight |     81450    2207.802    1693.745   308.1181   8736.727
    survquar |     80040    2.452024    1.105543          1          4
     survmon |     76740    6.381939    3.384659          1         12
       rural |     81480    .7750368    .4175606          0          1
     reg_tpi |     81480    2.271723    1.217436          0          4
-------------+--------------------------------------------------------
    spdomain |     25561    3.151207    1.263125          1          5
        news |     81240    2.343427    1.111683          1          4
      hhsize |     81420     7.06706    3.584038          1         29
 cons_hh_nom |     81390    14589.07    32266.71          0   874315.5
     _fillin |     81510    .6844559    .4647351          0          1
-------------+--------------------------------------------------------
       share |     79740    .0143853    .0419911          0   .8367343
       popwt |     81420       13754    11235.33   548.9749   104660.2
         cpc |     81330    2239.895     6115.97          0   252488.6

.  codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                               Unique HH Identifier Across Panel Waves
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2716                     missing .:  30/81510

                  mean:   1.3e+11
              std. dev:   4.1e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   3.0e+09   4.0e+09   1.1e+11

.         keep if cpc<=$medcpc;
(39330 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     42180    3.63e+10    1.97e+11   1.01e+09   2.32e+12
     product |     40774    125.6552    13.95645        101        150
  valued_tot |     42180    101.7493    332.7256          0   10285.71
quantityd_~t |     42180    .5284041    .6542123          0   34.28571
      strata |     42180     4.21835    1.303792          1          6
-------------+--------------------------------------------------------
    hhweight |     42180    2123.424    1587.787   308.1181   8736.727
    survquar |     40890    2.363169    1.083888          1          4
     survmon |     39330    6.160183    3.348182          1         12
       rural |     42180    .8776671    .3276737          0          1
     reg_tpi |     42180    2.497866    1.061257          0          4
-------------+--------------------------------------------------------
    spdomain |     11406    3.427407    1.044784          1          5
        news |     41970    2.523231    1.024025          1          4
      hhsize |     42180    7.403983    3.247374          1         29
 cons_hh_nom |     42180    6060.834    3870.438          0    27152.6
     _fillin |     42180    .7273352    .4453351          0          1
-------------+--------------------------------------------------------
       share |     40590    .0166815    .0489232          0   .7619048
       popwt |     42180    14322.62    11055.56   821.0083   104660.2
         cpc |     42180    821.1517    356.4997          0   1412.666

.                 collapse (mean) share (median) medshare=share [aw=popwt] , 
>                         by(reg_tpi product);

.                 egen sumsh=sum(share) , by(reg_tpi);

.                 replace share=share/sumsh;
(138 real changes made)

.                 drop sumsh;

.                 egen sumsh=sum(medshare) , by(reg_tpi);

.                 replace medshare=medshare/sumsh;
(30 real changes made)

.                 drop sumsh;

.                 lab var share "Reg 6: Mean HH share of total consumption";

.                 lab var medshare "Reg 6: Median HH share of total consumption";

.                 sort reg_tpi product;

.                 save "$path/work/tpi_reg_tpi_share.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_reg_tpi_share.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/tpi_reg_tpi_share.dta saved

.                 tempfile tempwt6;

.                 save `tempwt6', replace;
(note: file /tmp/St02337.00000g not found)
file /tmp/St02337.00000g saved

. use `uvq', clear;

.         sort reg_tpi product;

. save , replace;
file /tmp/St02337.00000c saved

. use `tempwt6';

.         merge reg_tpi product using `uvq';
variables reg_tpi product do not uniquely identify observations in /tmp/St02337.00000c
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         14        2.76        2.76
          3 |        493       97.24      100.00
------------+-----------------------------------
      Total |        507      100.00

.         gen tpi1     =ppkg     *share;
(14 missing values generated)

.         gen tpi1_trim=ppkg_trim*share;
(14 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       502    125.9522    13.95422        101        150
     reg_tpi |       507    2.216963    1.306819          0          4
       share |       507     .037098    .0414645          0   .2004303
    medshare |       507    .0374753    .1036145          0    .632345
    survquar |       493    2.440162    1.105681          1          4
-------------+--------------------------------------------------------
        news |       493    2.348884    1.138741          1          4
  valued_tot |       493     7329.15     9209.42   28.57143   71752.54
quantityd_~t |       493    11.33779    15.80897   .0357143   102.9673
        ppkg |       493    1561.561    1930.723   54.90598      15000
   ppkg_trim |       493    1488.922    1911.178   42.72749      15000
-------------+--------------------------------------------------------
      _merge |       507    2.944773    .3280486          1          3
        tpi1 |       493    66.16811    113.4047   .2575862    867.925
   tpi1_trim |       493    62.60399    109.7662   .2575862   860.1837

. keep if survquar!=.;
(14 observations deleted)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     product |       493    126.0588    13.91052        101        150
     reg_tpi |       493    2.249493    1.286509          0          4
       share |       493    .0381456     .041574   .0001568   .2004303
    medshare |       493    .0385396    .1048826          0    .632345
    survquar |       493    2.440162    1.105681          1          4
-------------+--------------------------------------------------------
        news |       493    2.348884    1.138741          1          4
  valued_tot |       493     7329.15     9209.42   28.57143   71752.54
quantityd_~t |       493    11.33779    15.80897   .0357143   102.9673
        ppkg |       493    1561.561    1930.723   54.90598      15000
   ppkg_trim |       493    1488.922    1911.178   42.72749      15000
-------------+--------------------------------------------------------
      _merge |       493           3           0          3          3
        tpi1 |       493    66.16811    113.4047   .2575862    867.925
   tpi1_trim |       493    62.60399    109.7662   .2575862   860.1837

. list in  1/3;

     +-------------------------------------------------------------------------------------------------------------+
  1. | product | reg_tpi |    share | medshare |    survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     107 | Kampala | .0207437 |        0 |  Oct-Dec 10 | Central | 857.1429 | .2857143 |     3000 |     3000 |
     |-------------------------------------------------------------------------------------------------------------|
     |              _merge              |                  tpi1              |              tpi1_t~m               |
     |                   3              |              62.23116              |              62.23116               |
     +-------------------------------------------------------------------------------------------------------------+

     +-------------------------------------------------------------------------------------------------------------+
  2. | product | reg_tpi |    share | medshare |    survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     108 | Kampala | .0006526 |        0 | Apr-June 11 | Central | 28.57143 | .0357143 | 799.9999 | 799.9999 |
     |-------------------------------------------------------------------------------------------------------------|
     |              _merge              |                  tpi1              |              tpi1_t~m               |
     |                   3              |              .5220856              |              .5220856               |
     +-------------------------------------------------------------------------------------------------------------+

     +-------------------------------------------------------------------------------------------------------------+
  3. | product | reg_tpi |    share | medshare |    survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     110 | Kampala | .1189225 | .1088928 |  Oct-Dec 10 | Central |  3371.58 |  1.68579 |     2000 |     2000 |
     |-------------------------------------------------------------------------------------------------------------|
     |              _merge              |                  tpi1              |              tpi1_t~m               |
     |                   3              |               237.845              |               237.845               |
     +-------------------------------------------------------------------------------------------------------------+

. list in -3/-1;

     +----------------------------------------------------------------------------------------------------------------+
491. | product | reg_tpi |    share | medshare |       survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     150 | Western | .0148618 |  .041664 |    Jan-Marc 11 | Western | 3601.478 | 11.12012 | 323.8705 |  379.402 |
     |----------------------------------------------------------------------------------------------------------------|
     |              _merge               |                  tpi1               |               tpi1_t~m               |
     |                   3               |              4.813293               |                5.63859               |
     +----------------------------------------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------------------------------------+
492. | product | reg_tpi |    share | medshare |       survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     150 | Western | .0148618 |  .041664 |    Apr-June 11 | Western | 2198.346 | 7.189951 | 305.7527 | 399.3661 |
     |----------------------------------------------------------------------------------------------------------------|
     |              _merge               |                  tpi1               |               tpi1_t~m               |
     |                   3               |               4.54403               |               5.935292               |
     +----------------------------------------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------------------------------------+
493. | product | reg_tpi |    share | medshare |       survquar |    news | valued~t | quanti~t |     ppkg | ppkg_t~m |
     |     150 | Western | .0148618 |  .041664 | July-Sept 2011 | Western | 1696.156 | 7.857604 | 215.8618 |  445.631 |
     |----------------------------------------------------------------------------------------------------------------|
     |              _merge               |                  tpi1               |               tpi1_t~m               |
     |                   3               |              3.208091               |                6.62287               |
     +----------------------------------------------------------------------------------------------------------------+

.         **************************************************************************;
. * Find TPI level and indexes for non-trimmed and trimmed prices
> **************************************************************************;
. * Not trimmed ;
.         collapse (sum) tpi1 tpi1_trim  , by(reg_tpi survquar);

.                 for num 1/$n_tpi :
>                         sum tpi1 if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1 if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1 if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1 if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1 if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1 if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

->  sum tpi1 if reg_tpi==5 & survquar==2 , meanonly

->  sum tpi1 if reg_tpi==5 & survquar==4 , meanonly

->  global base5=r(mean)

.                 lab var tpi1 "Temporal price index before normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi=tpi1/${base`v'} if reg_tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi=tpi1/${base`v'} if reg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(15 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)
(0 real changes made)

.                                                                                                 *gen     tpi=tpi1/$base1
>  if reg_tpi==1;
.                 *replace tpi=tpi1/$base2 if reg_tpi==2;
.                 *replace tpi=tpi1/$base3 if reg_tpi==3;
.                 *replace tpi=tpi1/$base4 if reg_tpi==4;
.                 *replace tpi=tpi1/$base5 if reg_tpi==5;
.                 *replace tpi=tpi1/$base6 if reg_tpi==6;
.                                                                                 lab var tpi "Temporal price index (Q4=1)
> ";

. * Trimmed ;
.                 for num 1/$n_tpi :
>                         sum tpi1_trim if reg_tpi==X & survquar==2 , meanonly \
>                         sum tpi1_trim if reg_tpi==X & survquar==4 , meanonly \
>                         global baseX=r(mean);

->  sum tpi1_trim if reg_tpi==1 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==1 & survquar==4 , meanonly

->  global base1=r(mean)

->  sum tpi1_trim if reg_tpi==2 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==2 & survquar==4 , meanonly

->  global base2=r(mean)

->  sum tpi1_trim if reg_tpi==3 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==3 & survquar==4 , meanonly

->  global base3=r(mean)

->  sum tpi1_trim if reg_tpi==4 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==4 & survquar==4 , meanonly

->  global base4=r(mean)

->  sum tpi1_trim if reg_tpi==5 & survquar==2 , meanonly

->  sum tpi1_trim if reg_tpi==5 & survquar==4 , meanonly

->  global base5=r(mean)

.                 lab var tpi1_trim "Six regions: TRIMMED Temporal price index before normalization";

.                                 foreach v of numlist 1/$n_tpi { ;
  2.                                         if `v'==1 { ;
  3.                                                 gen tpi_trim=tpi1_trim/${base`v'} if reg_tpi==`v' ;
  4.                                         } ;
  5.                                         if `v'>1 { ;
  6.                                                 replace tpi_trim=tpi1_trim/${base`v'} if reg_tpi==`v' ;
  7.                                         } ;
  8.                                 } ;
(15 missing values generated)
(4 real changes made)
(4 real changes made)
(4 real changes made)
(0 real changes made)

.                                                 lab var tpi_trim "TRIMMED Temporal price index (Q4=1)";

.                 sort reg_tpi survquar;

.             drop if reg_tpi<1 | reg_tpi>$n_tpi;
(3 observations deleted)

. gen tpi_diff = tpi - tpi_trim;

. lab var tpi_diff "TPI difference btw trimmed/untrimmed";

. twoway (connected tpi_trim survquar),yline(1) by(, title("TPI: Trimmed"))
> by(reg_tpi) sav("$path/work/reg_tpi-tpi_trim", replace);
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/reg_tpi-tpi_trim.gph not found)
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/reg_tpi-tpi_trim.gph saved)

. graph export "$path/work/reg_tpi-tpi_trim.tif", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/reg_tpi-tpi_trim.tif not found)
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/reg_tpi-tpi_trim.tif written in TIFF format)

. list reg_tpi survquar tpi tpi_trim tpi_diff;

     +-------------------------------------------------------------+
     |  reg_tpi         survquar        tpi   tpi_trim    tpi_diff |
     |-------------------------------------------------------------|
  1. |  Central       Oct-Dec 10   .7708836   .7787654   -.0078818 |
  2. |  Central      Jan-Marc 11   .8812565   .8588735    .0223829 |
  3. |  Central      Apr-June 11   .9680914   .9439998    .0240916 |
  4. |  Central   July-Sept 2011          1          1           0 |
  5. |  Eastern       Oct-Dec 10   .6629828   .7730982   -.1101153 |
     |-------------------------------------------------------------|
  6. |  Eastern      Jan-Marc 11   .6986216   .7488575   -.0502359 |
  7. |  Eastern      Apr-June 11   .8588197   .9843472   -.1255275 |
  8. |  Eastern   July-Sept 2011          1          1           0 |
  9. | Northern       Oct-Dec 10   .7757034   .8808464    -.105143 |
 10. | Northern      Jan-Marc 11   .7371657   .8919085   -.1547427 |
     |-------------------------------------------------------------|
 11. | Northern      Apr-June 11   .8267024   .9590539   -.1323515 |
 12. | Northern   July-Sept 2011          1          1           0 |
 13. |  Western       Oct-Dec 10   .7258057   .8402035   -.1143978 |
 14. |  Western      Jan-Marc 11   .8968236   .9428219   -.0459983 |
 15. |  Western      Apr-June 11    1.05824   1.185341   -.1271006 |
     |-------------------------------------------------------------|
 16. |  Western   July-Sept 2011          1          1           0 |
     +-------------------------------------------------------------+

.                 sort reg_tpi survquar;

. keep reg_tpi survquar tpi_trim;

. save "$path/work/temp_index_reg_tpi.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/temp_index_reg_tpi.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/temp_index_reg_tpi.dta saved

.                        **************************************************************************
> * 090_temp_index.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/100_food_basket_flex.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/100_food_basket_flex.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/100_food_basket_flex.log
  log type:  text
 opened on:   8 Jul 2013, 20:15:13

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 100_food_basket_flex.do     (start)
> *
> * This file is to get the data from the cons_cod.dta in work and then 
> * to create the do file with the 90% of the consumption expenditures 
> * using a flexible basket of goods.
> *
> * NOTE: we actually keep goods representing 95% of expenditure
> * in order to facilitate dropping of some goods (such as rats) where
> * quantity and nutrition information is unknown.
> *
> * We base our basket on the bottom 60 percent of consumption per capita
> * (weighted by hhweight*hhsize). We use the TEMPORALLY-ADJUSTED
> * NOMINAL consumption because we don't have a spatial adjustment yet.
> *
> * (Then we iterate this process to arrive at a final food bundle in later code)
> **************************************************************************;
. *CA modified to bring in hhdata into bootstrap;
. /*
> This file uses:
>                 work/cons_cod.dta
>                 work/hhdata.dta
>                 work/products.dta
>                 work/consump_nom.dta
>                 work/temp_index_reg_tpi.dta
>                 work/food_cat.dta
> 
> This file creates:
>                 work/food_basket_flex.dta
>                 work/codes_food_basket_flex.dta
> */
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************;
. * First, make a small temp file that has the temporally adjusted 
> * nominal consumption per capita, using work/consump_nom and 
> * work/temp_index_reg_tpi.dta. Make a dummy variable indicating
> * whether they are in the bottom 60%.
> **************************************************************************;
. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _m;

.         keep hhid hhweight hhsize cons_pc_nom reg_tpi rural survquar;

.         sort reg_tpi survquar;

.         cap drop _merge;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225        8.28        8.28
          3 |      2,492       91.72      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.                 gen food_pc_tpi  = food_pc_nom /tpi_trim;
(225 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(225 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

.         tempfile contpi;

.         save `contpi', replace;
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved

.         collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight] ;

.         rename cons_pc_tpi pctile_60;

.         tempfile 60pct;

.         sort one;

.         save `60pct', replace;
(note: file /tmp/St02337.000002 not found)
file /tmp/St02337.000002 saved

.                 use `contpi';

.                 sort one;

.                 merge one using `60pct';
variable one does not uniquely identify observations in the master data

.                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                 drop _merge;

.                 drop one;

.                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                 tab bottom_basket [aw=hhsize*hhweight];

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 948.911484       34.96       34.96
          1 | 1,765.0885       65.04      100.00
------------+-----------------------------------
      Total |      2,714      100.00

.                 lab var bottom_basket "=1 if in bottom 60% of PCE";

.                                 sort hhid;

. save `contpi' , replace;
file /tmp/St02337.000001 saved

. **************************************************************************;
. * Next, need to keep only the food products in order to calculate the 
> * food poverty line, and then calculate the food expenses by code.
> **************************************************************************;
. use "$path/work/cons_cod.dta";

. /*
>         sort product;
>         merge product using "$path/work/food_cat.dta";
>         tab _merge;
>         keep if _merge==3;
>         drop _merge;
> */
>         
>         keep if food_cat;
(0 observations deleted)

.         codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                               Unique HH Identifier Across Panel Waves
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2712                     missing .:  283/37116

                  mean:   1.3e+11
              std. dev:   4.1e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   2.2e+09   4.0e+09   1.1e+11

.         sort hhid;

. **************************************************************************;
. * Next, merge in the consumption information, and select those in bottom
> * 60% of nominal distribution, after making temporal adjustment. 
> **************************************************************************;
.         merge hhid using `contpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          4        0.01        0.01
          3 |     37,116       99.99      100.00
------------+-----------------------------------
      Total |     37,120      100.00

.         keep if _merge==3;
(4 observations deleted)

.         drop _merge;

.         keep if bottom_basket==1;
(16722 observations deleted)

.      **************************************************************************;
. * Calculate food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.           gen  food_expenditure= cod_hh_nom;

.                             *gen  food_expenditure= own_valued + daily_valued + monthly_valued + educ_valued;
.           egen tot_food_expen= sum (food_expen), by (hhid) ;

.           count if food_expenditure==.;
    0

.           count if tot_food_expen==.;
    0

.                     gen food_share= food_expenditure/tot_food_expen;
(10 missing values generated)

.           count if food_share==.;
   10

.           drop if food_share==.;
(10 observations deleted)

.           sort hhid product;

.                         tempfile food_basket_flex;

. save `food_basket_flex', replace;
(note: file /tmp/St02337.000003 not found)
file /tmp/St02337.000003 saved

. ********************************************************************************;
. * Now prepare to get the variable spdomain to the using dataset, and then find the 
> * total shares by each product in order to select the most important goods in the 
> * basket.
> ********************************************************************************;
.                 preserve;

.                 use "$path/work/hhdata.dta", clear;
(Household master record (1 record per household))

.                         keep hhid spdomain;

.                         sort hhid;

.                         tempfile spdomain;

.                 save `spdomain' , replace;
(note: file /tmp/St02337.000005 not found)
file /tmp/St02337.000005 saved

.                 restore;

.                            collapse (mean) hhweight, by (hhid);

.            sort hhid ;

.             merge hhid using `spdomain';

.            tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      1,042       38.37       38.37
          3 |      1,674       61.63      100.00
------------+-----------------------------------
      Total |      2,716      100.00

.            drop if _m==2;
(1042 observations deleted)

.            drop _merge;

.             collapse (sum) hhweight , by(spdomain);

.            rename hhweight tothhweight;

.            tempfile tothhweight;

. save `tothhweight';
file /tmp/St02337.000006 saved

. use `food_basket_flex';

.           sort hhid;

.           merge hhid using `spdomain';
variable hhid does not uniquely identify observations in the master data

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      1,042        4.86        4.86
          3 |     20,384       95.14      100.00
------------+-----------------------------------
      Total |     21,426      100.00

.           sort _m;

.           drop if _m==2;
(1042 observations deleted)

.           drop _m;

.           sort spdomain;

.             merge spdomain using `tothhweight';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.           tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     20,384      100.00      100.00
------------+-----------------------------------
      Total |     20,384      100.00

.           drop _merge;

.             sort spdomain product;

.             gen f_share_w=(food_share*hhweight)/tothhweight;

.                                                 *drop descript;
.                         *gen descript = 0;
.             collapse (sum) f_share_w, by(spdomain product descript);

.                      sort spdomain f_share_w;

.           by spdomain: gen cumshr= sum(f_share_w);

.                     count if cumshr<=.075;
  187

.           drop if cumshr<=.075;
(187 observations deleted)

.             lab var f_share_w "average food share for the 13 regions";

. save "$path/work/food_basket_flex.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/food_basket_flex.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/food_basket_flex.dta saved

. * List first spatial region to get an idea about contents;
. list product spdomain f_share_w cumshr if spdomain==1;

     +-----------------------------------------------+
     | product        spdomain   f_shar~w     cumshr |
     |-----------------------------------------------|
  1. |     105   Central Urban    .007011   .0778088 |
  2. |     107   Central Urban   .0081733    .085982 |
  3. |     102   Central Urban   .0090383   .0950203 |
  4. |     101   Central Urban   .0091023   .1041226 |
  5. |     114   Central Urban   .0091574   .1132801 |
     |-----------------------------------------------|
  6. |     135   Central Urban   .0098028   .1230829 |
  7. |     123   Central Urban   .0125427   .1356256 |
  8. |     122   Central Urban   .0129624    .148588 |
  9. |     157   Central Urban   .0154191   .1640071 |
 10. |     127   Central Urban   .0186287   .1826357 |
     |-----------------------------------------------|
 11. |     136   Central Urban    .019481   .2021168 |
 12. |     117   Central Urban    .019678   .2217948 |
 13. |     125   Central Urban    .020405   .2421998 |
 14. |     103   Central Urban   .0216762    .263876 |
 15. |     141   Central Urban   .0220954   .2859713 |
     |-----------------------------------------------|
 16. |     137   Central Urban   .0222872   .3082585 |
 17. |     110   Central Urban   .0229298   .3311884 |
 18. |     140   Central Urban   .0258224   .3570108 |
 19. |     144   Central Urban    .027746   .3847568 |
 20. |     108   Central Urban   .0336766   .4184333 |
     |-----------------------------------------------|
 21. |     147   Central Urban   .0416138   .4600471 |
 22. |     113   Central Urban   .0669171   .5269642 |
 23. |       .   Central Urban    .081341   .6083052 |
 24. |     999   Central Urban   .3916948          1 |
     +-----------------------------------------------+

.                     gen numreg=1;

.           collapse (sum) numreg cumshr, by (product descript);

.                           keep product descript numreg;

.           display _N;
41

.                     lab var numreg "number of goods in the basket";

. /*
>           merge product using "$path/work/products.dta";
>             tab _merge;
>           keep if _merge==3;
> */
>           keep product descript numreg;

.             sort product;

.                display _N;
41

.   save "$path/work/codes_food_basket_flex.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex.dta saved

. **************************************************************************
> * 100_food_basket_flex.do     (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/110_price_unit_flex.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/110_price_unit_flex.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/110_price_unit_flex.log
  log type:  text
 opened on:   8 Jul 2013, 20:15:22

. clear

. set more off

. #delimit ;
delimiter now ;
. ****************************************************************************************
> * 110_price_unit_flex.do                (start)
> *
> * Purpose: This do file creates a price_unit_flex database with the unit prices of the
> * goods of the flexible food basket in order to determine the poverty lines per spatial
> * domain. It uses the files work/daily.dta and work/own.dta file and draw unit prices
> * by: sum of values and quantity
> ****************************************************************************************;
. *CA modified to bring in work/hhdata.dta for bootstrap
> *CA check for price calcs conditional on number of observations;
. /*
> This file uses:
>         work/daily.dta
>         work/own.dta
>         work/hhdata.dta
>         work/consump_nom.dta
>         work/codes_food_basket_flex.dta
>         work/temp_index_reg_tpi.dta
>           new/conversions.do
> 
> This file creates:
>         work/price_unit_flex.dta
>         work/bottom_basket.dta
> */
> 
> 
> 
> 
> *do "$path/new/010_initial.do";
. **************************************************************************************
> * Create sorted data set with daily and own and the matched codes
> **************************************************************************************;
. use "$path/work/cons_cod_trans.dta", clear;
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

. *use "$path/in/cons_cod_trans.dta", clear;
. *save "$path/work/cons_cod_trans.dta", replace;
. *drop if quantityd==0 ;
. keep hhid product food_cat valuez quantityz unit;

. rename valuez    value;

. rename quantityz quantity;

. drop if quantity==0 ;
(779 observations deleted)

. *drop count;
.         sort product;

.         gen count=1;

.                 tempfile dd_acsort;

. save `dd_acsort', replace;
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved

. /*
> use "$path/work/daily.dta";
> tempfile dd_acsort;
>         drop days;
>         sort product;
>         tempfile dd_acsort;
> save `dd_acsort', replace;
> 
> use "$path/work/own.dta";
>         keep hhid product valued quantityd unit;
>         rename valued value;
>         rename quantityd quantity;
> 
>         *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>         drop if quantity==0;
> 
>         append using `dd_acsort';
> 
> *CA modified to merge in work/hhdata.dta for bootstrap;
>         sort hhid;
>       merge hhid using "$path/work/hhdata.dta";
>       tab _m;
> 
> * Drop observations if non existent in HH data set;
> drop if _m!=3;
> drop _m;
> 
> 
>         sort product;
>         gen count=1;
> 
> 
> save `dd_acsort', replace;
> */
> 
> 
> **************************************************************************************;
. * Merge the flexible food basket codes with the daily and own data sets
> * Drop all codes not a part of the flexible food basket
> **************************************************************************************;
.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data
product was int now float

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      5,447       16.20       16.20
          2 |          2        0.01       16.20
          3 |     28,178       83.80      100.00
------------+-----------------------------------
      Total |     33,627      100.00

.         drop if _merge~=3;
(5449 observations deleted)

.         drop _merge;

. **************************************************************************************;
. * Drop observations where product code or quantity or value information is unavailable
> **************************************************************************************;
.                                 codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          household id
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2582                     missing .:  140/28178

                  mean:   1.5e+11
              std. dev:   4.4e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   2.2e+09   4.0e+09   1.1e+11

. *        drop if product==. | value==. | quantity==.  ;
.                                 codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          household id
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2582                     missing .:  140/28178

                  mean:   1.5e+11
              std. dev:   4.4e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   2.2e+09   4.0e+09   1.1e+11

. **************************************************************************************;
. * Convert non-KG quantities (units and liters) to kilograms;
. **************************************************************************************;
. *do "$path/new/110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped
> ********************************************************************;
. *        drop if unit~=2;
. ********************************************************************
> * Merge in labels for the 13 spatial domains
> ********************************************************************;
.         preserve;

.                 use "$path/work/hhdata.dta", clear;
(Household master record (1 record per household))

.                                                                         keep hhid spdomain reg_tpi survquar;

.                         sort hhid;

.                         tempfile spdomainreg_tpi;

.                 save `spdomainreg_tpi', replace;
(note: file /tmp/St02337.000003 not found)
file /tmp/St02337.000003 saved

.                                 codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          Household ID
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2716                     missing .:  0/2716

                  mean:   1.3e+11
              std. dev:   4.1e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   3.0e+09   4.0e+09   1.1e+11

.         restore;

.                 sort hhid;

.         merge hhid using `spdomainreg_tpi';
variable hhid does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        140        0.49        0.49
          2 |        134        0.47        0.97
          3 |     28,038       99.03      100.00
------------+-----------------------------------
      Total |     28,312      100.00

.         drop _merge;

.         drop if product==.;
(156 observations deleted)

. codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          household id
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2560                     missing .:  140/28156

                  mean:   1.5e+11
              std. dev:   4.4e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   2.2e+09   4.0e+09   1.1e+11

. tab spd;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |      3,776       13.48       13.48
Central Rural |      5,379       19.20       32.68
      Eastern |      7,082       25.28       57.96
     Northern |      7,190       25.66       83.62
      Western |      4,589       16.38      100.00
--------------+-----------------------------------
        Total |     28,016      100.00

. sum if spd>=3;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     18861    5.33e+10    2.43e+11   1.07e+09   2.32e+12
     product |     19001    130.8395     15.6652        101        171
    quantity |     18861    .6004119    1.229895   .0071429         60
       value |     18861    437.4125    671.2989   2.857143      15000
        unit |     18861           1           0          1          1
-------------+--------------------------------------------------------
    food_cat |     18861           1           0          1          1
       count |     19001           1           0          1          1
    descript |     19001           1           0          1          1
      numreg |     19001     3.68428    1.336039          1          5
    survquar |     18861    2.513228    1.123261          1          4
-------------+--------------------------------------------------------
     reg_tpi |     18861    2.867822    .7754683          2          4
    spdomain |     18861    3.867822    .7754683          3          5

. table spdomain, content(mean quantity count quantity count hhid) row missing;

--------------------------------------------------------------
Spatial       |
domains: each |
with own      |
poverty line  |
(they are 5)  | mean(quantity)     N(quantity)         N(hhid)
--------------+-----------------------------------------------
Central Urban |       .4677047           3,776           3,776
Central Rural |       .5302123           5,379           5,379
      Eastern |       .6385076           7,082           7,082
     Northern |       .5574299           7,190           7,190
      Western |       .6089644           4,589           4,589
              | 
        Total |       .5690475          28,016          28,016
--------------------------------------------------------------

.         drop if product==. | value==. | quantity==.  ;
(140 observations deleted)

. codebook hhid;

--------------------------------------------------------------------------------------------------------------------------
hhid                                                                                                          household id
--------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (double)

                 range:  [1.013e+09,2.115e+14]        units:  1
         unique values:  2560                     missing .:  0/28016

                  mean:   1.5e+11
              std. dev:   4.4e+12

           percentiles:        10%       25%       50%       75%       90%
                           1.1e+09   1.1e+09   2.2e+09   4.0e+09   1.1e+11

. tab spd;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |      3,776       13.48       13.48
Central Rural |      5,379       19.20       32.68
      Eastern |      7,082       25.28       57.96
     Northern |      7,190       25.66       83.62
      Western |      4,589       16.38      100.00
--------------+-----------------------------------
        Total |     28,016      100.00

. ********************************************************************
> * Merge in temporal price index to convert nominal value to real
> ********************************************************************;
.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,243        8.01        8.01
          3 |     25,773       91.99      100.00
------------+-----------------------------------
      Total |     28,016      100.00

.         drop if _merge ~= 3;
(2243 observations deleted)

.         drop _merge;

.         gen value_r=value/tpi_trim;

. **************************************************************************;
. * Identify relatively poor households, based on nominal temporally adjusted
> * consumption per capita. Only work with these households for the price
> * calculations.
> **************************************************************************;
.                 preserve;

.                         use "$path/work/conpc.dta", clear;

. *                       use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.         sort hhid;

.       merge hhid using "$path/work/hhdata.dta";

.       tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.       drop _m;

. *CA modified to keep bswt;
.                                 keep hhid hhweight hhsize cons_pc_nom bswt ;

.                                 sort hhid;

.                                 merge hhid using `spdomainreg_tpi';
(label lbreg already defined)
(label lsurvquar already defined)
(label lspdomain already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                                 drop _merge;

.                                 sort reg_tpi survquar;

.                                 cap drop _merge;

.                                 merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lbreg already defined)

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225        8.28        8.28
          3 |      2,492       91.72      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                                 drop _merge;

.                                 sort hhid;

.                                 merge hhid using "$path/work/conpc.dta";

.                                 tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                                 drop _merge;

.                                 gen food_pc_tpi  = food_pc_nom /tpi_trim;
(225 missing values generated)

.                                 lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                                                                 * Non-food not TPI adjusted ;
.                                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(225 missing values generated)

.                                 lab var cons_pc_tpi "Temp adjusted total consumption/day";

.                                 gen one=1;

.                                 tempfile contpi;

.                                 save `contpi', replace;
(note: file /tmp/St02337.000005 not found)
file /tmp/St02337.000005 saved

.                                 collapse (p$bottom) one cons_pc_tpi [aw=hhsize*hhweight], by(spdomain) ;

.                                 rename cons_pc_tpi pctile_60;

.                                 tempfile 60pct;

.                                 sort spdomain;

.                                 save `60pct', replace;
(note: file /tmp/St02337.000006 not found)
file /tmp/St02337.000006 saved

.                                 use `contpi';

.                                         sort spdomain;

.                                         merge spdomain using `60pct';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.                                         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.                                         drop _merge;

.                                         drop one;

.                                         sort spdomain;

.                                         gen bottom_basket=cons_pc_tpi< pctile_60;

.                                         by spdomain: tab bottom_basket [aw=hhsize*hhweight];

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 217.154212       71.43       71.43
          1 | 86.8457882       28.57      100.00
------------+-----------------------------------
      Total |        304      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 162.297213       30.68       30.68
          1 | 366.702787       69.32      100.00
------------+-----------------------------------
      Total |        529      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |   200.1663       30.99       30.99
          1 |   445.8337       69.01      100.00
------------+-----------------------------------
      Total |        646      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 213.532491       30.81       30.81
          1 | 479.467509       69.19      100.00
------------+-----------------------------------
      Total |        693      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 174.838781       32.68       32.68
          1 | 360.161219       67.32      100.00
------------+-----------------------------------
      Total |        535      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = .

bottom_bask |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          7      100.00      100.00
------------+-----------------------------------
      Total |          7      100.00


.                                         lab var bottom_basket "=1 if in bottom (60%) of PCE";

.                                         sort hhid;

.                                                                 save "$path/work/bottom_basket.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/bottom_basket.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/bottom_basket.dta saved

.         restore;

.         sort hhid;

.         merge hhid using "$path/work/bottom_basket.dta";
variable hhid does not uniquely identify observations in the master data
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        319        1.22        1.22
          3 |     25,773       98.78      100.00
------------+-----------------------------------
      Total |     26,092      100.00

.         drop _merge;

.                         * Only keep price observations for the poor ;
.         keep if bottom_basket==1;
(9978 observations deleted)

.         **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * for each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
(56 missing values generated)

.                 egen lower5=pctile(hhppkg), p(5) by(spdomain product);
(56 missing values generated)

.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
(56 missing values generated)

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        hhid |     16114    4.29e+10    2.24e+11   1.01e+09   2.32e+12
     product |     16058    131.1113    15.78549        101        171
    quantity |     16058    .5736999    1.048957   .0071429   34.28571
       value |     16058    408.0044     606.284   2.857143   10285.71
        unit |     16058           1           0          1          1
-------------+--------------------------------------------------------
    food_cat |     16058           1           0          1          1
       count |     16058           1           0          1          1
    descript |     16058           1           0          1          1
      numreg |     16058    3.728858     1.30724          1          5
    survquar |     16114    2.437197    1.092476          1          4
-------------+--------------------------------------------------------
     reg_tpi |     16114    2.322328    1.060154          1          4
    spdomain |     16114    3.260022    1.160665          1          5
    tpi_trim |     16114    .9148665    .1034583   .7488575   1.185341
     value_r |     16058    445.8989     656.778   3.668811   11975.82
 cons_pc_nom |     16114    1136.326    523.1695          0   3796.331
-------------+--------------------------------------------------------
    hhweight |     16114    2054.267     1543.94   308.1181   8736.727
        bswt |     16114           1           0          1          1
      hhsize |     16114    7.670163    3.205511          1         29
 cons_hh_nom |     16114    8605.981    5600.623          0      51206
 food_pc_nom |     16114    677.1563    357.7267          0   3616.072
-------------+--------------------------------------------------------
   nf_pc_nom |     16114    459.1693    313.5306          0   2553.836
 food_pc_tpi |     16114    745.3005    394.3738          0   3616.072
 cons_pc_tpi |     16114     1204.47    552.3329          0   3796.331
   pctile_60 |     16114    1988.621     561.186   1604.367   3877.697
bottom_bas~t |     16114           1           0          1          1
-------------+--------------------------------------------------------
      hhppkg |     16058    1419.686     2017.35   3.128083    77609.8
      lower5 |     16058    523.3717     835.048   20.85389   6420.419
      upper5 |     16058    2880.575    2765.386   84.36391   38522.51

. describe;

Contains data from /tmp/St02337.000001
  obs:        16,114                          HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 +
                                                T6AEQ3)
 vars:            28                          8 Jul 2013 20:15
 size:     1,949,794                          (_dta has notes)
--------------------------------------------------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
--------------------------------------------------------------------------------------------------------------------------
hhid            double %10.0g                 household id
product         float  %39.0g      itmds      Food product code: numerical
quantity        float  %9.0g                  daily household food consumption
value           float  %9.0g                  daily value of consumption in UGX per per household
unit            float  %9.0g                  set equal to one since all observations are converted into kg
food_cat        float  %9.0g                  food category equals 1, if product is food and 0 if non food
count           float  %9.0g                  
descript        float  %9.0g       descrip    product description including product code but equals 2 for all non-foods
numreg          double %9.0g                  number of goods in the basket
survquar        float  %14.0g      lsurvquar
                                              Sequential Survey Quarter (Oct-Dec 10 = 1)
reg_tpi         byte   %24.0g      lbreg      Regions used for temporal price index calculations
spdomain        float  %13.0g      lspdomain
                                              Spatial domains: each with own poverty line (they are 5)
tpi_trim        float  %9.0g                  TRIMMED Temporal price index (Q4=1)
value_r         float  %9.0g                  
cons_pc_nom     float  %9.0g                  
hhweight        float  %9.0g                  Household sample weight
bswt            float  %9.0g                  bootstrap weights; and all equal to 1 for all households, as a toolkit
                                                requireme
hhsize          long   %9.0g                  number of household menbers
cons_hh_nom     double %9.0g                  (sum) cod_hh_nom
food_pc_nom     float  %9.0g                  nominal food consumption per capita
nf_pc_nom       float  %9.0g                  nominal non-food consumption per capita
food_pc_tpi     float  %9.0g                  Temp-adjusted per capita food consumption/day
cons_pc_tpi     float  %9.0g                  Temp adjusted total consumption/day
pctile_60       float  %9.0g                  (p 70) cons_pc_tpi
bottom_basket   float  %9.0g                  =1 if in bottom (60%) of PCE
hhppkg          float  %9.0g                  
lower5          float  %9.0g                  
upper5          float  %9.0g                  
--------------------------------------------------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

. keep if hhppkg-lower5>=0 & hhppkg-upper5<=0;
(1294 observations deleted)

. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_unitw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_unitt. Last we take the median, price_unitm. But in the end
> * we only use price_unitw
> *********************************************************************;
.         gen price_unitt=value_r/(quantity*1000);

.         gen price_unitm=price_unitt;

.                 *CA modified to count the boot sample weight bswt;
.         collapse (sum) quantity value_r count bswt 
>                  (mean) price_unitt 
>                  (median) price_unitm [aw=hhweight], by(spdomain product);

.         *Generate weighted price per gram ;
.         gen price_unitw=value_r/(quantity*1000);

.         drop value_r quantity;

.         sort spdomain product;

.         lab var price_unitt "simple average of calculated prices - transaction weighted";

.         lab var price_unitm "median of prices";

.         lab var price_unitw "value share weighted mean prices";

. * Get an idea of the difference between the price measures;
.         gen ratiotw=price_unitt/price_unitw;

.         gen ratiomw=price_unitm/price_unitw;

.         sum ratiotw ratiomw;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     ratiotw |       189    1.258554    .4945715   .5507623   3.923727
     ratiomw |       189    1.078488    .5008593   .2610922   5.840994

.         sort product;

.         merge product using "$path/work/codes_food_basket_flex.dta";
variable product does not uniquely identify observations in the master data

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.56        1.56
          3 |        189       98.44      100.00
------------+-----------------------------------
      Total |        192      100.00

.         count if _merge~=3;
    3

.         drop if _merge~=3;
(3 observations deleted)

.         drop _merge;

.         sort product spdomain;

. save "$path/work/price_unit_flex.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex.dta saved

. ****************************************************************************************
> * 110_price_unit_flex.do                (end)
> ****************************************************************************************;
. cap log close;

. 
end of do-file

. do "$path/new/120_povline_food_flex_original.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/120_povline_food_flex.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/120_povline_food_flex.log
  log type:  text
 opened on:   8 Jul 2013, 20:15:49

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 120_povline_food_flex.do      (start)
> *
> * Use the file with the food basket (food_basket_flex), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information.
> **************************************************************************;
. /*
> This file uses:
>         work/food_basket_flex.dta
>         work/price_unit_flex.dta
>         work/calperg.dta
>         work/calpp.dta
> 
> This file creates:
>         work/povline_flex.dta
> */
> 
> 
> * start with the quantity information;
. use "$path/work/food_basket_flex.dta";

.         sort product spdomain;

.         * merge in price information;
.         merge product spdomain using "$path/work/price_unit_flex.dta";
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         12        5.97        5.97
          2 |         77       38.31       44.28
          3 |        112       55.72      100.00
------------+-----------------------------------
      Total |        201      100.00

.         list product spdomain descript if _merge==1;

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
111. |     157   Central Urban          1 |
112. |     157   Central Rural          1 |
113. |     157         Eastern          1 |
114. |     157        Northern          1 |
115. |     157         Western          1 |
     |------------------------------------|
118. |     999   Central Urban          2 |
119. |     999   Central Rural          2 |
120. |     999         Eastern          2 |
121. |     999        Northern          2 |
122. |     999         Western          2 |
     |------------------------------------|
123. |       .   Central Urban          1 |
124. |       .   Central Rural          1 |
     +------------------------------------+

.         drop if _merge ~=3;
(89 observations deleted)

.         drop _merge;

.         sort product;

.         * merge in information on calories per gram;
.         merge product using "$path/work/calperg.dta";
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          2        1.45        1.45
          2 |         26       18.84       20.29
          3 |        110       79.71      100.00
------------+-----------------------------------
      Total |        138      100.00

.         * This tells where we are lacking calorie info or are lacking quantity info due to 
>         * missing price info above;
.         list product spdomain descript if _merge==1;

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
111. |     166         Western          1 |
112. |     171   Central Rural          1 |
     +------------------------------------+

.         drop if _merge~=3;
(28 observations deleted)

.         drop _merge;

.         sort spdomain f_share_w;

.                 * CA modified to handle bootstrap counting;
.         * determine if any quantity has fewer than 10 price observations;
.         by spdomain: count if round(bswt)<10;

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    2
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

.         drop if round(bswt) < 10;
(2 observations deleted)

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: gen cumshr1=sum(f_share_w);

.         * bundle was cut at 92.5 percent- cut back to 90 percent if necessary;
.         drop if cumshr1<=baskshr-.9;
(0 observations deleted)

.         * reobtain the share represented from the average basket- should be slightly more than 90;
.         drop baskshr;

.         by spdomain: egen baskshr=sum(f_share_w);

.         by spdomain: sum baskshr;

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        19    .4246981           0   .4246981   .4246981

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        21    .4414165           0   .4414165   .4414165

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        25    .5149055           0   .5149055   .5149055

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        26    .4605806           0   .4605806   .4605806

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     baskshr |        17    .4971784           0   .4971784   .4971784


.         * obtain quantities and calories provided by these quantities;
.         gen quan=f_share_w/price_unitw;

.                         /* how many g in 1 MT exp on food item */
>         gen cal_ir=quan*calperg;

.                                 /* how many cal in 1 MT exp on food item */
>         by spdomain: egen calreg=sum(cal_ir);

.         /* how many cal in 1 MT exp in food basket*/
> 
>         * merge in calorie requirements;
.         sort spdomain;

.         merge spdomain using "$path/work/calpp.dta";
variable spdomain does not uniquely identify observations in the master data

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.92        0.92
          3 |        108       99.08      100.00
------------+-----------------------------------
      Total |        109      100.00

.         drop _merge;

.         * get the expansion factor to hit 95% of calorie requirements;
.         gen ratio=.95*calpp/calreg;
(1 missing value generated)

.                         replace quan=quan*ratio;
(108 real changes made)

.         replace cal_ir=quan*calperg;
(105 real changes made)

.         * do a consistency check;
.         sort spdomain;

.         by spdomain: egen chkcal=sum(cal_ir);

.         replace chkcal=chkcal/.95-calpp ;
(109 real changes made)

.                         * these values should be about zero;
.         by spdomain: sum chkcal;

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        19   -.0000578           0  -.0000578  -.0000578

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        21   -.0000385           0  -.0000385  -.0000385

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        25   -.0000257           0  -.0000257  -.0000257

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        26   -.0000964           0  -.0000964  -.0000964

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |        17    .0000578           0   .0000578   .0000578

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = .

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      chkcal |         1   -1346.905           .  -1346.905  -1346.905


.         * obtain the value of each good in the bundle;
.         gen val_ir=quan*price_unitw;
(1 missing value generated)

.         * the sum of the value of the goods in the bundle is assumed to represent 90% of expenditure;
.         by spdomain: egen povline_f_flex90=sum(val_ir);

.         replace povline_f_flex=povline_f_flex90/.9;
(108 real changes made)

.         collapse (mean) povline_f_flex, by (spdomain);

.                 lab var povline_f_flex "Food poverty line. Flexible basket";

.         sort spdomain;

.         keep spdomain povline_f_flex;

. save "$path/work/povline_food_flex.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex.dta saved

. /*
> * To be used in 140_iterate.do;
> gen cutoff = 1.5 * povline_f_flex;
> keep spdomain cutoff;
> save "$path/work/povlines_first_iterate.dta", replace;
> */
> 
> **************************************************************************
> * 120_povline_food_flex.do      (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/120_povline_food_flex.log
  log type:  text
 closed on:   8 Jul 2013, 20:15:49
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/130_povmeas_flex.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/130_povmeas_flex.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/130_povmeas_flex.log
  log type:  text
 opened on:   8 Jul 2013, 20:15:58

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 130_povmeas_flex.do           (start)
> *
> * Purpose:
> * Initial poverty measures calculation for flexible basket. (Before any iteration)
> **************************************************************************;
. *CA modified to add work/hhdata.dta for bootstrap;
. /*
> This file uses:
>         in/foodshr96.dta
>         work/povline_f_flex.dta
>         work/consump_nom.dta
>         work/hhdata.dta
>         work/temp_index_reg_tpi.dta
> 
> This file creates:
>         work/foodshr96.dta
>         work/povmeas.dta
>         work/povlines.dta
>         work/cons_real.dta
> */
> 
> 
> 
> **************************************************************************;
. * Bring in data file with nominal consumption per capita, and deflate it
> * by temporal price index.
> **************************************************************************;
. use "$path/work/hhdata.dta", clear;
(Household master record (1 record per household))

.         keep hhid strata reg_tpi spdomain news rural survmon survquar;

.         tab reg_tpi, miss;

    Regions |
   used for |
   temporal |
price index |
calculation |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
    Kampala |        184        6.77        6.77
    Central |        657       24.19       30.96
    Eastern |        647       23.82       54.79
   Northern |        693       25.52       80.30
    Western |        535       19.70      100.00
------------+-----------------------------------
      Total |      2,716      100.00

.         tab survquar, miss;

    Sequential |
Survey Quarter |
 (Oct-Dec 10 = |
            1) |      Freq.     Percent        Cum.
---------------+-----------------------------------
    Oct-Dec 10 |        690       25.41       25.41
   Jan-Marc 11 |        692       25.48       50.88
   Apr-June 11 |        676       24.89       75.77
July-Sept 2011 |        610       22.46       98.23
             . |         48        1.77      100.00
---------------+-----------------------------------
         Total |      2,716      100.00

.         keep hhid spdomain reg_tpi survquar;

.         sort hhid;

.         tempfile spdomainreg_tpi;

. save `spdomainreg_tpi', replace;
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved

. use "$path/work/conpc.dta", clear;

. *use "$path/work/consump_nom.dta", clear;
. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;

.     merge hhid using "$path/work/hhdata.dta";

.     tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.     drop _m;

.         keep hhid hhweight hhsize cons_pc_nom ;

.         sort hhid;

.         merge hhid using `spdomainreg_tpi';
(label lbreg already defined)
(label lsurvquar already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225        8.28        8.28
          3 |      2,492       91.72      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort hhid;

.         merge hhid using "$path/work/conpc.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         gen food_pc_tpi  = food_pc_nom /tpi_trim;
(225 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.                 gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(225 missing values generated)

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         gen one=1;

. * TPI deflated per capita consumption ;
.         tempfile contpi;

. save `contpi', replace;
(note: file /tmp/St02337.000002 not found)
file /tmp/St02337.000002 saved

. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povline_food_flex.dta";
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

. gen     triwt = 0 ;

. replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex-1)+0.5)
>                 if abs(cons_pc_tpi/povline_f_flex-1)<=0.2;
(74 real changes made)

.                                         * Nearness to poverty line and population weights ;
.         gen tripopwt=triwt*hhweight*hhsize;
(3 missing values generated)

.         preserve;

.                 collapse (mean) nf_pc_nom [aw=tripopwt] ,
>                         by(spdomain);

.                                         rename nf_pc_nom povline_na_flex;

.                 lab var povline_na_flex "Nonfood poverty line. Flexible bundle";

.                                 tempfile znf;

.                 sort spdomain;

.                 save `znf', replace;
(note: file /tmp/St02337.000004 not found)
file /tmp/St02337.000004 saved

.                 tab spdomain;

      Spatial |
domains: each |
     with own |
 poverty line |
 (they are 5) |      Freq.     Percent        Cum.
--------------+-----------------------------------
Central Urban |          1       20.00       20.00
Central Rural |          1       20.00       40.00
      Eastern |          1       20.00       60.00
     Northern |          1       20.00       80.00
      Western |          1       20.00      100.00
--------------+-----------------------------------
        Total |          5      100.00

.         restore;

.         sort spdomain;

.         merge spdomain using `znf';
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          9        0.33        0.33
          3 |      2,708       99.67      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

. **************************************************************************;
. * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.         gen povline_flex=povline_f_flex + povline_na_flex;
(9 missing values generated)

.         lab var povline_flex "Poverty line. Flexible bundle";

.         sort spdomain;

. save "$path/work/povlines.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines.dta saved

. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
. use `contpi';

.         sort spdomain;

.         merge spdomain using "$path/work/povlines.dta";
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines.dta
(label lbreg already defined)
(label lsurvquar already defined)
(label lspdomain already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         * Real consumption pc, temporally deflated ;
.         gen cr= cons_pc_tpi ;
(225 missing values generated)

.         * Poverty line;
.         gen linpob=povline_flex;
(9 missing values generated)

.         *qui sum linpob if spdomain==1, meanonly;
.         sum linpob if spdomain==3, meanonly;

.         global spi_base=r(mean);

.         * Spatial price index ;
.         gen spi=linpob/$spi_base;
(9 missing values generated)

.         * Real consumption pc, temporally and spatially deflated ;
.         gen cr2=cr/spi;
(225 missing values generated)

.         qui sum cr [aw=hhweight*hhsize];

.         global sumcr=r(sum);

.         qui sum cr2 [aw=hhweight*hhsize];

.         global sumcr2=r(sum);

.         replace spi=spi*$sumcr2/$sumcr;
(2708 real changes made)

.         gen linpobr=linpob/spi;
(9 missing values generated)

.         replace cr2=cr/spi;
(2482 real changes made)

.         sum cr cr2 linpob linpobr [aw=hhweight*hhsize];

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
         cr2 |    2492  34690902.7    1990.349   6430.098          0   316343.8
      linpob |    2707    37257099    529.7761   132.8003   406.6796   692.5283
     linpobr |    2707    37257099    509.5302   .0000117   509.5302   509.5302

.         lab var cr      "Temporally-adjusted cons pc";

.         lab var cr2     "Spatially & temporally adjusted cons pc";

.         lab var linpob  "Poverty line";

.         lab var linpobr "Real poverty line";

.         lab var spi     "Spatial price index";

. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.         gen h = 100     if cr <=(linpob);
(2498 missing values generated)

.         replace  h = 0 if cr > (linpob);
(2498 real changes made)

.                         gen             pg      = ((linpob - cr )/linpob) *100;
(225 missing values generated)

.         replace         pg      = 0             if h==0;
(2498 real changes made)

.         gen             spg     = ((( linpob - cr )/ linpob )^2)*100;
(225 missing values generated)

.         replace         spg     = 0             if h==0;
(2498 real changes made)

.         gen h_flex=h;

.         gen pg_flex=pg;
(9 missing values generated)

.         gen spg_flex=spg;
(9 missing values generated)

.         lab var h_flex   "Poverty headcount. Flex bundle";

.         lab var pg_flex  "Poverty gap. Flex bundle";

.         lab var spg_flex "Squared poverty gap. Flex bundle";

.         sort hhid;

.         merge hhid using "$path/work/hhdata.dta";
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop if _merge~=3;
(1 observation deleted)

.         drop _merge;

.         gen popwt=hhsize*hhweight;
(2 missing values generated)

.                 * Stata 10.1 syntax ;
.         svyset , clear;

.         svyset [pweight=popwt] , str(strata) psu(psu);

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>

.         svy: mean h_flex pg_flex spg_flex;
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      h_flex |    8.76186   .8600683      7.070502    10.45322
     pg_flex |    3.32818   .5097187      2.325799    4.330562
    spg_flex |   2.188254   .4528251      1.297756    3.078753
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(rural);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
           0 |   2.347801   .7653406      .8427293    3.852873
           1 |    9.90916    1.00198      7.938727    11.87959
-------------+------------------------------------------------
pg_flex      |
           0 |   1.062615   .5288138      .0226822    2.102548
           1 |   3.733428   .5920856      2.569069    4.897787
-------------+------------------------------------------------
spg_flex     |
           0 |    .786894   .4957461       -.18801    1.761798
           1 |    2.43892   .5255589      1.405388    3.472452
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(news);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

      Central: news = Central
      Eastern: news = Eastern
     Northern: news = Northern
      Western: news = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Central |   8.777579   1.852652      5.134266    12.42089
     Eastern |   2.378509    .654105      1.092186    3.664831
    Northern |   6.334718     1.6445      3.100744    9.568692
     Western |   17.77789   2.283348       13.2876    22.26818
-------------+------------------------------------------------
pg_flex      |
     Central |   5.537216   1.608617      2.373808    8.700625
     Eastern |   .8312819     .31287      .2160109    1.446553
    Northern |    1.48846   .4796829      .5451449    2.431775
     Western |   5.222359   .8576244      3.535807     6.90891
-------------+------------------------------------------------
spg_flex     |
     Central |    4.57504   1.490075      1.644751     7.50533
     Eastern |   .3811335   .1689075      .0489703    .7132967
    Northern |    .540163   .2058027      .1354441    .9448819
     Western |   2.973454   .7168449      1.563751    4.383158
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(reg_tpi);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

      Kampala: reg_tpi = Kampala
      Central: reg_tpi = Central
      Eastern: reg_tpi = Eastern
     Northern: reg_tpi = Northern
      Western: reg_tpi = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Kampala |          0  (omitted)
     Central |   10.91161   2.268518      6.450482    15.37274
     Eastern |   2.378509    .654105      1.092186    3.664831
    Northern |   6.334718     1.6445      3.100744    9.568692
     Western |   17.77789   2.283348       13.2876    22.26818
-------------+------------------------------------------------
pg_flex      |
     Kampala |          0  (omitted)
     Central |   6.883441   1.978797       2.99206    10.77482
     Eastern |   .8312819     .31287      .2160109    1.446553
    Northern |    1.48846   .4796829      .5451449    2.431775
     Western |   5.222359   .8576244      3.535807     6.90891
-------------+------------------------------------------------
spg_flex     |
     Kampala |          0  (omitted)
     Central |   5.687338   1.835839      2.077089    9.297587
     Eastern |   .3811335   .1689075      .0489703    .7132967
    Northern |    .540163   .2058027      .1354441    .9448819
     Western |   2.973454   .7168449      1.563751    4.383158
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(strata);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
     Kampala |          0  (omitted)
   _subpop_2 |    3.61226   1.175674      1.300252    5.924269
   _subpop_3 |   12.44266   2.680751       7.17086    17.71446
   _subpop_4 |   2.404409   .7030801      1.021774    3.787043
   _subpop_5 |   6.744711   1.818026      3.169492    10.31993
   _subpop_6 |   18.68904    2.44331      13.88418    23.49391
-------------+------------------------------------------------
pg_flex      |
     Kampala |          0  (omitted)
   _subpop_2 |   1.634909   .8131727      .0357736    3.234045
   _subpop_3 |   7.745786   2.356314      3.112003    12.37957
   _subpop_4 |   .8738779    .338548      .2081101    1.539646
   _subpop_5 |   1.612815   .5331707      .5643144    2.661316
   _subpop_6 |   5.487546   .9198026      3.678718    7.296373
-------------+------------------------------------------------
spg_flex     |
     Kampala |          0  (omitted)
   _subpop_2 |   1.210693   .7625393     -.2888704    2.710256
   _subpop_3 |   6.368603   2.187377       2.06704    10.67017
   _subpop_4 |   .4008593   .1827781      .0414191    .7602994
   _subpop_5 |   .5948952   .2291733       .144217    1.045573
   _subpop_6 |    3.13957     .77015      1.625041      4.6541
--------------------------------------------------------------

.         svy: mean h_flex pg_flex spg_flex , over(spdomain);
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2707
Number of PSUs   =     368        Population size  =  37257099
                                  Design df        =       362

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex       |
   _subpop_1 |    1.70071   1.035329     -.3353047    3.736725
   _subpop_2 |   12.37902   2.668272       7.13176    17.62628
     Eastern |   2.378509    .654105      1.092186    3.664831
    Northern |   6.334718     1.6445      3.100744    9.568692
     Western |   17.77789   2.283348       13.2876    22.26818
-------------+------------------------------------------------
pg_flex      |
   _subpop_1 |   1.275202   .8513672     -.3990443    2.949449
   _subpop_2 |   7.706169      2.345      3.094636     12.3177
     Eastern |   .8312819     .31287      .2160109    1.446553
    Northern |    1.48846   .4796829      .5451449    2.431775
     Western |   5.222359   .8576244      3.535807     6.90891
-------------+------------------------------------------------
spg_flex     |
   _subpop_1 |   1.114679   .8109814     -.4801478    2.709505
   _subpop_2 |    6.33603    2.17677      2.055328    10.61673
     Eastern |   .3811335   .1689075      .0489703    .7132967
    Northern |    .540163   .2058027      .1354441    .9448819
     Western |   2.973454   .7168449      1.563751    4.383158
--------------------------------------------------------------

.         compress;
hhsize was long now byte
survquar was float now byte
spdomain was float now byte
one was float now byte
triwt was float now byte
h was float now byte
h_flex was float now byte
survmon was float now byte
rural was float now byte
news was float now byte
bswt was float now byte

.         sort hhid;

. save "$path/work/cons_real.dta" , replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real.dta saved

.         collapse  (mean) h_flex pg_flex spg_flex [aw=hhweight*hhsize];

. save "$path/work/povmeas.dta", replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povmeas.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povmeas.dta saved

. *** HARUNA, the file Povmeas.dta gives the headcount poverty rates using flexible food bundle without inflicting reveale
> s preferences
> *** therefore specifications in line 226 of this do file have been changed repeatedly to generate these counts for parti
> cular
> *** classifications of interest including strata spdomain region urban/rural (urban) and national (done by removing the 
> by command 
> **************************************************************************
> * 130_povmeas_flex.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/130_povmeas_flex.log
  log type:  text
 closed on:   8 Jul 2013, 20:15:59
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "$path/new/140_iterate_bjorn.do" $it_n $bottom

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/140_iterate.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/140_iterate.log
  log type:  text
 opened on:   8 Jul 2013, 20:16:10

. clear

. set more off

. #delimit ;
delimiter now ;
. *global povline_initial "$path/in/povlines_first_iof.dta";
. **************************************************************************
> * 140_iterate.do        (start)
> *
> * Purpose: Create flexible food basket and poverty line with iterative procedure
> *
> * This program will take the results from the first pass at the
> * poverty lines and applies the corresponding spatial deflator to
> * re-select the relatively poor, their consumption bundles, and
> * their prices.
> *
> * Welfare indicator is here always temporally and spatially adjusted per capita
> * expenditure. Here called cr_it< >.
> *
> * We will iterate this process 5 times which here assures convergence.
> *
> * CA, Mar 2010: Relatively poor are those below last iterated poverty line
> * MAH, Apr 2010: Cleaning
> * URB, feb 2012: Commented out "drop if unit~=2"
> **************************************************************************;
. /*
> This file uses:
>             in/povlines_first_new.dta
>         work/hhdata.dta
>         work/consump_nom.dta
>         work/own.dta
>         work/daily.dta
>         work/temp_index_reg_tpi.dta
>         work/cons_cod.dta
>         work/food_cat.dta
>         work/cons_real.dta
>         work/products.dta
>         work/match96_02.dta
>         new/conversions.do
>         
> This file creates (where `pass' is the number of the iteration):
>         work/codes_food_basket_flex_it`pass'.dta
>         work/price_unit_flex_it`pass'.dta
>         work/quan_flex_it`pass'.dta
>         work/match_cod_flex_it`pass'.csv
>         work/relpoor_it`pass'.dta
>         work/povlines_it`pass'.dta
>         work/foodshares_it`pass'.dta
>         work/nat_pov_flex.csv
>         work/rur_pov_flex.csv
>         work/strata_pov_flex.csv
>         work/spdomain_pov_flex.csv
>         work/reg_tpi_pov_flex.csv
> */
> 
> **************************************************************************;
. * Make a key file that will be used over and over, without change
> * in every iteration. This will include the TEMPORALLY deflated consumption
> * and various HH data such as hhweight, spdomain, etc.
> **************************************************************************;
. use "$path/work/conpc.dta";

.         sort hhid;

.         merg hhid using "$path/work/hhdata.dta";

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.04        0.04
          3 |      2,716       99.96      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.         sort reg_tpi survquar;

.         merge reg_tpi survquar using "$path/work/temp_index_reg_tpi.dta";
variables reg_tpi survquar do not uniquely identify observations in the master data
(label lsurvquar already defined)
(label lbreg already defined)

.         tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225        8.28        8.28
          3 |      2,492       91.72      100.00
------------+-----------------------------------
      Total |      2,717      100.00

.         drop _merge;

.                 gen food_pc_tpi = food_pc_nom /tpi_trim;
(225 missing values generated)

.         gen cons_pc_tpi = food_pc_tpi + nf_pc_nom;
(225 missing values generated)

.         lab var food_pc_tpi "Temp-adjusted per capita food consumption/day";

.         lab var cons_pc_tpi "Temp adjusted total consumption/day";

.         tempfile contpi;

.         sort hhid;

. save `contpi', replace;
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved

. save contpi_, replace;
file contpi_.dta saved

. *use "$path/in/povlines_first_iterate.dta", clear;
. *save "$path/work/povlines_first.dta", replace;
. **************************************************************************;
. * Now set some information pertaining to the iterations. For now we'll
> * manually set the number of iterations. Also specify the percentile
> * cutpoint that we will use for defining the relatively poor.
> **************************************************************************;
. local lastpass=0;

. local pass=1;

. * Use these two lines to manually specify the number of iterations
> * and the cutpoint here in the do file.;
.   *local maxit=5;
.   *local cutpt=50;
. * Use these few lines if you want to specify the number of iterations
> * and percentile cutpoint by passing them as parameters on the command
> * line, e.g.:   wstata do new/iterate1.do 5 50;
. if "`1'"=="" | "`2'"=="" {      ;
.         di in red "Error: you need to specify number of iterations as first parameter";
.         di in red "       and percentile cutpoint as second parameter on command line.";
. };

. local maxit `1';

. local cutpt `2';

. tempfile cutoff;

. di "**********************************************************************";
**********************************************************************

. while `pass' <= `maxit' {;
  2.         **************************************************************************;
. **************************************************************************;
. * Pick out the bottom X percent in real consumption per capita 
> * (temporally & spatially adjusted), as ranked by the previous iteration.
> * The percentile to use is defined by "cutpt". This produces a file that
> * has the hhid, and a dummy variable indicating if they were below the
> * cutpoint on the last iteration.
> **************************************************************************;
. **************************************************************************;
. /*
> * Comment out if IOF 2008/09. (This code included instead of below code in order to replicate published figures 2002/03)
> . ( START ) ;
> 
>         if "`pass'"=="1" {      ;
>               use `contpi', clear;
>               sort spdomain;
>               merge spdomain using "$path/work/povlines_first.dta";
>               tab _m;
>               drop _m;
> *              gen relpoor`pass'= cons_pc_tpi<=cutoff;
>                gen relpoor`pass'= cons_pc_tpi if cons_pc_tpi<=cutoff;
>               rename cons_pc_tpi cr_it0;
>               sort hhid;
>          save "$path/work/relpoor_it`pass'.dta", replace;
> *        use "$path/work/cons_real.dta", clear;
> *              gen cr_it0=cr2;
>         };
>         
> 
> * Comment out if IOF 2008/09. (This code included instead of below code in order to replicate published figures 2002/03)
> . ( END ) ;
> */
> 
> 
> 
> * Comment out if IAF 2002/03. (This code below excluded in order to replicate published figures 2002/03). ( START ) ;
.         if "`pass'"=="1" { ;
  3. * Find real income at cut point initially;
.                 use "$path/work/cons_real.dta", clear;
  4.                                     gen cr_it0=cr2;
  5.                         cap drop one;
  6.             gen one=1;
  7.                                     collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
  8.                                     rename cr_it`lastpass' cutoff;
  9.                                     sort one;
 10.             save `cutoff', replace;
 11.             save cutoff, replace;
 12.  * Find relatively poor initially;
.             use "$path/work/cons_real.dta", clear;
 13.                                                 gen cr_it`lastpass'=cr2;
 14.             cap drop one;
 15.             cap drop cutoff;
 16.             gen one=1;
 17.                                     sort one;
 18.             merge one using `cutoff';
 19.             tab _merge;
 20.             drop _merge;
 21.                                     drop one;
 22.                            gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 23.             *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                     tab relpoor`pass' [aw=popwt];
 24.                                     keep hhid cr_it`lastpass' relpoor`pass' popwt;
 25.             sort hhid;
 26.         save "$path/work/relpoor_it`pass'.dta", replace;
 27.         };
 28. * Comment out if IAF 2002/03. (This code below excluded in order to replicate published figures 2002/03). ( END ) ;
.                 if `pass'>1 {   ;
 29. * Find real income at cut point in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta" , clear;
 30.                                                 cap drop one;
 31.                 gen one=1;
 32.                                                                 *CA modified from hhweight*hhsize to popwt;
.                 collapse (p`cutpt') one cr_it`lastpass' [aw=popwt] ;
 33.                         rename cr_it`lastpass' cutoff;
 34.                                                                         sort one;
 35.         save `cutoff', replace;
 36.         * Find relatively poor in iteration number `pass' ;
.                 use "$path/work/cons_real_it`lastpass'.dta", clear;
 37.                                                 cap drop one;
 38.                 gen one=1;
 39.                                                 sort one;
 40.                 merge one using `cutoff';
 41.                 tab _merge;
 42.                 drop _merge;
 43.                                                 drop one;
 44.                 gen relpoor`pass'=cr_it`lastpass'<=cutoff;
 45.                 *lab var relpoor`pass' "=1 if in bottom of PCE";
.                                                 tab relpoor`pass' [aw=popwt];
 46. *CA modified to popwt above and to keep popwt below;
.                 keep hhid cr_it`lastpass' relpoor`pass' popwt;
 47.                 sort hhid;
 48.         save "$path/work/relpoor_it`pass'.dta", replace;
 49.         };
 50.         **************************************************************************;
. * Get the consumption file, and select only those codes that are food,
> * using our definition of "food", which includes alcoholic beverages.
> **************************************************************************;
.         use "$path/work/cons_cod.dta", clear;
 51. *CA modified to merge in work/hhdata.dta for bootstrap;
.     sort hhid;
 52.     merge hhid using "$path/work/hhdata.dta";
 53.     tab _m;
 54.     drop _m;
 55.         /*
>                 sort product;
>                 merge product using "$path/work/food_cat.dta";
>                 tab _merge;
>                 keep if _merge==3;
>                 drop _merge;
> */
> 
>                                 * Only food transactions ;
.                 keep if food_cat==1;
 56.                 sort hhid;
 57. **************************************************************************;
. * Merge with file that has temporally AND spatially adjusted consumption
> * per capita from the previous iteration, and also identifies those below 
> * the cutoff. Then select only those who are below the cutoff.
> **************************************************************************;
.                 merge hhid using "$path/work/relpoor_it`pass'.dta";
 58.                 tab _merge;
 59.                 drop _merge;
 60.                                 * Keep only transactions by the poor ;
.                 keep if relpoor`pass';
 61. **************************************************************************;
. * Calculate HH level food shares. Since we're only doing shares here, we can
> * work with the expenditures without doing temporal adjustment.
> **************************************************************************;
.                 gen  food_expenditure = cod_hh_nom;
 62.                 *gen  food_expenditure= own_valued + daily_valued + monthly_valued + educ_valued;
.                 egen tot_food_expen= sum (food_expen), by (hhid) ;
 63.                 count if food_expenditure==.;
 64.                 count if tot_food_expen==.;
 65.                 gen food_share= food_expenditure/tot_food_expen;
 66.                 count if food_share==.;
 67.                 drop if food_share==.;
 68.                 sort hhid product;
 69.                 tempfile foodshares;
 70.         save `foodshares', replace;
 71. ********************************************************************************;
. * Now find the total (economy wise, e.g. not by HH) shares by each product in
> * order to select the most important goods in each domain's basket.
> ********************************************************************************;
.                 collapse (mean) hhweight spdomain, by (hhid);
 72.                 sort hhid ;
 73.                  collapse (sum) hhweight , by(spdomain);
 74.                 rename hhweight tothhweight;
 75.                 tempfile tothhweight;
 76.                 sort spdomain;
 77.         save `tothhweight', replace;
 78.         use `foodshares', clear;
 79.                 sort spdomain;
 80.                 merge spdomain using `tothhweight';
 81.                 tab _merge;
 82.                 drop _merge;
 83.                 sort spdomain product;
 84.                 gen f_share_w`pass'=(food_share*hhweight)/tothhweight;
 85.                 collapse (sum) f_share_w`pass', by(spdomain product descript);
 86.                                sort spdomain f_share_w`pass';
 87.                 by spdomain: gen cumshr`pass'= sum(f_share_w`pass');
 88.                 count if cumshr`pass'<=.075;
 89.                 drop if cumshr`pass'<=.075;
 90.                 lab var f_share_w`pass' "average food share for the 13 spatial domains";
 91.         save `foodshares', replace;
 92.                                                 * Number of spatials domains a food product appears ;
.                 gen numreg=1;
 93.                 collapse (sum) numreg cumshr`pass', by (product descript);
 94.                 keep product numreg descript;
 95.                 display _N;
 96.                 sort product;
 97.                                 * Include food product labels ;
. *                merge product using "$path/work/products.dta";
. *                tab _merge;
. *                keep if _merge==3;
.                 keep product descript numreg;
 98.                   sort product;
 99.                      display _N;
100.           save "$path/work/codes_food_basket_flex_it`pass'.dta", replace;
101. **************************************************************************;
. **************************************************************************;
. * That is pretty much the part equivalent to "100_food_basket_flex.do",
> * which figures out the food shares for the relevant reference group. Now
> * we figure out the prices with a code stream that is adapted from
> * "110_price_unit_flex.do".
> **************************************************************************;
. **************************************************************************;
. **************************************************************************************
> * Create sorted data set with daily + own expenditure and the matched codes
> **************************************************************************************;
. use "$path/in/cons_cod_trans.dta", clear;
102. *save "$path/work/cons_cod_trans.dta", replace;
. *drop value   ;
. *drop quantity;
. keep hhid product food_cat valuez quantityz unit;
103. rename valuez    value;
104. rename quantityz quantity;
105. *drop count;
. drop if quantity==0 ;
106.         tempfile dd_acsort;
107.         save    `dd_acsort', replace;
108. /*
>         use "$path/work/daily.dta", clear;
>                 drop days;
>                 sort product;
>                 tempfile dd_acsort;
>         save `dd_acsort', replace;
>         
>         use "$path/work/own.dta", clear;
>                 keep hhid product valued quantityd unit;
>                 rename valued value;
>                 rename quantityd quantity;
>         
>                 *CHECK THE ZEROS IN quantity FOR NOW DELETE;
>                 drop if quantity==0;
>         
>                 append using `dd_acsort';
> */
> 
>                 *CA modified to insert work/hhdata.dta for bootstrap;
.                 sort hhid;
109.                 merge hhid using "$path/work/hhdata.dta";
110.                 tab _m;
111.                  drop if _m==2;
112.                 drop _m;
113.                                 sort product;
114.                 gen count=1;
115.         save `dd_acsort', replace;
116.         **************************************************************************;
. * Merge the basket codes with the dd  and own data sets.
> * Drop all codes not a part of the flexible food basket
> **************************************************************************;
.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.dta";
117.                         tab _merge;
118.                 drop if _merge~=3;
119.                 drop _merge;
120. **************************************************************************************
> * Drop observations where product code, quantity or value information is unavailable
> **************************************************************************************;
.                 drop if product==. | value==. | quantity==.  ;
121.         **************************************************************************************
> * Convert non-KG quantities (units, liters) into kilograms
> **************************************************************************************;
. *do "$path/new/110a_conversions.do"
> 
> ********************************************************************
> * There remain a few difficult to interpret observations such as liters
> * of fish and liters of pasta. These are dropped.
> ********************************************************************;
. *                $MZ drop if unit~=2;
.         **************************************************************************;
. * Bring in the spdomain and reg_tpi variables, and also the information on
> * relatively poor households.
> **************************************************************************;
.                 preserve;
122.                                                 * Temporally adjusted expenditure ;
.                         use `contpi', clear;
123.                                 keep hhid hhweight spdomain reg_tpi survquar tpi_trim cons_pc_tpi ;
124.                                 sort hhid;
125.                                 tempfile hhd2;
126.                         save `hhd2', replace;
127.                 restore;
128.                                 compress;
129.                 sort hhid;
130.                 merge hhid using `hhd2';
131.                 tab _merge;
132.                 drop _merge;
133.                 sort hhid;
134.                 merge hhid using "$path/work/relpoor_it`pass'.dta";
135.                 tab _merge;
136.                 drop _merge;
137.                                                 * Keep nominal food transactions by poor people ;
.                 keep if relpoor`pass';
138.                 drop if product==.;
139.                                                                 * Temporally deflate transaction values ;
.                 gen value_r=value/tpi_trim;
140. **************************************************************************;
. * Toss out the bottom 5% and top 5% of the HH-LEVEL prices per kg in
> * each spdomain & product combination. This should eliminate outliers
> * that may have an undue influence on the price calculation. 
> **************************************************************************;
.                 gen hhppkg=value_r/quantity;
141.                 egen lower5=pctile(hhppkg), p(5)  by(spdomain product);
142.                 egen upper5=pctile(hhppkg), p(95) by(spdomain product);
143.                 keep if hhppkg>=lower5 & hhppkg<=upper5;
144. *********************************************************************
> * Note that we do prices in three ways. First, by summing quantity and value 
> * This average price price_uw is thus quantity/value weighted. Second, we
> * calculate the price and take simple means for a transaction weighted
> * price, price_ut. Last we take the median, price_um. But in the end
> * we only use price_unitw
> *********************************************************************;
.                 gen price_ut`pass'=value_r/(quantity*1000);
145.                 gen price_um`pass'=price_ut;
146.                 collapse (sum) 
>                         quantity value_r count bswt (mean) price_ut (median) price_um [aw=hhweight], 
>                         by(spdomain product);
147.                 *Generate weighted price per gram ;
.                 gen price_uw`pass'=value_r/(quantity*1000);
148.                 drop value_r quantity;
149.                 sort spdomain product;
150.                 lab var price_ut`pass' "Average of calculated prices - transaction weighted";
151.                 lab var price_um`pass' "Median of prices";
152.                 lab var price_uw`pass' "Value share weighted mean prices";
153. * Get an idea of the difference between the price measures;
.                 gen ratiotw`pass'=price_ut`pass'/price_uw`pass';
154.                 gen ratiomw`pass'=price_um`pass'/price_uw`pass';
155.                 sum ratiotw`pass' ratiomw`pass';
156.                 sort product;
157.                 merge product using "$path/work/codes_food_basket_flex_it`pass'.dta";
158.                 tab _m;
159.                 count if _merge~=3;
160.                 drop if _merge~=3;
161.                 drop _merge;
162.                 sort product spdomain;
163.         save "$path/work/price_unit_flex_it`pass'.dta", replace;
164. **************************************************************************;
. **************************************************************************;
. * That concludes the prices part. Now we move to calculating the food
> * poverty lines, which draws code from "120_povline_flex.do" with very few
> * changes:
> * - The changes facilitate accumulating vectors
> *   of intermediate results across iterations, rather than generating a
> *   bunch of new files.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************;
. * Use the file with the food basket (`foodshares'), which is in shares. 
> * Then merge it with the prices file, and then with the calories file.
> * Along the way, drop those observations where we have no price information
> * or no calorie information, but list them out.
> **************************************************************************;
.         use `foodshares', clear;
165.                 sort product spdomain;
166.                 merge product spdomain using "$path/work/price_unit_flex_it`pass'.dta";
167.                         tab _merge;
168.                 list product spdomain descript if _merge==1;
169.                         drop if _merge ~=3;
170.                 drop _merge;
171.                 sort product;
172.                         merge product using "$path/work/calperg.dta";
173.                 tab _merge;
174.                                                 * This tells where we are lacking calorie info or are lacking quantit
> y info due to 
>                 * missing price info above;
.                 list product spdomain descript if _merge==1;
175.                         drop if _merge~=3;
176.                 drop _merge;
177.                 sort spdomain f_share_w`pass';
178.                                 *CA modified to change count bswt;
.                 by spdomain: count if round(bswt)<10;
179.                                 sum bswt;
180.                                                 drop if round(bswt) < 10;
181.                                                                 * Total food share in spatial domain ;
.                 by spdomain: egen baskshr=sum(f_share_w`pass');
182.                                 * Cumulated food share in spatial domain ;
.                 by spdomain: gen  cumshr =sum(f_share_w`pass');
183.                 drop if cumshr<=baskshr-.9;
184.                         drop baskshr;
185.                 by spdomain: egen baskshr=sum(f_share_w`pass');
186.                 tabstat baskshr , by(spdomain) st(n mean sd min max);
187.                                                                 * How many grams in 1 MT exp on food item ;
.                                 gen quan`pass'=f_share_w`pass'/price_uw`pass';
188.                                 * How many calories in 1 MT exp on food item ;
.                 gen cal_ir`pass'=quan`pass'*calperg;
189.                                 * how many calories in 1 MT exp in food basket ;
.                 by spdomain: egen calreg=sum(cal_ir);
190.                         sort spdomain;
191.                 merge spdomain using "$path/work/calpp.dta";
192.                 tab _merge;
193.                 drop _merge;
194.                                                         * get the expansion factor to hit 95% of calorie requirements
>  ;
.                 gen ratio=.95*calpp/calreg;
195.                         replace quan`pass'=quan`pass'*ratio;
196.                 replace cal_ir`pass'=quan`pass'*calperg;
197.                         sort spdomain product;
198.                 by spdomain: egen chkcal=sum(cal_ir`pass');
199.                 replace chkcal=chkcal/.95-calpp ;
200.                                                 tabstat chkcal , by(spdomain) st(n mean sd min max);
201.                         gen val_ir`pass'=quan`pass'*price_uw`pass';
202.                         by spdomain: egen povline_f_flex90_`pass'=sum(val_ir`pass');
203.                 replace povline_f=povline_f_flex90_`pass'/.9;
204.                 *drop product96;
. keep product spdomain quan`pass'  price_uw`pass' val_ir`pass' povline_f_flex90_`pass' calpp calperg;
205.                     save "$path/work/quan_flex_it`pass'.dta", replace;
206.                         collapse (mean) povline_f_flex90_`pass', by (spdomain);
207.                                                 keep spdomain povline_f_flex90_`pass';
208.                 sort spdomain;
209.                 save "$path/work/povline_food_flex_it`pass'.dta", replace;
210.         **************************************************************************;
. **************************************************************************;
. * Now comes the part that draws the non-food and total poverty lines,
> * and generates estimates of poverty measures. This is drawn from 
> * "130_povmeas_flex.do" with a few changes.
> **************************************************************************;
. **************************************************************************;
. **************************************************************************
> * Calculate non-food expenditure for HH around the food poverty line
> *
> * Develop a discrete triangular weighted distribution. This gives a
> * weight of  1 to HH at +/- 18-20% from food poverty line, and
> * weight of  2 to HH at +/- 16-18% from food poverty line, and ...
> * weight of 10 to HH at +/-  0- 2% from food poverty line.
> * This weight is called triwt below.
> **************************************************************************;
.         use `contpi', clear;
211.                 sort spdomain;
212.                 merge spdomain using "$path/work/povline_food_flex_it`pass'.dta";
213.                 tab _merge;
214.                 drop _merge;
215.                 gen triwt=0;
216.                 replace triwt = 11 - round(50*abs(cons_pc_tpi/povline_f_flex90_`pass'-1)+0.5) if abs(cons_pc_tpi/povl
> ine_f_flex90_`pass'-1) <= 0.2;
217.                                 ***since the poor were very few in Kampala and Central urban for Uganda we added 1 to
>  weights****;
.                                 * Nearness to poverty line and population weights ;
.                 gen tripopwt=(0.001+triwt)*hhweight*hhsize;
218.                                                 preserve;
219.                         collapse (mean) nf_pc_nom [aw=tripopwt] , by(spdomain);
220.                         rename nf_pc_nom povline_nf_flex`pass';
221.                         lab var povline_nf_flex`pass' "Nonfood poverty line. Flexible bundle";
222.                         tempfile znf;
223.                         sort spdomain;
224.                         save `znf', replace;
225.                                                                 restore;
226.                                 sort spdomain;
227.                 merge spdomain using `znf';
228.                 tab _merge;
229.                 drop _merge;
230. **************************************************************************
> * Poverty line is the sum of the food and non-food poverty lines
> **************************************************************************;
.                 gen povline_flex`pass'=povline_f_flex90_`pass' + povline_nf_flex`pass';
231. keep spdomain povline_flex`pass';
232.                 sort spdomain;
233.         save "$path/work/povlines_it`pass'.dta", replace;
234. **************************************************************************;
. * Create spatial price index, based on the total poverty line, with
> * adjustment so that mean (and total) nominal consumption equals
> * mean (and total) spatially deflated consumption.
> *
> * Choose arbitrary strata to be the base at first: we just use the first stratum.
> **************************************************************************;
.         use `contpi', clear;
235.                 sort spdomain;
236.                 merge spdomain using "$path/work/povlines_it`pass'.dta";
237.                 tab _merge;
238.                 drop _merge;
239.                 gen cr= cons_pc_tpi ;
240.                 gen linpob`pass'=povline_flex`pass';
241.                 qui sum linpob`pass' if spdomain==1, meanonly;
242.                 global spi_base=r(mean);
243.                 gen spi`pass'=linpob`pass'/$spi_base;
244.                 gen cr_it`pass'=cr/spi`pass';
245.                 qui sum cr [aw=hhweight*hhsize];
246.                 global sumcr=r(sum);
247.                 qui sum cr_it`pass' [aw=hhweight*hhsize];
248.                 global sumcr2=r(sum);
249.                 replace spi`pass'=spi`pass'*$sumcr2/$sumcr;
250.                 gen linpobr`pass'=linpob`pass'/spi`pass';
251.                 replace cr_it`pass'=cr/spi`pass';
252.                 su cr cr_it`pass' linpob`pass' linpobr`pass' [aw=hhweight*hhsize];
253.                 lab var cr "Temporally-adjusted cons pc";
254.                 lab var cr_it`pass' "Spatially & temporally adjusted cons pc";
255.                 lab var linpob`pass' "Poverty line";
256.                 lab var linpobr`pass' "Real poverty line";
257.                 lab var spi`pass' "Spatial price index";
258.                 gen linpob=linpob`pass';
259. **************************************************************************
> * calculate poverty measures with the flexible food bundle
> **************************************************************************;
.                 gen h=100 if cr_it`pass'<=linpobr`pass' & linpobr`pass'~=. & cr_it`pass'~=.;
260.                 replace  h   = 0 if cr_it`pass' > linpobr`pass' & linpobr`pass'~=. & cr_it`pass'~=.;
261.                 gen      pg  = ((linpobr`pass' - cr_it`pass' )/linpobr`pass') *100;
262.                 replace  pg  = 0             if h==0;
263.                 gen      spg = ((( linpobr`pass' - cr_it`pass' )/ linpobr`pass' )^2)*100;
264.                 replace  spg = 0             if h==0;
265.                 gen h_flex`pass'  =h;
266.                 gen pg_flex`pass' =pg;
267.                 gen spg_flex`pass'=spg;
268.                                 lab var h_flex`pass'   "Poverty headcount. Flexible bundle";
269.                 lab var pg_flex`pass'  "Poverty gap. Flexible bundle";
270.                 lab var spg_flex`pass' "Squared poverty gap. Flexible bundle";
271.                 gen popwt=hhsize*hhweight;
272.                         * Stata 10.1 syntax ;
.                         svyset , clear;
273.                         svyset [pweight=popwt] , str(strata) psu(psu);
274.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass';
275.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(rural);
276.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata);
277.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(strata rural);
278.                 svy: mean h_flex`pass' pg_flex`pass' spg_flex`pass' , over(spdomain);
279. *preserve;
. keep hhid popwt cr_it`pass' h_flex`pass' pg_flex`pass' spg_flex`pass' rural news reg_tpi strata spdomain;
280.                 compress;
281.                 sort hhid;
282.         save "$path/work/cons_real_it`pass'.dta" , replace;
283. *restore;
.                                 * New cutoff point (percentile) to use in next iteration is equal to the poverty ;
.                 * rate in this iteration ;
.                                                 sum h_flex`pass' [aw=popwt] ;
284.                                 * Comment out next line for IAF 2002/03 in order to replicate official figures ( STAR
> T );
.                 * URB: In this case, we just use the poorest 50% as there are too few actually poor to calculate the bun
> dle and prices..;
.                 local cutpt= $tpi_bottom;
285. *               local cutpt= round(r(mean));
.                 * Comment out next line for IAF 2002/03 in order to replicate official figures ( END );
. *       save foodshares tempfile to disk;
.         use `foodshares', clear;
286.         save "$path/work/foodshares_it`pass'.dta", replace;
287.         local lastpass = `pass';
288.         local pass = `pass' + 1;
289.         };
(224 missing values generated)
(note: file /tmp/St02337.000002 not found)
file /tmp/St02337.000002 saved
file cutoff.dta saved
(224 missing values generated)
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,716      100.00      100.00
------------+-----------------------------------
      Total |      2,716      100.00

   relpoor1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 948.049143       34.93       34.93
          1 | 1,765.9509       65.07      100.00
------------+-----------------------------------
      Total |      2,714      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it1.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.76        0.76
          2 |          4        0.01        0.77
          3 |     36,833       99.23      100.00
------------+-----------------------------------
      Total |     37,120      100.00
(2999 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         60        0.18        0.18
          3 |     34,121       99.82      100.00
------------+-----------------------------------
      Total |     34,181      100.00
(15573 observations deleted)
(10 missing values generated)
   10
    0
(10 missing values generated)
   10
(10 observations deleted)
(note: file /tmp/St02337.000003 not found)
file /tmp/St02337.000003 saved
(note: file /tmp/St02337.000004 not found)
file /tmp/St02337.000004 saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     18,598      100.00      100.00
------------+-----------------------------------
      Total |     18,598      100.00
  157
(157 observations deleted)
file /tmp/St02337.000003 saved
45
45
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it1.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(779 observations deleted)
(note: file /tmp/St02337.000005 not found)
file /tmp/St02337.000005 saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.84        0.84
          2 |        110        0.33        1.16
          3 |     33,342       98.84      100.00
------------+-----------------------------------
      Total |     33,735      100.00
(110 observations deleted)
file /tmp/St02337.000005 saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,096        9.21        9.21
          2 |          1        0.00        9.21
          3 |     30,529       90.79      100.00
------------+-----------------------------------
      Total |     33,626      100.00
(3097 observations deleted)
(181 observations deleted)
(note: file /tmp/St02337.000007 not found)
file /tmp/St02337.000007 saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
descript was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        156        0.51        0.51
          3 |     30,348       99.49      100.00
------------+-----------------------------------
      Total |     30,504      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.00        0.00
          3 |     30,503      100.00      100.00
------------+-----------------------------------
      Total |     30,504      100.00
(13357 observations deleted)
(54 observations deleted)
(1303 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw1 |       208    1.267721    .4887439   .6020459   3.923727
    ratiomw1 |       208     1.05857    .4772086   .2961278   5.840994
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          2        0.95        0.95
          3 |        208       99.05      100.00
------------+-----------------------------------
      Total |        210      100.00
    2
(2 observations deleted)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it1.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.26        3.26
          2 |         69       32.09       35.35
          3 |        139       64.65      100.00
------------+-----------------------------------
      Total |        215      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
136. |     157   Central Urban          1 |
137. |     157   Central Rural          1 |
138. |     157         Eastern          1 |
139. |     157        Northern          1 |
140. |     157         Western          1 |
     |------------------------------------|
145. |       .   Central Urban          1 |
146. |       .   Central Rural          1 |
     +------------------------------------+
(76 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          4        2.48        2.48
          2 |         22       13.66       16.15
          3 |        135       83.85      100.00
------------+-----------------------------------
      Total |        161      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
136. |     162        Northern          1 |
137. |     166   Central Urban          1 |
138. |     166         Western          1 |
139. |     171   Central Rural          1 |
     +------------------------------------+
(26 observations deleted)

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
   14
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       135    102.8148    94.39439          1        397
(14 observations deleted)
(0 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        11  .5221686         0  .5221686  .5221686
Central Rural |        28  .7908835         0  .7908835  .7908835
      Eastern |        30  .8930709         0  .8930709  .8930709
     Northern |        29  .8572496         0  .8572496  .8572496
      Western |        23  .8807663         0  .8807663  .8807663
--------------+--------------------------------------------------
        Total |       121  .8247817  .1033625  .5221686  .8930709
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.82        0.82
          3 |        121       99.18      100.00
------------+-----------------------------------
      Total |        122      100.00
(1 missing value generated)
(121 real changes made)
(114 real changes made)
(122 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        11  6.42e-06         0  6.42e-06  6.42e-06
Central Rural |        28  .0000257         0  .0000257  .0000257
      Eastern |        30  .0000385         0  .0000385  .0000385
     Northern |        29  .0000321         0  .0000321  .0000321
      Western |        23  .0000578         0  .0000578  .0000578
--------------+--------------------------------------------------
        Total |       121  .0000348  .0000141  6.42e-06  .0000578
-----------------------------------------------------------------
(1 missing value generated)
(121 real changes made)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it1.dta saved
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(69 real changes made)
(3 missing values generated)
(note: file /tmp/St02337.000009 not found)
file /tmp/St02337.000009 saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it1.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it1.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(225 missing values generated)
(225 missing values generated)
(2708 real changes made)
(9 missing values generated)
(2482 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
      cr_it1 |    2492  34690902.7    1990.349   7051.711          0   352670.1
     linpob1 |    2714  37328356.8     732.834    606.844          0   2598.683
    linpobr1 |    2707    37257099    554.9532   .0000303   554.9531   554.9532
(2453 missing values generated)
(2228 real changes made)
(225 missing values generated)
(2228 real changes made)
(225 missing values generated)
(2228 real changes made)
(225 missing values generated)
(225 missing values generated)
(225 missing values generated)
(3 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex1 |   11.30399          .             .           .
    pg_flex1 |   4.161427          .             .           .
   spg_flex1 |   2.622783          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
           0 |   20.41518          .             .           .
           1 |   10.26365          .             .           .
-------------+------------------------------------------------
pg_flex1     |
           0 |    7.15136          .             .           .
           1 |   3.820029          .             .           .
-------------+------------------------------------------------
spg_flex1    |
           0 |   3.746596          .             .           .
           1 |   2.494463          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
     Kampala |          0  (omitted)
   _subpop_2 |   20.41518          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.995052          .             .           .
   _subpop_5 |   6.394424          .             .           .
   _subpop_6 |   19.42525          .             .           .
-------------+------------------------------------------------
pg_flex1     |
     Kampala |          0  (omitted)
   _subpop_2 |    7.15136          .             .           .
   _subpop_3 |   7.918178          .             .           .
   _subpop_4 |   .9382142          .             .           .
   _subpop_5 |    1.50798          .             .           .
   _subpop_6 |   5.760272          .             .           .
-------------+------------------------------------------------
spg_flex1    |
     Kampala |          0  (omitted)
   _subpop_2 |   3.746596          .             .           .
   _subpop_3 |    6.47575          .             .           .
   _subpop_4 |   .4369273          .             .           .
   _subpop_5 |   .5540385          .             .           .
   _subpop_6 |   3.283556          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

         Over: strata rural
    _subpop_1: Kampala 1
    _subpop_2: Other Urban 0
    _subpop_3: Central rural 1
    _subpop_4: East rural 1
    _subpop_5: North rural 1
    _subpop_6: West rural 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   20.41518          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.995052          .             .           .
   _subpop_5 |   6.394424          .             .           .
   _subpop_6 |   19.42525          .             .           .
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |          0  (omitted)
   _subpop_2 |    7.15136          .             .           .
   _subpop_3 |   7.918178          .             .           .
   _subpop_4 |   .9382142          .             .           .
   _subpop_5 |    1.50798          .             .           .
   _subpop_6 |   5.760272          .             .           .
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   3.746596          .             .           .
   _subpop_3 |    6.47575          .             .           .
   _subpop_4 |   .4369273          .             .           .
   _subpop_5 |   .5540385          .             .           .
   _subpop_6 |   3.283556          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex1      |
   _subpop_1 |   46.39306          .             .           .
   _subpop_2 |   13.09757          .             .           .
     Eastern |   2.938117          .             .           .
    Northern |   6.036822          .             .           .
     Western |   18.45243          .             .           .
-------------+------------------------------------------------
pg_flex1     |
   _subpop_1 |   16.92961          .             .           .
   _subpop_2 |   7.877442          .             .           .
     Eastern |   .8997628          .             .           .
    Northern |   1.392303          .             .           .
     Western |   5.474222          .             .           .
-------------+------------------------------------------------
spg_flex1    |
   _subpop_1 |   9.029231          .             .           .
   _subpop_2 |   6.442435          .             .           .
     Eastern |   .4175686          .             .           .
    Northern |   .5032006          .             .           .
     Western |   3.105699          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex1 was float now byte
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it1.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex1 |    2492  34690902.7    11.30399   31.67051          0        100
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it1.dta saved
file /tmp/St02337.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

   relpoor2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,452.5749       53.52       53.52
          1 | 1,261.4251       46.48      100.00
------------+-----------------------------------
      Total |      2,714      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it2.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.76        0.76
          2 |          4        0.01        0.77
          3 |     36,833       99.23      100.00
------------+-----------------------------------
      Total |     37,120      100.00
(2999 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         61        0.18        0.18
          3 |     34,121       99.82      100.00
------------+-----------------------------------
      Total |     34,182      100.00
(22021 observations deleted)
(10 missing values generated)
   10
    0
(10 missing values generated)
   10
(10 observations deleted)
(note: file /tmp/St02337.00000a not found)
file /tmp/St02337.00000a saved
(note: file /tmp/St02337.00000b not found)
file /tmp/St02337.00000b saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     12,151      100.00      100.00
------------+-----------------------------------
      Total |     12,151      100.00
  164
(164 observations deleted)
file /tmp/St02337.00000a saved
45
45
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it2.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(779 observations deleted)
(note: file /tmp/St02337.00000c not found)
file /tmp/St02337.00000c saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.84        0.84
          2 |        110        0.33        1.16
          3 |     33,342       98.84      100.00
------------+-----------------------------------
      Total |     33,735      100.00
(110 observations deleted)
file /tmp/St02337.00000c saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,103        9.23        9.23
          2 |          1        0.00        9.23
          3 |     30,522       90.77      100.00
------------+-----------------------------------
      Total |     33,626      100.00
(3104 observations deleted)
(177 observations deleted)
(note: file /tmp/St02337.00000e not found)
file /tmp/St02337.00000e saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
descript was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        134        0.44        0.44
          3 |     30,345       99.56      100.00
------------+-----------------------------------
      Total |     30,479      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     30,479      100.00      100.00
------------+-----------------------------------
      Total |     30,479      100.00
(19209 observations deleted)
(45 observations deleted)
(785 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw2 |       212    1.252933    .4820457   .8504128    4.64159
    ratiomw2 |       212    1.059132    .3964208   .2999246   4.797804
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          2        0.93        0.93
          3 |        212       99.07      100.00
------------+-----------------------------------
      Total |        214      100.00
    2
(2 observations deleted)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it2.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          7        3.20        3.20
          2 |         75       34.25       37.44
          3 |        137       62.56      100.00
------------+-----------------------------------
      Total |        219      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
132. |     157   Central Urban          1 |
133. |     157   Central Rural          1 |
134. |     157         Eastern          1 |
135. |     157        Northern          1 |
136. |     157         Western          1 |
     |------------------------------------|
143. |       .   Central Urban          1 |
144. |       .   Central Rural          1 |
     +------------------------------------+
(82 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        3.12        3.12
          2 |         23       14.38       17.50
          3 |        132       82.50      100.00
------------+-----------------------------------
      Total |        160      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
133. |     162        Northern          1 |
134. |     166         Western          1 |
135. |     170   Central Urban          1 |
136. |     171   Central Rural          1 |
137. |     171         Eastern          1 |
     +------------------------------------+
(28 observations deleted)

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    4
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    1
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       132    69.31061    55.25004          7        277
(5 observations deleted)
(0 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25   .762072         0   .762072   .762072
Central Rural |        26  .7597615         0  .7597615  .7597615
      Eastern |        27  .8900589         0  .8900589  .8900589
     Northern |        26  .8547322         0  .8547322  .8547322
      Western |        23   .880883         0   .880883   .880883
--------------+--------------------------------------------------
        Total |       127  .8292956  .0574874  .7597615  .8900589
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.78        0.78
          3 |        127       99.22      100.00
------------+-----------------------------------
      Total |        128      100.00
(1 missing value generated)
(127 real changes made)
(120 real changes made)
(128 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25  6.42e-06         0  6.42e-06  6.42e-06
Central Rural |        26  .0000257         0  .0000257  .0000257
      Eastern |        27 -.0000257         0 -.0000257 -.0000257
     Northern |        26  .0000321         0  .0000321  .0000321
      Western |        23  .0000578         0  .0000578  .0000578
--------------+--------------------------------------------------
        Total |       127  .0000181  .0000279 -.0000257  .0000578
-----------------------------------------------------------------
(1 missing value generated)
(127 real changes made)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it2.dta saved
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(56 real changes made)
(3 missing values generated)
(note: file /tmp/St02337.00000g not found)
file /tmp/St02337.00000g saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it2.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it2.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(225 missing values generated)
(225 missing values generated)
(2708 real changes made)
(9 missing values generated)
(2482 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
      cr_it2 |    2492  34690902.7    1990.349   7532.325          0   383041.4
     linpob2 |    2714  37328356.8     720.859   666.3795          0   2774.872
    linpobr2 |    2707    37257099    516.7629          0   516.7629   516.7629
(2481 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(225 missing values generated)
(225 missing values generated)
(3 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex2 |   9.844081          .             .           .
    pg_flex2 |   3.878088          .             .           .
   spg_flex2 |   2.533186          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
           0 |   21.76924          .             .           .
           1 |   8.482435          .             .           .
-------------+------------------------------------------------
pg_flex2     |
           0 |   7.802456          .             .           .
           1 |   3.429993          .             .           .
-------------+------------------------------------------------
spg_flex2    |
           0 |   4.143901          .             .           .
           1 |   2.349271          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
     Kampala |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex2     |
     Kampala |          0  (omitted)
   _subpop_2 |   7.802456          .             .           .
   _subpop_3 |   7.917947          .             .           .
   _subpop_4 |   .8795093          .             .           .
   _subpop_5 |   .8553601          .             .           .
   _subpop_6 |   4.929269          .             .           .
-------------+------------------------------------------------
spg_flex2    |
     Kampala |          0  (omitted)
   _subpop_2 |   4.143901          .             .           .
   _subpop_3 |   6.475623          .             .           .
   _subpop_4 |   .4036744          .             .           .
   _subpop_5 |   .3267688          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

         Over: strata rural
    _subpop_1: Kampala 1
    _subpop_2: Other Urban 0
    _subpop_3: Central rural 1
    _subpop_4: East rural 1
    _subpop_5: North rural 1
    _subpop_6: West rural 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   7.802456          .             .           .
   _subpop_3 |   7.917947          .             .           .
   _subpop_4 |   .8795093          .             .           .
   _subpop_5 |   .8553601          .             .           .
   _subpop_6 |   4.929269          .             .           .
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   4.143901          .             .           .
   _subpop_3 |   6.475623          .             .           .
   _subpop_4 |   .4036744          .             .           .
   _subpop_5 |   .3267688          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex2      |
   _subpop_1 |    51.4747          .             .           .
   _subpop_2 |   13.09757          .             .           .
     Eastern |   2.401441          .             .           .
    Northern |   3.936353          .             .           .
     Western |   14.42713          .             .           .
-------------+------------------------------------------------
pg_flex2     |
   _subpop_1 |   18.94604          .             .           .
   _subpop_2 |   7.877213          .             .           .
     Eastern |   .8407687          .             .           .
    Northern |   .7700536          .             .           .
     Western |   4.681379          .             .           .
-------------+------------------------------------------------
spg_flex2    |
   _subpop_1 |   10.12423          .             .           .
   _subpop_2 |   6.442309          .             .           .
     Eastern |   .3856657          .             .           .
    Northern |   .2941796          .             .           .
     Western |   2.807814          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex2 was float now byte
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it2.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex2 |    2492  34690902.7    9.844081   29.79695          0        100
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it2.dta saved
file /tmp/St02337.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

   relpoor3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,452.7411       53.53       53.53
          1 | 1,261.2589       46.47      100.00
------------+-----------------------------------
      Total |      2,714      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it3.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.76        0.76
          2 |          4        0.01        0.77
          3 |     36,833       99.23      100.00
------------+-----------------------------------
      Total |     37,120      100.00
(2999 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         61        0.18        0.18
          3 |     34,121       99.82      100.00
------------+-----------------------------------
      Total |     34,182      100.00
(21886 observations deleted)
(10 missing values generated)
   10
    0
(10 missing values generated)
   10
(10 observations deleted)
(note: file /tmp/St02337.00000h not found)
file /tmp/St02337.00000h saved
(note: file /tmp/St02337.00000i not found)
file /tmp/St02337.00000i saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     12,286      100.00      100.00
------------+-----------------------------------
      Total |     12,286      100.00
  164
(164 observations deleted)
file /tmp/St02337.00000h saved
47
47
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it3.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(779 observations deleted)
(note: file /tmp/St02337.00000j not found)
file /tmp/St02337.00000j saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.84        0.84
          2 |        110        0.33        1.16
          3 |     33,342       98.84      100.00
------------+-----------------------------------
      Total |     33,735      100.00
(110 observations deleted)
file /tmp/St02337.00000j saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,831        8.42        8.42
          2 |          2        0.01        8.42
          3 |     30,794       91.58      100.00
------------+-----------------------------------
      Total |     33,627      100.00
(2833 observations deleted)
(179 observations deleted)
(note: file /tmp/St02337.00000l not found)
file /tmp/St02337.00000l saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
descript was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        133        0.43        0.43
          3 |     30,615       99.57      100.00
------------+-----------------------------------
      Total |     30,748      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     30,748      100.00      100.00
------------+-----------------------------------
      Total |     30,748      100.00
(19323 observations deleted)
(45 observations deleted)
(794 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw3 |       217    1.262218    .4901708   .8819051    4.64159
    ratiomw3 |       217    1.068268    .4071235   .4867766    4.13329
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.36        1.36
          3 |        217       98.64      100.00
------------+-----------------------------------
      Total |        220      100.00
    3
(3 observations deleted)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it3.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          8        3.56        3.56
          2 |         80       35.56       39.11
          3 |        137       60.89      100.00
------------+-----------------------------------
      Total |        225      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
132. |     157   Central Urban          1 |
133. |     157   Central Rural          1 |
134. |     157         Eastern          1 |
135. |     157        Northern          1 |
136. |     157         Western          1 |
     |------------------------------------|
138. |     160   Central Urban          1 |
144. |       .   Central Urban          1 |
145. |       .   Central Rural          1 |
     +------------------------------------+
(88 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        3.14        3.14
          2 |         22       13.84       16.98
          3 |        132       83.02      100.00
------------+-----------------------------------
      Total |        159      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
133. |     162        Northern          1 |
134. |     166         Western          1 |
135. |     170   Central Urban          1 |
136. |     171   Central Rural          1 |
137. |     171         Eastern          1 |
     +------------------------------------+
(27 observations deleted)

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    1
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       132    70.09091    55.66427          7        277
(4 observations deleted)
(0 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25  .7333384         0  .7333384  .7333384
Central Rural |        26  .7648284         0  .7648284  .7648284
      Eastern |        28  .8941371         0  .8941371  .8941371
     Northern |        26  .8529498         0  .8529498  .8529498
      Western |        23   .880883         0   .880883   .880883
--------------+--------------------------------------------------
        Total |       128  .8257175  .0646062  .7333384  .8941371
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.78        0.78
          3 |        128       99.22      100.00
------------+-----------------------------------
      Total |        129      100.00
(1 missing value generated)
(128 real changes made)
(121 real changes made)
(129 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25 -.0001221         0 -.0001221 -.0001221
Central Rural |        26 -.0000385         0 -.0000385 -.0000385
      Eastern |        28 -.0000899         0 -.0000899 -.0000899
     Northern |        26  .0000321         0  .0000321  .0000321
      Western |        23  .0000578         0  .0000578  .0000578
--------------+--------------------------------------------------
        Total |       128 -.0000344  .0000681 -.0001221  .0000578
-----------------------------------------------------------------
(1 missing value generated)
(128 real changes made)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it3.dta saved
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(56 real changes made)
(3 missing values generated)
(note: file /tmp/St02337.00000n not found)
file /tmp/St02337.00000n saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it3.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it3.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(225 missing values generated)
(225 missing values generated)
(2708 real changes made)
(9 missing values generated)
(2482 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
      cr_it3 |    2492  34690902.7    1990.349   7521.424          0   382334.8
     linpob3 |    2714  37328356.8    723.3075   673.1132          0   2799.716
    linpobr3 |    2707    37257099    517.5221   .0000268    517.522   517.5221
(2481 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(225 missing values generated)
(225 missing values generated)
(3 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex3 |   9.844081          .             .           .
    pg_flex3 |   3.890261          .             .           .
   spg_flex3 |   2.539307          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
           0 |   21.76924          .             .           .
           1 |   8.482435          .             .           .
-------------+------------------------------------------------
pg_flex3     |
           0 |   7.917524          .             .           .
           1 |   3.430418          .             .           .
-------------+------------------------------------------------
spg_flex3    |
           0 |   4.206679          .             .           .
           1 |   2.348922          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
     Kampala |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex3     |
     Kampala |          0  (omitted)
   _subpop_2 |   7.917524          .             .           .
   _subpop_3 |    7.90065          .             .           .
   _subpop_4 |   .8841512          .             .           .
   _subpop_5 |   .8669976          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex3    |
     Kampala |          0  (omitted)
   _subpop_2 |   4.206679          .             .           .
   _subpop_3 |   6.466156          .             .           .
   _subpop_4 |   .4065594          .             .           .
   _subpop_5 |   .3302996          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

         Over: strata rural
    _subpop_1: Kampala 1
    _subpop_2: Other Urban 0
    _subpop_3: Central rural 1
    _subpop_4: East rural 1
    _subpop_5: North rural 1
    _subpop_6: West rural 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   7.917524          .             .           .
   _subpop_3 |    7.90065          .             .           .
   _subpop_4 |   .8841512          .             .           .
   _subpop_5 |   .8669976          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   4.206679          .             .           .
   _subpop_3 |   6.466156          .             .           .
   _subpop_4 |   .4065594          .             .           .
   _subpop_5 |   .3302996          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex3      |
   _subpop_1 |    51.4747          .             .           .
   _subpop_2 |   13.09757          .             .           .
     Eastern |   2.401441          .             .           .
    Northern |   3.936353          .             .           .
     Western |   14.42713          .             .           .
-------------+------------------------------------------------
pg_flex3     |
   _subpop_1 |   19.23469          .             .           .
   _subpop_2 |   7.860005          .             .           .
     Eastern |   .8454839          .             .           .
    Northern |   .7805305          .             .           .
     Western |   4.681379          .             .           .
-------------+------------------------------------------------
spg_flex3    |
   _subpop_1 |   10.28266          .             .           .
   _subpop_2 |   6.432891          .             .           .
     Eastern |   .3884258          .             .           .
    Northern |   .2973582          .             .           .
     Western |   2.807814          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex3 was float now byte
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it3.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex3 |    2492  34690902.7    9.844081   29.79695          0        100
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it3.dta saved
file /tmp/St02337.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

   relpoor4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,452.7643       53.53       53.53
          1 | 1,261.2357       46.47      100.00
------------+-----------------------------------
      Total |      2,714      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it4.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.76        0.76
          2 |          4        0.01        0.77
          3 |     36,833       99.23      100.00
------------+-----------------------------------
      Total |     37,120      100.00
(2999 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         61        0.18        0.18
          3 |     34,121       99.82      100.00
------------+-----------------------------------
      Total |     34,182      100.00
(21905 observations deleted)
(10 missing values generated)
   10
    0
(10 missing values generated)
   10
(10 observations deleted)
(note: file /tmp/St02337.00000o not found)
file /tmp/St02337.00000o saved
(note: file /tmp/St02337.00000p not found)
file /tmp/St02337.00000p saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     12,267      100.00      100.00
------------+-----------------------------------
      Total |     12,267      100.00
  164
(164 observations deleted)
file /tmp/St02337.00000o saved
47
47
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it4.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(779 observations deleted)
(note: file /tmp/St02337.00000q not found)
file /tmp/St02337.00000q saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.84        0.84
          2 |        110        0.33        1.16
          3 |     33,342       98.84      100.00
------------+-----------------------------------
      Total |     33,735      100.00
(110 observations deleted)
file /tmp/St02337.00000q saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,831        8.42        8.42
          2 |          2        0.01        8.42
          3 |     30,794       91.58      100.00
------------+-----------------------------------
      Total |     33,627      100.00
(2833 observations deleted)
(179 observations deleted)
(note: file /tmp/St02337.00000s not found)
file /tmp/St02337.00000s saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
descript was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        133        0.43        0.43
          3 |     30,615       99.57      100.00
------------+-----------------------------------
      Total |     30,748      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     30,748      100.00      100.00
------------+-----------------------------------
      Total |     30,748      100.00
(19340 observations deleted)
(45 observations deleted)
(797 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw4 |       217    1.263138    .4944414   .8819051    4.64159
    ratiomw4 |       217    1.067593    .4058826   .4867766   4.090567
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.36        1.36
          3 |        217       98.64      100.00
------------+-----------------------------------
      Total |        220      100.00
    3
(3 observations deleted)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it4.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          8        3.56        3.56
          2 |         80       35.56       39.11
          3 |        137       60.89      100.00
------------+-----------------------------------
      Total |        225      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
132. |     157   Central Urban          1 |
133. |     157   Central Rural          1 |
134. |     157         Eastern          1 |
135. |     157        Northern          1 |
136. |     157         Western          1 |
     |------------------------------------|
138. |     160   Central Urban          1 |
144. |       .   Central Urban          1 |
145. |       .   Central Rural          1 |
     +------------------------------------+
(88 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        3.14        3.14
          2 |         22       13.84       16.98
          3 |        132       83.02      100.00
------------+-----------------------------------
      Total |        159      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
133. |     162        Northern          1 |
134. |     166         Western          1 |
135. |     170   Central Urban          1 |
136. |     171   Central Rural          1 |
137. |     171         Eastern          1 |
     +------------------------------------+
(27 observations deleted)

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    1
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       132    69.98485    55.50682          7        277
(4 observations deleted)
(0 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25  .7333384         0  .7333384  .7333384
Central Rural |        26  .7645174         0  .7645174  .7645174
      Eastern |        28  .8942755         0  .8942755  .8942755
     Northern |        26  .8532822         0  .8532822  .8532822
      Western |        23   .880883         0   .880883   .880883
--------------+--------------------------------------------------
        Total |       128  .8257521  .0647274  .7333384  .8942755
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.78        0.78
          3 |        128       99.22      100.00
------------+-----------------------------------
      Total |        129      100.00
(1 missing value generated)
(128 real changes made)
(121 real changes made)
(129 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25 -.0001221         0 -.0001221 -.0001221
Central Rural |        26  .0000257         0  .0000257  .0000257
      Eastern |        28 -.0000257         0 -.0000257 -.0000257
     Northern |        26  .0001606         0  .0001606  .0001606
      Western |        23  .0000578         0  .0000578  .0000578
--------------+--------------------------------------------------
        Total |       128  .0000188  .0000935 -.0001221  .0001606
-----------------------------------------------------------------
(1 missing value generated)
(128 real changes made)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it4.dta saved
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(56 real changes made)
(3 missing values generated)
(note: file /tmp/St02337.00000u not found)
file /tmp/St02337.00000u saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it4.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it4.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(225 missing values generated)
(225 missing values generated)
(2708 real changes made)
(9 missing values generated)
(2482 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
      cr_it4 |    2492  34690902.7    1990.349   7517.215          0   382114.2
     linpob4 |    2714  37328356.8     723.756   673.0642          0   2799.716
    linpobr4 |    2707    37257099    518.0089          0   518.0089   518.0089
(2481 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(225 missing values generated)
(225 missing values generated)
(3 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex4 |   9.844081          .             .           .
    pg_flex4 |   3.894462          .             .           .
   spg_flex4 |   2.541319          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
           0 |   21.76924          .             .           .
           1 |   8.482435          .             .           .
-------------+------------------------------------------------
pg_flex4     |
           0 |   7.917234          .             .           .
           1 |   3.435132          .             .           .
-------------+------------------------------------------------
spg_flex4    |
           0 |   4.206618          .             .           .
           1 |   2.351171          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
     Kampala |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex4     |
     Kampala |          0  (omitted)
   _subpop_2 |   7.917234          .             .           .
   _subpop_3 |   7.918424          .             .           .
   _subpop_4 |   .8829452          .             .           .
   _subpop_5 |   .8723121          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex4    |
     Kampala |          0  (omitted)
   _subpop_2 |   4.206618          .             .           .
   _subpop_3 |   6.475886          .             .           .
   _subpop_4 |    .405808          .             .           .
   _subpop_5 |   .3319337          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

         Over: strata rural
    _subpop_1: Kampala 1
    _subpop_2: Other Urban 0
    _subpop_3: Central rural 1
    _subpop_4: East rural 1
    _subpop_5: North rural 1
    _subpop_6: West rural 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   7.917234          .             .           .
   _subpop_3 |   7.918424          .             .           .
   _subpop_4 |   .8829452          .             .           .
   _subpop_5 |   .8723121          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   4.206618          .             .           .
   _subpop_3 |   6.475886          .             .           .
   _subpop_4 |    .405808          .             .           .
   _subpop_5 |   .3319337          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex4      |
   _subpop_1 |    51.4747          .             .           .
   _subpop_2 |   13.09757          .             .           .
     Eastern |   2.401441          .             .           .
    Northern |   3.936353          .             .           .
     Western |   14.42713          .             .           .
-------------+------------------------------------------------
pg_flex4     |
   _subpop_1 |   19.23469          .             .           .
   _subpop_2 |   7.877688          .             .           .
     Eastern |   .8442589          .             .           .
    Northern |    .785315          .             .           .
     Western |   4.681379          .             .           .
-------------+------------------------------------------------
spg_flex4    |
   _subpop_1 |   10.28266          .             .           .
   _subpop_2 |    6.44257          .             .           .
     Eastern |   .3877068          .             .           .
    Northern |   .2988294          .             .           .
     Western |   2.807814          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex4 was float now byte
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it4.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex4 |    2492  34690902.7    9.844081   29.79695          0        100
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it4.dta saved
file /tmp/St02337.000002 saved
variable one does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00

   relpoor5 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,450.7274       53.45       53.45
          1 | 1,263.2726       46.55      100.00
------------+-----------------------------------
      Total |      2,714      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/relpoor_it5.dta saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.76        0.76
          2 |          4        0.01        0.77
          3 |     36,833       99.23      100.00
------------+-----------------------------------
      Total |     37,120      100.00
(2999 observations deleted)
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         61        0.18        0.18
          3 |     34,121       99.82      100.00
------------+-----------------------------------
      Total |     34,182      100.00
(21890 observations deleted)
(10 missing values generated)
   10
    0
(10 missing values generated)
   10
(10 observations deleted)
(note: file /tmp/St02337.00000v not found)
file /tmp/St02337.00000v saved
(note: file /tmp/St02337.00000w not found)
file /tmp/St02337.00000w saved
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     12,282      100.00      100.00
------------+-----------------------------------
      Total |     12,282      100.00
  164
(164 observations deleted)
file /tmp/St02337.00000v saved
47
47
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/codes_food_basket_flex_it5.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(779 observations deleted)
(note: file /tmp/St02337.00000x not found)
file /tmp/St02337.00000x saved
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        283        0.84        0.84
          2 |        110        0.33        1.16
          3 |     33,342       98.84      100.00
------------+-----------------------------------
      Total |     33,735      100.00
(110 observations deleted)
file /tmp/St02337.00000x saved
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,831        8.42        8.42
          2 |          2        0.01        8.42
          3 |     30,794       91.58      100.00
------------+-----------------------------------
      Total |     33,627      100.00
(2833 observations deleted)
(179 observations deleted)
(note: file /tmp/St02337.000011 not found)
file /tmp/St02337.000011 saved
product was float now int
unit was float now byte
food_cat was float now byte
survquar was float now byte
survmon was float now byte
rural was float now byte
spdomain was float now byte
news was float now byte
bswt was float now byte
hhsize was long now byte
count was float now byte
descript was float now byte
numreg was double now byte
variable hhid does not uniquely identify observations in the master data
survquar was byte now float
spdomain was byte now float
(label lspdomain already defined)
(label lsurvquar already defined)
(label lbreg already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |        133        0.43        0.43
          3 |     30,615       99.57      100.00
------------+-----------------------------------
      Total |     30,748      100.00
variable hhid does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |     30,748      100.00      100.00
------------+-----------------------------------
      Total |     30,748      100.00
(19325 observations deleted)
(45 observations deleted)
(798 observations deleted)

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    ratiotw5 |       217     1.26284    .4912453   .8819051    4.64159
    ratiomw5 |       217    1.068684    .4079751   .4867766   4.187579
variable product does not uniquely identify observations in the master data
product was int now float

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          3        1.36        1.36
          3 |        217       98.64      100.00
------------+-----------------------------------
      Total |        220      100.00
    3
(3 observations deleted)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex_it5.dta saved
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          8        3.56        3.56
          2 |         80       35.56       39.11
          3 |        137       60.89      100.00
------------+-----------------------------------
      Total |        225      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
132. |     157   Central Urban          1 |
133. |     157   Central Rural          1 |
134. |     157         Eastern          1 |
135. |     157        Northern          1 |
136. |     157         Western          1 |
     |------------------------------------|
138. |     160   Central Urban          1 |
144. |       .   Central Urban          1 |
145. |       .   Central Rural          1 |
     +------------------------------------+
(88 observations deleted)
variable product does not uniquely identify observations in the master data
(note: descript is str26 in using data but will be float now)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          5        3.14        3.14
          2 |         22       13.84       16.98
          3 |        132       83.02      100.00
------------+-----------------------------------
      Total |        159      100.00

     +------------------------------------+
     | product        spdomain   descript |
     |------------------------------------|
133. |     162        Northern          1 |
134. |     166         Western          1 |
135. |     170   Central Urban          1 |
136. |     171   Central Rural          1 |
137. |     171         Eastern          1 |
     +------------------------------------+
(27 observations deleted)

--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Urban
    3
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Central Rural
    0
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Eastern
    1
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Northern
    1
--------------------------------------------------------------------------------------------------------------------------
-> spdomain = Western
    0

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        bswt |       132    70.05303    55.57573          7        277
(5 observations deleted)
(0 observations deleted)

Summary for variables: baskshr
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25  .7333384         0  .7333384  .7333384
Central Rural |        26  .7647542         0  .7647542  .7647542
      Eastern |        27   .885439         0   .885439   .885439
     Northern |        26  .8541934         0  .8541934  .8541934
      Western |        23   .880883         0   .880883   .880883
--------------+--------------------------------------------------
        Total |       127   .823569  .0627901  .7333384   .885439
-----------------------------------------------------------------
variable spdomain does not uniquely identify observations in the master data

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          1        0.78        0.78
          3 |        127       99.22      100.00
------------+-----------------------------------
      Total |        128      100.00
(1 missing value generated)
(127 real changes made)
(120 real changes made)
(128 real changes made)

Summary for variables: chkcal
     by categories of: spdomain (Spatial domains: each with own poverty line (they are 5))

     spdomain |         N      mean        sd       min       max
--------------+--------------------------------------------------
Central Urban |        25 -.0001221         0 -.0001221 -.0001221
Central Rural |        26  .0000257         0  .0000257  .0000257
      Eastern |        27 -.0000257         0 -.0000257 -.0000257
     Northern |        26  .0000321         0  .0000321  .0000321
      Western |        23  .0000578         0  .0000578  .0000578
--------------+--------------------------------------------------
        Total |       127 -7.18e-06  .0000633 -.0001221  .0000578
-----------------------------------------------------------------
(1 missing value generated)
(127 real changes made)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex_it5.dta saved
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povline_food_flex_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(56 real changes made)
(3 missing values generated)
(note: file /tmp/St02337.000013 not found)
file /tmp/St02337.000013 saved
variable spdomain does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it5.dta saved
variable spdomain does not uniquely identify observations in the master data
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/povlines_it5.dta
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |      2,717      100.00      100.00
------------+-----------------------------------
      Total |      2,717      100.00
(225 missing values generated)
(225 missing values generated)
(2708 real changes made)
(9 missing values generated)
(2482 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
          cr |    2492  34690902.7    1990.349   5527.795          0   252488.6
      cr_it5 |    2492  34690902.7    1990.349   7546.638          0   383865.4
     linpob5 |    2714  37328356.8    722.7188   673.4224          0   2799.716
    linpobr5 |    2707    37257099    516.2853   .0000262   516.2853   516.2853
(2481 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(2256 real changes made)
(225 missing values generated)
(225 missing values generated)
(225 missing values generated)
(3 missing values generated)

      pweight: popwt
          VCE: linearized
  Single unit: missing
     Strata 1: strata
         SU 1: psu
        FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

--------------------------------------------------------------
             |             Linearized
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
     h_flex5 |   9.844081          .             .           .
    pg_flex5 |     3.8849          .             .           .
   spg_flex5 |   2.537552          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

            0: rural = 0
            1: rural = 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
           0 |   21.76924          .             .           .
           1 |   8.482435          .             .           .
-------------+------------------------------------------------
pg_flex5     |
           0 |   7.917295          .             .           .
           1 |   3.424471          .             .           .
-------------+------------------------------------------------
spg_flex5    |
           0 |    4.20663          .             .           .
           1 |   2.346973          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

      Kampala: strata = Kampala
    _subpop_2: strata = Other Urban
    _subpop_3: strata = Central rural
    _subpop_4: strata = East rural
    _subpop_5: strata = North rural
    _subpop_6: strata = West rural

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
     Kampala |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex5     |
     Kampala |          0  (omitted)
   _subpop_2 |   7.917295          .             .           .
   _subpop_3 |   7.899232          .             .           .
   _subpop_4 |   .8832051          .             .           .
   _subpop_5 |   .8445327          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex5    |
     Kampala |          0  (omitted)
   _subpop_2 |    4.20663          .             .           .
   _subpop_3 |   6.465383          .             .           .
   _subpop_4 |   .4059698          .             .           .
   _subpop_5 |   .3235425          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

         Over: strata rural
    _subpop_1: Kampala 1
    _subpop_2: Other Urban 0
    _subpop_3: Central rural 1
    _subpop_4: East rural 1
    _subpop_5: North rural 1
    _subpop_6: West rural 1

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   21.76924          .             .           .
   _subpop_3 |    13.1653          .             .           .
   _subpop_4 |   2.415916          .             .           .
   _subpop_5 |   4.372422          .             .           .
   _subpop_6 |   15.09143          .             .           .
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |          0  (omitted)
   _subpop_2 |   7.917295          .             .           .
   _subpop_3 |   7.899232          .             .           .
   _subpop_4 |   .8832051          .             .           .
   _subpop_5 |   .8445327          .             .           .
   _subpop_6 |    4.92927          .             .           .
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |          0  (omitted)
   _subpop_2 |    4.20663          .             .           .
   _subpop_3 |   6.465383          .             .           .
   _subpop_4 |   .4059698          .             .           .
   _subpop_5 |   .3235425          .             .           .
   _subpop_6 |   2.972345          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       6        Number of obs    =      2492
Number of PSUs   =     317        Population size  =  34690903
                                  Design df        =       311

    _subpop_1: spdomain = Central Urban
    _subpop_2: spdomain = Central Rural
      Eastern: spdomain = Eastern
     Northern: spdomain = Northern
      Western: spdomain = Western

--------------------------------------------------------------
             |             Linearized
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
h_flex5      |
   _subpop_1 |    51.4747          .             .           .
   _subpop_2 |   13.09757          .             .           .
     Eastern |   2.401441          .             .           .
    Northern |   3.936353          .             .           .
     Western |   14.42713          .             .           .
-------------+------------------------------------------------
pg_flex5     |
   _subpop_1 |   19.23469          .             .           .
   _subpop_2 |   7.858594          .             .           .
     Eastern |   .8445229          .             .           .
    Northern |    .760306          .             .           .
     Western |    4.68138          .             .           .
-------------+------------------------------------------------
spg_flex5    |
   _subpop_1 |   10.28266          .             .           .
   _subpop_2 |   6.432122          .             .           .
     Eastern |   .3878616          .             .           .
    Northern |   .2912751          .             .           .
     Western |   2.807814          .             .           .
--------------------------------------------------------------
Note: missing standard errors because of stratum with single
      sampling unit.
rural was float now byte
spdomain was float now byte
news was float now byte
h_flex5 was float now byte
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/cons_real_it5.dta saved

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     h_flex5 |    2492  34690902.7    9.844081   29.79695          0        100
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/foodshares_it5.dta saved

. **************************************************************************
> * Send results to one big csv-file
> **************************************************************************;
. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         gen dum=1;

.         collapse (mean) dum h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt];

. gen geo="National";

. gen geono=dum;

. tempfile nat;

. save `nat';
file /tmp/St02337.000014 saved

.         use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by(rural);

. gen geo="Rural/Urban";

. gen geono=rural;

. tempfile rur;

. save `rur';
file /tmp/St02337.000015 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by(news);

. gen geo="North/Center/South";

. gen geono=news;
(1 missing value generated)

. tempfile new;

. save `new';
file /tmp/St02337.000016 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by(reg_tpi);

. gen geo="TPI - 6 regions";

. gen geono=reg_tpi;

. tempfile rtp;

. save `rtp';
file /tmp/St02337.000017 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by(strata);

. gen geo="Provinces";

. gen geono=strata;

. tempfile str;

. save `str';
file /tmp/St02337.000018 saved

. use "$path/work/cons_real_it`lastpass'.dta", clear ;

.         collapse (mean) h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' [aw=popwt], by(spdomain);

. gen geo="Spatial domains";

. gen geono=spdomain;
(1 missing value generated)

. tempfile r13;

. save `r13';
file /tmp/St02337.000019 saved

. clear;

. set obs 1;
obs was 0, now 1

. gen geo=" ";

. tempfile one;

. save `one';
file /tmp/St02337.00001a saved

. use          `nat';

. append using `one';

. append using `rur';
geo was str8 now str11

. append using `one';

. append using `new';
geo was str11 now str18

. append using `one';

. append using `rtp';

. append using `one';

. append using `str';

. append using `one';

. append using `r13';

. outsheet geo geono h_flex`lastpass' pg_flex`lastpass' spg_flex`lastpass' dum rural news reg_tpi strata spdomain using "$
> path/work/poverty_flexBask.csv", replace c;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/poverty_flexBask.csv not found)

. **************************************************************************
> * Convergence graph (based on 5 iterations)
> **************************************************************************;
. #delimit cr
delimiter now cr
. 
. clear

. set obs 1
obs was 0, now 1

. gen iteration=.
(1 missing value generated)

. tempfile converg

. save `converg'
file /tmp/St02337.00001b saved

. 
. forvalues X = 1/`maxit' {
  2.         use "$path/work/cons_real_it`X'.dta", clear
  3.         collapse (mean) h_flex`X' pg_flex`X' spg_flex`X' [aw=popwt], by(strata)
  4.         rename h_flex`X' h_flex
  5.         rename pg_flex`X' pg_flex
  6.         rename spg_flex`X' spg_flex
  7.         gen iteration=`X'
  8.         order iteration
  9.         *sum
.         if `X' != 1     {
 10.                 append using `converg'
 11.                         }
 12.         save `converg', replace
 13.         }
file /tmp/St02337.00001b saved
(label strat already defined)
file /tmp/St02337.00001b saved
(label strat already defined)
file /tmp/St02337.00001b saved
(label strat already defined)
file /tmp/St02337.00001b saved
(label strat already defined)
file /tmp/St02337.00001b saved

. 
. use `converg', clear

. sum

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   iteration |        30           3     1.43839          1          5
      strata |        30         3.5    1.737021          1          6
      h_flex |        30    9.655081    7.922925          0   21.76924
     pg_flex |        30    3.771762    3.351773          0   7.918424
    spg_flex |        30    2.398923    2.412449          0   6.475885

. 
. twoway (connected h_flex iteration), by(, title(Convergence graph: Poverty rate. %) subtitle(After iterative procedure))
>  by(strata)

. graph export "$path/work/converge_pov_rate.tif", replace
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/converge_pov_rate.tif not found)
(file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/converge_pov_rate.tif written in TIFF format)

. 
. sort strata iteration

. 
. for var h_flex pg_flex spg_flex: replace X = round(X,0.01)

->  replace h_flex = round(h_flex,0.01)
(25 real changes made)

->  replace pg_flex = round(pg_flex,0.01)
(25 real changes made)

->  replace spg_flex = round(spg_flex,0.01)
(25 real changes made)

. 
. list strata iteration h_flex pg_flex spg_flex

     +--------------------------------------------------------+
     |        strata   iterat~n   h_flex   pg_flex   spg_flex |
     |--------------------------------------------------------|
  1. |       Kampala          1        0         0          0 |
  2. |       Kampala          2        0         0          0 |
  3. |       Kampala          3        0         0          0 |
  4. |       Kampala          4        0         0          0 |
  5. |       Kampala          5        0         0          0 |
     |--------------------------------------------------------|
  6. |   Other Urban          1    20.42      7.15       3.75 |
  7. |   Other Urban          2    21.77       7.8       4.14 |
  8. |   Other Urban          3    21.77      7.92       4.21 |
  9. |   Other Urban          4    21.77      7.92       4.21 |
 10. |   Other Urban          5    21.77      7.92       4.21 |
     |--------------------------------------------------------|
 11. | Central rural          1    13.17      7.92       6.48 |
 12. | Central rural          2    13.17      7.92       6.48 |
 13. | Central rural          3    13.17       7.9       6.47 |
 14. | Central rural          4    13.17      7.92       6.48 |
 15. | Central rural          5    13.17       7.9       6.47 |
     |--------------------------------------------------------|
 16. |    East rural          1        3       .94        .44 |
 17. |    East rural          2     2.42       .88         .4 |
 18. |    East rural          3     2.42       .88        .41 |
 19. |    East rural          4     2.42       .88        .41 |
 20. |    East rural          5     2.42       .88        .41 |
     |--------------------------------------------------------|
 21. |   North rural          1     6.39      1.51        .55 |
 22. |   North rural          2     4.37       .86        .33 |
 23. |   North rural          3     4.37       .87        .33 |
 24. |   North rural          4     4.37       .87        .33 |
 25. |   North rural          5     4.37       .84        .32 |
     |--------------------------------------------------------|
 26. |    West rural          1    19.43      5.76       3.28 |
 27. |    West rural          2    15.09      4.93       2.97 |
 28. |    West rural          3    15.09      4.93       2.97 |
 29. |    West rural          4    15.09      4.93       2.97 |
 30. |    West rural          5    15.09      4.93       2.97 |
     +--------------------------------------------------------+

.         
. #delimit ;
delimiter now ;
. **************************************************************************
> * 140_iterate.do        (end)
> **************************************************************************;
. cap log close;

. 
end of do-file

.  "$path/new/170_pref_r_price_bjorn.do"
unrecognized command:  "/home/bjvca/data/data/GAP/Harun invalid command name
r(199);

. do "$path/new/170_pref_r_price_bjorn.do"

. *global path "C:/user/gapp"
. clear all

. set mem 999m

. 
. cap log close

. log using "$path/rep/170_pref_r_price.log", replace
--------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/170_pref_r_price.log
  log type:  text
 opened on:   8 Jul 2013, 20:18:46

. clear

. set more off

. #delimit ;
delimiter now ;
. **************************************************************************
> * 170_pref_r_price.do           (start)
> *
> * This file conducts revealed preference comparisons so that
> * we can check the quality of the regional baskets.
> * It also exports the price and quantity data for work in GAMS
> * Rather than make up for missing prices with shares, we estimate
> * a missing price in this case
> **************************************************************************;
. *global n_spdom "13";
. *global it_n "5";
. /*
> This file uses:
>         work/quan_flex_it$it_n.dta
>         work/povline_food_flex_it$it_n.dta
>         work/price_unit_flex_it$it_n.dta
>                 
> This file creates:
>         work/pref_r_price.dta
>         work/revpref_price_`i'.dta
>         work/product_flex.inc
>         work/price_unit_flex.inc
>         work/quan_flex.inc
> */
> 
> 
> 
> ***************************************************************************;
. * Export price, codes and quantity data to text
> ***************************************************************************;
. use "$path/work/price_unit_flex_it$it_n.dta";
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

. gen reg=spdomain ;

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. outsheet product crap reg bswt price_uw$it_n using "$path/work/price_unit_flex.inc",  noquote noname replace ;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/price_unit_flex.inc not found)

. collapse (min) spdomain, by(product);

. outsheet product  using "$path/work/product_flex.inc", noname replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/product_flex.inc not found)

. use "$path/work/quan_flex_it$it_n.dta", clear;

. gen reg=spdomain;
(1 missing value generated)

. gen crap=1;

.  lab def crap
>          1  ".";

.  lab val crap crap;

. format calperg quan$it_n calpp %14.9e;

. outsheet  product crap reg calperg quan$it_n  calpp povline_f_flex90_$it_n using "$path/work/quan_flex.inc", noname noqu
> ote replace;
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/quan_flex.inc not found)

. clear;

. **************************************************************************;
. * Revealed preference calculations
> * get the basket for the region we want to test
> **************************************************************************;
. tempfile quanreg;

. tempfile getmiss;

. tempfile codmiss;

. gen crap=0;

. save "$path/work/pref_r_price.dta", replace;
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved

. forvalues i=1/$n_spdom {                ;
  2.         clear;
  3.         gen crap=0;
  4.         save "$path/work/revpref_price_`i'.dta", replace;
  5.         clear;
  6.                 use "$path/work/quan_flex_it$it_n.dta", clear;
  7.                 keep product spdomain quan$it_n price_uw$it_n val_ir$it_n povline_f_flex90_$it_n calpp;
  8.         gen share=val_ir$it_n/povline_f_flex90_$it_n;
  9.         rename price_uw$it_n pquanreg;
 10.         rename spdomain spdomainq;
 11.         drop if spdomainq~= `i';
 12.         sort product;
 13.                                 *rescale quantities to hit constant calorie target;
.                 gen ratquan=2150/calpp;
 14.             gen quan_s=quan$it_n*ratquan;
 15.             lab var quan_s "quantities rescaled to hit 2150 calories pp";
 16.         save `quanreg', replace;
 17. **************************************************************************;
. * Now get the prices in other regions so that you can use them 
> * to build  a new poverty line
> **************************************************************************;
.         forvalues j= 1/$n_spdom {               ;
 18.                 use "$path/work/price_unit_flex_it$it_n.dta";
 19.                                 keep product spdomain price_uw$it_n descript count bswt;
 20.                         sort product;
 21.                 keep if spdomain==`j';
 22.                 sort product;
 23.                 merge product using `quanreg';
 24.                     *here we have to deal with the fact that not all commodities are consumed in every region;
.                 *so we might have a quantity from region i but no price in region j;
.                 *these will have _merge value=2;
.                 *alternatively the number of observations might be too small;
.                 *deal with these problems by TAKING THE MAX PRICE OBSERVED ELSEWHERE (excluding Maputo)
>                         
>                 tab _m;
.                 drop if _m==1;
 25.                                 *CA modified to handle the counting of bswt instead of count
>                   replace price_uw$it_n=. if round(bswt)<5;
.                         gen pricemiss=0;
 26.                   replace spdomain=`j' if _m==2 ;
 27.                   replace pricemiss=1 if _m==2 | round(bswt)<5;
 28.                         lab var pricemiss "identify those items with no price observation";
 29.                   drop _m;
 30.                         sort product;
 31. *browse;
.                *this is the tempfile containing observed quans and prices;
.              save `getmiss', replace;
 32.                         keep if pricemiss==1;
 33.                         if _N>0 {
>                             keep product;
 34.                                             sort product;
 35.                                             *this file contains the price codes that are missing for the region in qu
> estion;
.                             save `codmiss', replace;
 36. *browse;
.                                   use "$path/work/price_unit_flex_it$it_n.dta", clear;
 37.                         sort product;
 38. *browse;
.                         merge product using `codmiss';
 39.                                                 tab _m;
 40.                         keep if _m==3 ;
 41.                                 *exclude Maputo province and city from other price calculation;
.                                 drop if spdomain>10;
 42.                         collapse (max) price_uw$it_n, by(product);
 43.                   *this file contains the code and the max price;
.                   save `codmiss', replace;
 44. *browse;
.                         use `getmiss';
 45.                               merge product using `codmiss';
 46. *browse;
.                         tab _m;
 47.                         drop _m;
 48.                         *end if;
.                  };
 49.                                                             else use `getmiss', clear;
 50.                         gen val_q=quan_s*price_uw$it_n;
 51.                                                 collapse (sum) val_q pricemiss (mean) spdomainq ratquan, by(spdomain)
> ;
 52.                   gen linf_q=val_q/.9;
 53.                   drop val_q;
 54.                         append using "$path/work/revpref_price_`i'.dta";
 55.                         sort spdomain;
 56.                 save "$path/work/revpref_price_`i'.dta", replace;
 57.    *browse;
.         *close j loop;
.         };
 58.         *aggregate into a big data set;
.         append using "$path/work/pref_r_price.dta";
 59.       sort spdomain spdomainq;
 60.       save "$path/work/pref_r_price.dta", replace;
 61.  *close i loop;
. };
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
(1 missing value generated)
(103 observations deleted)
(note: file /tmp/St02337.000001 not found)
file /tmp/St02337.000001 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(19 observations deleted)
(0 real changes made)
(0 real changes made)
(note: file /tmp/St02337.000002 not found)
file /tmp/St02337.000002 saved
(25 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(25 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(3 real changes made)
file /tmp/St02337.000002 saved
(22 observations deleted)
(note: file /tmp/St02337.000003 not found)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        202       93.09       93.09
          3 |         15        6.91      100.00
------------+-----------------------------------
      Total |        217      100.00
(202 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       88.00       88.00
          3 |          3       12.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(3 real changes made)
file /tmp/St02337.000002 saved
(22 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        202       93.09       93.09
          3 |         15        6.91      100.00
------------+-----------------------------------
      Total |        217      100.00
(202 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       88.00       88.00
          3 |          3       12.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(19 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02337.000002 saved
(23 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        207       95.39       95.39
          3 |         10        4.61      100.00
------------+-----------------------------------
      Total |        217      100.00
(207 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23       92.00       92.00
          3 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_1.dta saved
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(1 missing value generated)
(102 observations deleted)
file /tmp/St02337.000001 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02337.000002 saved
(24 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        207       95.39       95.39
          3 |         10        4.61      100.00
------------+-----------------------------------
      Total |        217      100.00
(207 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       92.31       92.31
          3 |          2        7.69      100.00
------------+-----------------------------------
      Total |         26      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_2.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(1 missing value generated)
(101 observations deleted)
file /tmp/St02337.000001 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(3 real changes made)
file /tmp/St02337.000002 saved
(24 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        203       93.55       93.55
          3 |         14        6.45      100.00
------------+-----------------------------------
      Total |        217      100.00
(203 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       88.89       88.89
          3 |          3       11.11      100.00
------------+-----------------------------------
      Total |         27      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(1 real change made)
(1 real change made)
file /tmp/St02337.000002 saved
(26 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        213       98.16       98.16
          3 |          4        1.84      100.00
------------+-----------------------------------
      Total |        217      100.00
(213 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(1 missing value generated)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(16 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(27 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(16 observations deleted)
(0 real changes made)
(1 real change made)
file /tmp/St02337.000002 saved
(26 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        212       97.70       97.70
          3 |          5        2.30      100.00
------------+-----------------------------------
      Total |        217      100.00
(212 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         26       96.30       96.30
          3 |          1        3.70      100.00
------------+-----------------------------------
      Total |         27      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(27 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_3.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(1 missing value generated)
(102 observations deleted)
file /tmp/St02337.000001 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(4 real changes made)
file /tmp/St02337.000002 saved
(22 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        198       91.24       91.24
          3 |         19        8.76      100.00
------------+-----------------------------------
      Total |        217      100.00
(198 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       84.62       84.62
          3 |          4       15.38      100.00
------------+-----------------------------------
      Total |         26      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(1 real change made)
(2 real changes made)
file /tmp/St02337.000002 saved
(24 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       95.85       95.85
          3 |          9        4.15      100.00
------------+-----------------------------------
      Total |        217      100.00
(208 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       92.31       92.31
          3 |          2        7.69      100.00
------------+-----------------------------------
      Total |         26      100.00
(1 missing value generated)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(17 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(26 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(18 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02337.000002 saved
(24 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        207       95.39       95.39
          3 |         10        4.61      100.00
------------+-----------------------------------
      Total |        217      100.00
(207 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24       92.31       92.31
          3 |          2        7.69      100.00
------------+-----------------------------------
      Total |         26      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_4.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved
(note: dataset contains 0 observations)
(note: file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta not found)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(1 missing value generated)
(105 observations deleted)
file /tmp/St02337.000001 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(21 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02337.000002 saved
(21 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        208       95.85       95.85
          3 |          9        4.15      100.00
------------+-----------------------------------
      Total |        217      100.00
(208 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(21 observations deleted)
(1 real change made)
(1 real change made)
file /tmp/St02337.000002 saved
(22 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        213       98.16       98.16
          3 |          4        1.84      100.00
------------+-----------------------------------
      Total |        217      100.00
(213 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         22       95.65       95.65
          3 |          1        4.35      100.00
------------+-----------------------------------
      Total |         23      100.00
(1 missing value generated)
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(20 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(23 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(174 observations deleted)
(label lspdomain already defined)
(20 observations deleted)
(0 real changes made)
(2 real changes made)
file /tmp/St02337.000002 saved
(21 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
variable product does not uniquely identify observations in the master data
(label lspdomain already defined)

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        207       95.39       95.39
          3 |         10        4.61      100.00
------------+-----------------------------------
      Total |        217      100.00
(207 observations deleted)
(0 observations deleted)
file /tmp/St02337.000003 saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       91.30       91.30
          3 |          2        8.70      100.00
------------+-----------------------------------
      Total |         23      100.00
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(173 observations deleted)
(label lspdomain already defined)
(21 observations deleted)
(0 real changes made)
(0 real changes made)
file /tmp/St02337.000002 saved
(23 observations deleted)
(HH food cons. (1 rec per item cons. cat A& B per HH; Cat B: only T6SQ1 + T6AEQ3))
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/revpref_price_5.dta saved
(label lspdomain already defined)
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved

. *bring in actual flexible bundle numbers;
. use "$path/work/povline_food_flex_it$it_n.dta", clear;

.         merge spdomain using "$path/work/pref_r_price.dta";
variable spdomain does not uniquely identify observations in
    /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta
(label lspdomain already defined)

.         tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        3.85        3.85
          3 |         25       96.15      100.00
------------+-----------------------------------
      Total |         26      100.00

.          drop crap;

.         drop _m;

.         order spdomainq spdomain;

.       sort spdomainq spdomain;

.         *rescale expenditures to hit a constant calorie target;
.         gen povline_f5_s=ratquan*povline_f_flex90_$it_n;
(1 missing value generated)

.       compress;
spdomainq was float now byte
spdomain was float now byte
pricemiss was double now byte

. *browse;
.         *categorize revealed preference performance;
.       gen pref_r=0;

.       replace pref_r=1 if float(linf_q)>float(povline_f5_s);
(12 real changes made)

.       replace pref_r=2 if float(linf_q)<float(povline_f5_s);
(9 real changes made)

.       lab var pref_r "Fails or passes revealed preference test";

.       lab def pref_r
>                         0 "comparison of the same region with itself"
>                         1 "passes revealed preference test"
>                         2 "fails revealed preference test" ;

.         lab val pref_r pref_r;

.       drop if spdomainq==spdomain;
(6 observations deleted)

.         tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         11       55.00       55.00
         fails revealed preference test |          9       45.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

.              sort spdomainq ;

.       by spdomainq: tab pref_r;

--------------------------------------------------------------------------------------------------------------------------
-> spdomainq = 1

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
         fails revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomainq = 2

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          3       75.00       75.00
         fails revealed preference test |          1       25.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomainq = 3

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          2       50.00       50.00
         fails revealed preference test |          2       50.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomainq = 4

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          2       50.00       50.00
         fails revealed preference test |          2       50.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00

--------------------------------------------------------------------------------------------------------------------------
-> spdomainq = 5

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          4      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |          4      100.00


. save "$path/work/pref_r_price.dta", replace;
file /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//work/pref_r_price.dta saved

. *drop comparisons with Maputo ;
. drop if spdomain>=11;
(0 observations deleted)

. drop if spdomainq>=11;
(0 observations deleted)

. display "this is with maputo dropped";
this is with maputo dropped

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |         11       55.00       55.00
         fails revealed preference test |          9       45.00      100.00
----------------------------------------+-----------------------------------
                                  Total |         20      100.00

. *further drop Nampula rural and urban;
. drop if spdomain==3 | spdomain==4;
(8 observations deleted)

. display "this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 spatial domains)";
this is with maputo and nampula dropped (MAH: Actually not - experimenting with 6 spatial domains)

. tab pref_r;

    Fails or passes revealed preference |
                                   test |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
        passes revealed preference test |          5       41.67       41.67
         fails revealed preference test |          7       58.33      100.00
----------------------------------------+-----------------------------------
                                  Total |         12      100.00

. **************************************************************************
> * 170_pref_r_price.do           (end)
> **************************************************************************;
. log close;
      name:  <unnamed>
       log:  /home/bjvca/data/data/GAP/Haruna/UNPS_2011/GAPP3//rep/170_pref_r_price.log
  log type:  text
 closed on:   8 Jul 2013, 20:18:47
--------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. exit, clear
